<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="BackgroundThe business team needs to conduct a year-end drill, primarily using faketime to simulate specific future time points. During the drill, we encountered an abnormal CPU spike, which eventuall">
<meta property="og:type" content="article">
<meta property="og:title" content="The Mystery Behind JDK 21 faketime Exercise Overloading CPU">
<meta property="og:url" content="https://zoues.com/posts/319cc956/index.html">
<meta property="og:site_name" content="zouyee">
<meta property="og:description" content="BackgroundThe business team needs to conduct a year-end drill, primarily using faketime to simulate specific future time points. During the drill, we encountered an abnormal CPU spike, which eventuall">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pic1.imgdb.cn/item/6794787cd0e0a243d4f7ba2f.png">
<meta property="og:image" content="https://pic1.imgdb.cn/item/6794787dd0e0a243d4f7ba30.png">
<meta property="article:published_time" content="2025-01-25T12:00:43.000Z">
<meta property="article:modified_time" content="2025-01-25T12:15:55.042Z">
<meta property="article:author" content="zouyee">
<meta property="article:tag" content="misc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic1.imgdb.cn/item/6794787cd0e0a243d4f7ba2f.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>The Mystery Behind JDK 21 faketime Exercise Overloading CPU</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="zouyee" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.1.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/zouyee">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/posts/819cc60d/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://zoues.com/posts/319cc956/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://zoues.com/posts/319cc956/&text=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://zoues.com/posts/319cc956/&title=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://zoues.com/posts/319cc956/&is_video=false&description=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=The Mystery Behind JDK 21 faketime Exercise Overloading CPU&body=Check out this article: https://zoues.com/posts/319cc956/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://zoues.com/posts/319cc956/&title=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://zoues.com/posts/319cc956/&title=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://zoues.com/posts/319cc956/&title=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://zoues.com/posts/319cc956/&title=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://zoues.com/posts/319cc956/&name=The Mystery Behind JDK 21 faketime Exercise Overloading CPU&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://zoues.com/posts/319cc956/&t=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Background"><span class="toc-number">1.</span> <span class="toc-text">Background</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Technical-Background"><span class="toc-number">1.1.</span> <span class="toc-text">Technical Background</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Introduction-to-LD-PRELOAD"><span class="toc-number">1.1.1.</span> <span class="toc-text">Introduction to LD_PRELOAD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Usage"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">Usage</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Introduction-to-faketime"><span class="toc-number">1.1.2.</span> <span class="toc-text">Introduction to faketime</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-faketime-Configuration-Methods"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">1. faketime Configuration Methods</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-How-It-Works"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">2. How It Works</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Installation-and-Usage"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">3. Installation and Usage</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tracing-the-Root-Cause"><span class="toc-number">1.1.3.</span> <span class="toc-text">Tracing the Root Cause</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Identifying-the-JVM-Clock"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">1. Identifying the JVM Clock</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Analyzing-the-Blocking-Point"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">2. Analyzing the Blocking Point</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Root-Cause-Analysis"><span class="toc-number">1.1.4.</span> <span class="toc-text">3. Root Cause Analysis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Faketime%E2%80%99s-Behavior"><span class="toc-number">1.1.5.</span> <span class="toc-text">Faketime’s Behavior</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">1.2.</span> <span class="toc-text">Reference</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        The Mystery Behind JDK 21 faketime Exercise Overloading CPU
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">zouyee</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-01-25T12:00:43.000Z" class="dt-published" itemprop="datePublished">2025-01-25</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/misc/" rel="tag">misc</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><p>The business team needs to conduct a year-end drill, primarily using faketime to simulate specific future time points. During the drill, we encountered an abnormal CPU spike, which eventually maxed out the CPU quota and triggered a CPU throttle phenomenon.</p>
<p><img src="https://pic1.imgdb.cn/item/6794787cd0e0a243d4f7ba2f.png"></p>
<p>The above CPU maxing out phenomenon can be consistently reproduced in JDK 21 (with the container image being AlmaLinux 9).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        java.util.Date now = new java.util.Date();</span><br><span class="line">        System.out.println(&quot;time:&quot; + now);</span><br><span class="line"></span><br><span class="line">        for (int k = 0; k &lt; 10; k++) &#123;</span><br><span class="line">            Thread t = new Thread(() -&gt; &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(1000);</span><br><span class="line">                &#125; catch (InterruptedException ignore) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            t.setDaemon(false);</span><br><span class="line">            t.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Through the custom script <code>/opt/tomcat/bin/extraenv.sh</code> in the Tomcat environment, which is used to set additional environment variables or run custom initialization logic, the faketime (0.9.10) related configuration is as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt;/opt/tomcat/bin/extraenv.sh &lt;&lt;EOF</span><br><span class="line"></span><br><span class="line">export LD_PRELOAD=/usr/lib64/faketime/libfaketime.so.1</span><br><span class="line">export FAKETIME=&quot;$&#123;FAKETIME&#125;&quot;</span><br><span class="line">export DONT_FAKE_MONOTONIC=1</span><br><span class="line">EOF</span><br><span class="line">fi</span><br><span class="line">supervisorctl restart tomcat</span><br></pre></td></tr></table></figure>





<h2 id="Technical-Background"><a href="#Technical-Background" class="headerlink" title="Technical Background"></a>Technical Background</h2><h3 id="Introduction-to-LD-PRELOAD"><a href="#Introduction-to-LD-PRELOAD" class="headerlink" title="Introduction to LD_PRELOAD"></a>Introduction to LD_PRELOAD</h3><ul>
<li><p>When a dynamically linked program is started, it doesn’t have all the required function code. So, what happens?</p>
<ol>
<li>The program is loaded into memory.</li>
<li>The dynamic linker identifies any other libraries (e.g., <code>.so</code> files) needed for the program to run.</li>
<li>It loads these libraries into memory as well.</li>
<li>Then, everything is linked together.</li>
</ol>
<p><code>LD_PRELOAD</code> is a system environment variable used to force the loading of custom shared libraries when running a program. It is part of the dynamic linking functionality in the Linux environment, allowing the dynamic manipulation of shared library loading behavior during program execution.</p>
<p>When a program runs, it loads the required shared libraries (such as the standard C library <code>libc</code>). <code>LD_PRELOAD</code> allows the user to prioritize loading a custom shared library before the program loads its normally required libraries. This enables the user to replace certain functions with custom implementations or modify the program’s behavior without changing the program’s source code. The following are some main use cases:</p>
<p>a. Function Interception and Overriding</p>
<ul>
<li><p>By creating a shared library, certain system calls or functions (e.g., <code>malloc()</code>, <code>open()</code>) can be overridden.</p>
</li>
<li><p>During the program’s execution, the custom implementation is forced to take priority, modifying the program’s behavior.</p>
<p>b. Performance Debugging</p>
</li>
<li><p>Intercept memory allocation functions (e.g., <code>malloc</code>, <code>free</code>) to detect memory leaks.</p>
</li>
<li><p>Record function calls and parameters to help debug program execution.</p>
<p>c. Compatibility Fixes</p>
</li>
<li><p>If the running program relies on outdated libraries or functions, <code>LD_PRELOAD</code> can dynamically provide compatible implementations without modifying the system environment.</p>
<p>d. Time Faking</p>
</li>
<li><p>Tools like <code>faketime</code> use <code>LD_PRELOAD</code> to inject a library that fakes the system time perceived by the program.</p>
<p>e. Security Testing</p>
</li>
<li><p>Intercept and examine sensitive operations like file access or network calls, simulating security attack scenarios or protecting specific resources.</p>
</li>
</ul>
</li>
</ul>
<h4 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=/PATH/DEST.so &lt;<span class="built_in">command</span>&gt;</span><br></pre></td></tr></table></figure>

<p>   Below are examples of three main scenarios:</p>
<p>a. Intercepting and Modifying System Calls<br> Suppose we have a custom library <code>myopen.so</code> that overrides the <code>open()</code> function to log file accesses:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">open</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> flags, ...)</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;File opened: %s\n&quot;</span>, pathname);</span><br><span class="line">    <span class="keyword">return</span> open(pathname, flags);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Compile into a shared library:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -fPIC -o myopen.so myopen.c -ldl</span><br></pre></td></tr></table></figure>

<p>Load it using <code>LD_PRELOAD</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=./myopen.so <span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<p>The output will log all file access.</p>
<p>b. Simulating Memory Allocation Issues</p>
<p>Use <code>libmalloc.so</code> to detect memory allocation function calls (e.g., the number of <code>malloc</code> and <code>free</code> calls):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=/usr/lib/libmalloc.so my_program</span><br></pre></td></tr></table></figure>

<p>  c. Fixing Compatibility Issues</p>
<p>If a program requires an older version of <code>libc.so</code>, you can use:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=/path/to/old_libc.so my_program</span><br></pre></td></tr></table></figure>

<p>Key Points to Note When Using <code>LD_PRELOAD</code>:</p>
<p>a. <strong>Priority</strong></p>
<ul>
<li>Libraries specified by <code>LD_PRELOAD</code> are loaded first and override the system’s default libraries, but this only applies to dynamically linked programs. Statically linked programs are not affected.</li>
</ul>
<p>b. <strong>Permission Restrictions</strong></p>
<ul>
<li>For security reasons, <code>LD_PRELOAD</code> is typically ignored in <code>setuid</code> or <code>setgid</code> programs to prevent malicious library injection.</li>
</ul>
<p>c. <strong>Scope of Impact</strong></p>
<ul>
<li>It only affects the current terminal session or processes explicitly using <code>LD_PRELOAD</code> and does not alter the global environment.</li>
</ul>
<p>d. <strong>Debugging Complexity</strong></p>
<ul>
<li>Overriding core system functions with <code>LD_PRELOAD</code> may introduce unintended behavior, making debugging more challenging.</li>
</ul>
<h3 id="Introduction-to-faketime"><a href="#Introduction-to-faketime" class="headerlink" title="Introduction to faketime"></a>Introduction to faketime</h3><p><code>libfaketime</code> is a shared library that works alongside the <code>faketime</code> tool. By using the <code>LD_PRELOAD</code> environment variable, it ensures that <code>libfaketime.so.1</code> is loaded before other libraries when a program starts. It replaces the original time-related logic provided by <code>libc</code> with its custom logic, enabling programs to perceive a specific absolute or relative date and time without affecting the system-wide clock.</p>
<h4 id="1-faketime-Configuration-Methods"><a href="#1-faketime-Configuration-Methods" class="headerlink" title="1. faketime Configuration Methods"></a>1. faketime Configuration Methods</h4><p><code>libfaketime</code> supports five ways to provide fake time:</p>
<p>a. Setting the <code>FAKETIME</code> environment variable.<br> b. Using a file specified by the <code>FAKETIME_TIMESTAMP_FILE</code> environment variable.<br> c. Using a <code>.faketimerc</code> file in the user’s home directory.<br> d. Using the system-level <code>/etc/faketimerc</code> file.<br> e. Setting the <code>FAKETIME_UPDATE_TIMESTAMP_FILE</code> environment variable and executing the <code>date -s &quot;&quot;</code> command.</p>
<p>When using options b, c, or d, you can modify the file’s content to define the time rules.<br> The behavior is controlled by:</p>
<ul>
<li>The <code>FAKETIME_CACHE_DURATION</code> environment variable, which defines the cache duration to enable hot updates.</li>
<li>The <code>FAKETIME_NO_CACHE=1</code> environment variable to disable caching for real-time fetching.</li>
<li>Default cache duration of 10 seconds if no environment variable is set.</li>
</ul>
<h4 id="2-How-It-Works"><a href="#2-How-It-Works" class="headerlink" title="2. How It Works"></a>2. How It Works</h4><p><code>libfaketime</code> intercepts common system calls for time, such as:</p>
<ul>
<li><code>time()</code></li>
<li><code>gettimeofday()</code></li>
<li><code>clock_gettime()</code></li>
</ul>
<p>By injecting its implementation, it returns a faked time value instead of the actual system time. This approach only works for dynamically linked programs, as statically linked ones remain unaffected. Key features of faketime include:</p>
<p>a. <strong>Fixed Time</strong><br> Programs perceive a specific fixed time, such as simulating January 1, 2025.</p>
<p>b. <strong>Time Offset</strong><br> Add or subtract a time offset based on the current time, e.g., advancing one day or delaying one hour.</p>
<p>c. <strong>Time Acceleration or Deceleration</strong><br> Simulate faster or slower time progression, such as doubling the speed of time (time acceleration) or slowing it down (time deceleration).</p>
<p>d. <strong>Dynamic Time Adjustment</strong><br> Supports adjusting time rules dynamically via files or environment variables to meet flexible testing needs.</p>
<hr>
<h4 id="3-Installation-and-Usage"><a href="#3-Installation-and-Usage" class="headerlink" title="3. Installation and Usage"></a>3. Installation and Usage</h4><p><code>libfaketime</code> can usually be installed through the system’s package manager:</p>
<ul>
<li><p>On Debian-based systems:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libfaketime</span><br></pre></td></tr></table></figure>
</li>
<li><p>On RHEL-based systems:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install libfaketime</span><br></pre></td></tr></table></figure></li>
</ul>
<p>To inject <code>libfaketime</code> into a target program, use <code>LD_PRELOAD</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=/usr/lib/libfaketime.so.1 FAKETIME=<span class="string">&quot;&lt;fake time&gt;&quot;</span> &lt;<span class="built_in">command</span>&gt;</span><br></pre></td></tr></table></figure>

<p>Common Scenarios:</p>
<p>a. <strong>Fixed Time Point</strong><br> Simulate a fixed time, such as January 1, 2025:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=/usr/lib/libfaketime.so.1 FAKETIME=<span class="string">&quot;2025-01-01 00:00:00&quot;</span> <span class="built_in">date</span></span><br></pre></td></tr></table></figure>

<p>Output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Wed Jan  1 00:00:00 UTC 2025</span><br></pre></td></tr></table></figure>

<p>b. <strong>Time Offset</strong><br> Shift time forward or backward by one day:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=/usr/lib/libfaketime.so.1 FAKETIME=<span class="string">&quot;+1d&quot;</span> <span class="built_in">date</span></span><br></pre></td></tr></table></figure>

<p>or:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=/usr/lib/libfaketime.so.1 FAKETIME=<span class="string">&quot;-1d&quot;</span> <span class="built_in">date</span></span><br></pre></td></tr></table></figure>

<p>c. <strong>Time Acceleration</strong><br> Simulate time passing faster, such as making one second equal to two seconds:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=/usr/lib/libfaketime.so.1 FAKETIME=<span class="string">&quot;@2x&quot;</span> <span class="built_in">sleep</span> 5</span><br></pre></td></tr></table></figure>

<p>A task that normally takes 5 seconds might now complete in 2.5 seconds.</p>
<p>d. <strong>Dynamic Time Adjustment</strong><br> Configure time manipulation rules via a file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=/usr/lib/libfaketime.so.1 FAKETIME=<span class="string">&quot;@&quot;</span> ./my_program</span><br></pre></td></tr></table></figure>

<p>The time rules can be dynamically adjusted using configuration files like <code>/etc/faketimerc</code>.</p>
<p>Important Considerations:</p>
<p>a. <strong>Affects Only Dynamically Linked Programs</strong><br> Statically linked programs, such as those written in <strong>Golang</strong>, use direct system calls and are not intercepted by <code>libfaketime</code>.</p>
<p>b. <strong>Impact on Multi-threaded Programs</strong><br> Multi-threaded programs sensitive to time operations may experience concurrency issues when using <code>libfaketime</code>.</p>
<p>c. <strong>Environment Isolation</strong><br> Using <code>LD_PRELOAD</code> only affects the current terminal session or process and does not impact the global environment.</p>
<p>d. <strong>Security Concerns</strong><br> For security reasons, some sensitive programs (e.g., <code>setuid</code> programs) may ignore <code>LD_PRELOAD</code> to prevent malicious injection.</p>
<h3 id="Tracing-the-Root-Cause"><a href="#Tracing-the-Root-Cause" class="headerlink" title="Tracing the Root Cause"></a>Tracing the Root Cause</h3><blockquote>
<p>According to <a target="_blank" rel="noopener" href="https://github.com/wolfcw/libfaketime/issues/425">issue #425</a>, a specific JDK version requires the removal of the <code>DONT_FAKE_MONOTONIC</code> variable.</p>
</blockquote>
<h4 id="1-Identifying-the-JVM-Clock"><a href="#1-Identifying-the-JVM-Clock" class="headerlink" title="1. Identifying the JVM Clock"></a>1. Identifying the JVM Clock</h4><p>The <code>java -Xlog:all=info</code> command-line option enables verbose logging in the JVM, which is useful for identifying issues and debugging. In this investigation, it prints critical information:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=/usr/lib64/faketime/libfaketime.so.1 FAKETIME=<span class="string">&quot;@2024-12-22 19:44:32&quot;</span> java -Xlog:all=info Main.java</span><br></pre></td></tr></table></figure>

<p>Sample output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[0.006s][info][os       ] Use of pthread_condattr_setclock is supported</span><br><span class="line">[0.006s][info][os       ] Relative timed-wait using pthread_cond_timedwait is associated with CLOCK_MONOTONIC</span><br><span class="line">[0.006s][info][os,thread] Lookup of __pthread_get_minstack succeeded</span><br></pre></td></tr></table></figure>

<p>It shows that the JVM in JDK 21 determines the availability of <code>CLOCK_MONOTONIC</code> using <code>pthread_condattr_setclock</code>. This ensures that when the JVM uses condition variables (e.g., <code>pthread_cond_timedwait</code>) for timeout operations, it can rely on <code>CLOCK_MONOTONIC</code> to avoid disruptions caused by system time changes.</p>
<h4 id="2-Analyzing-the-Blocking-Point"><a href="#2-Analyzing-the-Blocking-Point" class="headerlink" title="2. Analyzing the Blocking Point"></a>2. Analyzing the Blocking Point</h4><p>The following information reveals the call chain and blocking point for <code>Thread.sleep</code> behavior:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Thread 2 (Thread 0x7fb00eafa700 (LWP 15984)):</span><br><span class="line">#0  0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088c22499 in pthread_cond_timedwait_common (cond=0x7fb0806e7350, mutex=0x7fb0806e7328, abstime=&lt;optimized out&gt;, compat=FT_COMPAT_GLIBC_2_3_2) at libfaketime.c:2840</span><br><span class="line">#2  0x00007fb0876be25f in PlatformEvent::park_nanos(long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb0872d8d59 in JavaThread::sleep_nanos(long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0873989ed in JVM_Sleep () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb06fdf39c0 in ?? ()</span><br><span class="line">#6  0x0000000000000000 in ?? ()</span><br></pre></td></tr></table></figure>

<p>Debugging Details：</p>
<ol>
<li><p><strong>Attach the JVM Process</strong><br>Use <code>gdb</code> to attach to the Java process:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb -p 15959</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Backtrace the Stack</strong><br>Retrieve the call stack for debugging:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) bt</span><br></pre></td></tr></table></figure>

<p>Example output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#0  0x00007fb088a08017 in pthread_join () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb089039e6f in CallJavaMainInNewThread () from /usr/java/jdk21/bin/../lib/libjli.so</span><br><span class="line">#2  0x00007fb089036ffd in ContinueInNewThread () from /usr/java/jdk21/bin/../lib/libjli.so</span><br><span class="line">#3  0x00007fb089037a4d in JLI_Launch () from /usr/java/jdk21/bin/../lib/libjli.so</span><br><span class="line">#4  0x000055fa5ded6b0f in main ()</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>List Threads</strong><br>Identify all active threads:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info threads</span><br></pre></td></tr></table></figure>

<p>Example output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Id   Target Id         Frame </span><br><span class="line">25   Thread 0x7fb089023700 (LWP 15960) &quot;java&quot; 0x00007fb088a0aa35 in pthread_cond_wait@@GLIBC_2.3.2 ()</span><br><span class="line">24   Thread 0x7fb08553c700 (LWP 15962) &quot;GC Thread#0&quot; 0x00007fb088a0cb3b in do_futex_wait.constprop.1 ()</span><br><span class="line">23   Thread 0x7fb08543b700 (LWP 15963) &quot;G1 Main Marker&quot; 0x00007fb088a0aa35 in pthread_cond_wait@@GLIBC_2.3.2 ()</span><br><span class="line">...</span><br><span class="line">3    Thread 0x7fb00ebfb700 (LWP 15983) &quot;Thread-0&quot; 0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 ()</span><br><span class="line">2    Thread 0x7fb00eafa700 (LWP 15984) &quot;Thread-1&quot; 0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 ()</span><br><span class="line">* 1    Thread 0x7fb089024740 (LWP 15959) &quot;java&quot; 0x00007fb088a08017 in pthread_join () from /lib64/libpthread.so.0</span><br></pre></td></tr></table></figure>

<p>Focus on key threads, such as:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3    Thread 0x7fb00ebfb700 (LWP 15983) &quot;Thread-0&quot; 0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 ()</span><br><span class="line">2    Thread 0x7fb00eafa700 (LWP 15984) &quot;Thread-1&quot; 0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 ()</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Backtrace Specific Threads</strong><br>For each critical thread, backtrace the stack:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) thread apply &lt;thread-id&gt; bt</span><br></pre></td></tr></table></figure></li>
</ol>
<p>By analyzing these threads and call stacks, you can pinpoint the blocking points and understand how <code>CLOCK_MONOTONIC</code> interacts with <code>libfaketime</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br></pre></td><td class="code"><pre><span class="line">(gdb) thread apply all bt</span><br><span class="line"></span><br><span class="line">Thread 25 (Thread 0x7fb089023700 (LWP 15960)):</span><br><span class="line">#0  0x00007fb088a0aa35 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb0876be95b in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#2  0x00007fb0876663ec in Monitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb0879361ea in Threads::destroy_vm() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb087355fa2 in jni_DestroyJavaVM () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb089035942 in JavaMain () from /usr/java/jdk21/bin/../lib/libjli.so</span><br><span class="line">#6  0x00007fb089039289 in ThreadJavaMain () from /usr/java/jdk21/bin/../lib/libjli.so</span><br><span class="line">#7  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#8  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 24 (Thread 0x7fb08553c700 (LWP 15962)):</span><br><span class="line">#0  0x00007fb088a0cb3b in do_futex_wait.constprop.1 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088a0cbcf in __new_sem_wait_slow.constprop.0 () from /lib64/libpthread.so.0</span><br><span class="line">#2  0x00007fb088a0cc6b in sem_wait@@GLIBC_2.2.5 () from /lib64/libpthread.so.0</span><br><span class="line">#3  0x00007fb08776afa2 in PosixSemaphore::wait() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0879e4d5b in WorkerThread::run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#8  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 23 (Thread 0x7fb08543b700 (LWP 15963)):</span><br><span class="line">#0  0x00007fb088a0aa35 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb0876be95b in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#2  0x00007fb087666369 in Monitor::wait_without_safepoint_check(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb08718e80a in G1ConcurrentMarkThread::wait_for_next_cycle() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb08718fa29 in G1ConcurrentMarkThread::run_service() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0870453fb in ConcurrentGCThread::run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#8  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#9  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 22 (Thread 0x7fb08533a700 (LWP 15964)):</span><br><span class="line">#0  0x00007fb088a0cb3b in do_futex_wait.constprop.1 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088a0cbcf in __new_sem_wait_slow.constprop.0 () from /lib64/libpthread.so.0</span><br><span class="line">#2  0x00007fb088a0cc6b in sem_wait@@GLIBC_2.2.5 () from /lib64/libpthread.so.0</span><br><span class="line">#3  0x00007fb08776afa2 in PosixSemaphore::wait() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0879e4d5b in WorkerThread::run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#8  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---</span><br><span class="line">Thread 21 (Thread 0x7fb084a31700 (LWP 15965)):</span><br><span class="line">#0  0x00007fb088a0aa35 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb0876be95b in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#2  0x00007fb087666369 in Monitor::wait_without_safepoint_check(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb087195d7c in G1PrimaryConcurrentRefineThread::wait_for_completed_buffers() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0871960f8 in G1ConcurrentRefineThread::run_service() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0870453fb in ConcurrentGCThread::run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#8  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#9  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 20 (Thread 0x7fb084930700 (LWP 15966)):</span><br><span class="line">#0  0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088c22499 in pthread_cond_timedwait_common (cond=0x7fb08010b1c0, mutex=0x7fb08010b198, abstime=&lt;optimized out&gt;, compat=FT_COMPAT_GLIBC_2_3_2) at libfaketime.c:2840</span><br><span class="line">#2  0x00007fb0876be937 in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb087666369 in Monitor::wait_without_safepoint_check(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0871eac11 in G1ServiceThread::wait_for_task() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0871eafa0 in G1ServiceThread::run_service() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0870453fb in ConcurrentGCThread::run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#8  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#9  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#10 0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 19 (Thread 0x7fb084753700 (LWP 15967)):</span><br><span class="line">#0  0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088c22499 in pthread_cond_timedwait_common (cond=0x7fb087eefcd0 &lt;mutex_init()::PeriodicTask_lock_storage+48&gt;, mutex=0x7fb087eefca8 &lt;mutex_init()::PeriodicTask_lock_storage+8&gt;, </span><br><span class="line">    abstime=&lt;optimized out&gt;, compat=FT_COMPAT_GLIBC_2_3_2) at libfaketime.c:2840</span><br><span class="line">#2  0x00007fb0876be937 in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb087666369 in Monitor::wait_without_safepoint_check(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb08767ed4d in WatcherThread::sleep() const () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb08767ee51 in WatcherThread::run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#8  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#9  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 18 (Thread 0x7fb084652700 (LWP 15968)):</span><br><span class="line">#0  0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088c22499 in pthread_cond_timedwait_common (cond=0x7fb087eeead0 &lt;mutex_init()::VMOperation_lock_storage+48&gt;, mutex=0x7fb087eeeaa8 &lt;mutex_init()::VMOperation_lock_storage+8&gt;, </span><br><span class="line">    abstime=&lt;optimized out&gt;, compat=FT_COMPAT_GLIBC_2_3_2) at libfaketime.c:2840</span><br><span class="line">#2  0x00007fb0876be937 in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb087666369 in Monitor::wait_without_safepoint_check(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0879be7f5 in VMThread::wait_for_operation() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0879bf318 in VMThread::run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---</span><br><span class="line">#6  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#8  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#9  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 17 (Thread 0x7fb0843c8700 (LWP 15969)):</span><br><span class="line">#0  0x00007fb088a0aa35 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb0876be95b in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#2  0x00007fb0876663ec in Monitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb08739937a in JVM_WaitForReferencePendingList () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb06fdf39c0 in ?? ()</span><br><span class="line">#5  0x0000000000000004 in ?? ()</span><br><span class="line">#6  0x00007fb0843c7948 in ?? ()</span><br><span class="line">#7  0x0000000000000000 in ?? ()</span><br><span class="line"></span><br><span class="line">Thread 16 (Thread 0x7fb0842c7700 (LWP 15970)):</span><br><span class="line">#0  0x00007fb088a0aa35 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb0876be0ab in PlatformEvent::park() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#2  0x00007fb08768e3f5 in ObjectMonitor::wait(long, bool, JavaThread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb0878da904 in ObjectSynchronizer::wait(Handle, long, JavaThread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb08739ad7f in JVM_MonitorWait () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb06fdf39c0 in ?? ()</span><br><span class="line">#6  0x00007fb0842c67a8 in ?? ()</span><br><span class="line">#7  0x00007fb06fdf3697 in ?? ()</span><br><span class="line">#8  0x0000000000000000 in ?? ()</span><br><span class="line"></span><br><span class="line">Thread 15 (Thread 0x7fb0841c6700 (LWP 15971)):</span><br><span class="line">#0  0x00007fb088a0cb3b in do_futex_wait.constprop.1 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088a0cbcf in __new_sem_wait_slow.constprop.0 () from /lib64/libpthread.so.0</span><br><span class="line">#2  0x00007fb088a0cc6b in sem_wait@@GLIBC_2.2.5 () from /lib64/libpthread.so.0</span><br><span class="line">#3  0x00007fb08776afa2 in PosixSemaphore::wait() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb08781b93f in os::signal_wait() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0876a59e5 in signal_thread_entry(JavaThread*, JavaThread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0872d5cd8 in JavaThread::thread_main_inner() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#8  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#9  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#10 0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 14 (Thread 0x7fb0648af700 (LWP 15972)):</span><br><span class="line">#0  0x00007fb088a0aa35 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb0876be95b in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#2  0x00007fb087666369 in Monitor::wait_without_safepoint_check(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb08776ca82 in ServiceThread::service_thread_entry(JavaThread*, JavaThread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0872d5cd8 in JavaThread::thread_main_inner() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---</span><br><span class="line">#6  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#8  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 13 (Thread 0x7fb0647ae700 (LWP 15973)):</span><br><span class="line">#0  0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088c22499 in pthread_cond_timedwait_common (cond=0x7fb087ef0cd0 &lt;mutex_init()::MonitorDeflation_lock_storage+48&gt;, mutex=0x7fb087ef0ca8 &lt;mutex_init()::MonitorDeflation_lock_storage+8&gt;, </span><br><span class="line">    abstime=&lt;optimized out&gt;, compat=FT_COMPAT_GLIBC_2_3_2) at libfaketime.c:2840</span><br><span class="line">#2  0x00007fb0876be937 in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb087666369 in Monitor::wait_without_safepoint_check(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb087659353 in MonitorDeflationThread::monitor_deflation_thread_entry(JavaThread*, JavaThread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0872d5cd8 in JavaThread::thread_main_inner() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#8  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#9  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 12 (Thread 0x7fb0646ad700 (LWP 15974)):</span><br><span class="line">#0  0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088c22499 in pthread_cond_timedwait_common (cond=0x7fb087ef0250 &lt;mutex_init()::MethodCompileQueue_lock_storage+48&gt;, mutex=0x7fb087ef0228 &lt;mutex_init()::MethodCompileQueue_lock_storage+8&gt;, </span><br><span class="line">    abstime=&lt;optimized out&gt;, compat=FT_COMPAT_GLIBC_2_3_2) at libfaketime.c:2840</span><br><span class="line">#2  0x00007fb0876be937 in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb0876663ec in Monitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb087026e76 in CompileQueue::get(CompilerThread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb08702ae79 in CompileBroker::compiler_thread_loop() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0872d5cd8 in JavaThread::thread_main_inner() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#8  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#9  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#10 0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 11 (Thread 0x7fb0645ac700 (LWP 15975)):</span><br><span class="line">#0  0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088c22499 in pthread_cond_timedwait_common (cond=0x7fb087ef0250 &lt;mutex_init()::MethodCompileQueue_lock_storage+48&gt;, mutex=0x7fb087ef0228 &lt;mutex_init()::MethodCompileQueue_lock_storage+8&gt;, </span><br><span class="line">    abstime=&lt;optimized out&gt;, compat=FT_COMPAT_GLIBC_2_3_2) at libfaketime.c:2840</span><br><span class="line">#2  0x00007fb0876be937 in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb0876663ec in Monitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb087026e76 in CompileQueue::get(CompilerThread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb08702ae79 in CompileBroker::compiler_thread_loop() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0872d5cd8 in JavaThread::thread_main_inner() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#8  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#9  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#10 0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 10 (Thread 0x7fb0643db700 (LWP 15976)):</span><br><span class="line">---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---</span><br><span class="line">#0  0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088c22499 in pthread_cond_timedwait_common (cond=0x7fb08017cab8, mutex=0x7fb08017ca90, abstime=&lt;optimized out&gt;, compat=FT_COMPAT_GLIBC_2_3_2) at libfaketime.c:2840</span><br><span class="line">#2  0x00007fb0876be547 in Parker::park(bool, long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb0879603c4 in Unsafe_Park () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb06fdf39c0 in ?? ()</span><br><span class="line">#5  0x00007fb0643da578 in ?? ()</span><br><span class="line">#6  0x00007fb0643da5e8 in ?? ()</span><br><span class="line">#7  0x00007fb06fdef180 in ?? ()</span><br><span class="line">#8  0x00000000868003f8 in ?? ()</span><br><span class="line">#9  0x00007fb0643da580 in ?? ()</span><br><span class="line">#10 0x0000000000000000 in ?? ()</span><br><span class="line"></span><br><span class="line">Thread 9 (Thread 0x7fb0642da700 (LWP 15977)):</span><br><span class="line">#0  0x00007fb088a0aa35 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb0876be95b in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#2  0x00007fb087666369 in Monitor::wait_without_safepoint_check(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb08767f2f2 in NotificationThread::notification_thread_entry(JavaThread*, JavaThread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0872d5cd8 in JavaThread::thread_main_inner() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#8  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 8 (Thread 0x7fb0641d9700 (LWP 15978)):</span><br><span class="line">#0  0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088c22499 in pthread_cond_timedwait_common (cond=0x7fb087ef0250 &lt;mutex_init()::MethodCompileQueue_lock_storage+48&gt;, mutex=0x7fb087ef0228 &lt;mutex_init()::MethodCompileQueue_lock_storage+8&gt;, </span><br><span class="line">    abstime=&lt;optimized out&gt;, compat=FT_COMPAT_GLIBC_2_3_2) at libfaketime.c:2840</span><br><span class="line">#2  0x00007fb0876be937 in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb0876663ec in Monitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb087026e76 in CompileQueue::get(CompilerThread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb08702ae79 in CompileBroker::compiler_thread_loop() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0872d5cd8 in JavaThread::thread_main_inner() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#8  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#9  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#10 0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 7 (Thread 0x7fb00efff700 (LWP 15979)):</span><br><span class="line">#0  0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088c22499 in pthread_cond_timedwait_common (cond=0x7fb087ef0250 &lt;mutex_init()::MethodCompileQueue_lock_storage+48&gt;, mutex=0x7fb087ef0228 &lt;mutex_init()::MethodCompileQueue_lock_storage+8&gt;, </span><br><span class="line">    abstime=&lt;optimized out&gt;, compat=FT_COMPAT_GLIBC_2_3_2) at libfaketime.c:2840</span><br><span class="line">#2  0x00007fb0876be937 in PlatformMonitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb0876663ec in Monitor::wait(unsigned long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb087026e76 in CompileQueue::get(CompilerThread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb08702ae79 in CompileBroker::compiler_thread_loop() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0872d5cd8 in JavaThread::thread_main_inner() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---</span><br><span class="line">#7  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#8  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#9  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#10 0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 6 (Thread 0x7fb00eefe700 (LWP 15980)):</span><br><span class="line">#0  0x00007fb088a0cb3b in do_futex_wait.constprop.1 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088a0cbcf in __new_sem_wait_slow.constprop.0 () from /lib64/libpthread.so.0</span><br><span class="line">#2  0x00007fb088a0cc6b in sem_wait@@GLIBC_2.2.5 () from /lib64/libpthread.so.0</span><br><span class="line">#3  0x00007fb08776afa2 in PosixSemaphore::wait() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0879e4d5b in WorkerThread::run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#8  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 5 (Thread 0x7fb00edfd700 (LWP 15981)):</span><br><span class="line">#0  0x00007fb088a0cb3b in do_futex_wait.constprop.1 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088a0cbcf in __new_sem_wait_slow.constprop.0 () from /lib64/libpthread.so.0</span><br><span class="line">#2  0x00007fb088a0cc6b in sem_wait@@GLIBC_2.2.5 () from /lib64/libpthread.so.0</span><br><span class="line">#3  0x00007fb08776afa2 in PosixSemaphore::wait() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0879e4d5b in WorkerThread::run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#8  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 4 (Thread 0x7fb00ecfc700 (LWP 15982)):</span><br><span class="line">#0  0x00007fb088a0cb3b in do_futex_wait.constprop.1 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088a0cbcf in __new_sem_wait_slow.constprop.0 () from /lib64/libpthread.so.0</span><br><span class="line">#2  0x00007fb088a0cc6b in sem_wait@@GLIBC_2.2.5 () from /lib64/libpthread.so.0</span><br><span class="line">#3  0x00007fb08776afa2 in PosixSemaphore::wait() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0879e4d5b in WorkerThread::run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb0879283b8 in Thread::call_run() () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#6  0x00007fb0876b312a in thread_native_entry(Thread*) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#7  0x00007fb088a06ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#8  0x00007fb08852bb0d in clone () from /lib64/libc.so.6</span><br><span class="line"></span><br><span class="line">Thread 3 (Thread 0x7fb00ebfb700 (LWP 15983)):</span><br><span class="line">#0  0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088c22499 in pthread_cond_timedwait_common (cond=0x7fb08070b250, mutex=0x7fb08070b228, abstime=&lt;optimized out&gt;, compat=FT_COMPAT_GLIBC_2_3_2) at libfaketime.c:2840</span><br><span class="line">#2  0x00007fb0876be25f in PlatformEvent::park_nanos(long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb0872d8d59 in JavaThread::sleep_nanos(long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0873989ed in JVM_Sleep () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb06fdf39c0 in ?? ()</span><br><span class="line">#6  0x0000000000000000 in ?? ()</span><br><span class="line">---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---</span><br><span class="line"></span><br><span class="line">Thread 2 (Thread 0x7fb00eafa700 (LWP 15984)):</span><br><span class="line">#0  0x00007fb088a0ade2 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb088c22499 in pthread_cond_timedwait_common (cond=0x7fb0806e7350, mutex=0x7fb0806e7328, abstime=&lt;optimized out&gt;, compat=FT_COMPAT_GLIBC_2_3_2) at libfaketime.c:2840</span><br><span class="line">#2  0x00007fb0876be25f in PlatformEvent::park_nanos(long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#3  0x00007fb0872d8d59 in JavaThread::sleep_nanos(long) () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#4  0x00007fb0873989ed in JVM_Sleep () from /usr/java/jdk21/lib/server/libjvm.so</span><br><span class="line">#5  0x00007fb06fdf39c0 in ?? ()</span><br><span class="line">#6  0x0000000000000000 in ?? ()</span><br><span class="line"></span><br><span class="line">Thread 1 (Thread 0x7fb089024740 (LWP 15959)):</span><br><span class="line">#0  0x00007fb088a08017 in pthread_join () from /lib64/libpthread.so.0</span><br><span class="line">#1  0x00007fb089039e6f in CallJavaMainInNewThread () from /usr/java/jdk21/bin/../lib/libjli.so</span><br><span class="line">#2  0x00007fb089036ffd in ContinueInNewThread () from /usr/java/jdk21/bin/../lib/libjli.so</span><br><span class="line">#3  0x00007fb089037a4d in JLI_Launch () from /usr/java/jdk21/bin/../lib/libjli.so</span><br><span class="line">#4  0x000055fa5ded6b0f in main ()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="3-Root-Cause-Analysis"><a href="#3-Root-Cause-Analysis" class="headerlink" title="3. Root Cause Analysis"></a>3. Root Cause Analysis</h3><p>For <strong>Thread.Sleep</strong> in JDK 21+9, the call path is as follows:</p>
<ol>
<li><strong>Thread.Sleep</strong><ul>
<li>Source: <a target="_blank" rel="noopener" href="https://github.com/openjdk/jdk21u/blob/e45287d1ad9dcadf8a23d3271f1b675b8dade0ac/src/java.base/share/classes/java/lang/Thread.java#L498">Thread.java</a></li>
</ul>
</li>
<li><strong>Thread.Sleep → sleep0</strong></li>
<li><strong>sleep0 → JNI Implementation (JVM_Sleep)</strong></li>
<li><strong>JVM_Sleep</strong><ul>
<li>Utilizes the JVM method <code>sleep_nanos</code> (<a target="_blank" rel="noopener" href="https://github.com/openjdk/jdk21u/blob/e45287d1ad9dcadf8a23d3271f1b675b8dade0ac/src/hotspot/share/runtime/javaThread.cpp#L1990C18-L1990C29">Source</a>).</li>
</ul>
</li>
<li><strong>sleep_nanos</strong><ul>
<li>Internally calls <code>park_nanos(nanos_remaining)</code> via the <code>ParkEvent</code> object.</li>
</ul>
</li>
<li><strong>park_nanos</strong><ul>
<li>Invokes <strong>glibc’s <code>pthread_cond_timedwait</code></strong>, which gets intercepted by <strong>faketime</strong>.</li>
</ul>
</li>
</ol>
<p>Issue Analysis:</p>
<ul>
<li>In <strong>faketime’s <code>pthread_cond_timedwait</code></strong>, if the <code>clock_id</code> is not <code>CLOCK_MONOTONIC</code>, it uses <strong>realtime</strong> for calculations.</li>
<li>The realtime value is then passed to glibc’s <code>pthread_cond_timedwait</code>, which uses <strong>faketime’s altered <code>clock_gettime</code></strong> for timeout computation.</li>
<li>As a result, the JVM thread remains <strong>stuck in waiting</strong>, unable to be unparked, because the faketime-altered clock values are inconsistent with the expected monotonic behavior.</li>
</ul>
<p>Implementation Insight: <code>sleep_nanos</code></p>
<p>The implementation of <code>sleep_nanos</code> is as follows:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">JavaThread::sleep_nanos</span><span class="params">(jlong nanos)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">assert</span>(<span class="keyword">this</span> == Thread::<span class="built_in">current</span>(),  <span class="string">&quot;thread consistency check&quot;</span>);</span><br><span class="line">  <span class="built_in">assert</span>(nanos &gt;= <span class="number">0</span>, <span class="string">&quot;nanos are in range&quot;</span>);</span><br><span class="line"></span><br><span class="line">  ParkEvent * <span class="type">const</span> slp = <span class="keyword">this</span>-&gt;_SleepEvent;</span><br><span class="line">  <span class="comment">// Reset the event to avoid immediate return due to races with interrupts</span></span><br><span class="line">  slp-&gt;<span class="built_in">reset</span>();</span><br><span class="line">  OrderAccess::<span class="built_in">fence</span>();</span><br><span class="line"></span><br><span class="line">  jlong prevtime = os::<span class="built_in">javaTimeNanos</span>();</span><br><span class="line">  jlong nanos_remaining = nanos;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    <span class="comment">// Check for interruptions before timing out</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;<span class="built_in">is_interrupted</span>(<span class="literal">true</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nanos_remaining &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="function">ThreadBlockInVM <span class="title">tbivm</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">      <span class="function">OSThreadWaitState <span class="title">osts</span><span class="params">(<span class="keyword">this</span>-&gt;osthread(), <span class="literal">false</span> <span class="comment">/* not Object.wait() */</span>)</span></span>;</span><br><span class="line">      slp-&gt;<span class="built_in">park_nanos</span>(nanos_remaining);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update elapsed time tracking</span></span><br><span class="line">    jlong newtime = os::<span class="built_in">javaTimeNanos</span>();</span><br><span class="line">    <span class="keyword">if</span> (newtime - prevtime &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">assert</span>(<span class="literal">false</span>,</span><br><span class="line">             <span class="string">&quot;unexpected time moving backwards detected in JavaThread::sleep()&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      nanos_remaining -= (newtime - prevtime);</span><br><span class="line">    &#125;</span><br><span class="line">    prevtime = newtime;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>The loop ensures that time tracking and remaining nanos are adjusted iteratively.</li>
<li>The fallback to realtime (<code>os::javaTimeNanos</code>) when <code>CLOCK_MONOTONIC</code> isn’t available is critical here, but <strong>faketime alters the behavior, causing backward time jumps or inconsistencies</strong>.</li>
</ul>
<h3 id="Faketime’s-Behavior"><a href="#Faketime’s-Behavior" class="headerlink" title="Faketime’s Behavior"></a>Faketime’s Behavior</h3><ul>
<li><p>In <strong>versions 0.9.8</strong> and <strong>0.9.10</strong>, <code>pthread_cond_timedwait</code> is intercepted.</p>
</li>
<li><p>However, the handling of </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLOCK_MONOTONIC</span><br></pre></td></tr></table></figure>

<p> differs between these versions:</p>
<ul>
<li><strong>Version 0.9.10</strong> introduces <strong>adaptive behavior</strong> based on the Glibc version, offering improved compatibility for <code>CLOCK_MONOTONIC</code>.</li>
</ul>
</li>
</ul>
<p>This discrepancy in handling leads to differences in behavior under faketime when dealing with threads and timers.</p>
<p><img src="https://pic1.imgdb.cn/item/6794787dd0e0a243d4f7ba30.png"></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><p><a target="_blank" rel="noopener" href="https://www.ffutop.com/posts/2024-08-06-faketime/">https://www.ffutop.com/posts/2024-08-06-faketime/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2240075">https://cloud.tencent.com/developer/article/2240075</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/wolfcw/libfaketime/issues/469">https://github.com/wolfcw/libfaketime/issues/469</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/wolfcw/libfaketime/commit/0e61d3d1917f530b5e3f66db2ed5dd6acd20e798#diff-9c808c04a6c7f0cf8c7c99d7d03f9e6cfd420f7733dd38d1519d86b4da92a7c3R3571">https://github.com/wolfcw/libfaketime/commit/0e61d3d1917f530b5e3f66db2ed5dd6acd20e798#diff-9c808c04a6c7f0cf8c7c99d7d03f9e6cfd420f7733dd38d1519d86b4da92a7c3R3571</a></p>
</li>
</ol>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/zouyee">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Background"><span class="toc-number">1.</span> <span class="toc-text">Background</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Technical-Background"><span class="toc-number">1.1.</span> <span class="toc-text">Technical Background</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Introduction-to-LD-PRELOAD"><span class="toc-number">1.1.1.</span> <span class="toc-text">Introduction to LD_PRELOAD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Usage"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">Usage</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Introduction-to-faketime"><span class="toc-number">1.1.2.</span> <span class="toc-text">Introduction to faketime</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-faketime-Configuration-Methods"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">1. faketime Configuration Methods</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-How-It-Works"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">2. How It Works</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Installation-and-Usage"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">3. Installation and Usage</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tracing-the-Root-Cause"><span class="toc-number">1.1.3.</span> <span class="toc-text">Tracing the Root Cause</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Identifying-the-JVM-Clock"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">1. Identifying the JVM Clock</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Analyzing-the-Blocking-Point"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">2. Analyzing the Blocking Point</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Root-Cause-Analysis"><span class="toc-number">1.1.4.</span> <span class="toc-text">3. Root Cause Analysis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Faketime%E2%80%99s-Behavior"><span class="toc-number">1.1.5.</span> <span class="toc-text">Faketime’s Behavior</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">1.2.</span> <span class="toc-text">Reference</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://zoues.com/posts/319cc956/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://zoues.com/posts/319cc956/&text=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://zoues.com/posts/319cc956/&title=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://zoues.com/posts/319cc956/&is_video=false&description=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=The Mystery Behind JDK 21 faketime Exercise Overloading CPU&body=Check out this article: https://zoues.com/posts/319cc956/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://zoues.com/posts/319cc956/&title=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://zoues.com/posts/319cc956/&title=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://zoues.com/posts/319cc956/&title=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://zoues.com/posts/319cc956/&title=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://zoues.com/posts/319cc956/&name=The Mystery Behind JDK 21 faketime Exercise Overloading CPU&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://zoues.com/posts/319cc956/&t=The Mystery Behind JDK 21 faketime Exercise Overloading CPU"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2024
    zouyee
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/zouyee">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
