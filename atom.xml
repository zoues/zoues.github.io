<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>zouyee</title>
  
  <subtitle>life is short, enjoy it</subtitle>
  <link href="https://zoues.com/atom.xml" rel="self"/>
  
  <link href="https://zoues.com/"/>
  <updated>2024-04-30T06:11:34.615Z</updated>
  <id>https://zoues.com/</id>
  
  <author>
    <name>zouyee</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Why does RLIMIT_NOFILE slow down your containerized application</title>
    <link href="https://zoues.com/posts/5cdbe8ce/"/>
    <id>https://zoues.com/posts/5cdbe8ce/</id>
    <published>2024-04-30T05:32:59.000Z</published>
    <updated>2024-04-30T06:11:34.615Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>thanks <strong><a href="https://github.com/polarathene">polarathene</a></strong></p></blockquote><h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>The max open files limit <code>NOFILE</code> of dockerd is 1048576, which is defined in dockerd‚Äôs systemd unit file.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /proc/$(pidof dockerd)/limits | grep &quot;Max open files&quot;</span><br><span class="line">Max open files            1048576              1048576              files</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl show docker | grep LimitNOFILE</span><br><span class="line">LimitNOFILE=1048576</span><br><span class="line">LimitNOFILESoft=1048576</span><br></pre></td></tr></table></figure><p>However, inside the container, the value of the limit is a very large number ‚Äî 1073741816:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm ubuntu bash -c &quot;cat /proc/self/limits&quot; | grep  &quot;Max open files&quot;</span><br><span class="line">Max open files            1073741816           1073741816           files</span><br></pre></td></tr></table></figure><p>It may cause the program iterate all available fds until the limit is reached; for example, the <code>xinetd</code> program sets the number of file descriptors using <code>setrlimit(2)</code> at initialization, which causes unnecessary waste of CPU resources and time on closing 1073741816 fds.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@1b3165886528# strace xinetd</span><br><span class="line">execve(&quot;/usr/sbin/xinetd&quot;, [&quot;xinetd&quot;], 0x7ffd3c2882e0 /* 9 vars */) = 0</span><br><span class="line">brk(NULL)                               = 0x557690d7a000</span><br><span class="line">arch_prctl(0x3001 /* ARCH_??? */, 0x7ffee17ce6f0) = -1 EINVAL (Invalid argument)</span><br><span class="line">mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fb14255c000</span><br><span class="line">access(&quot;/etc/ld.so.preload&quot;, R_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">close(12024371)                         = -1 EBADF (Bad file descriptor)</span><br><span class="line">close(12024372)                         = -1 EBADF (Bad file descriptor)</span><br><span class="line">close(12024373)                         = -1 EBADF (Bad file descriptor)</span><br><span class="line">close(12024374)                         = -1 EBADF (Bad file descriptor)</span><br><span class="line">close(12024375)                         = -1 EBADF (Bad file descriptor)</span><br><span class="line">close(12024376)                         = -1 EBADF (Bad file descriptor)</span><br><span class="line">close(12024377)                         = -1 EBADF (Bad file descriptor)</span><br><span class="line">close(12024378)                         = -1 EBADF (Bad file descriptor)</span><br></pre></td></tr></table></figure><p>we found similar cases:</p><h3 id="yum-hang"><a href="#yum-hang" class="headerlink" title="yum hang"></a>yum hang</h3><p>I noticed that newest version of docker, on rockylinux-9, taken from <a href="https://download.docker.com/linux/centos/$releasever/$basearch/stable">https://download.docker.com/linux/centos/$releasever/$basearch/stable</a> are a bit slow especially for operations done by yum</p><p>On both centos-7 and rocky-9 hosts I did:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --name centos7 quay.io/centos/centos:centos7</span><br><span class="line">docker exec -it centos7 /bin/bash -c &quot;time yum update -y&quot;</span><br></pre></td></tr></table></figure><p>On centos7 host it takes ~2 minutes<br>On rocky-9 host after an hour it did not complete the process, I can leave it under tmux to discover how much time it takes</p><p>reproduce steps:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --name centos7 quay.io/centos/centos:centos7</span><br><span class="line">docker exec -it centos7 /bin/bash -c &quot;time yum update -y&quot;</span><br></pre></td></tr></table></figure><h3 id="rpm-slow"><a href="#rpm-slow" class="headerlink" title="rpm slow"></a>rpm slow</h3><p>run below comamnd on host:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time zypper --reposd-dir /workspace/zypper/reposd --cache-dir /workspace/zypper/cache --solv-cache-dir /workspace/zypper/solv --pkg-cache-dir /workspace/zypper/pkg --non-interactive --root /workspace/root install rpm subversion</span><br></pre></td></tr></table></figure><p>spend timeÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">real    0m11.248s</span><br><span class="line">user    0m7.316s</span><br><span class="line">sys     0m1.932s</span><br></pre></td></tr></table></figure><p>when test it in container</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm --net=none --log-driver=none -v &quot;/workspace:/workspace&quot; -v &quot;/disks:/disks&quot; opensuse bash -c &quot;time zypper --reposd-dir /workspace/zypper/reposd --cache-dir /workspace/zypper/cache --solv-cache-dir /workspace/zypper/solv --pkg-cache-dir /workspace/zypper/pkg --non-interactive --root /workspace/root install rpm subversion&quot;</span><br></pre></td></tr></table></figure><p>spend timeÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">real    0m31.089s</span><br><span class="line">user    0m14.876s</span><br><span class="line">sys     0m12.524s</span><br></pre></td></tr></table></figure><p>Here‚Äôs the relevant section of code from RPM. It‚Äôs part of the POSIX lua library that‚Äôs inside RPM, and was added by <a href="https://github.com/rpm-software-management/rpm/commit/7a7c31f551ff167f8718aea6d5048f6288d60205">rpm-software-management&#x2F;rpm@<code>7a7c31f</code></a>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">static int Pexec(lua_State *L) /** exec(path,[args]) */</span><br><span class="line">&#123;</span><br><span class="line">/* ... */</span><br><span class="line">open_max = sysconf(_SC_OPEN_MAX);</span><br><span class="line">if (open_max == -1) &#123;</span><br><span class="line">    open_max = 1024;</span><br><span class="line">&#125;</span><br><span class="line">for (fdno = 3; fdno &lt; open_max; fdno++) &#123;</span><br><span class="line">    flag = fcntl(fdno, F_GETFD);</span><br><span class="line">    if (flag == -1 || (flag &amp; FD_CLOEXEC))</span><br><span class="line">continue;</span><br><span class="line">    fcntl(fdno, F_SETFD, FD_CLOEXEC);</span><br><span class="line">&#125;</span><br><span class="line">/* ... */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>So the reason for doing <code>F_GETFD</code> is because they are setting all of the FDs to <code>CLOEXEC</code> before doing the requested <code>exec(2)</code>. There‚Äôs a <a href="https://bugzilla.redhat.com/show_bug.cgi?id=919801">redhat bugzilla entry</a> in the commit message, which says that this was an SELinux issue where Fedora (or RHEL) have an SELinux setup where you cannot execute a process if it will inherit FDs it shouldn‚Äôt have access to?</p><p>I guess if this is an SELinux issue it should be handled by only applying this fix when SELinux is used (though there are arguably security reasons why you might want to <code>CLOEXEC</code> every file descriptor).</p><h3 id="PtyProcess-spawn-slowdown-in-close-loop"><a href="#PtyProcess-spawn-slowdown-in-close-loop" class="headerlink" title="PtyProcess.spawn slowdown in close() loop"></a>PtyProcess.spawn slowdown in close() loop</h3><p>The following code in ptyprocess</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Do not allow child to inherit open file descriptors from parent, </span><br><span class="line"> # with the exception of the exec_err_pipe_write of the pipe </span><br><span class="line"> # and pass_fds. </span><br><span class="line"> # Impose ceiling on max_fd: AIX bugfix for users with unlimited </span><br><span class="line"> # nofiles where resource.RLIMIT_NOFILE is 2^63-1 and os.closerange() </span><br><span class="line"> # occasionally raises out of range error </span><br><span class="line"> max_fd = min(1048576, resource.getrlimit(resource.RLIMIT_NOFILE)[0]) </span><br><span class="line"> spass_fds = sorted(set(pass_fds) | &#123;exec_err_pipe_write&#125;) </span><br><span class="line"> for pair in zip([2] + spass_fds, spass_fds + [max_fd]): </span><br><span class="line">     os.closerange(pair[0]+1, pair[1]) </span><br></pre></td></tr></table></figure><p>is looping through all possible file descriptors in order to close those (note that <code>closerange()</code> implemented as a loop at least on Linux). In case the limit of open fds (aka <code>ulimit -n</code>, aka <code>RLIMIT_NOFILE</code>, aka <code>SC_OPEN_MAX</code>) is set too high (for example, with recent docker it is 1024*1024), this loop takes considerable time (as it results in about a million <code>close()</code> syscalls).</p><p>The solution (at least for Linux and Darwin) is to obtain the list of actually opened fds, and only close those. This is implemented in <code>subprocess</code> module in Python3, and there is a backport of it to Python2 called subprocess32.</p><h3 id="MySQL-has-been-known-to-allocate-excessive-memory"><a href="#MySQL-has-been-known-to-allocate-excessive-memory" class="headerlink" title="MySQL has been known to allocate excessive memory"></a><a href="https://github.com/overhangio/tutor/pull/810/files#diff-a7c720c9cc5fa1b93c92c33e3e75a0b0880d80915d867d57d48464ff4f472b0aR115-R117">MySQL has been known to allocate excessive memory</a></h3><p>In idle mode, the ‚Äúmysql‚Äù container should use ~200MB memory; ~200-300MB for the the ‚Äúlms‚Äù and ‚Äúcms‚Äù containers.</p><p>On some operating systems, such as RedHat, Arch Linux or Fedora, a very high limit of the number of open files (<code>nofile</code>) per container may cause the ‚Äúmysql‚Äù, ‚Äúlms‚Äù and ‚Äúcms‚Äù containers to use a lot of memory: up to 8-16GB. To check whether you might impacted, run::</p><pre><code>cat /proc/$(pgrep dockerd)/limits | grep &quot;Max open files&quot;</code></pre><p>If the output is 1073741816 or higher, then it is likely that you are affected by <code>this mysql issue &lt;https://github.com/docker-library/mysql/issues/579&gt;</code><strong>. To learn more about the root cause, read <code>this containerd issue comment &lt;https://github.com/containerd/containerd/pull/7566#issuecomment-1285417325&gt;</code></strong>. Basically, the OS is hard-coding a very high limit for the allowed number of open files, and this is causing some containers to fail. To resolve the problem, you should configure the Docker daemon to enforce a lower value, as described <code>here &lt;https://github.com/docker-library/mysql/issues/579#issuecomment-1432576518&gt;</code>__. Edit <code>/etc/docker/daemon.json</code> and add the following contents::</p><pre><code>&#123;    &quot;default-ulimits&quot;: &#123;        &quot;nofile&quot;: &#123;            &quot;Name&quot;: &quot;nofile&quot;,            &quot;Hard&quot;: 1048576,            &quot;Soft&quot;: 1048576        &#125;    &#125;&#125;</code></pre><p>Check your configuration is valid with:</p><pre><code>dockerd --validate</code></pre><p>Then restart the Docker service:</p><pre><code>sudo systemctl restart docker.service</code></pre><h2 id="Technical-Background-Introduction"><a href="#Technical-Background-Introduction" class="headerlink" title="Technical Background Introduction"></a>Technical Background Introduction</h2><h3 id="1-RLIMIT-NOFILE"><a href="#1-RLIMIT-NOFILE" class="headerlink" title="1. RLIMIT_NOFILE"></a>1. RLIMIT_NOFILE</h3><blockquote><p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#Process%20Properties">https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#Process%20Properties</a></p></blockquote><p>Don‚Äôt use. Be careful when raising the soft limit above 1024, since <a href="https://man7.org/linux/man-pages/man2/select.2.html">select(2)</a> cannot function with file descriptors above 1023 on Linux. Nowadays, the hard limit defaults to 524288, a very high value compared to historical defaults. Typically applications should increase their soft limit to the hard limit on their own, if they are OK with working with file descriptors above 1023, i.e. do not use <a href="https://man7.org/linux/man-pages/man2/select.2.html">select(2)</a>. Note that file descriptors are nowadays accounted like any other form of memory, thus there should not be any need to lower the hard limit. Use <code>MemoryMax=</code> to control overall service memory use, including file descriptor memory.</p><blockquote><p><a href="https://github.com/systemd/systemd/blob/1742aae2aa8cd33897250d6fcfbe10928e43eb2f/NEWS#L60..L94">https://github.com/systemd/systemd/blob/1742aae2aa8cd33897250d6fcfbe10928e43eb2f/NEWS#L60..L94</a></p></blockquote><p>The Linux kernel‚Äôs current default RLIMIT_NOFILE resource limit for userspace processes is set to 1024 (soft) and 4096 (hard). Previously, systemd passed this on unmodified to all processes it forked off. With this systemd release the hard limit systemd passes on is increased to 512K, overriding the kernel‚Äôs defaults and substantially increasing the number of simultaneous file descriptors unprivileged userspace processes can allocate. Note that the soft limit remains at 1024 for compatibility reasons: the traditional UNIX select() call cannot deal with file descriptors &gt;&#x3D; 1024 and increasing the soft limit globally might thus result in programs unexpectedly allocating a high file descriptor and thus failing abnormally when attempting to use it with select() (of course, programs shouldn‚Äôt use select() anymore, and prefer poll()&#x2F;epoll, but the call unfortunately remains undeservedly popular at this time). This change reflects the fact that file descriptor<br>handling in the Linux kernel has been optimized in more recent kernels and allocating large numbers of them should be much cheaper both in memory and in performance than it used to be. Programs that<br>want to take benefit of the increased limit have to ‚Äúopt-in‚Äù into high file descriptors explicitly by raising their soft limit. Of course, when they do that they must acknowledge that they cannot use select() anymore (and neither can any shared library they use ‚Äî or any shared library used by any shared library they use and so on). Which default hard limit is most appropriate is of course hard to decide. However, given reports that ~300K file descriptors are used in real-life applications we believe 512K is sufficiently high as new default for now. Note that there are also reports that using very high hard limits (e.g. 1G) is problematic: some software allocates large arrays with one element for each potential file descriptor  (Java, ‚Ä¶) ‚Äî a high hard limit thus triggers excessively large memory allocations in these applications. Hopefully, the new default of 512K is a good middle ground: higher than what real-life applications currently need, and low enough for avoid triggering excessively large allocations in problematic software. (And yes, somebody should fix<br>Java.)</p><p>systemd v240 release in 2018Q4. Both Docker and Containerd projects have recently removed the line from their configs to rely on the <code>1024:524288</code> default systemd v240 provides (<em>unless the system has been configured explicitly to some other value, which the system administrator may do so when they know they need higher limits</em>).</p><h3 id="2-File-Descriptor-Limits"><a href="#2-File-Descriptor-Limits" class="headerlink" title="2.  File Descriptor Limits"></a>2.  File Descriptor Limits</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">This specifies a value one greater than the maximum file descriptor number that can be opened by this process. Attempts (open(2), pipe(2), dup(2), etc.)  to exceed this limit yield the error EMFILE.  (Historically, this limit was named RLIMIT_OFILE on BSD.)</span><br><span class="line">Since Linux 4.5, this limit also defines the maximum number of file descriptors that an unprivileged process (one without the CAP_SYS_RESOURCE capability) may have &quot;in</span><br><span class="line">flight&quot; to other processes, by being passed across UNIX domain sockets.  This limit applies to the sendmsg(2) system call.  For further details, see unix(7).</span><br></pre></td></tr></table></figure><p>The primary way to reference, allocate and pin runtime OS resources on Linux today are file descriptors (‚Äúfds‚Äù). Originally they were used to reference open files and directories and maybe a bit more, but today they may be used to reference almost any kind of runtime resource in Linux userspace, including open devices, memory (<a href="https://man7.org/linux/man-pages/man2/memfd_create.2.html"><code>memfd_create(2)</code></a>), timers (<a href="https://man7.org/linux/man-pages/man2/timerfd_create.2.html"><code>timefd_create(2)</code></a>) and even processes (with the new <a href="https://man7.org/linux/man-pages/man2/pidfd_open.2.html"><code>pidfd_open(2)</code></a> system call). In a way, the philosophically skewed UNIX concept of ‚Äúeverything is a file‚Äù through the proliferation of fds actually acquires a bit of sensible meaning: ‚Äúeverything <em>has</em> a file <em>descriptor</em>‚Äú is certainly a much better motto to adopt.</p><p>Because of this proliferation of fds, non-trivial modern programs tend to have to deal with substantially more fds at the same time than they traditionally did. Today, you‚Äôll often encounter real-life programs that have a few thousand fds open at the same time.</p><p>Like on most runtime resources on Linux limits are enforced on file descriptors: once you hit the resource limit configured via <a href="https://man7.org/linux/man-pages/man2/getrlimit.2.html"><code>RLIMIT_NOFILE</code></a> any attempt to allocate more is refused with the <code>EMFILE</code> error ‚Äî until you close a couple of those you already have open.</p><p>Because fds weren‚Äôt such a universal concept traditionally, the limit of <code>RLIMIT_NOFILE</code> used to be quite low. Specifically, when the Linux kernel first invokes userspace it still sets <code>RLIMIT_NOFILE</code> to a low value of 1024 (soft) and 4096 (hard). (Quick explanation: the <em>soft</em> limit is what matters and causes the <code>EMFILE</code> issues, the <em>hard</em> limit is a secondary limit that processes may bump their soft limit to ‚Äî if they like ‚Äî without requiring further privileges to do so. Bumping the limit further would require privileges however.). A limit of 1024 fds made fds a <em>scarce</em> resource: APIs tried to be careful with using fds, since you simply couldn‚Äôt have that many of them at the same time. This resulted in some questionable coding decisions and concepts at various places: often secondary descriptors that are very similar to fds ‚Äî but were not actually fds ‚Äî were introduced (e.g. inotify watch descriptors), simply to avoid for them the low limits enforced on true fds. Or code tried to aggressively close fds when not absolutely needing them (e.g. <code>ftw()</code>&#x2F;<code>nftw()</code>), losing the nice + stable ‚Äúpinning‚Äù effect of open fds.</p><p>Worse though is that certain OS level APIs were designed having only the low limits in mind. The worst offender being the BSD&#x2F;POSIX <a href="https://man7.org/linux/man-pages/man2/select.2.html"><code>select(2)</code></a> system call: it only works with fds in the numeric range of 0‚Ä¶1023 (aka <code>FD_SETSIZE</code>-1). If you have an fd outside of this range, tough luck: select() won‚Äôt work, and only if you are lucky you‚Äôll detect that and can handle it somehow.</p><p>Linux fds are exposed as simple integers, and for most calls it is guaranteed that the lowest unused integer is allocated for new fds. Thus, as long as the <code>RLIMIT_NOFILE</code> soft limit is set to 1024 everything remains compatible with <code>select()</code>: the resulting fds will also be below 1024. Yay. If we‚Äôd bump the soft limit above this threshold though and at some point in time an fd higher than the threshold is allocated, this fd would not be compatible with <code>select()</code> anymore.</p><p>Because of that, indiscriminately increasing the soft <code>RLIMIT_NOFILE</code> resource limit today for every userspace process is problematic: as long as there‚Äôs userspace code still using <code>select()</code> doing so will risk triggering hard-to-handle, hard-to-debug errors all over the place.</p><p>However, given the nowadays ubiquitous use of fds for all kinds of resources (did you know, an eBPF program is an fd? and a cgroup too? and attaching an eBPF program to cgroup is another fd? ‚Ä¶), we‚Äôd really like to raise the limit anyway.</p><p>So before we continue thinking about this problem, let‚Äôs make the problem more complex (‚Ä¶uh, I mean‚Ä¶ ‚Äúmore exciting‚Äù) first. Having just one hard and one soft per-process limit on fds is boring. Let‚Äôs add more limits on fds to the mix. Specifically on Linux there are two system-wide sysctls: <code>fs.nr_open</code> and <code>fs.file-max</code>. (Don‚Äôt ask me why one uses a dash and the other an underscore, or why there are two of them‚Ä¶) On today‚Äôs kernels they kinda lost their relevance. They had some originally, because fds weren‚Äôt accounted by any other counter. But today, the kernel tracks fds mostly as small pieces of memory allocated on userspace requests ‚Äî because that‚Äôs ultimately what they are ‚Äî, and thus charges them to the memory accounting done anyway.</p><p>So now, we have four limits (actually: five if you count the memory accounting) on the same kind of resource, and all of them make a resource artificially scarce that we don‚Äôt want to be scarce. So what to do?</p><p>Back in systemd v240 already (i.e. 2019) we decided to do something about it. Specifically:</p><ul><li>Automatically at boot we‚Äôll now bump the two sysctls to their maximum, making them effectively ineffective. This one was easy. We got rid of two pretty much redundant knobs. Nice!</li><li>The <code>RLIMIT_NOFILE</code> hard limit is bumped substantially to 512K. Yay, cheap fds! <em>You</em> may have an fd, and <em>you</em>, and <em>you</em> as well, <em>everyone</em> may have an fd!</li><li>But ‚Ä¶ we left the soft <code>RLIMIT_NOFILE</code> limit at 1024. We weren‚Äôt quite ready to break all programs still using <code>select()</code> in 2019 yet. But it‚Äôs not as bad as it might sound I think: given the hard limit is bumped every program can easily opt-in to a larger number of fds, by setting the soft limit to the hard limit early on ‚Äî without requiring privileges.</li></ul><p>So effectively, with this approach fds should be much less scarce (at least for programs that opt into that), and the limits should be much easier to configure, since there are only two knobs now one really needs to care about:</p><ul><li>Configure the <code>RLIMIT_NOFILE</code> hard limit to the maximum number of fds you actually want to allow a process.</li><li>In the program code then either bump the soft to the hard limit, or not. If you do, you basically declare ‚ÄúI understood the problem, I promise to not use <code>select()</code>, drown me fds please!‚Äù. If you don‚Äôt then effectively everything remains as it always was.</li></ul><p>Apparently this approach worked, since the negative feedback on change was even scarcer than fds traditionally were (ha, fun!). We got reports from pretty much only two projects that were bitten by the change (one being a JVM implementation): they already bumped their soft limit automatically to their hard limit during program initialization, and then allocated an array with one entry per possible fd. With the new high limit this resulted in one massive allocation that traditionally was just a few K, and this caused memory checks to be hit.</p><p>Anyway, here‚Äôs the take away of this blog story:</p><ul><li>Don‚Äôt use <code>select()</code> anymore in 2021. Use <code>poll()</code>, <code>epoll</code>, <code>iouring</code>, ‚Ä¶, but for heaven‚Äôs sake don‚Äôt use <code>select()</code>. It might have been all the rage in the 1990s but it doesn‚Äôt scale and is simply not designed for today‚Äôs programs. I wished the man page of <code>select()</code> would make clearer how icky it is and that there are plenty of more preferably APIs.</li><li>If you hack on a program that potentially uses a lot of fds, add <a href="https://github.com/systemd/systemd/blob/e7901aba1480db21e06e21cef4f6486ad71b2ec5/src/basic/rlimit-util.c#L373">some simple code</a> somewhere to its start-up that bumps the <code>RLIMIT_NOFILE</code> soft limit to the hard limit. But if you do this, you have to make sure your code (and any code that you link to from it) refrains from using <code>select()</code>. (Note: there‚Äôs at least one glibc NSS plugin using <code>select()</code> internally. Given that NSS modules can end up being loaded into pretty much <em>any</em> process such modules should probably be considered just buggy.)</li><li>If said program you hack on forks off foreign programs, make sure to reset the <code>RLIMIT_NOFILE</code> soft limit <a href="https://github.com/systemd/systemd/blob/e7901aba1480db21e06e21cef4f6486ad71b2ec5/src/basic/rlimit-util.c#L394">back to 1024</a> for them. Just because your program might be fine with fds &gt;&#x3D; 1024 it doesn‚Äôt mean that those foreign programs might. And unfortunately <code>RLIMIT_NOFILE</code> is inherited down the process tree unless explicitly set.</li></ul><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><ul><li><a href="https://github.com/Supervisor/supervisor/issues/26"><code>supervisord</code> with <code>select()</code></a> (<em>2011 reported, <strong>2014</strong> fixed</em>).</li><li>Nginx will <a href="https://nginx.org/en/docs/ngx_core_module.html#worker_rlimit_nofile">raise soft limit when you tell it to</a> via config (<em><a href="https://forum.nginx.org/read.php?2,258259,258259">bug report in <strong>2015</strong>, where <code>select()</code> was used</a> by nginx limiting it to <code>1024</code></em>). Alternatively if you‚Äôre using the nginx container, you can raise the soft limit at the container level.</li><li>Redis docs advising <code>2^16</code> in example, will be dependent upon your workload.<ul><li><a href="https://github.com/redis/redis-py/issues/419#issuecomment-41134427"><code>redis-py</code> Dec 2013 issue with <code>select()</code></a>, fixed in June <strong>2014</strong></li><li><code>redis/hiredis</code> 2015 issue where a <a href="https://github.com/redis/hiredis/issues/385#issue-123387718">user was relying on <code>select()</code></a>.</li><li><a href="https://blog.pjam.me/posts/select-syscall-in-rust/">Nov 2020 article on <code>select()</code></a>, references Redis still carries <code>select()</code> as a fallback (<a href="https://github.com/redis/redis/blob/e12f2decc1cf7742878d516d89d38af178119b17/src/ae_select.c"><code>ae_select.c</code></a>)</li></ul></li><li>httpd has <code>select()</code> (see <a href="https://github.com/apache/httpd/commit/8286cb80fd160a4259ddf10c3ea016777d34d083">this 2002 commit</a>, which is <a href="https://github.com/apache/httpd/blob/bc0e56cdd3eebbe0fae3f9f5770b09236e8a4a17/modules/http/http_core.c#L241">still present today</a> in 2024_)</li><li>Postgres hasthis 2010 response for why they don‚Äôt use the hard limit to not negatively impact other software running. Less of an issue in a container, especially when you can set the limits. The limits work a little bit differently now , that the issue shouldn‚Äôt be applicable anymore (the global FD limit for a system is notably higher than the hard limit tends to be per process).<ul><li><a href="https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-MAX-FILES-PER-PROCESS">Docs on <code>max_files_per_process</code></a>. Similar to nginx, there is a specific setting here, and it‚Äôs also per process this software manages. Both of these are doing the correct thing by not having a monolithic process sharing the same FD limit. The soft limit applied is per process, if you have 1024 processes with the soft limit of 1024, you also have <code>2^20</code> FDs available across them‚Ä¶not only 1024.</li><li>Postgres still has source with usage of <code>select()</code> <a href="https://github.com/postgres/postgres/blob/0eb23285a2579591c09a591e5a52829f65665341/src/bin/pg_basebackup/receivelog.c#L904">here</a>, <a href="https://github.com/postgres/postgres/blob/0eb23285a2579591c09a591e5a52829f65665341/src/bin/pgbench/pgbench.c#L7862">here</a> and various other locations if you want to look through it.</li></ul></li><li><a href="https://narkive.com/CrxObBlI.2">MongoDB using <code>select()</code> in 2014</a>, in the <a href="https://github.com/mongodb/mongo/blob/91fc5673cab5d1267fd805f1375577df9072ea1b/src/mongo/util/net/listen.cpp#L252-L270">3.7.5 release it was still using it for <code>listen.cpp</code></a>, but that was <a href="https://github.com/mongodb/mongo/commit/55aac9ac800531ad021f18f56d69c69ac5619245">dropped in the 3.7.6 release</a> (April <strong>2018</strong>). A <a href="https://github.com/mongodb/mongo/blob/8de341d0d2011b51eb1d140fb4820424d29fe510/src/mongo/transport/asio/asio_utils.cpp#L131"><code>select()</code> call still exists though</a>.</li></ul><h2 id="Dig-deeping-into"><a href="#Dig-deeping-into" class="headerlink" title="Dig deeping into"></a>Dig deeping into</h2><p>ulimit, being an archaic resource management mechanism, is not completely obsoleted by cgroup controllers, and it is still an essential part of system administration.</p><p>Default ulimits for a new container are derived from those of <del>dockerd</del> containerd itself. They are set in <code>containerd.service</code> systemd unit file to <code>unlimited</code> values:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ grep ^Limit /lib/systemd/system/containerd.service</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br></pre></td></tr></table></figure><p>This is required for containerd itself, but is way too generous for containers it runs. For comparison, ulimits for a user (including root) on the host system are pretty modest (this is an example from Ubuntu 18.04):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ ulimit -a</span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 62435</span><br><span class="line">max locked memory       (kbytes, -l) 16384</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 1024</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 62435</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br></pre></td></tr></table></figure><p>This can create a number of problems, such as container abusing system resources (e.g. DoS attacks). In general, cgroup limits should be used to prevent those, yet I think ulimits should be set to a saner values.</p><p>In particular, <code>RLIMIT_NOFILE</code>, a number of open files limit, which is set to 2^20 (aka 1048576), causes a slowdown in a number of programs, as they use the upper limit value to iterate over all potentially opened file descriptors, closing those (or setting CLOEXEC bit) before every fork&#x2F;exec. I am aware of the following cases:</p><ul><li>rpm, reported in <a href="https://github.com/moby/moby/issues/23137">Slow performance when installing RPMs to create new Docker images #23137</a>, <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1537564">https://bugzilla.redhat.com/show_bug.cgi?id=1537564</a>, fix: <a href="https://github.com/rpm-software-management/rpm/pull/444">Optimize and unite setting CLOEXEC on fds rpm-software-management&#x2F;rpm#444</a> (fixed in Fedora 28).</li><li>python2, reported in <a href="https://github.com/docker/for-linux/issues/502">Spawning PTY processes is many times slower on Docker 18.09 docker&#x2F;for-linux#502</a>, proposed fix: [<a href="https://github.com/python/cpython/pull/11584">2.7] bpo-35757: subprocess.Popen: optimize close_fds for Linux python&#x2F;cpython#11584</a> (WONTFIX as python2 is frozen)</li><li>python‚Äôs pexpect&#x2F;ptyprocess library, reported in <a href="https://github.com/pexpect/ptyprocess/issues/50">PtyProcess.spawn (and thus pexpect) slowdown in close() loop pexpect&#x2F;ptyprocess#50</a>.</li></ul><p>Attacking those one by one proved complicated and not very fruitful, as some software is obsoleted, some is hard to fix, etc. In addition, the above list is not a concise one, so there might be more cases like this we‚Äôre not aware of.</p><h3 id="Investigated-limits-impact-and-costs"><a href="#Investigated-limits-impact-and-costs" class="headerlink" title="Investigated limits impact and costs"></a>Investigated limits impact and costs</h3><p><code>2^16</code> (65k) <code>busybox</code> containers estimated resource usage:</p><ul><li>688k tasks + 206 GB (192 GiB) memory in <code>containerd</code> (<em>10.5 tasks + 3MiB per container</em>)</li><li>Requiring at minimum <code>LimitNOFILE=262144</code> (<code>containerd.service</code>) + <code>LimitNOFILE=393216</code> (<code>docker.service</code>) - based on <code>4:1</code> + <code>6:1</code> service FDs needed per container ratio.</li><li>2.49 million open files (<em><code>fs.file-nr</code> must be below <code>fs.file-max</code> limit</em>) - approx 38 FDs per container.</li><li>25 GiB memory for the containers cgroup (<em>approx 400KiB per container</em>).</li></ul><p><code>LimitNOFILE=524288</code> (<em>systemd default since v240</em>) should be more than enough for most systems as a sane default. This should be more than enough for both <code>docker.service</code> and <code>containerd.service</code> resource needs, capable of supporting 65k containers.</p><p>Containers that do need higher limits can explicitly declare that (<em>via <code>--ulimit</code> or equivalent</em>), as the upper bound is not impacted by <code>containerd.service</code>. The same can be done for lowering limits if necessary, both should rarely be necessary for most containers.</p><p>While <code>docker.service</code> and <code>containerd.service</code> need the higher soft limit (<em>enforced implicitly since Go 1.19</em>), it would be unlikely required for containers. An upcoming release of Go (with backports to 1.19) will implicitly restore the soft limit to <code>fork</code> &#x2F; <code>exec</code> processes AFAIK. Until then, the Docker daemon can be configured with <code>default-ulimit</code> setting to enforce a <code>1024</code> soft limit on containers.</p><h4 id="System-details"><a href="#System-details" class="headerlink" title="System details"></a>System details</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Fedora 37 VM 6.1.9 kernel x86_64 (16 GB memory)</span><br><span class="line">Docker v23, containerd 1.6.18, systemd v251</span><br><span class="line"></span><br><span class="line"># Additionally verified with builds before Go 1.19 to test soft limit lower than the hard limit:</span><br><span class="line">dnf install docker-ce-3:20.10.23 docker-ce-cli-1:20.10.23 containerd.io-1.6.8</span><br></pre></td></tr></table></figure><h4 id="Observations-in-service-files-for-LimitNOFILE"><a href="#Observations-in-service-files-for-LimitNOFILE" class="headerlink" title="Observations in .service files for LimitNOFILE"></a>Observations in <code>.service</code> files for <code>LimitNOFILE</code></h4><p>On a fresh install (<em>via VM on Vultr</em>) there was approx 1800 file descriptors open (<code>sysctl fs.file-nr</code>). I used a shell loop to run <code>busybox</code> containers until failure and adjusted the <code>LimitNOFILE</code> for <code>docker.service</code> and <code>containerd.service</code> to collect metrics for insights.</p><p>I noticed a consistent ratio of number of FDs needed per container:</p><ul><li><code>docker.service</code> - <code>6:1</code> ratio (<em><code>5:1</code> with <code>--network=host</code></em>), approx 853 containers with <code>LimitNOFILE=5120</code> (<em>1024 with host network</em>).</li><li><code>containerd.service</code> - <code>4:1</code> ratio (<em>I did not verify if <code>--network=host</code> reduced this</em>), <code>LimitNOFILE=1024</code> should be capable of 256 containers, provided <code>docker.service</code> is also high enough (eg: <code>LimitNOFILE=2048</code>_).</li></ul><p>In <code>containerd.service</code> there was also a clear pattern in resources per container, where the <code>LimitNOFILE</code> value, image used (<em><code>busybox</code>, <code>alpine</code>, <code>debian</code></em>), and number of containers remained constant:</p><ul><li><p>Each containers systemd <code>.scope</code> has 1 task and approx 400KiB memory (little bit less for <code>alpine</code> and <code>debian</code>).</p></li><li><p>10.5 tasks + 3MiB memory added per container to <code>systemctl status containerd</code> report.</p></li><li><p>Approx 38 open files per container running (<em><code>fs.file-nr</code> after, minus the before value, divided by number of containers</em>).</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mailserver/docker-mailserver:edge</span><br></pre></td></tr></table></figure><p>  was also tested to compare to the</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sleep 180</span><br></pre></td></tr></table></figure><p>  containers:</p><pre><code>- 33 tasks per container `.scope` and 85MiB memory reported via `systemd-cgtop` (*10GiB needed min to run 120 of these containers*).- In `containerd` per container average resources were 11 tasks + 3.4MiB memory (*approx 400MiB usage for 120 of these containers*). Roughly consistent with the lighter images resource usage in `containerd`.- Files opened per container also increased to 291 (*approx 35k files open for 120 of these containers*).- If you want to reproduce for this image, `docker run` should include these extra options: `--hostname example.test --env SMTP_ONLY=1` (*hostname required to init, `SMTP_ONLY=1` skips needing an account configured*).</code></pre><p>Operations like <code>docker stats</code> need to open as many file descriptors as total containers running, otherwise it‚Äôll hang waiting. You can observe if the daemon has reached the limit with <code>ls -1 /proc/$(pidof dockerd)/fd | wc -l</code>.</p><h4 id="Reproduction"><a href="#Reproduction" class="headerlink" title="Reproduction"></a>Reproduction</h4><p>Set <code>LimitNOFILE=768</code> in <code>docker.service</code>, then <code>systemctl daemon-reload &amp;&amp; systemctl restart docker</code>. You can confirm the limit is applied to the daemon process with <code>cat /proc/$(pidof dockerd)/limits</code>.</p><p>Running the following should list:</p><ul><li>How many containers are running.</li><li>Number of open files.</li><li>How many tasks and memory both the <code>containerd</code> and <code>dockerd</code> daemons are using.</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Useful to run before the loop to compare against output after the loop is done</span><br><span class="line">(pgrep containerd-shim | wc -l) &amp;&amp; sysctl fs.file-nr \</span><br><span class="line">  &amp;&amp; (echo &#x27;Containerd service:&#x27; &amp;&amp; systemctl status containerd | grep -E &#x27;Tasks|Memory&#x27;) \</span><br><span class="line">  &amp;&amp; (echo &#x27;Docker service:&#x27; &amp;&amp; systemctl status docker | grep -E &#x27;Tasks|Memory&#x27;)</span><br></pre></td></tr></table></figure><p>Running this loop below should fail on the last few containers, about 123 should be created:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># When `docker.service` limit is the bottleneck, you may need to `CTRL + C` to exit the loop</span><br><span class="line"># if it stalls while waiting for new FDs once exhausted and outputting errors:</span><br><span class="line">for i in $(seq 1 130); do docker run --rm -d busybox sleep 180; done</span><br></pre></td></tr></table></figure><p>You can add additional options:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--network host</span><br></pre></td></tr></table></figure><pre><code>- Avoids creating a new veth interface (see `ip link`) to the default Docker bridge each `docker run`.- Without this `docker run` [may fail after `1023` interfaces are present on a single bridge](https://github.com/moby/moby/issues/44973#issuecomment-1543747718)?- Creation will be a bit faster, and the FD to container ratio for `dockerd` is lowered to `5:1`.</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--ulimit &quot;nofile=1023456789&quot;</span><br></pre></td></tr></table></figure><pre><code>- Useful to observe that it does not affect memory usage on it&#39;s own.- Also shows `dockerd` + `containerd` limits don&#39;t affect how high this can go.- For Debian based distros this would fail as it&#39;s higher than `fs.nr_open` (`1 048 576`), use that or a lower value.</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--cgroup-parent=LimitTests.slice</span><br></pre></td></tr></table></figure><pre><code>- Similar to `docker stats` but isolated from other running containers. `systemd-cgtop` does include disk cache (*file-backed memory pages*) in it&#39;s reported memory usage however (*use `sync &amp;&amp; sysctl vm.drop_caches=3` to clear that*).- This can be useful if you want a better overview of resource usage across all the containers created:    - Create a temporary slice for testing with: `mkdir /sys/fs/cgroup/LimitTests.slice`.    - Run `systemd-cgtop --order=memory LimitTests.slice` to only view the containers running in this cgroup slice sorted by memory usage.    - Memory usage shown for the entire slice and per container. A `busybox` container uses roughly 400KB per container.</code></pre><h3 id="Limits-impact-across-process-children"><a href="#Limits-impact-across-process-children" class="headerlink" title="Limits impact across process children"></a>Limits impact across process children</h3><p>I had a misconception that child processes contributed to the parents open files limit. However as my notes in this section detail, it‚Äôs only inheriting the limits applied, each process seems to have it‚Äôs own individual count.</p><p>Although, I‚Äôm probably missing something here as I have read of processes passing down FDs to children, which is also why daemons have a common hygiene practice to close the FD range available I think? This is lower level than I‚Äôm familiar with üòÖ</p><ul><li>You can also observe the number of file descriptors open for the <code>dockerd</code> and <code>containerd</code> processes like this: <code>ls -1 /proc/$(pidof dockerd)/fd | wc -l</code>.</li><li>This isn‚Äôt applicable to the <code>containerd-shim</code> process that is responsible for the container, so <code>ls -1 /proc/$(pgrep --newest --exact containerd-shim)/fd | wc -l</code> won‚Äôt be useful there.</li></ul><p>To confirm this, run a container to test with: <code>docker run --rm -it --ulimit &quot;nofile=1024:1048576&quot; alpine ash</code>. Then try the following:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"># Create a folder to add many files to:</span><br><span class="line">mkdir /tmp/test; cd /tmp/test</span><br><span class="line"></span><br><span class="line"># Create empty files:</span><br><span class="line">for x in $(seq 3 2048); do touch &quot;$&#123;x&#125;.tmp&quot;; done</span><br><span class="line"></span><br><span class="line"># Open files to specific file descriptors:</span><br><span class="line">for x in $(seq 1000 1030); do echo &quot;$&#123;x&#125;&quot;; eval &quot;exec $&#123;x&#125;&lt; $&#123;x&#125;.tmp&quot;; done</span><br><span class="line"># Fails after 1024 because soft limit is capped there. Raise it:</span><br><span class="line">ulimit -Sn 2048</span><br><span class="line"></span><br><span class="line"># Now the loop before will be successful.</span><br><span class="line"># You could cover the whole original soft limit range (excluding FDs 0-2: stdin, stdout, stderr):</span><br><span class="line">for x in $(seq 3 1024); do echo &quot;$&#123;x&#125;&quot;; eval &quot;exec $&#123;x&#125;&lt; $&#123;x&#125;.tmp&quot;; done</span><br><span class="line"></span><br><span class="line"># Multiple container processes / children opening as many files:</span><br><span class="line"># You can run the same loop in a new shell process with `ash -c &#x27;for ... done&#x27;`</span><br><span class="line"># Or `docker exec` into the container from another terminal and run the loop at `/tmp/test` again.</span><br><span class="line"># Each can open files up to their current soft limit, it doesn&#x27;t matter what limits are set on `dockerd`, `containerd` or the containers PID 1.</span><br><span class="line"></span><br><span class="line">############</span><br><span class="line">### Tips ###</span><br><span class="line">############</span><br><span class="line"></span><br><span class="line"># You can observe the current limit applied:</span><br><span class="line">cat /proc/self/limits</span><br><span class="line"># And if you have not exhausted your FDs soft limit (due to the pipe),</span><br><span class="line"># this will report how much of the limit is used:</span><br><span class="line">ls -1 /proc/self/fd | wc -l</span><br><span class="line"># Otherwise, outside of the container if this is your only `ash` process running,</span><br><span class="line"># you can query it&#x27;s PID to get this information:</span><br><span class="line">ls -1 /proc/$(pgrep --newest --exact ash)/fd | wc -l</span><br><span class="line"></span><br><span class="line"># Process count in container:</span><br><span class="line"># `docker stats` should list a containers PIDs count for number of processes,</span><br><span class="line"># `systemd-cgtop` should report the same value in it&#x27;s Tasks column.</span><br><span class="line"># Alternatively if you know the cgroup name like `docker-&lt;CONTAINER_ID&gt;.scope`:</span><br><span class="line"># (NOTE: Path may differ if you used `--cgroup-parent`)</span><br><span class="line">cat /sys/fs/cgroup/system.slice/docker-&lt;CONTAINER_ID&gt;.scope/pids.current</span><br><span class="line"></span><br><span class="line"># List the processes with their PIDs:</span><br><span class="line"># For a single container, you can visualize the process tree:</span><br><span class="line">pstree --arguments --show-pids $(pgrep --newest --exact containerd-shim)</span><br><span class="line"># Alternatively if you know the cgroup name like `docker-&lt;CONTAINER_ID&gt;.scope`:</span><br><span class="line">systemd-cgls --unit docker-&lt;CONTAINER_ID&gt;.scope</span><br><span class="line"></span><br><span class="line"># You can also observe disk cache in memory monitoring by creating a 1GB file:</span><br><span class="line">dd if=/dev/zero of=bigfile bs=1M count=1000</span><br><span class="line">free -h</span><br><span class="line"># `systemd-cgtop` will include 1GB more in memory usage for the container,</span><br><span class="line"># while `docker stats` appears to account only 30MiB (scales proportionally).</span><br><span class="line"># Now clear the cache outside of the container and observe memory usage again:</span><br><span class="line">sync &amp;&amp; sysctl vm.drop_caches=3</span><br></pre></td></tr></table></figure><p>You will notice that:</p><ul><li><p>Each process adds those FDs to the open file count returned from <code>fs.file-nr</code>, and frees them when that process is closed.</p></li><li><p>You can re-run the loops for the same process and observe no change, the files are already counted as open for that process.</p></li><li><p>There is a memory cost involved:</p><ul><li>Each file <code>touch</code> costs about <code>2048</code> bytes (<em>disk-cache only until opened</em>).</li><li>Each file open (<em>1 or more FD references each increment <code>fs.file-nr</code></em>) costs about <code>512</code> bytes per FD open for it.</li><li>Creating 512k files this way uses approx 1.1GiB memory (<em>not released with <code>sysctl vm.drop_caches=3</code> while opened by at least one FD</em>), while each process opening the equivalent amount of file descriptors additionally uses 250MiB (262MB).</li></ul></li></ul><h3 id="Errors"><a href="#Errors" class="headerlink" title="Errors"></a>Errors</h3><p>Nothing useful here, other than depending on which service limit was exhausted first resulted in slightly different errors.</p><p>Sometimes this made any <code>docker</code> command like <code>docker ps</code> hang (daemon exhausted limit). I had also observed:</p><ul><li>Containers not running (<em>no <code>pgrep containerd-shim</code> output, but <code>docker ps</code> listed containers running well beyond when they should have exited</em>).</li><li>Containers running with <code>containerd-shim</code> process (using memory), despite <code>systemctl stop docker containerd</code>. Sometimes this needed <code>pkill containerd-shim</code> to cleanup and <code>systemctl start docker containerd</code> would log a bunch of errors in <code>journalctl</code> handling cleanup of dead shims (<em>depending on the number of containers, this may time out and need to start the <code>containerd</code> service again</em>).</li><li>Even with all that out of the way, there was some memory usage of several hundred MB from the baseline that lingered. As it didn‚Äôt seem to belong to any process, I assume it was kernel memory. I think the largest number of containers I experimented running with was around 1600-ish.</li></ul><h4 id="docker-service-limit-exceeded"><a href="#docker-service-limit-exceeded" class="headerlink" title="docker.service limit exceeded"></a><code>docker.service</code> limit exceeded</h4><p>This failure output more errors per <code>docker run</code> but the errors varied:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERRO[0000] Error waiting for container: container caff476371b6897ef35a95e26429f100d0d929120ff1abecc8a16aa674d692bf: driver &quot;overlay2&quot; failed to remove root filesystem: openfdat /var/lib/docker/overlay2/35f26ec862bb91d7c3214f76f8660938145bbb36eda114f67e711aad2be89578-init/diff/etc: too many open files </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker: Error response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: error during container init: error running hook #0: error running hook: exit status 1, stdout: , stderr: time=&quot;2023-03-12T02:26:20Z&quot; level=fatal msg=&quot;failed to create a netlink handle: could not get current namespace while creating netlink socket: too many open files&quot;: unknown.</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker: Error response from daemon: failed to initialize logging driver: open /var/lib/docker/containers/b014a19f7eb89bb909dee158d21f35f001cfeb80c01e0078d6f20aac8151573f/b014a19f7eb89bb909dee158d21f35f001cfeb80c01e0078d6f20aac8151573f-json.log: too many open files.</span><br></pre></td></tr></table></figure><h4 id="containerd-service-limit-exceeded"><a href="#containerd-service-limit-exceeded" class="headerlink" title="containerd.service limit exceeded"></a><code>containerd.service</code> limit exceeded</h4><p>I think I‚Äôve seen some others, but it‚Äôs usually this one:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker: Error response from daemon: failed to start shim: start failed: : pipe2: too many open files: unknown.</span><br></pre></td></tr></table></figure><h2 id="Scope-and-Explanation"><a href="#Scope-and-Explanation" class="headerlink" title="Scope and Explanation"></a>Scope and Explanation</h2><ul><li><p>Aug 2023: <code>LimitNOFILE=infinity</code>  <a href="https://github.com/moby/moby/pull/42373">remove from <code>docker.service</code></a></p></li><li><p>May 2021: <code>LimitNOFILE=infinity</code> + <code>LimitNPROC=infinity</code> <a href="https://github.com/moby/moby/pull/42373">brought back into <code>docker.service</code></a> to sync with Docker CE‚Äôs equivalent config.</p><ul><li>This PR was a merge commit of <a href="https://github.com/moby/moby/commit/80039b4699e36ceb0eb81109cd1686aaa805c5ec">this one from Sep 2018</a> (<em>commit history interleaved ranges from 2017-2021</em>).</li><li>As the PR main diff shows, <code>LimitNPROC=infinity</code> was already added, and <code>LimitNOFILE=1048576</code> was changed to <code>infinity</code> by the PR merge (<em>initially confused since I‚Äôm using <code>git blame</code> on the master branch</em>).</li></ul></li><li><p>July 2016: <a href="https://github.com/moby/moby/pull/24555"><code>LimitNOFILE=infinity</code> changed to <code>LimitNOFILE=1048576</code></a> (<em>this number is <code>2^20</code></em>).</p><ul><li>Discussion references a <a href="https://stackoverflow.com/questions/1212925/on-linux-set-maximum-open-files-to-unlimited-possible">2009 StackOverflow answer</a> about <code>infinity</code> being capped to <code>2^20</code> in a specific distro release &#x2F; kernel. On some systems today, that ceiling can be 1024 times higher (<em><code>2^30 == 1073741816</code>, over 1 billion</em>).</li></ul></li><li><p>July 2016: <a href="https://github.com/moby/moby/pull/24307"><code>LimitNOFILE</code> and <code>LimitNPROC</code> changed from <code>1048576</code> to <code>infinity</code></a></p><ul><li>This PR reverted the <code>LimitNOFILE</code> change shortly after as described above.</li></ul></li><li><p>March 2014: <a href="https://github.com/moby/moby/pull/4455#issuecomment-36679884">Original <code>LimitNOFILE</code> + <code>LimitNPROC</code> added with <code>1048576</code></a>.</p><ul><li><p>Linked PR comment mentions that this 2^20 value is already higher than Docker needs:</p></li><li><p>It appears it was later changed to <code>infinity</code> to improve CI times where a smaller limit was applied (<em>like <a href="https://stackoverflow.com/questions/1212925/on-linux-set-maximum-open-files-to-unlimited-possible#comment76259289_1213069">this comment about Ubuntu 14.04 adjusting any limit exceeding <code>2^20</code> to <code>2^10</code>?</a></em>).</p></li><li><p>PR also [referenced relevant systemd docs](<a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#Process">https://www.freedesktop.org/software/systemd/man/systemd.exec.html#Process</a> Properties) (<em>which may have changed since 2014</em>)</p></li></ul></li></ul><hr><p><strong>Current Status:</strong></p><ul><li><code>LimitNOFILE=infinity</code> is still the case until Docker v25, unless the team is backporting it to any releases built with Go 1.19+</li><li><code>containerd</code> has <a href="https://github.com/containerd/containerd/pull/8924">merged the equivalent change to remove <code>LimitNOFILE</code></a> from their systemd service file.</li></ul><h3 id="Systemd-240"><a href="#Systemd-240" class="headerlink" title="Systemd &lt; 240"></a>Systemd &lt; 240</h3><p>Why is LimitNOFILE not set to infinity when configured in the service?</p><p>After setting LimitNOFILE to infinity in the service, when checking the limit of the process ID (pid), it is observed that the open file limit is 65536 instead of infinity.</p><p>Please review the service configuration.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@XXX ~]# ulimit -n -u</span><br><span class="line">open files                      (-n) 1024</span><br><span class="line">max user processes              (-u) 499403</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>containerd systemd configuration:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/lib/systemd/system/containerd.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=containerd container runtime</span><br><span class="line">Documentation=https://containerd.io</span><br><span class="line">After=network.target local-fs.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStartPre=-/sbin/modprobe overlay</span><br><span class="line">ExecStart=/usr/local/bin/containerd</span><br><span class="line"></span><br><span class="line">Type=notify</span><br><span class="line">Delegate=yes</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=5</span><br><span class="line"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class="line"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line"># Comment TasksMax if your systemd version does not supports it.</span><br><span class="line"># Only systemd 226 and above support this version.</span><br><span class="line">TasksMax=infinity</span><br><span class="line">OOMScoreAdjust=-999</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>Viewing the configuration effect</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@XXX ~]# cat /proc/$(pidof dockerd)/limits</span><br><span class="line">Limit                     Soft Limit           Hard Limit           Units     </span><br><span class="line">Max cpu time              unlimited            unlimited            seconds   </span><br><span class="line">Max file size             unlimited            unlimited            bytes     </span><br><span class="line">Max data size             unlimited            unlimited            bytes     </span><br><span class="line">Max stack size            8388608              unlimited            bytes     </span><br><span class="line">Max core file size        unlimited            unlimited            bytes     </span><br><span class="line">Max resident set          unlimited            unlimited            bytes     </span><br><span class="line">Max processes             unlimited            unlimited            processes </span><br><span class="line">Max open files            1048576              1048576              files     </span><br><span class="line">Max locked memory         65536                65536                bytes     </span><br><span class="line">Max address space         unlimited            unlimited            bytes     </span><br><span class="line">Max file locks            unlimited            unlimited            locks     </span><br><span class="line">Max pending signals       499403               499403               signals   </span><br><span class="line">Max msgqueue size         819200               819200               bytes     </span><br><span class="line">Max nice priority         0                    0                    </span><br><span class="line">Max realtime priority     0                    0                    </span><br><span class="line">Max realtime timeout      unlimited            unlimited            us        </span><br><span class="line">[root@XXX ~]# cat /proc/$(pidof containerd)/limits</span><br><span class="line">Limit                     Soft Limit           Hard Limit           Units     </span><br><span class="line">Max cpu time              unlimited            unlimited            seconds   </span><br><span class="line">Max file size             unlimited            unlimited            bytes     </span><br><span class="line">Max data size             unlimited            unlimited            bytes     </span><br><span class="line">Max stack size            8388608              unlimited            bytes     </span><br><span class="line">Max core file size        unlimited            unlimited            bytes     </span><br><span class="line">Max resident set          unlimited            unlimited            bytes     </span><br><span class="line">Max processes             unlimited            unlimited            processes </span><br><span class="line">Max open files            1048576              1048576              files     </span><br><span class="line">Max locked memory         65536                65536                bytes     </span><br><span class="line">Max address space         unlimited            unlimited            bytes     </span><br><span class="line">Max file locks            unlimited            unlimited            locks     </span><br><span class="line">Max pending signals       499403               499403               signals   </span><br><span class="line">Max msgqueue size         819200               819200               bytes     </span><br><span class="line">Max nice priority         0                    0                    </span><br><span class="line">Max realtime priority     0                    0                    </span><br><span class="line">Max realtime timeout      unlimited            unlimited            us</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">This has systemd look at /proc/sys/fs/nr_open to find the current maximum of</span><br><span class="line">open files compiled into the kernel and tries to set the RLIMIT_NOFILE max to</span><br><span class="line">it. This has the advantage the value chosen as limit is less arbitrary and also</span><br><span class="line">improves the behavior of systemd in containers that have an rlimit set: When</span><br><span class="line">systemd currently starts in a container that has RLIMIT_NOFILE set to e.g.</span><br><span class="line">100000 systemd will lower it to 65536. With this patch systemd will try to set</span><br><span class="line">the nofile limit to the allowed kernel maximum. If this fails, it will compute</span><br><span class="line">the minimum of the current set value (the limit that is set on the container)</span><br><span class="line">and the maximum value as soft limit and the currently set maximum value as the</span><br><span class="line">maximum value. This way it retains the limit set on the container.</span><br></pre></td></tr></table></figure><p>see: <a href="https://github.com/systemd/systemd/issues/6559">https://github.com/systemd/systemd/issues/6559</a></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://github.com/moby/moby/issues/45838">https://github.com/moby/moby/issues/45838</a></li><li><a href="https://github.com/moby/moby/issues/23137">https://github.com/moby/moby/issues/23137</a></li><li><a href="https://0pointer.net/blog/file-descriptor-limits.html">https://0pointer.net/blog/file-descriptor-limits.html</a></li><li><a href="https://www.codenong.com/cs105896693/">https://www.codenong.com/cs105896693/</a></li><li><a href="https://github.com/moby/moby/issues/38814">https://github.com/moby/moby/issues/38814</a></li><li><a href="https://github.com/cri-o/cri-o/issues/7703">https://github.com/cri-o/cri-o/issues/7703</a></li><li><a href="https://github.com/envoyproxy/envoy/issues/31502">https://github.com/envoyproxy/envoy/issues/31502</a></li><li><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#Process%20Properties">https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#Process%20Properties</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;thanks &lt;strong&gt;&lt;a href=&quot;https://github.com/polarathene&quot;&gt;polarathene&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Description&quot;&gt;&lt;a h</summary>
      
    
    
    
    <category term="container" scheme="https://zoues.com/categories/container/"/>
    
    
    <category term="kubernetes" scheme="https://zoues.com/tags/kubernetes/"/>
    
    <category term="cncf" scheme="https://zoues.com/tags/cncf/"/>
    
    <category term="container" scheme="https://zoues.com/tags/container/"/>
    
  </entry>
  
  <entry>
    <title>Interpreting common exit codes in Kubernetes You Need to Know</title>
    <link href="https://zoues.com/posts/45fc99a8/"/>
    <id>https://zoues.com/posts/45fc99a8/</id>
    <published>2024-03-06T12:23:48.000Z</published>
    <updated>2024-03-06T10:21:52.287Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Interpreting-common-exit-codes-in-Kubernetes"><a href="#Interpreting-common-exit-codes-in-Kubernetes" class="headerlink" title="Interpreting common exit codes in Kubernetes"></a>Interpreting common exit codes in Kubernetes</h2><p>In this article, we will delve into Kubernetes exit codes 127 and 137, explaining what they are, common causes in K8s and Docker, and how to fix them!</p><p>We will cover:</p><ol><li>History of exit codes</li><li>Exit code 127</li><li>Exit code 137</li></ol><h2 id="The-History-of-Exit-Codes"><a href="#The-History-of-Exit-Codes" class="headerlink" title="The History of Exit Codes"></a>The History of Exit Codes</h2><p>The history of process exit codes can be traced back to the early days of the Unix operating system. In Unix systems, a process exit code is an integer value passed to its parent process upon termination, used to indicate the termination status of the process. This integer value typically falls between 0 and 255, where 0 indicates successful termination, and other values are usually used to represent different errors or exceptional conditions.</p><p>Process exit codes were initially designed to provide a simple mechanism for parent processes to understand the outcome of their child processes‚Äô execution. This allows parent processes to take appropriate actions based on the exit code of the child process, such as handling error conditions or continuing with other operations.</p><p>In Unix systems, specific exit code values often have specific meanings, such as:</p><ul><li>0: Indicates successful execution without errors.</li><li>1: Typically signifies a general error.</li><li>2: Indicates a syntax error in the command.</li><li>127: Indicates command not found.</li></ul><p>Over time, with the development of Unix operating systems and different implementations, the meanings of process exit codes may vary, but the basic concept remains unchanged.</p><p>In Linux systems, the usage of process exit codes is similar to Unix systems. Linux inherits Unix‚Äôs process management mechanism and extends and improves upon it. Therefore, process exit codes remain an important concept in Linux, used to aid in understanding and diagnosing the execution status of processes.</p><p>The history of process exit codes can be traced back to the early days of Unix systems and is an important concept in both Unix and Linux operating systems, providing a simple yet effective mechanism for inter-process communication. When an application or command terminates or fails to execute due to a fatal error, it produces exit codes in the 128 series (<code>128+n</code>), where <code>n</code> represents the signal number. <code>n</code> includes all types of termination codes, such as <code>SIGTERM</code>, <code>SIGKILL</code>, etc.</p><h2 id="Exit-Code-127"><a href="#Exit-Code-127" class="headerlink" title="Exit Code 127"></a>Exit Code 127</h2><p>Exit code 127 is not a Kubernetes-specific error code, but rather a standard exit code used in Linux and similar Unix-like operating systems. However, it is frequently encountered in Kubernetes and typically indicates that a command or binary executed within a container could not be found.</p><p>Some standard exit codes include:</p><table><thead><tr><th>Exit Code</th><th>Explanation</th></tr></thead><tbody><tr><td>0</td><td>Command executed successfully</td></tr><tr><td>1</td><td>General error</td></tr><tr><td>2</td><td>Misuse of shell builtins</td></tr><tr><td>126</td><td>Permission denied, command invoked cannot execute</td></tr><tr><td>127</td><td>Command not found, incorrect PATH</td></tr><tr><td>128+n</td><td>Command terminated by signal, fatal error encountered</td></tr><tr><td>&gt;255</td><td>Exit codes beyond 255 will be re-calculated (mod 256)</td></tr></tbody></table><p>Let‚Äôs take a look at some common reasons for exit code 127:</p><ol><li><p>Command or binary not installed</p><p>The executable specified in the <code>command</code> field of a Kubernetes container is not installed in the container‚Äôs file system. Ensure that the required binary or command is available.</p></li><li><p>Incorrect path or command</p><p>The command specified in the Pod definition is incorrect or does not exist in the specified path. This is one of the most common errors, often caused by incorrect input in the Dockerfile or pod spec‚Äôs <code>entrypoint</code> or <code>command</code>.</p></li><li><p>Missing dependencies</p><p>The application or script running inside the container lacks necessary dependencies. Ensure that all required dependencies are included in the container image.</p></li><li><p>Shell interpreter</p><p>If a script is specified as a command, ensure that the script is valid (e.g., <code>#!/bin/bash</code>) and available in the container.</p></li><li><p>Shell script syntax error</p><p>If the shell script exits with code 127, check if there are syntax errors in the script or issues preventing its execution.</p></li><li><p>Insufficient permissions</p><p>The user running the command inside the container may not have the necessary permissions to execute the specified command. Ensure that the container runs with appropriate privileges.</p></li><li><p>Image compatibility issues</p><p>Ensure that the container image used is compatible with the host architecture and operating system. Mismatched images may result in commands not being found, such as running an x86 image on an ARM machine.</p></li><li><p>Volume mounts</p><p>If the command relies on files mounted from a volume, check if the volume mount is configured correctly and the required files are accessible.</p></li><li><p>Environment variables</p><p>Some commands may depend on specific environment variables. Ensure that the necessary environment variables are set correctly.</p></li><li><p>Kubernetes RBAC policies</p><p>If RBAC is enabled, ensure that the necessary permissions are granted to execute the specified command.</p></li></ol><h3 id="How-to-Troubleshoot"><a href="#How-to-Troubleshoot" class="headerlink" title="How to Troubleshoot"></a>How to Troubleshoot</h3><p>To diagnose the issue, you can use the following commands to check the logs of the Pod:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs -f </span><br></pre></td></tr></table></figure><p>You can also inspect the Pod‚Äôs status, which provides detailed information about the Pod, including its current state, recent events, and any error messages.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod </span><br></pre></td></tr></table></figure><p>Additionally, you can attach a debugging container to the Pod, which includes a shell (e.g., BusyBox). This allows you to enter the container and manually check the availability of environment, paths, and commands.</p><p>Example of debugging with BusyBox:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">containers:</span><br><span class="line">  - name: test</span><br><span class="line">    image: test</span><br><span class="line">    command: [&quot;/bin/sleep&quot;, &quot;36000&quot;]</span><br><span class="line">  - name: debug</span><br><span class="line">    image: busybox</span><br><span class="line">    command: [&quot;/bin/sh&quot;]</span><br></pre></td></tr></table></figure><p>If you are using a higher version of Kubernetes, you can also utilize Ephemeral Containers, which are temporary containers. This is a new feature introduced as alpha in Kubernetes v1.16, and enabling the feature of Ephemeral Containers is straightforward. Just configure <code>--feature-gates=EphemeralContainers=true</code> in the kube-api and kubelet services, then restart.</p><p>By carefully examining the logs and investigating in the above directions, you should be able to determine the cause of the exit code 127 issue.</p><h3 id="How-to-Fix"><a href="#How-to-Fix" class="headerlink" title="How to Fix"></a>How to Fix</h3><p>Now that we know the common causes of exit code 127 and how to troubleshoot them, let‚Äôs see how to fix them.</p><ol><li>Command or binary not installed</li></ol><p>If the required command or binary is missing, it may need to be installed in the container image. Modify the Dockerfile or the build process to install the necessary software.</p><p>Example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:latest </span><br><span class="line">RUN apk --no-cache add &lt;package&gt; </span><br></pre></td></tr></table></figure><ol><li>Incorrect path or command</li></ol><p>When specifying commands in the Pod definition, consider using the absolute path of the binary. This helps ensure that the binary is found by the runtime, regardless of the current working directory.</p><p>Example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">containers:</span><br><span class="line">  - name: test</span><br><span class="line">    image: test</span><br><span class="line">    command: [&quot;/usr/bin/command&quot;]</span><br></pre></td></tr></table></figure><ol><li>Missing dependencies</li></ol><p>The reason for the command not running may be that additional software needs to be installed in the container image. If the command requires additional setup or installation steps, you can use init containers to perform these tasks before the main container starts.</p><p>Example (installing a package using init container):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">initContainers:</span><br><span class="line">  - name: install-package</span><br><span class="line">    image: alpine:latest</span><br><span class="line">    command: [&quot;apk&quot;, &quot;--no-cache&quot;, &quot;add&quot;, &quot;&lt;package-name&gt;&quot;]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: shared-data</span><br><span class="line">      mountPath: /data</span><br></pre></td></tr></table></figure><ol><li>Shell interpreter</li></ol><p>If a script is specified as a command, ensure that the script is valid (e.g., <code>#!/bin/bash</code>) and available in the container.</p><p>Example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br></pre></td></tr></table></figure><ol><li>Volume mounts</li></ol><p>Check the Pod‚Äôs configuration to ensure that volumes are correctly mounted. Verify that the volume names, mount paths, and subPaths are correct.</p><p>Example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">  - name: test</span><br><span class="line">    emptyDir: &#123;&#125;</span><br><span class="line">containers:</span><br><span class="line">  - name: test</span><br><span class="line">    image: test</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: test</span><br><span class="line">      mountPath: /path in container</span><br></pre></td></tr></table></figure><p>Additionally, confirm that the volume specified in the Pod definition exists and is accessible. If it‚Äôs a persistent volume (PV), check its status. If it‚Äôs an emptyDir or other types of volumes, verify that they are created and mounted correctly. If subPaths are used in the volume mount, ensure that the specified subPaths exist in the source directory or file.</p><p>Example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">volumeMounts:</span><br><span class="line">  - name: test</span><br><span class="line">    mountPath: /path in container</span><br><span class="line">    subPath: my-file.txt</span><br></pre></td></tr></table></figure><h2 id="Exit-Code-137"><a href="#Exit-Code-137" class="headerlink" title="Exit Code 137"></a>Exit Code 137</h2><p>In Kubernetes, the exit code 137 indicates that the process was terminated forcibly. In Unix and Linux systems, when a process is terminated due to a signal, the exit code is determined by adding the signal number to 128. Since the signal number for ‚ÄúSIGKILL‚Äù is 9, adding 128 to 9 results in exit code 137.</p><p>When a container exceeds its memory limit in a Kubernetes cluster, it may be terminated by the Kubernetes system with an ‚ÄúOOMKilled‚Äù error, indicating that the process was terminated due to insufficient memory. The exit code for this error is 137, where OOM stands for ‚Äúout-of-memory‚Äù.</p><p>If the Pod state shows as ‚ÄúOOMKilled‚Äù, you can check it using the following command:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pods PODNAME</span><br></pre></td></tr></table></figure><h3 id="OOMKiller"><a href="#OOMKiller" class="headerlink" title="OOMKiller"></a>OOMKiller</h3><p>OOMKiller is a mechanism in the Linux kernel responsible for preventing the system from running out of memory by terminating processes that consume too much memory. When the system runs out of memory, the kernel invokes OOMKiller to select a process to terminate in order to free up memory and keep the system running.</p><p>There are two different OOM Killers in the kernel; one is the global OOM Killer, and the other is the OOM Killer based on cgroup memory control, which can be either cgroup v1 or cgroup v2.</p><p>In summary, when the kernel encounters issues allocating physical memory pages, the global OOM Killer is triggered. When the kernel attempts to allocate memory pages (whether for kernel use or for processes needing pages) and initially fails, it tries various ways to reclaim and consolidate memory. If this attempt is successful or at least makes some progress, the kernel will continue retrying allocation (from the code I can see); if it fails to free pages or make progress, it will often trigger the OOM Killer in many cases.</p><p>Once the OOMKiller selects a process to terminate, it sends a signal to that process requesting it to gracefully terminate. If the process does not respond to the signal, the kernel forcibly terminates the process and releases its memory.</p><p>Note: Pods terminated due to memory issues may not necessarily be evicted from the node; if their restart policy is set to ‚ÄúAlways‚Äù, they will attempt to restart the Pod.</p><p>At the system level, the Linux kernel maintains an oom_score for each process running on the host. The likelihood of a process being terminated depends on how high the score is.</p><p>The oom_score_adj value allows users to customize OOM processes and define when processes should be terminated. Kubernetes uses the oom_score_adj value when defining the Quality of Service (QoS) of Pods.</p><p>Kubernetes defines three types of QoS for Pods, each with a corresponding oom_score_adj value:</p><ul><li>Guaranteed: -997</li><li>BestEffort: 1000</li><li>Burstable: <em>min(max(2, 1000 ‚Äî (1000 * memoryRequestBytes) &#x2F; machineMemoryCapacityBytes), 999)</em></li></ul><p>Where Pods of Guaranteed QoS have an oom_score_adj value of -997, so they are the last ones to be terminated when the node runs out of memory. BestEffort Pod configurations have an oom_score_adj value of 1000, so they are the first ones to be terminated.</p><p>To check the QoS of a Pod, you can use the following command:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -o jsonpath=&#x27;&#123;.status.qosClass&#125;&#x27;</span><br></pre></td></tr></table></figure><p>Here‚Äôs the calculation policy for defining Pods of <code>Guaranteed</code> QoS type:</p><ul><li>Each container in the Pod must have memory limits and memory requests.</li><li>For each container in the Pod, the memory limit must be equal to the memory request.</li><li>Each container in the Pod must have CPU limits and CPU requests.</li><li>For each container in the Pod, the CPU limit must be equal to the CPU request.</li></ul><p>Exit code 137 typically has two scenarios:</p><p>First and foremost, the most common cause is related to resource constraints. In this scenario, Kubernetes typically exceeds the memory allocation limit of the container. When this happens, it terminates the container to ensure the stability of the node.</p><p>The other scenario involves manual intervention - a user or a script may send a ‚ÄúSIGKILL‚Äù signal to the container process, resulting in this exit code. OOMKilled (exit code 137)</p><h3 id="How-to-Troubleshoot-1"><a href="#How-to-Troubleshoot-1" class="headerlink" title="How to Troubleshoot"></a>How to Troubleshoot</h3><ol><li>Check Pod logs</li></ol><p>The first step in diagnosing OOMKilled errors is to check the Pod logs for any error messages indicating memory issues. The events section of the describe command will provide further confirmation and the time&#x2F;date of the error occurrence.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod &lt;podname&gt;</span><br><span class="line">State:          Running</span><br><span class="line">       Started:      Fri, 12 May 2023 11:14:13 +0200</span><br><span class="line">       Last State:   Terminated</span><br><span class="line">       Reason:       OOMKilled</span><br><span class="line">       Exit Code:    137</span><br><span class="line">       ...</span><br></pre></td></tr></table></figure><p>You can also query the Pod logs:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/log/pods/&lt;podname&gt;</span><br></pre></td></tr></table></figure><p>Of course, you can also do it via (standard output)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs -f &lt;podname&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>Monitor memory usage</li></ol><p>Monitor memory usage in Pods and containers using monitoring systems like Prometheus or Grafana. This can help us identify which containers are consuming too much memory and triggering OOMKilled errors, and you can use dmesg on the container host to check the scene of the oomkiller.</p><ol start="3"><li>Use memory profilers</li></ol><p>Use memory profilers like pprof to identify memory leaks or inefficient code that may be causing excessive memory usage.</p><h3 id="How-to-Fix-1"><a href="#How-to-Fix-1" class="headerlink" title="How to Fix"></a>How to Fix</h3><p>Below are common causes of OOMKilled Kubernetes errors and their solutions.</p><ol><li>Container memory limit reached</li></ol><p>This may be due to improper setting of the memory limit value specified in the container. The solution is to increase the value of the memory limit or investigate the root cause of the increased load and correct it. Common causes of this situation include large file uploads, as uploading large files can consume a significant amount of memory resources, especially when multiple containers are running in a single Pod, and sudden increases in traffic volume.</p><ol start="2"><li>Application memory leak, container memory usage reaches the upper limit</li></ol><p>Debug the application to locate the cause of the memory leak.</p><ol start="3"><li>Total memory used by all Pods exceeds available node memory</li></ol><p>Increase the available memory of the node by increasing the memory of the node, or migrate Pods to nodes with more memory. Alternatively, adjust the memory limits of Pods running on the node to comply with memory constraints.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://spacelift.io/blog/oomkilled-exit-code-137">https://spacelift.io/blog/oomkilled-exit-code-137</a></p><p><a href="https://spacelift.io/blog/exit-code-127">https://spacelift.io/blog/exit-code-127</a></p><p><a href="https://cloud.tencent.com/developer/news/1152344">https://cloud.tencent.com/developer/news/1152344</a></p><p><a href="https://utcc.utoronto.ca/~cks/space/blog/linux/OOMKillerWhen">https://utcc.utoronto.ca/~cks/space/blog/linux/OOMKillerWhen</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Interpreting-common-exit-codes-in-Kubernetes&quot;&gt;&lt;a href=&quot;#Interpreting-common-exit-codes-in-Kubernetes&quot; class=&quot;headerlink&quot; title=&quot;Inte</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Ëß£ËØªKubernetesÂ∏∏ËßÅÈîôËØØÁ†Å</title>
    <link href="https://zoues.com/posts/b421b57/"/>
    <id>https://zoues.com/posts/b421b57/</id>
    <published>2024-03-02T12:23:48.000Z</published>
    <updated>2024-03-03T01:09:03.172Z</updated>
    
    <content type="html"><![CDATA[<p>Âú®ËøôÁØáÊñáÁ´†‰∏≠ÔºåÊàë‰ª¨Â∞ÜÊ∑±ÂÖ•ÂàÜÊûêKubernetes‰∏≠ÁöÑÈÄÄÂá∫Á†Å127‰∏é137ÔºåËß£ÈáäÂÆÉ‰ª¨ÊòØ‰ªÄ‰πàÔºåK8sÂíåDocker‰∏≠Â∏∏ËßÅÁöÑÂéüÂõ†ÊòØ‰ªÄ‰πàÔºå‰ª•ÂèäÂ¶Ç‰Ωï‰øÆÂ§çÂÆÉ‰ª¨ÔºÅ</p><p>Êàë‰ª¨Â∞ÜÊ∂µÁõñ‰ª•‰∏ãÂÜÖÂÆπÔºö</p><ol><li><p>ÈÄÄÂá∫Á†ÅÁöÑÂéÜÂè≤ </p></li><li><p>ÈÄÄÂá∫Á†Å 127</p></li><li><p>ÈÄÄÂá∫Á†Å 137</p></li></ol><h2 id="ÈÄÄÂá∫Á†ÅÁöÑÂéÜÂè≤"><a href="#ÈÄÄÂá∫Á†ÅÁöÑÂéÜÂè≤" class="headerlink" title="ÈÄÄÂá∫Á†ÅÁöÑÂéÜÂè≤"></a>ÈÄÄÂá∫Á†ÅÁöÑÂéÜÂè≤</h2><p>ËøõÁ®ãÈÄÄÂá∫Á†ÅÁöÑÂéÜÂè≤ÂèØ‰ª•ËøΩÊ∫ØÂà∞UnixÊìç‰ΩúÁ≥ªÁªüÁöÑÊó©Êúü„ÄÇÂú®UnixÁ≥ªÁªü‰∏≠ÔºåËøõÁ®ãÈÄÄÂá∫Á†ÅÊòØËøõÁ®ãÁªàÊ≠¢Êó∂ÂêëÂÖ∂Áà∂ËøõÁ®ã‰º†ÈÄíÁöÑ‰∏Ä‰∏™Êï¥Êï∞ÂÄºÔºåÁî®‰∫éË°®Á§∫ËøõÁ®ãÁöÑÁªàÊ≠¢Áä∂ÊÄÅ„ÄÇËøô‰∏™Êï¥Êï∞ÂÄºÈÄöÂ∏∏Âú®0Âà∞255‰πãÈó¥ÔºåÂÖ∂‰∏≠0Ë°®Á§∫ËøõÁ®ãÊàêÂäüÁªàÊ≠¢ÔºåÂÖ∂‰ªñÂÄºÈÄöÂ∏∏Áî®Êù•Ë°®Á§∫‰∏çÂêåÁöÑÈîôËØØÊàñÂºÇÂ∏∏ÊÉÖÂÜµ„ÄÇ</p><p>ËøõÁ®ãÈÄÄÂá∫Á†ÅÊúÄÂàùË¢´ËÆæËÆ°Áî®‰∫éÊèê‰æõ‰∏ÄÁßçÁÆÄÂçïÁöÑÊú∫Âà∂Ôºå‰ΩøÁà∂ËøõÁ®ãËÉΩÂ§ü‰∫ÜËß£Â≠êËøõÁ®ãÁöÑÊâßË°åÁªìÊûú„ÄÇËøô‰ΩøÂæóÁà∂ËøõÁ®ãËÉΩÂ§üÊ†πÊçÆÂ≠êËøõÁ®ãÁöÑÈÄÄÂá∫Á†ÅÊù•ÈááÂèñÈÄÇÂΩìÁöÑË°åÂä®ÔºåÊØîÂ¶ÇÂ§ÑÁêÜÈîôËØØÊÉÖÂÜµÊàñÁªßÁª≠ÊâßË°åÂÖ∂‰ªñÊìç‰Ωú„ÄÇ</p><p>Âú®UnixÁ≥ªÁªü‰∏≠ÔºåÁâπÂÆöÁöÑÈÄÄÂá∫Á†ÅÂÄºÈÄöÂ∏∏ÂÖ∑ÊúâÁâπÂÆöÁöÑÂê´‰πâÔºå‰æãÂ¶ÇÔºö</p><ul><li>0ÔºöË°®Á§∫ÊàêÂäüÊâßË°åÔºåÊ≤°ÊúâÈîôËØØ„ÄÇ</li><li>1ÔºöÈÄöÂ∏∏Ë°®Á§∫ÈÄöÁî®ÁöÑÈîôËØØ„ÄÇ</li><li>2ÔºöË°®Á§∫ÂëΩ‰ª§ÁöÑËØ≠Ê≥ïÈîôËØØ„ÄÇ</li><li>127ÔºöË°®Á§∫ÂëΩ‰ª§Êú™ÊâæÂà∞„ÄÇ</li></ul><p>ÈöèÁùÄÊó∂Èó¥ÁöÑÊé®ÁßªÔºåUnixÊìç‰ΩúÁ≥ªÁªüÁöÑÂèëÂ±ïÂíå‰∏çÂêåÁöÑÂÆûÁé∞ÔºåËøõÁ®ãÈÄÄÂá∫Á†ÅÁöÑÂê´‰πâÂèØËÉΩÊúâÊâÄ‰∏çÂêåÔºå‰ΩÜÂü∫Êú¨ÁöÑÊ¶ÇÂøµ‰øùÊåÅ‰∏çÂèò„ÄÇ</p><p>Âú®LinuxÁ≥ªÁªü‰∏≠ÔºåËøõÁ®ãÈÄÄÂá∫Á†ÅÁöÑ‰ΩøÁî®‰∏éUnixÁ≥ªÁªüÁ±ª‰ºº„ÄÇLinuxÁªßÊâø‰∫ÜUnixÁöÑËøõÁ®ãÁÆ°ÁêÜÊú∫Âà∂ÔºåÂπ∂Âú®ÂÖ∂Âü∫Á°Ä‰∏äËøõË°å‰∫ÜÊâ©Â±ïÂíåÊîπËøõ„ÄÇÂõ†Ê≠§ÔºåLinux‰∏≠ÁöÑËøõÁ®ãÈÄÄÂá∫Á†Å‰ªçÁÑ∂ÊòØ‰∏Ä‰∏™ÈáçË¶ÅÁöÑÊ¶ÇÂøµÔºåÁî®‰∫éÂ∏ÆÂä©ÁêÜËß£ÂíåËØäÊñ≠ËøõÁ®ãÁöÑÊâßË°åÁä∂ÊÄÅ„ÄÇ</p><p>ËøõÁ®ãÈÄÄÂá∫Á†ÅÁöÑÂéÜÂè≤ÂèØ‰ª•ËøΩÊ∫ØÂà∞Êó©ÊúüÁöÑUnixÁ≥ªÁªüÔºåÊòØUnixÂíåLinuxÊìç‰ΩúÁ≥ªÁªü‰∏≠ÁöÑ‰∏Ä‰∏™ÈáçË¶ÅÊ¶ÇÂøµÔºå‰∏∫ËøõÁ®ãÈó¥ÈÄö‰ø°Êèê‰æõ‰∫Ü‰∏ÄÁßçÁÆÄÂçïËÄåÊúâÊïàÁöÑÊú∫Âà∂„ÄÇÂΩìÂ∫îÁî®Á®ãÂ∫èÊàñÂëΩ‰ª§Âõ†Ëá¥ÂëΩÈîôËØØËÄåÁªàÊ≠¢ÊàñÊâßË°åÂ§±Ë¥•Êó∂ÔºåÂ∞Ü‰∫ßÁîü 128 Á≥ªÂàóÈÄÄÂá∫Á†ÅÔºà<code>128+n</code>ÔºâÔºåÂÖ∂‰∏≠ <code>n</code> ‰∏∫‰ø°Âè∑ÁºñÂè∑„ÄÇ<code>n</code> ÂåÖÊã¨ÊâÄÊúâÁ±ªÂûãÁöÑÁªàÊ≠¢‰ª£Á†ÅÔºåÂ¶Ç <code>SIGTERM</code>„ÄÅ<code>SIGKILL</code> Á≠â„ÄÇ</p><h2 id="ÈÄÄÂá∫Á†Å127"><a href="#ÈÄÄÂá∫Á†Å127" class="headerlink" title="ÈÄÄÂá∫Á†Å127"></a>ÈÄÄÂá∫Á†Å127</h2><p>ÈÄÄÂá∫Á†Å 127 ‰∏çÊòØÁâπÂÆö‰∫é Kubernetes ÁöÑÈîôËØØ‰ª£Á†ÅÔºåËÄåÊòØ Linux ÂíåÁ±ª Unix Êìç‰ΩúÁ≥ªÁªü‰∏≠‰ΩøÁî®ÁöÑÊ†áÂáÜÈÄÄÂá∫Á†Å„ÄÇÂΩìÁÑ∂ÔºåÊàë‰ª¨Âú®Kubernetes‰∏≠ÁªèÂ∏∏ÁúãÂà∞ÂÆÉÔºåÂπ∂‰∏îÈÄöÂ∏∏Ë°®Á§∫ÂÆπÂô®ÂÜÖÊâßË°åÁöÑÂëΩ‰ª§Êàñ‰∫åËøõÂà∂Êñá‰ª∂Êâæ‰∏çÂà∞„ÄÇ</p><p>‰∏Ä‰∫õÊ†áÂáÜÁöÑÈÄÄÂá∫Á†ÅÂåÖÊã¨Ôºö</p><table><thead><tr><th>ÈÄÄÂá∫Á†Å</th><th>Ëß£Èáä</th></tr></thead><tbody><tr><td>0</td><td>ÂëΩ‰ª§ÊàêÂäüÊâßË°å</td></tr><tr><td>1</td><td>ÈÄöÁî®ÈîôËØØ</td></tr><tr><td>2</td><td>ÂëΩ‰ª§ÔºàÂèÇÊï∞Ôºâ‰ΩøÁî®‰∏çÂΩì</td></tr><tr><td>126</td><td>ÊùÉÈôêË¢´ÊãíÁªù„ÄÅÊó†Ê≥ïÊâßË°å</td></tr><tr><td>127</td><td>Êú™ÊâæÂà∞ÂëΩ‰ª§Ë°å„ÄÅPATHÈîôËØØ</td></tr><tr><td>128+n</td><td>ÂëΩ‰ª§Ë¢´‰ø°Âè∑‰ªéÂ§ñÈÉ®ÁªàÊ≠¢„ÄÅÈÅáÂà∞Ëá¥ÂëΩÈîôËØØ</td></tr><tr><td>&gt;255</td><td>ÈÄÄÂá∫Á†ÅË∂ÖËøá255ËåÉÂõ¥ÁöÑÔºå‰ºöÈáçÊñ∞ËÆ°ÁÆóÔºàmod 256Ôºâ</td></tr></tbody></table><p>ËÆ©Êàë‰ª¨Áúã‰∏Ä‰∏ãÈÄÄÂá∫Á†Å 127 ÁöÑ‰∏Ä‰∫õÂ∏∏ËßÅÂéüÂõ†Ôºö</p><ol><li><p>ÂëΩ‰ª§Êàñ‰∫åËøõÂà∂Êñá‰ª∂Êú™ÂÆâË£Ö </p><p>Kubernetes ÂÆπÂô®ÁöÑ command Â≠óÊÆµ‰∏≠ÊåáÂÆöÁöÑÂèØÊâßË°åÊñá‰ª∂Êú™ÂÆâË£ÖÂú®ÂÆπÂô®ÁöÑÊñá‰ª∂Á≥ªÁªü‰∏≠„ÄÇÈúÄË¶ÅÁ°Æ‰øùÊâÄÈúÄÁöÑ‰∫åËøõÂà∂Êñá‰ª∂ÊàñÂëΩ‰ª§ÂèØÁî®„ÄÇ</p></li><li><p>Ë∑ØÂæÑÊàñÂëΩ‰ª§‰∏çÊ≠£Á°Æ</p><p>Pod ÂÆö‰πâ‰∏≠ÊåáÂÆöÁöÑÂëΩ‰ª§‰∏çÊ≠£Á°ÆÊàñÂú®ÊåáÂÆöÁöÑË∑ØÂæÑ‰∏≠‰∏çÂ≠òÂú®„ÄÇËøôÊòØÈîôËØØÁöÑÊúÄÂ∏∏ËßÅÂéüÂõ†‰πã‰∏ÄÔºåÈÄöÂ∏∏ÊòØÁî±‰∫é Dockerfile Êàñ pod  spec‰∏≠ÁöÑentrypointÊàñcommandËæìÂÖ•‰∏çÊ≠£Á°ÆÈÄ†ÊàêÁöÑ„ÄÇ</p></li><li><p>Áº∫Â∞ë‰æùËµñ</p><p>Âú®ÂÆπÂô®ÂÜÖËøêË°åÁöÑÂ∫îÁî®Á®ãÂ∫èÊàñËÑöÊú¨Êú™ÂÆâË£ÖÁõ∏ÂÖ≥‰æùËµñ„ÄÇÈúÄË¶ÅÁ°Æ‰øùÊâÄÊúâÂøÖÈúÄÁöÑ‰æùËµñÈ°πÂåÖÂê´Âú®ÂÆπÂô®Êò†ÂÉè‰∏≠„ÄÇ</p></li><li><p>shell Ëß£ÈáäÂô®</p><p>Â¶ÇÊûúÊåáÂÆö‰∫ÜËÑöÊú¨‰Ωú‰∏∫ÂëΩ‰ª§ÔºåÈúÄË¶ÅÁ°Æ‰øùËÑöÊú¨ÊúâÊïà Ôºà‰æãÂ¶Ç#!&#x2F;bin&#x2F;bashÔºâÔºå‰∏îÂú®ÂÆπÂô®‰∏≠ÂèØÁî®„ÄÇ</p></li><li><p>shell ËÑöÊú¨ËØ≠Ê≥ïÈîôËØØ</p><p>Â¶ÇÊûú shell ËÑöÊú¨ÈÄÄÂá∫Á†ÅÊòØ127ÔºåËØ∑Ê£ÄÊü•ËÑöÊú¨ÊòØÂê¶Â≠òÊúâËØ≠Ê≥ïÈîôËØØÊàñÂèØËÉΩÈòªÊ≠¢ÂÖ∂ÊâßË°åÁöÑÈóÆÈ¢ò„ÄÇ</p></li><li><p>ÊùÉÈôê‰∏çË∂≥</p><p>Âú®ÂÆπÂô®ÂÜÖËøêË°åÂëΩ‰ª§ÁöÑÁî®Êà∑ÂèØËÉΩÊ≤°ÊúâÊâßË°åÊåáÂÆöÂëΩ‰ª§ÊâÄÈúÄÁöÑÂøÖË¶ÅÊùÉÈôê„ÄÇÁ°Æ‰øùÂÆπÂô®‰ª•ÈÄÇÂΩìÁöÑÁâπÊùÉËøêË°å„ÄÇ</p></li><li><p>ÈïúÂÉèÂÖºÂÆπÊÄßÈóÆÈ¢ò</p><p>Á°Æ‰øù‰ΩøÁî®ÁöÑÂÆπÂô®ÈïúÂÉè‰∏éÂÆø‰∏ªÊú∫Êû∂ÊûÑÂíåÊìç‰ΩúÁ≥ªÁªüÂÖºÂÆπ„ÄÇ‰∏çÂåπÈÖçÁöÑÊò†ÂÉèÂèØËÉΩÂØºËá¥ÂëΩ‰ª§Êâæ‰∏çÂà∞ÔºåÊØîÂ¶Çx86ÁöÑÈïúÂÉèËøêË°åÂú®armÁöÑÊú∫Âô®‰∏ä</p></li><li><p>Âç∑ÊåÇËΩΩ</p><p>Â¶ÇÊûúÂëΩ‰ª§ÊòØÂç∑ÊåÇËΩΩÁöÑÊñá‰ª∂ÔºåËØ∑Ê£ÄÊü•Âç∑ÊåÇËΩΩÊòØÂê¶ÈÖçÁΩÆÊ≠£Á°ÆÔºå‰∏îÊâÄÈúÄÁöÑÊñá‰ª∂ÂèØ‰ª•Ë¢´ËÆøÈóÆÂà∞„ÄÇ</p></li><li><p>ÁéØÂ¢ÉÂèòÈáè</p><p>‰∏Ä‰∫õÂëΩ‰ª§ÂèØËÉΩ‰æùËµñ‰∫éÁâπÂÆöÁöÑÁéØÂ¢ÉÂèòÈáè„ÄÇÁ°Æ‰øùÂøÖÈúÄÁöÑÁéØÂ¢ÉÂèòÈáèËÆæÁΩÆÊ≠£Á°Æ„ÄÇ</p></li><li><p>Kubernetes RBAC Á≠ñÁï•</p><p> Â¶ÇÊûúÂêØÁî®‰∫ÜRBACÔºåÈúÄË¶ÅÁ°Æ‰øùÂÖ∑ÊúâÊâßË°åÊåáÂÆöÂëΩ‰ª§ÊâÄÈúÄÁöÑÊùÉÈôê„ÄÇ</p></li></ol><h3 id="Â¶Ç‰ΩïÊéíÊü•"><a href="#Â¶Ç‰ΩïÊéíÊü•" class="headerlink" title="Â¶Ç‰ΩïÊéíÊü•"></a>Â¶Ç‰ΩïÊéíÊü•</h3><p>Ë¶ÅÊéíÈô§ÈóÆÈ¢òÔºåÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§Ê£ÄÊü• Pod ÁöÑÊó•ÂøóÔºö</p><p><code>kubectl logs -f &lt;pod-name&gt; </code></p><p>ËøòÂèØ‰ª•Ê£ÄÊü• Pod Áä∂ÊÄÅÔºåËØ•Áä∂ÊÄÅÊèê‰æõÊúâÂÖ≥ Pod ÁöÑËØ¶ÁªÜ‰ø°ÊÅØÔºåÂåÖÊã¨ÂÖ∂ÂΩìÂâçÁä∂ÊÄÅ„ÄÅÊúÄËøë‰∫ã‰ª∂Âíå‰ªª‰ΩïÈîôËØØÊ∂àÊÅØ„ÄÇ</p><p><code>kubectl describe pod &lt;pod-name&gt; </code></p><p>ËøòÂèØ‰ª•‰∏∫ÊääË∞ÉËØïÂÆπÂô®attachÂà∞Pod ‰∏≠ÔºåËØ•ÂÆπÂô®ÂåÖÊã¨‰∏Ä‰∏™ shellÔºà‰æãÂ¶Ç BusyBoxÔºâ„ÄÇËøôÂÖÅËÆ∏ÊÇ®ËøõÂÖ•ÂÆπÂô®Âπ∂ÊâãÂä®Ê£ÄÊü•ÁéØÂ¢É„ÄÅË∑ØÂæÑÂíåÂëΩ‰ª§ÁöÑÂèØÁî®ÊÄß„ÄÇ</p><p>‰ΩøÁî® BusyBox ËøõË°åË∞ÉËØïÁöÑÁ§∫‰æãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">containers:</span><br><span class="line">  - name: my-container</span><br><span class="line">    image: my-image:latest</span><br><span class="line">    command: [&quot;/bin/sleep&quot;, &quot;infinity&quot;]</span><br><span class="line">  - name: debug-container</span><br><span class="line">    image: busybox:latest</span><br><span class="line">    command: [&quot;/bin/sh&quot;]</span><br><span class="line">    tty: true</span><br><span class="line">    stdin: true</span><br></pre></td></tr></table></figure><p>Â¶ÇÊûúÊòØÈ´òÁâàÊú¨K8sÔºå‰πüÂèØ‰ª•‰ΩøÁî®Ephemeral ContainersÔºåÂÆÉÂ∞±ÊòØ‰∏Ä‰∏™‰∏¥Êó∂ÂÆπÂô®„ÄÇËøôÊòØ‰∏Ä‰∏™Ëá™Kubernetes v1.16‰∏≠‰Ωú‰∏∫alphaÂºïÂÖ•ÁöÑÊñ∞ÂäüËÉΩÔºåÂêØÁî®‰∏¥Êó∂ÂÆπÂô®ÁöÑÁâπÊÄß‰πüÈùûÂ∏∏ÁÆÄÂçïÔºåÂú®kubernetes v1.16‰πãÂêéÁöÑÁâàÊú¨‰∏≠Â∞ÜÂêØÂä®ÂèÇÊï∞<code>--feature-gates=EphemeralContainers=true</code>ÈÖçÁΩÆÂà∞kube-apiÂíåkubeletÊúçÂä°‰∏äÈáçÂêØÂç≥ÂèØ„ÄÇ</p><p>ÈÄöËøá‰ªîÁªÜÊü•ÁúãÊó•ÂøóÂπ∂ÊéíÊü•‰∏äËø∞Âá†‰∏™ÊñπÂêëÔºåÂ∫îËØ•ËÉΩÂ§üÁ°ÆÂÆöÈÄÄÂá∫Á†Å 127 ÈóÆÈ¢òÁöÑÂéüÂõ†„ÄÇ</p><h3 id="Â¶Ç‰Ωï‰øÆÂ§ç"><a href="#Â¶Ç‰Ωï‰øÆÂ§ç" class="headerlink" title="Â¶Ç‰Ωï‰øÆÂ§ç"></a>Â¶Ç‰Ωï‰øÆÂ§ç</h3><p> Êàë‰ª¨Áü•ÈÅì‰∫ÜÈÄÄÂá∫Á†Å 127 ÁöÑÂ∏∏ËßÅÂéüÂõ†‰ª•ÂèäÊéíÊü•ÊñπÂºèÔºåÁé∞Âú®ËÆ©Êàë‰ª¨ÁúãÁúãÂ¶Ç‰Ωï‰øÆÂ§çÂÆÉ‰ª¨„ÄÇ</p><ol><li>ÂëΩ‰ª§Êàñ‰∫åËøõÂà∂Êñá‰ª∂Êú™ÂÆâË£Ö</li></ol><p>Â¶ÇÊûúÊâÄÈúÄÁöÑÂëΩ‰ª§Êàñ‰∫åËøõÂà∂Êñá‰ª∂‰∏¢Â§±ÔºåÂàôÂèØËÉΩÈúÄË¶ÅÂú®ÂÆπÂô®ÈïúÂÉè‰∏≠ÂÆâË£Ö„ÄÇ‰øÆÊîπ Dockerfile ÊàñÊûÑÂª∫ËøáÁ®ãÂÆâË£ÖÊâÄÈúÄËΩØ‰ª∂„ÄÇ</p><p>Á§∫‰æãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:latest </span><br><span class="line">RUN apk --no-cache add &lt;package-name&gt; </span><br></pre></td></tr></table></figure><ol start="2"><li>Ë∑ØÂæÑÊàñÂëΩ‰ª§‰∏çÊ≠£Á°Æ</li></ol><p>Âú® Pod ÂÆö‰πâ‰∏≠ÊåáÂÆöÂëΩ‰ª§Êó∂ÔºåËÄÉËôë‰ΩøÁî®‰∫åËøõÂà∂Êñá‰ª∂ÁöÑÁªùÂØπË∑ØÂæÑ„ÄÇËøôÊúâÂä©‰∫éÁ°Æ‰øù‰∏çÂèóÂΩìÂâçÂ∑•‰ΩúÁõÆÂΩïÁöÑÂΩ±ÂìçÔºå runtimeÂèØ‰ª•ÊâæÂà∞‰∫åËøõÂà∂Êñá‰ª∂„ÄÇ</p><p>Á§∫‰æãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">containers:</span><br><span class="line">  - name: my-container</span><br><span class="line">    image: my-image:latest</span><br><span class="line">    command: [&quot;/usr/local/bin/my-command&quot;]</span><br></pre></td></tr></table></figure><ol start="3"><li>Áº∫Â∞ë‰æùËµñÈ°π</li></ol><p>ÂØºËá¥ÂëΩ‰ª§Êó†Ê≥ïËøêË°åÁöÑÂéüÂõ†ÂèØËÉΩÊòØÂÆπÂô®ÈïúÂÉèÈúÄË¶ÅÂÆâË£ÖÈ¢ùÂ§ñÁöÑËΩØ‰ª∂„ÄÇÂ¶ÇÊûúÂëΩ‰ª§ÈúÄË¶ÅÈ¢ùÂ§ñÁöÑËÆæÁΩÆÊàñÂÆâË£ÖÊ≠•È™§ÔºåÂèØ‰ª•‰ΩøÁî®initÂÆπÂô®Âú®‰∏ªÂÆπÂô®ÂêØÂä®‰πãÂâçÊâßË°åËøô‰∫õ‰ªªÂä°„ÄÇ</p><p>Á§∫‰æãÔºà‰ΩøÁî®initÂÆπÂô®ÂÆâË£ÖËΩØ‰ª∂ÂåÖÔºâÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">initContainers:</span><br><span class="line">  - name: install-package</span><br><span class="line">    image: alpine:latest</span><br><span class="line">    command: [&quot;apk&quot;, &quot;--no-cache&quot;, &quot;add&quot;, &quot;&lt;package-name&gt;&quot;]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: shared-data</span><br><span class="line">      mountPath: /data</span><br></pre></td></tr></table></figure><ol start="4"><li>shellËß£ÈáäÂô®</li></ol><p>Â¶ÇÊûúÊåáÂÆö‰∫ÜËÑöÊú¨‰Ωú‰∏∫ÂëΩ‰ª§ÔºåÈúÄË¶ÅÁ°Æ‰øùËÑöÊú¨ÊúâÊïà Ôºà‰æãÂ¶Ç#!&#x2F;bin&#x2F;bashÔºâÔºå‰∏îÂú®ÂÆπÂô®‰∏≠ÂèØÁî®„ÄÇ</p><p>Á§∫‰æãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br></pre></td></tr></table></figure><ol start="5"><li>Âç∑ÊåÇËΩΩ</li></ol><p>Ê£ÄÊü•PodÁöÑÈÖçÁΩÆÔºåÁ°Æ‰øùÂç∑Â∑≤Ê≠£Á°ÆÊåÇËΩΩ„ÄÇÈ™åËØÅÂç∑ÂêçÁß∞„ÄÅÊåÇËΩΩË∑ØÂæÑÂíå subPathsÊòØÂê¶Ê≠£Á°Æ„ÄÇ</p><p>Á§∫‰æãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">  - name: my-volume</span><br><span class="line">    emptyDir: &#123;&#125;</span><br><span class="line">containers:</span><br><span class="line">  - name: my-container</span><br><span class="line">    image: my-image:latest</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: my-volume</span><br><span class="line">      mountPath: /path/in/container</span><br></pre></td></tr></table></figure><p>ÂêåÊó∂Êàë‰ª¨ÈúÄË¶ÅÁ°ÆËÆ§Pod ÂÆö‰πâÊåáÂÆöÁöÑÂç∑Â≠òÂú®‰∏îÂèØÁî®„ÄÇÂ¶ÇÊûúÊòØÊåÅ‰πÖÂç∑ÔºàPVÔºâÔºåÈúÄË¶ÅÊ£ÄÊü•ÂÖ∂Áä∂ÊÄÅ„ÄÇÂ¶ÇÊûúÊòØ emptyDir ÊàñÂÖ∂‰ªñÁ±ªÂûãÁöÑÂç∑ÔºåÈúÄË¶ÅÈ™åËØÅÂÖ∂ÊòØÂê¶Ê≠£Á°ÆÂàõÂª∫ÂíåÊåÇËΩΩ„ÄÇÂ¶ÇÊûúÂú®Âç∑ÊåÇËΩΩ‰∏≠‰ΩøÁî®‰∫Ü subPathsÔºåÈúÄË¶ÅÁ°Æ‰øùÊ∫êÁõÆÂΩïÊàñÊñá‰ª∂‰∏≠Â≠òÂú®ÊåáÂÆöÁöÑ subPaths„ÄÇ</p><p>Á§∫‰æãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">volumeMounts:</span><br><span class="line">  - name: my-volume</span><br><span class="line">    mountPath: /path/in/container</span><br><span class="line">    subPath: my-file.txt</span><br></pre></td></tr></table></figure><h2 id="ÈÄÄÂá∫Á†Å137"><a href="#ÈÄÄÂá∫Á†Å137" class="headerlink" title="ÈÄÄÂá∫Á†Å137"></a>ÈÄÄÂá∫Á†Å137</h2><p>Âú®Kubernetes‰∏≠Ôºå137ÈÄÄÂá∫Á†ÅË°®Á§∫ËøõÁ®ãË¢´Âº∫Âà∂ÁªàÊ≠¢„ÄÇÂú®UnixÂíåLinuxÁ≥ªÁªü‰∏≠ÔºåÂΩìËøõÁ®ãÁî±‰∫é‰ø°Âè∑ËÄåÁªàÊ≠¢Êó∂ÔºåÈÄÄÂá∫Á†ÅÁî±‰ø°Âè∑ÁºñÂè∑Âä†‰∏ä128Á°ÆÂÆö„ÄÇ‰ø°Âè∑ÁºñÂè∑‰∏∫9ÔºåÊÑèÂë≥ÁùÄ‚ÄúSIGKILL‚ÄùÔºåÂõ†Ê≠§Â∞Ü9Âä†‰∏ä128ÔºåÂæóÂà∞137ÈÄÄÂá∫Á†Å„ÄÇ</p><p>ÂΩìKubernetesÈõÜÁæ§‰∏≠ÂÆπÂô®Ë∂ÖÂá∫ÂÖ∂ÂÜÖÂ≠òÈôêÂà∂Êó∂ÔºåÂÆÉÂèØËÉΩ‰ºöË¢´KubernetesÁ≥ªÁªüÁªàÊ≠¢ÔºåÂπ∂ÊòæÁ§∫‚ÄúOOMKilled‚ÄùÈîôËØØÔºåËøôË°®Á§∫ËøõÁ®ãÂõ†ÂÜÖÂ≠ò‰∏çË∂≥ËÄåË¢´ÁªàÊ≠¢„ÄÇÊ≠§ÈîôËØØÁöÑÈÄÄÂá∫Á†Å‰∏∫137OOM‰ª£Ë°®‚ÄúÂÜÖÂ≠òËÄóÂ∞ΩÔºàout-of-memoryÔºâ‚Äù„ÄÇ</p><p>Â¶ÇÊûúPodÁä∂ÊÄÅÂ∞ÜÊòæÁ§∫‰∏∫‚ÄúOOMKilled‚ÄùÔºå‰Ω†ÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§Êü•ÁúãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod &lt;podname&gt;</span><br></pre></td></tr></table></figure><h3 id="OOMKiller"><a href="#OOMKiller" class="headerlink" title="OOMKiller"></a>OOMKiller</h3><p>OOMKillerÊòØLinuxÂÜÖÊ†∏‰∏≠ÁöÑ‰∏ÄÁßçÊú∫Âà∂ÔºåÂÆÉË¥üË¥£ÈÄöËøáÁªàÊ≠¢Ê∂àËÄóËøáÂ§öÂÜÖÂ≠òÁöÑËøõÁ®ãÊù•Èò≤Ê≠¢Á≥ªÁªüËÄóÂ∞ΩÂÜÖÂ≠ò„ÄÇÂΩìÁ≥ªÁªüÂÜÖÂ≠òËÄóÂ∞ΩÊó∂ÔºåÂÜÖÊ†∏‰ºöË∞ÉÁî®OOMKillerÊù•ÈÄâÊã©‰∏Ä‰∏™Ë¶ÅÁªàÊ≠¢ÁöÑËøõÁ®ãÔºå‰ª•ÈáäÊîæÂÜÖÂ≠òÂπ∂‰øùÊåÅÁ≥ªÁªüËøêË°å„ÄÇ</p><p>ÂÜÖÊ†∏‰∏≠Êúâ‰∏§Áßç‰∏çÂêåÁöÑOOM KillerÔºõ‰∏ÄÁßçÊòØÂÖ®Â±ÄÁöÑOOM KillerÔºåÂè¶‰∏ÄÁßçÊòØÂü∫‰∫écgroupÂÜÖÂ≠òÊéßÂà∂Âô®ÁöÑOOM KillerÔºåÂèØ‰ª•ÊòØcgroup v1Êàñcgroup v2„ÄÇ</p><p>ÁÆÄÂçïÊù•ËØ¥ÊòØÔºåÂΩìÂÜÖÊ†∏Âú®ÂàÜÈÖçÁâ©ÁêÜÂÜÖÂ≠òÈ°µÈù¢Êó∂ÈÅáÂà∞ÈóÆÈ¢òÊó∂ÔºåÂÖ®Â±ÄÁöÑOOM Killer ‰ºöËß¶Âèë„ÄÇÂΩìÂÜÖÊ†∏Â∞ùËØïÂàÜÈÖçÂÜÖÂ≠òÈ°µÈù¢ÔºàÊó†ËÆ∫ÊòØÁî®‰∫éÂÜÖÊ†∏‰ΩøÁî®ËøòÊòØÁî®‰∫éÈúÄË¶ÅÈ°µÈù¢ÁöÑËøõÁ®ãÔºâÔºåÂπ∂‰∏îÊúÄÂàùÂ§±Ë¥•Êó∂ÔºåÂÆÉÂ∞ÜÂ∞ùËØïÂêÑÁßçÊñπÂºèÊù•ÂõûÊî∂ÂíåÊï¥ÁêÜÂÜÖÂ≠ò„ÄÇÂ¶ÇÊûúËøôÁßçÂ∞ùËØïÊàêÂäüÊàñËÄÖËá≥Â∞ëÂèñÂæó‰∫Ü‰∏Ä‰∫õËøõÂ±ïÔºåÂÜÖÊ†∏Â∞ÜÁªßÁª≠ÈáçËØïÂàÜÈÖçÔºà‰ªé‰ª£Á†Å‰∏≠ÊàëÂèØ‰ª•ÁúãÂà∞ÔºâÔºõÂ¶ÇÊûúÊó†Ê≥ïÈáäÊîæÈ°µÈù¢ÊàñËÄÖÂèñÂæóËøõÂ±ïÔºåÂÆÉÂ∞ÜÂú®ËÆ∏Â§öÊÉÖÂÜµ‰∏ãËß¶ÂèëOOM Killer„ÄÇ</p><p>‰∏ÄÊó¶OOMKillerÈÄâÊã©Ë¶ÅÁªàÊ≠¢ÁöÑËøõÁ®ãÔºåÂÆÉ‰ºöÂêëËØ•ËøõÁ®ãÂèëÈÄÅ‰ø°Âè∑ÔºåË¶ÅÊ±ÇÂÖ∂‰ºòÈõÖÂú∞ÁªàÊ≠¢„ÄÇÂ¶ÇÊûúËøõÁ®ã‰∏çÂìçÂ∫î‰ø°Âè∑ÔºåÂàôÂÜÖÊ†∏‰ºöÂº∫Âà∂ÁªàÊ≠¢ËØ•ËøõÁ®ãÂπ∂ÈáäÊîæÂÖ∂ÂÜÖÂ≠ò„ÄÇ</p><p>Ê≥®ÊÑèÔºöÁî±‰∫éÂÜÖÂ≠òÈóÆÈ¢òËÄåË¢´ÁªàÊ≠¢ÁöÑPod‰∏ç‰∏ÄÂÆö‰ºöË¢´ËäÇÁÇπÈ©±ÈÄêÔºåÂ¶ÇÊûúÂÖ∂ËÆæÁΩÆÁöÑÈáçÂêØÁ≠ñÁï•ËÆæÁΩÆ‰∏∫‚ÄúAlways‚ÄùÔºåÂÆÉÂ∞ÜÂ∞ùËØïÈáçÊñ∞ÂêØÂä®Pod„ÄÇ</p><p>Âú®Á≥ªÁªüÂ±ÇÈù¢ÔºåLinuxÂÜÖÊ†∏‰∏∫ËøêË°åÂú®‰∏ªÊú∫‰∏äÁöÑÊØè‰∏™ËøõÁ®ãÁª¥Êä§‰∏Ä‰∏™oom_score„ÄÇËøõÁ®ãË¢´ÁªàÊ≠¢ÁöÑÊú∫ÁéáÂèñÂÜ≥‰∫éÂàÜÊï∞ÊúâÂ§öÈ´ò„ÄÇ</p><p>oom_score_adjÂÄºÂÖÅËÆ∏Áî®Êà∑Ëá™ÂÆö‰πâOOMËøõÁ®ãÔºåÂπ∂ÂÆö‰πâ‰ΩïÊó∂Â∫îÁªàÊ≠¢ËøõÁ®ã„ÄÇKubernetesÂú®ÂÆö‰πâPodÁöÑQuality of ServiceÔºàQoSÔºâÊó∂‰ΩøÁî®oom_score_adjÂÄº„ÄÇ</p><p>K8sÈíàÂØπPodÂÆö‰πâ‰∫Ü‰∏âÁßçQoSÔºåÊØè‰∏™Á±ªÂûãÂÖ∑ÊúâÂØπÂ∫îÁöÑoom_score_adjÂÄºÔºö</p><ul><li>Guaranteed: -997</li><li>BestEffort: 1000</li><li>Burstable: <em>min(max(2, 1000 ‚Äî (1000 * memoryRequestBytes) &#x2F; machineMemoryCapacityBytes), 999)</em></li></ul><p>ÂÖ∂‰∏≠Pod‰∏∫Guaranteed QoSÔºåÂàôÂÖ∂oom_score_adjÁöÑÂÄºÊòØ-997ÔºåÂõ†Ê≠§ÂÆÉ‰ª¨Âú®ËäÇÁÇπÂÜÖÂ≠ò‰∏çË∂≥Êó∂ÊúÄÂêé‰∏Ä‰∏™Ë¢´ÁªàÊ≠¢„ÄÇBestEffort PodÈÖçÁΩÆÁöÑÊòØ1000ÔºåÊâÄ‰ª•ÂÆÉ‰ª¨Á¨¨‰∏Ä‰∏™Ë¢´Ë¢´ÁªàÊ≠¢„ÄÇ</p><p>Ë¶ÅÊü•ÁúãPodÁöÑQoSÔºåÂèØ‰ª•ÈÄöËøá‰∏ãËø∞ÂëΩ‰ª§Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -o jsonpath=&#x27;&#123;.status.qosClass&#125;&#x27;</span><br></pre></td></tr></table></figure><p>‰∏ãÈù¢ÊòØÂÆö‰πâPod<code>Guaranteed</code> QoS Á±ªÂûãÁöÑËÆ°ÁÆóÁ≠ñÁï•Ôºö</p><ul><li>Pod ‰∏≠ÁöÑÊØè‰∏™ÂÆπÂô®ÂøÖÈ°ªÊúâÂÜÖÂ≠ò limit ÂíåÂÜÖÂ≠ò request„ÄÇ</li><li>ÂØπ‰∫é Pod ‰∏≠ÁöÑÊØè‰∏™ÂÆπÂô®ÔºåÂÜÖÂ≠ò limit ÂøÖÈ°ªÁ≠â‰∫éÂÜÖÂ≠ò request„ÄÇ</li><li>Pod ‰∏≠ÁöÑÊØè‰∏™ÂÆπÂô®ÂøÖÈ°ªÊúâ CPU limit Âíå CPU request„ÄÇ</li><li>ÂØπ‰∫é Pod ‰∏≠ÁöÑÊØè‰∏™ÂÆπÂô®ÔºåCPU limit ÂøÖÈ°ªÁ≠â‰∫é CPU request„ÄÇ</li></ul><p>ÈÄÄÂá∫Á†Å137ÈÄöÂ∏∏Êúâ‰∏§ÁßçÊÉÖÂÜµÔºö</p><ul><li><p>È¶ñÂÖàÔºå‰πüÊòØÊúÄÂ∏∏ËßÅÁöÑÂéüÂõ†ÊòØ‰∏éËµÑÊ∫êÈôêÂà∂Áõ∏ÂÖ≥„ÄÇÂú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåKubernetesË∂ÖÂá∫‰∫ÜÂÆπÂô®ÁöÑÂàÜÈÖçÂÜÖÂ≠òÈôêÂà∂ÔºåÂΩìÂèëÁîüËøôÁßçÊÉÖÂÜµÊó∂ÔºåÂÆÉÂ∞ÜÁªàÊ≠¢ÂÆπÂô®‰ª•Á°Æ‰øùËäÇÁÇπÁöÑÁ®≥ÂÆöÊÄß„ÄÇ </p></li><li><p>Âè¶‰∏ÄÁßçÊÉÖÂÜµÊòØÊâãÂä®Âπ≤È¢Ñ - Áî®Êà∑ÊàñËÑöÊú¨ÂèØËÉΩ‰ºöÂêëÂÆπÂô®ËøõÁ®ãÂèëÈÄÅ‚ÄúSIGKILL‚Äù‰ø°Âè∑ÔºåÂØºËá¥Ê≠§ÈÄÄÂá∫Á†Å„ÄÇ OOMKilledÔºàÈÄÄÂá∫Á†Å137Ôºâ</p></li></ul><h3 id="Â¶Ç‰ΩïÊéíÊü•-1"><a href="#Â¶Ç‰ΩïÊéíÊü•-1" class="headerlink" title="Â¶Ç‰ΩïÊéíÊü•"></a>Â¶Ç‰ΩïÊéíÊü•</h3><ol><li>Ê£ÄÊü•PodÊó•Âøó</li></ol><p>ËØäÊñ≠OOMKilledÈîôËØØÁöÑÁ¨¨‰∏ÄÊ≠•ÊòØÊ£ÄÊü•PodÊó•ÂøóÔºåÊü•ÁúãÊòØÂê¶Êúâ‰ªª‰ΩïÊåáÁ§∫ÂÜÖÂ≠òÈóÆÈ¢òÁöÑÈîôËØØÊ∂àÊÅØ„ÄÇÊèèËø∞ÂëΩ‰ª§ÁöÑ‰∫ã‰ª∂ÈÉ®ÂàÜÂ∞ÜÊèê‰æõËøõ‰∏ÄÊ≠•ÁöÑÁ°ÆËÆ§‰ª•ÂèäÂèëÁîüÈîôËØØÁöÑÊó∂Èó¥&#x2F;Êó•Êúü„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod &lt;podname&gt;</span><br><span class="line">State:          Running</span><br><span class="line">       Started:      Fri, 12 May 2023 11:14:13 +0200</span><br><span class="line">       Last State:   Terminated</span><br><span class="line">       Reason:       OOMKilled</span><br><span class="line">       Exit Code:    137</span><br><span class="line">       ...</span><br></pre></td></tr></table></figure><p>ÊÇ®ËøòÂèØ‰ª•Êü•ËØ¢PodÊó•ÂøóÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/log/pods/&lt;podname&gt;</span><br></pre></td></tr></table></figure><p>ÂΩìÁÑ∂‰πüÂèØ‰ª•ÈÄöËøá(Ê†áÂáÜËæìÂá∫)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs -f &lt;podname&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>ÁõëËßÜÂÜÖÂ≠ò‰ΩøÁî®ÊÉÖÂÜµ</li></ol><p>‰ΩøÁî®ÁõëËßÜÁ≥ªÁªüÔºàÂ¶ÇPrometheusÊàñGrafanaÔºâÁõëËßÜPodÂíåÂÆπÂô®‰∏≠ÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÊÉÖÂÜµ„ÄÇËøôÂèØ‰ª•Â∏ÆÂä©Êàë‰ª¨Á°ÆÂÆöÂì™‰∫õÂÆπÂô®Ê∂àËÄó‰∫ÜËøáÂ§öÁöÑÂÜÖÂ≠ò‰ªéËÄåËß¶Âèë‰∫ÜOOMKilledÈîôËØØÔºå‰πüÂèØ‰ª•Âú®ÂÆπÂô®ÂÆø‰∏ªÊú∫‰ΩøÁî®dmesgÊü•ÁúãÂΩìÊó∂oomkillerÁöÑÁé∞Âú∫</p><ol start="3"><li>‰ΩøÁî®ÂÜÖÂ≠òÂàÜÊûêÂô®</li></ol><p>‰ΩøÁî®ÂÜÖÂ≠òÂàÜÊûêÂô®ÔºàÂ¶ÇpprofÔºâÊù•ËØÜÂà´ÂèØËÉΩÂØºËá¥ËøáÂ§öÂÜÖÂ≠ò‰ΩøÁî®ÁöÑÂÜÖÂ≠òÊ≥ÑÊºèÊàñ‰ΩéÊïà‰ª£Á†Å„ÄÇ</p><h3 id="Â¶Ç‰Ωï‰øÆÂ§ç-1"><a href="#Â¶Ç‰Ωï‰øÆÂ§ç-1" class="headerlink" title="Â¶Ç‰Ωï‰øÆÂ§ç"></a>Â¶Ç‰Ωï‰øÆÂ§ç</h3><p>‰ª•‰∏ãÊòØOOMKilled KubernetesÈîôËØØÁöÑÂ∏∏ËßÅÂéüÂõ†ÂèäÂÖ∂Ëß£ÂÜ≥ÊñπÊ≥ï„ÄÇ</p><ol><li>ÂÆπÂô®ÂÜÖÂ≠òÈôêÂà∂Â∑≤ËææÂà∞</li></ol><p>ËøôÂèØËÉΩÊòØÁî±‰∫éÂú®ÂÆπÂô®ÊåáÂÆöÁöÑÂÜÖÂ≠òÈôêÂà∂ÂÄºËÆæÁΩÆ‰∏çÂΩìÂØºËá¥ÁöÑ„ÄÇËß£ÂÜ≥ÊñπÊ≥ïÊòØÂ¢ûÂä†ÂÜÖÂ≠òÈôêÂà∂ÁöÑÂÄºÔºåÊàñËÄÖË∞ÉÊü•ÂØºËá¥Ë¥üËΩΩÂ¢ûÂä†ÁöÑÊ†πÊú¨ÂéüÂõ†Âπ∂ËøõË°åÁ∫†Ê≠£„ÄÇÂØºËá¥ËøôÁßçÊÉÖÂÜµÁöÑÂ∏∏ËßÅÂéüÂõ†ÂåÖÊã¨Â§ßÊñá‰ª∂‰∏ä‰º†ÔºåÂõ†‰∏∫‰∏ä‰º†Â§ßÊñá‰ª∂ÂèØËÉΩ‰ºöÊ∂àËÄóÂ§ßÈáèÂÜÖÂ≠òËµÑÊ∫êÔºåÁâπÂà´ÊòØÂΩìÂ§ö‰∏™ÂÆπÂô®Âú®‰∏Ä‰∏™PodÂÜÖËøêË°åÊó∂Ôºå‰ª•ÂèäÁ™ÅÁÑ∂Â¢ûÂä†ÁöÑÊµÅÈáèÈáè„ÄÇ</p><ol start="2"><li>Âõ†‰∏∫Â∫îÁî®Á®ãÂ∫èÂÜÖÂ≠òÊ≥ÑÊºè,ÂÆπÂô®ÂÜÖÂ≠ò‰ΩøÁî®ËææÂà∞‰∏äÈôê</li></ol><p>ÈúÄË¶ÅË∞ÉËØïÂ∫îÁî®Á®ãÂ∫èÊù•ÂÆö‰ΩçÂÜÖÂ≠òÊ≥ÑÊºèÁöÑÂéüÂõ†Ôºå</p><ol start="3"><li>ÊâÄÊúâPod‰ΩøÁî®ÁöÑÊÄªÂÜÖÂ≠òÂ§ß‰∫éËäÇÁÇπÂèØÁî®ÂÜÖÂ≠ò</li></ol><p>ÈÄöËøáÂ¢ûÂä†ËäÇÁÇπÂèØÁî®ÂÜÖÂ≠òÊù•Â¢ûÂä†ËäÇÁÇπÂÜÖÂ≠òÔºåÊàñËÄÖÂ∞ÜPodËøÅÁßªÂà∞ÂÜÖÂ≠òÊõ¥Â§öÁöÑËäÇÁÇπ„ÄÇÂΩìÁÑ∂‰πüÂèØ‰ª•Ë∞ÉÊï¥ËøêË°åÂú®ËäÇÁÇπ‰∏äÁöÑPodÁöÑÂÜÖÂ≠òÈôêÂà∂Ôºå‰ΩøÂÖ∂Á¨¶ÂêàÂÜÖÂ≠òÈôêÂà∂ÔºåÊ≥®ÊÑè‰Ω†ËøòÂ∫îËØ•Ê≥®ÊÑèÂÜÖÂ≠òËØ∑Ê±ÇËÆæÁΩÆÔºåÂÆÉÊåáÂÆö‰∫ÜPodÂ∫îËØ•‰ΩøÁî®ÁöÑÊúÄÂ∞èÂÜÖÂ≠òÈáè„ÄÇÂ¶ÇÊûúËÆæÁΩÆÂæóÂ§™È´òÔºåÂèØËÉΩ‰∏çÊòØÊúâÊïàÂà©Áî®ÂèØÁî®ÂÜÖÂ≠òÔºåÂÖ≥‰∫éËµÑÊ∫êÈÖçÁΩÆÁõ∏ÂÖ≥ÁöÑÂª∫ËÆÆÔºåÂèØ‰ª•ÂèÇÁúãVPAÁªÑ‰ª∂</p><p>Âú®Ë∞ÉÊï¥ÂÜÖÂ≠òËØ∑Ê±ÇÂíåÈôêÂà∂Êó∂ÔºåÂΩìËäÇÁÇπËøáËΩΩÊó∂ÔºåKubernetesÊåâÁÖß‰ª•‰∏ã‰ºòÂÖàÁ∫ßÈ°∫Â∫èÁªàÊ≠¢PodÔºö</p><ul><li><p>Ê≤°ÊúâËØ∑Ê±ÇÊàñÈôêÂà∂ÁöÑPod„ÄÇ </p></li><li><p>ÂÖ∑ÊúâËØ∑Ê±Ç‰ΩÜÊ≤°ÊúâÈôêÂà∂ÁöÑPod„ÄÇ</p></li><li><p>‰ΩøÁî®Ë∂ÖËøáÂÖ∂ÂÜÖÂ≠òËØ∑Ê±ÇÂÄºÁöÑÂÜÖÂ≠ò - ÊåáÂÆöÁöÑÊúÄÂ∞èÂÜÖÂ≠òÂÄº - ‰ΩÜ‰Ωé‰∫éÂÖ∂ÂÜÖÂ≠òÈôêÂà∂ÁöÑPod„ÄÇ </p></li><li><p>‰ΩøÁî®Ë∂ÖËøáÂÖ∂ÂÜÖÂ≠òÈôêÂà∂ÁöÑPod„ÄÇ</p></li></ul><h3 id="Â¶Ç‰ΩïÈ¢ÑÈò≤"><a href="#Â¶Ç‰ΩïÈ¢ÑÈò≤" class="headerlink" title="Â¶Ç‰ΩïÈ¢ÑÈò≤"></a>Â¶Ç‰ΩïÈ¢ÑÈò≤</h3><p>ÊúâÂá†ÁßçÊñπÊ≥ïÂèØ‰ª•Èò≤Ê≠¢OOMKilledÁöÑÂèëÁîüÔºö</p><ol><li>ËÆæÁΩÆÈÄÇÂΩìÁöÑÂÜÖÂ≠òÈôêÂà∂</li></ol><p>ÈÄöËøáÂéãÊµãÂèäÁõëÊéßÊù•Á°ÆÂÆöÂ∫îÁî®Á®ãÂ∫èÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÔºåÈÄöËøá‰∏äËø∞ÊñπÂºèÈÖçÁΩÆÂÆπÂô®ÂÖÅËÆ∏‰ΩøÁî®ÁöÑÊúÄÂ§ßÂÜÖÂ≠òÈáè„ÄÇËøáÂ∫¶‰øùÂÆàÂèØËÉΩ‰ºöÂØºËá¥Âõ†ËµÑÊ∫êÂà©Áî®Áéá‰ΩéÊïàËÄåÈÄ†ÊàêËµÑÈáëÁöÑÊµ™Ë¥πÔºåÂêåÊó∂‰Ωé‰º∞‰ºöÂØºËá¥È¢ëÁπÅÂá∫Áé∞OOMKilledÁé∞Ë±°„ÄÇ</p><ol start="2"><li>HPA</li></ol><p>ÊúÄ‰Ω≥ÂÅöÊ≥ïÊòØÂà©Áî®K8sÊèê‰æõÁöÑHPAÊú∫Âà∂ÔºåÂΩìÂ∫îÁî®Á®ãÂ∫èÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÂçáÈ´òÊó∂Ëá™Âä®Â¢ûÂä†PodÂâØÊú¨Êï∞Èáè„ÄÇ</p><ol start="3"><li>ËäÇÁÇπËµÑÊ∫êÂàÜÈÖç</li></ol><p>Á°Æ‰øùËäÇÁÇπÂÖ∑ÊúâË∂≥Â§üÁöÑËµÑÊ∫êÊù•Â§ÑÁêÜ‰∏öÂä°„ÄÇ</p><ol start="4"><li>‰ºòÂåñÂ∫îÁî®Á®ãÂ∫èÂÜÖÂ≠ò‰ΩøÁî®</li></ol><p>ÁõëËßÜÂ∫îÁî®Á®ãÂ∫èÂπ∂ËøõË°åÈÄÇÂΩì‰ºòÂåñÔºå‰ª•ÂáèÂ∞ëÂÜÖÂ≠òÊ∂àËÄó„ÄÇ</p><ol start="5"><li>ÈÅøÂÖçÂ∫îÁî®Á®ãÂ∫è‰∏≠ÁöÑÂÜÖÂ≠òÊ≥ÑÊºè</li></ol><p>‰ªéÂ∫îÁî®Á®ãÂ∫èÊù•ÁúãÔºåÈúÄË¶ÅÈïøÊúüÊ£ÄÊü•Âπ∂‰øÆÂ§çÂÜÖÂ≠òÊ≥ÑÊºè„ÄÇ</p><h2 id="ÈìæÊé•"><a href="#ÈìæÊé•" class="headerlink" title="ÈìæÊé•"></a>ÈìæÊé•</h2><ul><li><p><a href="https://spacelift.io/blog/oomkilled-exit-code-137">https://spacelift.io/blog/oomkilled-exit-code-137</a></p></li><li><p><a href="https://spacelift.io/blog/exit-code-127">https://spacelift.io/blog/exit-code-127</a></p></li><li><p><a href="https://cloud.tencent.com/developer/news/1152344">https://cloud.tencent.com/developer/news/1152344</a></p></li><li><p><a href="https://utcc.utoronto.ca/~cks/space/blog/linux/OOMKillerWhen">https://utcc.utoronto.ca/~cks/space/blog/linux/OOMKillerWhen</a></p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Âú®ËøôÁØáÊñáÁ´†‰∏≠ÔºåÊàë‰ª¨Â∞ÜÊ∑±ÂÖ•ÂàÜÊûêKubernetes‰∏≠ÁöÑÈÄÄÂá∫Á†Å127‰∏é137ÔºåËß£ÈáäÂÆÉ‰ª¨ÊòØ‰ªÄ‰πàÔºåK8sÂíåDocker‰∏≠Â∏∏ËßÅÁöÑÂéüÂõ†ÊòØ‰ªÄ‰πàÔºå‰ª•ÂèäÂ¶Ç‰Ωï‰øÆÂ§çÂÆÉ‰ª¨ÔºÅ&lt;/p&gt;
&lt;p&gt;Êàë‰ª¨Â∞ÜÊ∂µÁõñ‰ª•‰∏ãÂÜÖÂÆπÔºö&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;ÈÄÄÂá∫Á†ÅÁöÑÂéÜÂè≤ &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ÈÄÄÂá∫Á†Å</summary>
      
    
    
    
    <category term="‰∫ëÂéüÁîüÈù¢ËØïÊ°à‰æã50ÁØá" scheme="https://zoues.com/categories/%E4%BA%91%E5%8E%9F%E7%94%9F%E9%9D%A2%E8%AF%95%E6%A1%88%E4%BE%8B50%E7%AF%87/"/>
    
    
  </entry>
  
  <entry>
    <title>Exploring the Root Cause of Kubernetes 1.28 Scheduler OOM</title>
    <link href="https://zoues.com/posts/e4e37b07/"/>
    <id>https://zoues.com/posts/e4e37b07/</id>
    <published>2024-03-01T09:13:10.000Z</published>
    <updated>2024-03-01T09:17:38.524Z</updated>
    
    <content type="html"><![CDATA[<p>Before the new year, a colleague upgraded the Kubernetes scheduler to version 1.28.3 and observed abnormal memory behavior. Let‚Äôs take a look together. In the context of fluctuating business tidal changes affecting both pods and nodes in the cluster, memory usage shows a continuous upward trend until reaching Out Of Memory (OOM) conditions.</p><h2 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h2><blockquote><p>The following data is all publicly available information from the community.</p></blockquote><img src="https://pic.imgdb.cn/item/65dc98699f345e8d03f7c855.png" alt="K8s 1.28 scheduler OOM" style="zoom:50%;" /><p>The triggering scenarios include the following two types (there are also other reproduction methods in the community):</p><ul><li>case 1</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for (( ; ; ))</span><br><span class="line">do</span><br><span class="line">    kubectl scale deployment nginx-test --replicas=0 </span><br><span class="line">    sleep 30</span><br><span class="line">    kubectl scale deployment nginx-test --replicas=60</span><br><span class="line">    sleep 30</span><br><span class="line">done</span><br></pre></td></tr></table></figure><ul><li>case 2</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. Create a Pod with NodeAffinity under the situation where no Node can accommodate the Pod.</span><br><span class="line">2. Create a new Node.</span><br></pre></td></tr></table></figure><p>Our findings in the community revealed multiple instances of similar memory anomaly scenarios, with various methods of reproduction. The conclusion regarding the above issue is as follows:</p><blockquote><p>The Kubernetes community defaulted to enabling the scheduling feature SchedulerQueueingHints in version 1.28, which led to memory anomalies in the scheduler component. To temporarily address memory-related issues, the community adjusted this feature to default to disabled in version 1.28.5. However, as the problem has not been completely resolved, it is advisable to exercise caution when enabling this feature.</p></blockquote><h2 id="Technical-Background"><a href="#Technical-Background" class="headerlink" title="Technical Background"></a>Technical Background</h2><p>This section introduces the following content:</p><ul><li>Introduction to Kubernetes scheduler related data structures</li><li>Introduction to Kubernetes scheduler QueueingHint</li><li>Doubly linked lists in Golang</li></ul><h3 id="K8s-Scheduler-Introduction"><a href="#K8s-Scheduler-Introduction" class="headerlink" title="K8s-Scheduler Introduction"></a>K8s-Scheduler Introduction</h3><p>The PriorityQueue is an interface implementation of the SchedulingQueue. It holds the highest priority pod ready for scheduling at its head. PriorityQueue contains the following important fields:</p><ol><li>activeQ: This queue holds pods ready for scheduling. Newly added pods are placed into this queue. When the scheduling queue needs to perform scheduling, it fetches pods from this queue. activeQ is implemented using a heap.</li><li>backoffQ: This queue holds pods that have been determined to be unschedulable for various reasons (such as not meeting node requirements). These pods will be moved to activeQ to attempt scheduling again after a certain backoff period. backoffQ is also implemented using a heap.</li><li>unschedulablePods: This map data structure holds pods that cannot be scheduled for various reasons. Instead of directly placing them in backoffQ, they are recorded here. When conditions are met, they will be moved to activeQ or backoffQ. The scheduling queue periodically cleans up pods in unschedulablePods.</li><li>inFlightEvents: This is used to store events received by the scheduling queue (with the entry value as clusterEvent) and pods that are currently being processed (with the entry value as *v1.Pod). It‚Äôs based on a doubly linked list implemented in Go.</li><li>inFlightPods: This holds the UIDs of all pods that have been popped but have not yet had Done called on them. In other words, it keeps track of all pods that are currently being processed (i.e., in scheduling, in admit, or in binding phases).</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// PriorityQueue implements a scheduling queue.</span><br><span class="line">type PriorityQueue struct &#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">inFlightPods map[types.UID]*list.Element</span><br><span class="line"></span><br><span class="line">inFlightEvents *list.List</span><br><span class="line"></span><br><span class="line">activeQ *heap.Heap</span><br><span class="line"></span><br><span class="line">podBackoffQ *heap.Heap</span><br><span class="line">// unschedulablePods holds pods that have been tried and determined unschedulable.</span><br><span class="line">unschedulablePods *UnschedulablePods</span><br><span class="line">// schedulingCycle represents sequence number of scheduling cycle and is incremented</span><br><span class="line">// when a pod is popped.</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">// preEnqueuePluginMap is keyed with profile name, valued with registered preEnqueue plugins.</span><br><span class="line">preEnqueuePluginMap map[string][]framework.PreEnqueuePlugin</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">// isSchedulingQueueHintEnabled indicates whether the feature gate for the scheduling queue is enabled.</span><br><span class="line">isSchedulingQueueHintEnabled bool</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p> For a comprehensive introduction to Kubernetes, please refer to <a href="https://mp.weixin.qq.com/s?__biz=MzI1MzE0NTI0NQ==&mid=2650490396&idx=1&sn=c59b2252a833c7a215a606598f907f5c&chksm=f1d71feec6a096f81f54b2af3830a7e49aaf11ce118c4fda4928bfff5229dbce334610561b3d&token=232089518&lang=zh_CN#rd">An In-depth Introduction to Kubernetes Scheduling: Framework</a>. Updates on the latest Kubernetes scheduler will be provided subsequently.</p></blockquote><h3 id="QueueingHint"><a href="#QueueingHint" class="headerlink" title="QueueingHint"></a>QueueingHint</h3><p>Kubernetes scheduler introduced the <code>QueueingHint</code> feature to provide recommendations for re-queueing pods from each plugin. This aims to reduce unnecessary scheduling retries, thereby enhancing scheduling throughput. Additionally, it skips backoff under appropriate circumstances to further improve pod scheduling efficiency.</p><h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>Currently, each plugin can define when to retry scheduling pods that have been rejected by the plugin through the <code>EventsToRegister</code> mechanism.</p><p>For example, the <code>NodeAffinity</code> plugin may retry scheduling pods when nodes are added or updated because newly added or updated nodes may have labels that match the node affinity on the pod. However, in practice, a large number of node update events occur in the cluster, which does not guarantee successful scheduling of pods previously rejected by <code>NodeAffinity</code>.</p><p>To address this issue, the scheduler introduced more refined callback functions to filter out irrelevant events, thereby only retrying pods that are likely to be successfully scheduled in the next scheduling cycle.</p><p>Furthermore, the Dynamic Resource Allocation (DRA) scheduling plugin sometimes needs to reject pods to wait for status updates from device drivers. Therefore, certain pods may require several scheduling cycles to be scheduled. For this scenario, the wait time for fallback is longer compared to waiting for device driver status updates. Hence, there is a need to allow plugins to skip fallback in specific cases to improve scheduling performance.</p><h3 id="Implementation-Goals"><a href="#Implementation-Goals" class="headerlink" title="Implementation Goals"></a>Implementation Goals</h3><p>To improve scheduling throughput, the community proposed the following enhancements:</p><ol><li>Introduction of QueueingHint<ul><li>Introducing <code>QueueingHint</code> into the <code>EventsToRegister</code> mechanism, allowing plugins to provide recommendations for re-queuing pods.</li></ul></li><li>Enhancement of Pod Tracking and Re-queueing Mechanism<ul><li>Optimizing the implementation for tracking pods currently being processed in the scheduling queue.</li><li>Implementing a mechanism to re-queue rejected pods to appropriate queues.</li><li>Optimizing the backoff strategy for rejected pods, allowing plugins to skip backoff in specific cases to improve scheduling throughput.</li></ul></li></ol><h3 id="Potential-Risks"><a href="#Potential-Risks" class="headerlink" title="Potential Risks"></a>Potential Risks</h3><blockquote><h4 id="1-Errors-in-Implementation-Leading-to-Pods-Being-Unschedulable-in-unschedulablePods-for-Extended-Periods"><a href="#1-Errors-in-Implementation-Leading-to-Pods-Being-Unschedulable-in-unschedulablePods-for-Extended-Periods" class="headerlink" title="1. Errors in Implementation Leading to Pods Being Unschedulable in unschedulablePods for Extended Periods"></a>1. Errors in Implementation Leading to Pods Being Unschedulable in unschedulablePods for Extended Periods</h4></blockquote><p>If a plugin is configured with QueueingHint but misses some events that could make pods schedulable, pods rejected by that plugin may remain stuck in unschedulablePods for a long time.</p><p>Although the scheduling queue periodically cleans up pods in unschedulablePods (default is 5 minutes, configurable).</p><blockquote><h4 id="2-Increase-in-Memory-Usage"><a href="#2-Increase-in-Memory-Usage" class="headerlink" title="2. Increase in Memory Usage"></a>2. Increase in Memory Usage</h4></blockquote><p>As the scheduling queue needs to retain events occurring during scheduling, the memory usage of kube-scheduler will increase. Therefore, the busier the cluster, the more memory it may require.</p><p>Although it‚Äôs not possible to completely eliminate memory growth, releasing cached events as soon as possible can slow down the rate of memory growth.</p><blockquote><h4 id="3-Significant-Changes-in-EventsToRegister-in-EnqueueExtension"><a href="#3-Significant-Changes-in-EventsToRegister-in-EnqueueExtension" class="headerlink" title="3. Significant Changes in EventsToRegister in EnqueueExtension"></a>3. Significant Changes in <code>EventsToRegister</code> in <code>EnqueueExtension</code></h4></blockquote><p>Developers of custom scheduler plugins need to perform compatibility upgrades, as the return type of <code>EventsToRegister</code> in <code>EnqueueExtension</code> has changed from <code>ClusterEvent</code> to <code>ClusterEventWithHint</code>. <code>ClusterEventWithHint</code> allows each plugin to filter out more useless events through a callback function called <code>QueueingHintFn</code>.</p><p>To simplify the migration work, an empty <code>QueueingHintFn</code> is considered to always return <code>Queue</code>. Thus, if they only want to maintain the existing behavior, they only need to change <code>ClusterEvent</code> to <code>ClusterEventWithHint</code> without registering any <code>QueueingHintFn</code>.</p><h3 id="Design-of-QueueingHints"><a href="#Design-of-QueueingHints" class="headerlink" title="Design of QueueingHints"></a>Design of QueueingHints</h3><p>The return type of the <code>EventsToRegister</code> method has been changed to <code>[]ClusterEventWithHint</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type EnqueueExtensions interface &#123;</span><br><span class="line">Plugin</span><br><span class="line">...</span><br><span class="line">EventsToRegister() []ClusterEventWithHint</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Each <code>ClusterEventWithHint</code> structure consists of a <code>ClusterEvent</code> and a <code>QueueingHintFn</code>. When an event occurs, the <code>QueueingHintFn</code> is executed to determine whether the event can make the pod eligible for scheduling.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">type ClusterEventWithHint struct &#123;</span><br><span class="line">Event ClusterEvent</span><br><span class="line"></span><br><span class="line">QueueingHintFn QueueingHintFn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type QueueingHintFn func(logger klog.Logger, pod *v1.Pod, oldObj, newObj interface&#123;&#125;) (QueueingHint, error)</span><br><span class="line"></span><br><span class="line">type QueueingHint int</span><br><span class="line"></span><br><span class="line">const (</span><br><span class="line">// QueueSkip implies that the cluster event has no impact on</span><br><span class="line">// scheduling of the pod.</span><br><span class="line">QueueSkip QueueingHint = iota</span><br><span class="line"></span><br><span class="line">// Queue implies that the Pod may be schedulable by the event.</span><br><span class="line">Queue</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>The type <code>QueueingHintFn</code> is a function with a return type of <code>(QueueingHint, error)</code>. Here, <code>QueueingHint</code> is an enumeration type with possible values of <code>QueueSkip</code> and <code>Queue</code>. The invocation of <code>QueueingHintFn</code> occurs before moving pods from <code>unschedulableQ</code> to <code>backoffQ</code> or <code>activeQ</code>. If an error is returned, the <code>QueueingHint</code> provided by the caller will be treated as <code>QueueAfterBackoff</code>, which ensures that the pod does not remain indefinitely in the <code>unschedulableQ</code> queue, regardless of the returned result.</p><h3 id="When-to-Skip-Not-Skip-Backoff"><a href="#When-to-Skip-Not-Skip-Backoff" class="headerlink" title="When to Skip&#x2F;Not Skip Backoff"></a>When to Skip&#x2F;Not Skip Backoff</h3><p>The <code>backoffQ</code> prevents pods that are ‚Äúlong-term unschedulable‚Äù from blocking the queue, maintaining a lightweight queue with high throughput.</p><p>The longer a pod is rejected during the scheduling cycle, the longer it waits in the <code>backoffQ</code>.</p><p>For example, when <code>NodeAffinity</code> rejects a pod, and later returns <code>Queue</code> in its <code>QueueingHintFn</code>, the pod needs to wait for backoff before retrying scheduling.</p><p>However, certain plugins are designed to experience some failures during the scheduling cycle itself. For instance, the built-in DRA (Dynamic Resource Allocation) plugin, at the Reserve extension, informs the resource driver of the scheduling result and rejects the pod once to wait for a response from the resource driver. For such rejection scenarios, it should not be considered wasted scheduling cycles. Although a specific scheduling cycle fails, the scheduling result based on that cycle can facilitate pod scheduling. Therefore, pods rejected for this reason do not need to be penalized (backoff).</p><p>To support this scenario, we introduce a new state, <code>Pending</code>. When the DRA plugin rejects a pod using <code>Pending</code> and later returns <code>Queue</code> in its <code>QueueingHintFn</code>, the pod skips backoff and is rescheduled.</p><h3 id="How-QueueingHint-Works"><a href="#How-QueueingHint-Works" class="headerlink" title="How QueueingHint Works"></a>How QueueingHint Works</h3><p>When Kubernetes cluster events occur, the scheduling queue executes the <code>QueueingHintFn</code> of those plugins that rejected pods in the previous scheduling cycle.</p><p>The following scenarios describe how they are executed and how pods are moved:</p><blockquote><p>Pod Rejected by One or More Plugins</p></blockquote><p>Suppose there are three nodes. When a pod enters the scheduling cycle, one node rejects the pod due to insufficient resources, and the other two nodes reject it due to mismatching node affinity.</p><p>In this scenario, the pod is rejected by the <code>NodeResourceFit</code> and <code>NodeAffinity</code> plugins and is eventually placed in <code>unschedulableQ</code>.</p><p>Subsequently, whenever cluster events registered in these plugins occur, the scheduling queue notifies them via <code>QueueingHint</code>. If any <code>QueueingHintFn</code> from <code>NodeResourceFit</code> or <code>NodeAffinity</code> returns <code>Queue</code>, the pod is moved to <code>activeQ</code> or <code>backoffQ</code>. (For example, when a <code>NodeAdded</code> event occurs, <code>QueueingHint</code> from <code>NodeResourceFit</code> returns <code>Queue</code> because the pod may be schedulable to the new node.)</p><p>Whether it moves to <code>activeQ</code> or <code>backoffQ</code> depends on how long the pod has been in <code>unschedulableQ</code>. If the time spent in <code>unschedulableQ</code> exceeds the expected pod backoff delay time, it is moved directly to <code>activeQ</code>. Otherwise, it is moved to <code>backoffQ</code>.</p><blockquote><p>Pod Rejected due to Pending State</p></blockquote><p>When the DRA plugin returns <code>Pending</code> for a pod during the Reserve extension phase, the scheduling queue adds the DRA plugin to the pod‚Äôs <code>pendingPlugins</code> dictionary and returns the pod.</p><p>When a call to the <code>QueueingHint</code> of the DRA plugin returns <code>Queue</code> in subsequent invocations, the scheduling queue places the pod directly into <code>activeQ</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// Reserve reserves claims for the pod.</span><br><span class="line">func (pl *dynamicResources) Reserve(ctx context.Context, cs *framework.CycleState, pod *v1.Pod, nodeName string) *framework.Status &#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">if numDelayedAllocationPending == 1 || numClaimsWithStatusInfo == numDelayedAllocationPending &#123;</span><br><span class="line">...</span><br><span class="line">schedulingCtx.Spec.SelectedNode = nodeName</span><br><span class="line">logger.V(5).Info(&quot;start allocation&quot;, &quot;pod&quot;, klog.KObj(pod), &quot;node&quot;, klog.ObjectRef&#123;Name: nodeName&#125;)</span><br><span class="line">...</span><br><span class="line">return statusUnschedulable(logger, &quot;waiting for resource driver to allocate resource&quot;, &quot;pod&quot;, klog.KObj(pod), &quot;node&quot;, klog.ObjectRef&#123;Name: nodeName&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">return statusUnschedulable(logger, &quot;waiting for resource driver to provide information&quot;, &quot;pod&quot;, klog.KObj(pod))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Tracking-Pods-Being-Processed-in-the-Scheduling-Queue"><a href="#Tracking-Pods-Being-Processed-in-the-Scheduling-Queue" class="headerlink" title="Tracking Pods Being Processed in the Scheduling Queue"></a>Tracking Pods Being Processed in the Scheduling Queue</h4><p>By introducing <code>QueueingHint</code>, we can only retry scheduling when specific events occur. But what if these events happen during pod scheduling?</p><p>The scheduler takes a snapshot of the cluster data and schedules pods based on the snapshot. The snapshot is updated each time a scheduling cycle is initiated, meaning the same snapshot is used within the same scheduling cycle.</p><p>Consider a scenario where, during the scheduling of a pod, it is rejected due to no nodes meeting the pod‚Äôs node affinity, but a new node matching the pod‚Äôs node affinity is added during the scheduling process.</p><p>As mentioned earlier, this new node is not considered a candidate node within the current scheduling cycle. Therefore, the pod is still rejected by the node affinity plugin. The issue arises if the scheduling queue puts the pod into <code>unschedulableQ</code>, as the pod would still need to wait for another event even though a node matching the pod‚Äôs node affinity requirement is available.</p><p>To prevent scenarios where pods miss events during scheduling, the scheduling queue records events occurring during pod scheduling and determines the pod‚Äôs queueing position based on these events and <code>QueueingHint</code>.</p><p>Therefore, the scheduling queue caches events from the time a pod leaves the scheduling queue until it returns to the scheduling queue or is scheduled. When the cached events are no longer needed, they are discarded.</p><h2 id="Golang-Doubly-Linked-List"><a href="#Golang-Doubly-Linked-List" class="headerlink" title="Golang Doubly Linked List"></a>Golang Doubly Linked List</h2><p><code>*list.List</code> is a data structure in Go‚Äôs standard library <code>container/list</code> package, representing a doubly linked list. In Go, doubly linked lists are a common data structure used to provide efficient performance for operations like element insertion, deletion, and traversal.</p><p>Here‚Äôs a brief overview of the <code>*list.List</code> structure:</p><ul><li><strong>Definition</strong>: <code>*list.List</code> is a pointer to a doubly linked list. It contains pointers to the head and tail of the list, as well as information about the length of the list.</li><li><strong>Features</strong>: Each node in the doubly linked list contains pointers to the previous and next nodes, making operations like inserting and deleting elements in the list efficient.</li><li><strong>Usage</strong>: <code>*list.List</code> is commonly used in scenarios where frequent insertion and deletion operations are required, especially when the number of elements is not fixed or the order may change frequently.</li></ul><p>Here‚Äôs a demonstration of how to use <code>*list.List</code> in Go:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">goCopy codepackage main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;container/list&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">    // Create a new doubly linked list</span><br><span class="line">    l := list.New()</span><br><span class="line"></span><br><span class="line">    // Add elements to the end of the list</span><br><span class="line">    l.PushBack(1)</span><br><span class="line">    l.PushBack(2)</span><br><span class="line">    l.PushBack(3)</span><br><span class="line"></span><br><span class="line">    // Iterate over the list and print elements</span><br><span class="line">    for e := l.Front(); e != nil; e = e.Next() &#123;</span><br><span class="line">        fmt.Println(e.Value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>PushBack</code> method adds a new element to the end of the list and returns a pointer to the new element (<code>*list.Element</code>). This pointer can be used for further operations on the element, such as removal or modification.</p><p>The <code>*list.Element</code> structure contains pointers to the previous and next elements in the list, as well as a field for storing the element‚Äôs value. By returning a <code>*list.Element</code> pointer, we can conveniently access the newly added element when needed for further operations. To remove an element from the doubly linked list, you can use the <code>list.Remove()</code> method. This method takes a list element as input and removes the element from the list.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">&quot;container/list&quot;</span><br><span class="line">&quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line"></span><br><span class="line">myList := list.New()</span><br><span class="line"></span><br><span class="line">myList.PushBack(1)</span><br><span class="line">myList.PushBack(2)</span><br><span class="line">myList.PushBack(3)</span><br><span class="line"></span><br><span class="line">elementToRemove := myList.Front().Next()</span><br><span class="line"></span><br><span class="line">myList.Remove(elementToRemove)</span><br><span class="line"></span><br><span class="line">for element := myList.Front(); element != nil; element = element.Next() &#123;</span><br><span class="line">fmt.Println(element.Value)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>outputsÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">3</span><br></pre></td></tr></table></figure><p>In this example, we remove the second element (with a value of 2) from the linked list.</p><h2 id="A-brief-analysis"><a href="#A-brief-analysis" class="headerlink" title="A brief analysis"></a>A brief analysis</h2><p>Let‚Äôs dive straight into analyzing the memory usage using pprof. Here‚Äôs a partial list of pprof profiles:</p><p><img src="https://pic.imgdb.cn/item/65dc98699f345e8d03f7c8e8.png" alt="K8s 1.28 scheduler OOM pprof"></p><p>Here, we can observe that memory usage is primarily concentrated in protobuf‚Äôs <code>Decode</code>. Without delving into specific pprof analysis, we can consider three potential factors:</p><ul><li>Whether grpc-go has memory issues</li><li>Whether there are issues with Go itself</li><li>Whether Kubernetes has memory issues</li></ul><p>Regarding the first assumption, we can check related issues in grpc-go. However, recent reports do not indicate any memory anomalies. As for issues with Go itself, it doesn‚Äôt seem likely, although we did find a related Transparent Huge Pages (THP) issue, which we can briefly discuss later. Thus, the most probable cause would be an issue within Kubernetes itself. However, considering that <code>(*FieldsV1).Unmarshal</code> hasn‚Äôt been modified for 5 years, it‚Äôs highly unlikely to be the source of the problem. Therefore, let‚Äôs delve deeper into analyzing pprof.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">k8s.io/apimachinery/pkg/apis/meta/v1.(*FieldsV1).Unmarshal</span><br><span class="line">vendor/k8s.io/apimachinery/pkg/apis/meta/v1/generated.pb.go</span><br><span class="line"></span><br><span class="line">  Total:      309611     309611 (flat, cum)  2.62%</span><br><span class="line">   6502            .          .           if postIndex &gt; l &#123; </span><br><span class="line">   6503            .          .           return io.ErrUnexpectedEOF </span><br><span class="line">   6504            .          .           &#125; </span><br><span class="line">   6505       309611     309611           m.Raw = append(m.Raw[:0], dAtA[iNdEx:postIndex]...) </span><br><span class="line">   6506            .          .           if m.Raw == nil &#123; </span><br><span class="line">   6507            .          .           m.Raw = []byte&#123;&#125; </span><br><span class="line">   6508            .          .           &#125; </span><br></pre></td></tr></table></figure><p>ËøáÊÆµÊó∂Èó¥Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">k8s.io/apimachinery/pkg/apis/meta/v1.(*FieldsV1).Unmarshal</span><br><span class="line">vendor/k8s.io/apimachinery/pkg/apis/meta/v1/generated.pb.go</span><br><span class="line"></span><br><span class="line">  Total:     2069705    2069705 (flat, cum)  2.49%</span><br><span class="line">   6502            .          .           if postIndex &gt; l &#123; </span><br><span class="line">   6503            .          .           return io.ErrUnexpectedEOF </span><br><span class="line">   6504            .          .           &#125; </span><br><span class="line">   6505      2069705    2069705           m.Raw = append(m.Raw[:0], dAtA[iNdEx:postIndex]...) </span><br><span class="line">   6506            .          .           if m.Raw == nil &#123; </span><br><span class="line">   6507            .          .           m.Raw = []byte&#123;&#125; </span><br><span class="line">   6508            .          .           &#125; </span><br></pre></td></tr></table></figure><p>In the continuously growing list of pods, I noticed some unreleased data that seemed to align with the results of my previous analysis using pprof. Interestingly, pods are the only continuously changing objects. Therefore, I attempted another troubleshooting method to verify if the community had resolved this issue. I used minikube to launch Kubernetes version 1.18.5 locally for investigation. Fortunately, I couldn‚Äôt reproduce the issue, indicating that the problem might have been fixed after version 1.18.5.</p><p>To narrow down the investigation further, I asked my colleagues to inspect the commit history between these three minor versions. Eventually, we found a PR that closed the <code>SchedulerQueueingHints</code> feature. As mentioned in the technical background, the <code>SchedulerQueueingHints</code> feature could potentially lead to memory growth issues.</p><p>By examining the <code>PriorityQueue</code> structure, it was evident that the logic handling the feature was controlled by <code>isSchedulingQueueHintEnabled</code>. If the <code>QueueingHint</code> feature is enabled, when executing the <code>Pop</code> method to schedule pods, the UID of the corresponding pod in <code>inFlightPods</code> needs to be populated with the same linked list as <code>inFlightEvents</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">func (p *PriorityQueue) Pop(logger klog.Logger) (*framework.QueuedPodInfo, error) &#123;</span><br><span class="line">p.lock.Lock()</span><br><span class="line">defer p.lock.Unlock()</span><br><span class="line"></span><br><span class="line">obj, err := p.activeQ.Pop()</span><br><span class="line">...</span><br><span class="line">// In flight, no concurrent events yet.</span><br><span class="line">if p.isSchedulingQueueHintEnabled &#123;</span><br><span class="line">p.inFlightPods[pInfo.Pod.UID] = p.inFlightEvents.PushBack(pInfo.Pod)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">return pInfo, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>So, when are the linked list fields removed? We can observe that the only time they are removed is when the pod completes its scheduling cycle, that is, when the <code>Done</code> method is called.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">func (p *PriorityQueue) Done(pod types.UID) &#123;</span><br><span class="line">p.lock.Lock()</span><br><span class="line">defer p.lock.Unlock()</span><br><span class="line"></span><br><span class="line">p.done(pod)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (p *PriorityQueue) done(pod types.UID) &#123;</span><br><span class="line">if !p.isSchedulingQueueHintEnabled &#123;</span><br><span class="line">// do nothing if schedulingQueueHint is disabled.</span><br><span class="line">// In that case, we don&#x27;t have inFlightPods and inFlightEvents.</span><br><span class="line">return</span><br><span class="line">&#125;</span><br><span class="line">inFlightPod, ok := p.inFlightPods[pod]</span><br><span class="line">if !ok &#123;</span><br><span class="line">// This Pod is already done()ed.</span><br><span class="line">return</span><br><span class="line">&#125;</span><br><span class="line">delete(p.inFlightPods, pod)</span><br><span class="line"></span><br><span class="line">// Remove the pod from the list.</span><br><span class="line">p.inFlightEvents.Remove(inFlightPod)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for &#123;</span><br><span class="line">...</span><br><span class="line">p.inFlightEvents.Remove(e)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here, it can be observed that the later the timing of <code>Done</code>, the more pronounced the memory growth, and if pod events are ignored or missed, abnormal memory growth in the linked list can also occur. Some fixes for the above scenario can be seen:</p><ul><li>A PR, such as #120586, which emphasizes calling <code>Done()</code> as soon as possible.</li><li>The <code>QueueingHint</code> of the NodeAffinity&#x2F;NodeUnschedulable plugins missed relevant Node events, as seen in PR#122284.</li></ul><p>Despite these modifications, such issues are far from over.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><a href="https://github.com/kubernetes/kubernetes/issues/122725">https://github.com/kubernetes/kubernetes/issues/122725</a></li><li><a href="https://github.com/kubernetes/kubernetes/issues/122284">https://github.com/kubernetes/kubernetes/issues/122284</a></li><li><a href="https://github.com/kubernetes/kubernetes/pull/122289">https://github.com/kubernetes/kubernetes/pull/122289</a></li><li><a href="https://github.com/kubernetes/kubernetes/issues/118893">https://github.com/kubernetes/kubernetes/issues/118893</a></li><li><a href="https://github.com/kubernetes/enhancements/blob/cf6ee34e37f00d838872d368ec66d7a0b40ee4e6/keps/sig-scheduling/4247-queueinghint/README.md?plain=1#L579">https://github.com/kubernetes/enhancements/blob/cf6ee34e37f00d838872d368ec66d7a0b40ee4e6/keps/sig-scheduling/4247-queueinghint/README.md?plain=1#L579</a></li><li><a href="https://github.com/kubernetes/kubernetes/issues/122661">https://github.com/kubernetes/kubernetes/issues/122661</a></li><li><a href="https://github.com/kubernetes/kubernetes/pull/120586">https://github.com/kubernetes/kubernetes/pull/120586</a></li><li><a href="https://openai.com/">https://openai.com/</a></li><li><a href="https://github.com/kubernetes/kubernetes/issues/118059">https://github.com/kubernetes/kubernetes/issues/118059</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Before the new year, a colleague upgraded the Kubernetes scheduler to version 1.28.3 and observed abnormal memory behavior. Let‚Äôs take a </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Êé¢Á¥¢Kubernetes 1.28Ë∞ÉÂ∫¶Âô®OOMÁöÑÊ†πÊ∫ê</title>
    <link href="https://zoues.com/posts/e46bd846/"/>
    <id>https://zoues.com/posts/e46bd846/</id>
    <published>2024-02-25T12:25:08.000Z</published>
    <updated>2024-02-28T12:18:12.203Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ÈóÆÈ¢òÊèèËø∞"><a href="#ÈóÆÈ¢òÊèèËø∞" class="headerlink" title="ÈóÆÈ¢òÊèèËø∞"></a>ÈóÆÈ¢òÊèèËø∞</h2><p>Âπ¥ÂâçÔºåÂêå‰∫ãÂçáÁ∫ßK8sË∞ÉÂ∫¶Âô®Ëá≥1.28.3ÔºåËßÇÂØüÂà∞ÂÜÖÂ≠òÂºÇÂ∏∏Áé∞Ë±°ÔºåÂ∏ÆÂøô‰∏ÄËµ∑ÁúãÁúãÔºåÂú®ÈõÜÁæ§podÂèänodeÈöè‰∏öÂä°ÊΩÆÊ±êÂèòÂä®ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂÜÖÂ≠òÂëàÁé∞‰∏çÊñ≠‰∏äÂçáÁöÑË∂ãÂäøÔºåÁõ¥Ëá≥OOM</p><blockquote><p>‰∏ãÈù¢Êï∞ÊçÆÂùá‰∏∫Á§æÂå∫ÂÖ¨ÂºÄ‰ø°ÊÅØ</p></blockquote><img src="https://pic.imgdb.cn/item/65dc98699f345e8d03f7c855.png" alt="K8s 1.28 scheduler OOM" style="zoom:50%;" /><p>Ëß¶ÂèëÂú∫ÊôØÊúâ‰ª•‰∏ã‰∏§Áßç(Á§æÂå∫ËøòÊúâÂÖ∂‰ªñÂ§çÁé∞ÊñπÂºè)Ôºö</p><ul><li>case 1</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for (( ; ; ))</span><br><span class="line">do</span><br><span class="line">    kubectl scale deployment nginx-test --replicas=0 </span><br><span class="line">    sleep 30</span><br><span class="line">    kubectl scale deployment nginx-test --replicas=50</span><br><span class="line">    sleep 30</span><br><span class="line">done</span><br></pre></td></tr></table></figure><ul><li>case 2</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. Create a Pod with NodeAffinity under the situation where no Node can accommodate the Pod.</span><br><span class="line">2. Create a new Node.</span><br></pre></td></tr></table></figure><p>Êàë‰ª¨Âú®Á§æÂå∫ÁöÑÂèëÁé∞Â§öËµ∑Á±ª‰ººÂÜÖÂ≠òÂºÇÂ∏∏Âú∫ÊôØÔºåÂ§çÁé∞ÊñπÂºè‰∏çÂ∞ΩÁõ∏ÂêåÔºåÂÖ≥‰∫é‰∏äËø∞ÈóÆÈ¢òÁöÑÁªìËÆ∫ÊòØÔºö</p><blockquote><blockquote><p>KubernetesÁ§æÂå∫Âú®1.28ÁâàÊú¨‰∏≠ÈªòËÆ§ÂºÄÂêØ‰∫ÜË∞ÉÂ∫¶ÁâπÊÄßSchedulerQueueingHintsÔºåÂØºËá¥Ë∞ÉÂ∫¶ÁªÑ‰ª∂ÂÜÖÂ≠òÂºÇÂ∏∏„ÄÇ‰∏∫‰∫Ü‰∏¥Êó∂Ëß£ÂÜ≥ÂÜÖÂ≠òÁ≠âÈóÆÈ¢òÔºåÁ§æÂå∫Âú®1.28.5‰∏≠Â∞ÜËØ•ÁâπÊÄßË∞ÉÊï¥‰∏∫ÈªòËÆ§ÂÖ≥Èó≠„ÄÇÂõ†‰∏∫ÈóÆÈ¢òÂπ∂Êú™ÂÆåÂÖ®‰øÆÂ§çÔºåÊâÄ‰ª•Âª∫ËÆÆÂÆ°ÊÖéÂºÄÂêØËØ•ÁâπÊÄß„ÄÇ</p></blockquote></blockquote><h2 id="ÊäÄÊúØËÉåÊôØ"><a href="#ÊäÄÊúØËÉåÊôØ" class="headerlink" title="ÊäÄÊúØËÉåÊôØ"></a>ÊäÄÊúØËÉåÊôØ</h2><p>ËØ•Á´†ËäÇ‰ªãÁªç‰ª•‰∏ãÂÜÖÂÆπÔºö</p><ul><li>‰ªãÁªçK8sË∞ÉÂ∫¶Âô®Áõ∏ÂÖ≥ÁªìÊûÑ‰Ωì</li><li>‰ªãÁªçK8sË∞ÉÂ∫¶Âô®QueueingHint</li><li>golangÁöÑÂèåÂêëÈìæË°®</li></ul><h3 id="Ë∞ÉÂ∫¶Âô®ÁÆÄ‰ªã"><a href="#Ë∞ÉÂ∫¶Âô®ÁÆÄ‰ªã" class="headerlink" title="Ë∞ÉÂ∫¶Âô®ÁÆÄ‰ªã"></a>Ë∞ÉÂ∫¶Âô®ÁÆÄ‰ªã</h3><p>PriorityQueueÊòØSchedulingQueueÁöÑÊé•Âè£ÂÆûÁé∞„ÄÇÂÆÉÁöÑÂ§¥ÈÉ®Â≠òÊîæÁùÄ‰ºòÂÖàÁ∫ßÊúÄÈ´òÁöÑÂæÖË∞ÉÂ∫¶Pod„ÄÇPriorityQueueÂåÖÂê´‰ª•‰∏ãÈáçË¶ÅÂ≠óÊÆµÔºö</p><ol><li>activeQÔºöÂ≠òÊîæÂáÜÂ§áÂ•ΩË∞ÉÂ∫¶ÁöÑPod„ÄÇÊñ∞Ê∑ªÂä†ÁöÑPod‰ºöË¢´ÊîæÂÖ•ËØ•ÈòüÂàó„ÄÇË∞ÉÂ∫¶ÈòüÂàóÈúÄË¶ÅÊâßË°åË∞ÉÂ∫¶Êó∂Ôºå‰ºö‰ªéËØ•ÈòüÂàó‰∏≠Ëé∑ÂèñPod„ÄÇactiveQÁî±Â†ÜÊù•ÂÆûÁé∞„ÄÇ</li><li>backoffQÔºöÂ≠òÊîæÂõ†ÂêÑÁßçÂéüÂõ†ÔºàÊØîÂ¶ÇÊú™Êª°Ë∂≥ËäÇÁÇπË¶ÅÊ±ÇÔºâËÄåË¢´Âà§ÂÆö‰∏∫Êó†Ê≥ïË∞ÉÂ∫¶ÁöÑPod„ÄÇËøô‰∫õPod‰ºöÂú®‰∏ÄÊÆµÈÄÄÈÅøÊó∂Èó¥ÂêéÔºåË¢´ÁßªÂà∞activeQ‰ª•Â∞ùËØïÂÜçÊ¨°Ë∞ÉÂ∫¶„ÄÇbackoffQ‰πüÁî±Â†ÜÊù•ÂÆûÁé∞„ÄÇ</li><li>unschedulablePodsÔºöÂ≠òÊîæÂõ†ÂêÑÁßçÂéüÂõ†Êó†Ê≥ïË∞ÉÂ∫¶ÁöÑPodÔºåÊòØ‰∏Ä‰∏™mapÊï∞ÊçÆÁªìÊûÑ„ÄÇËøô‰∫õPodË¢´ËÆ§ÂÆö‰∏∫Êó†Ê≥ïË∞ÉÂ∫¶Ôºå‰∏ç‰ºöÁõ¥Êé•ÊîæÂÖ•backoffQÔºåËÄåÊòØË¢´ËÆ∞ÂΩïÂú®ËøôÈáå„ÄÇÂæÖÊù°‰ª∂Êª°Ë∂≥Êó∂ÔºåÂÆÉ‰ª¨Â∞ÜË¢´ÁßªÂà∞activeQÊàñËÄÖbackoffQ‰∏≠ÔºåË∞ÉÂ∫¶ÈòüÂàó‰ºöÂÆöÊúüÊ∏ÖÁêÜunschedulablePods ‰∏≠ÁöÑ Pod„ÄÇ</li><li>inFlightEventsÔºöÁî®‰∫é‰øùÂ≠òË∞ÉÂ∫¶ÈòüÂàóÊé•Êî∂Âà∞ÁöÑ‰∫ã‰ª∂ÔºàentryÁöÑÂÄºÊòØclusterEventÔºâÔºå‰ª•ÂèäÊ≠£Âú®Â§ÑÁêÜ‰∏≠ÁöÑPodÔºàentryÁöÑÂÄºÊòØ*v1.PodÔºâÔºåÂü∫‰∫égolangÂÜÖÈÉ®ÂÆûÁé∞ÁöÑÂèåÂêëÈìæË°®</li><li>inFlightPodsÔºö‰øùÂ≠ò‰∫ÜÊâÄÊúâÂ∑≤ÁªèPopÔºå‰ΩÜÂ∞öÊú™Ë∞ÉÁî®DoneÁöÑPodÁöÑUIDÔºåÊç¢Âè•ËØùËØ¥ÔºåÊâÄÊúâÂΩìÂâçÊ≠£Âú®Â§ÑÁêÜ‰∏≠ÁöÑPodÔºàÊ≠£Âú®Ë∞ÉÂ∫¶„ÄÅÂú®admit‰∏≠ÊàñÂú®ÁªëÂÆöÂë®Êúü‰∏≠Ôºâ„ÄÇ</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// PriorityQueue implements a scheduling queue.</span><br><span class="line">type PriorityQueue struct &#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">inFlightPods map[types.UID]*list.Element</span><br><span class="line"></span><br><span class="line">inFlightEvents *list.List</span><br><span class="line"></span><br><span class="line">activeQ *heap.Heap</span><br><span class="line"></span><br><span class="line">podBackoffQ *heap.Heap</span><br><span class="line">// unschedulablePods holds pods that have been tried and determined unschedulable.</span><br><span class="line">unschedulablePods *UnschedulablePods</span><br><span class="line">// schedulingCycle represents sequence number of scheduling cycle and is incremented</span><br><span class="line">// when a pod is popped.</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">// preEnqueuePluginMap is keyed with profile name, valued with registered preEnqueue plugins.</span><br><span class="line">preEnqueuePluginMap map[string][]framework.PreEnqueuePlugin</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">// isSchedulingQueueHintEnabled indicates whether the feature gate for the scheduling queue is enabled.</span><br><span class="line">isSchedulingQueueHintEnabled bool</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ÂÖ≥‰∫éK8sÂÆåÊï¥‰ªãÁªçÔºåÂèÇÁúã<a href="https://mp.weixin.qq.com/s?__biz=MzI1MzE0NTI0NQ==&mid=2650490396&idx=1&sn=c59b2252a833c7a215a606598f907f5c&chksm=f1d71feec6a096f81f54b2af3830a7e49aaf11ce118c4fda4928bfff5229dbce334610561b3d&token=232089518&lang=zh_CN#rd">kuberneterË∞ÉÂ∫¶Áî±ÊµÖÂÖ•Ê∑±ÔºöÊ°ÜÊû∂</a>ÔºåÂêéÁª≠‰ºöÊõ¥Êñ∞ÊúÄÊñ∞ÁöÑK8sË∞ÉÂ∫¶Âô®Ê¢≥ÁêÜ</p></blockquote><h3 id="QueueingHint"><a href="#QueueingHint" class="headerlink" title="QueueingHint"></a>QueueingHint</h3><p>K8sË∞ÉÂ∫¶Âô®ÂºïÂÖ•‰∫Ü<code>QueueingHint</code>ÁâπÊÄßÔºåÈÄöËøá‰ªéÊØè‰∏™Êèí‰ª∂Ëé∑ÂèñÊúâÂÖ≥PodÈáçÊñ∞ÂÖ•ÈòüÁöÑÂª∫ËÆÆÔºå‰ª•ÂáèÂ∞ë‰∏çÂøÖË¶ÅÁöÑË∞ÉÂ∫¶ÈáçËØïÔºå‰ªéËÄåÊèêÂçáË∞ÉÂ∫¶ÂêûÂêêÈáè„ÄÇÂêåÊó∂ÔºåÂú®ÈÄÇÂΩìÊÉÖÂÜµ‰∏ãË∑≥ËøáÈÄÄÈÅøÔºåËøõ‰∏ÄÊ≠•ÊèêÈ´òPodË∞ÉÂ∫¶ÊïàÁéá„ÄÇ</p><h4 id="ÈúÄÊ±ÇËÉåÊôØ"><a href="#ÈúÄÊ±ÇËÉåÊôØ" class="headerlink" title="ÈúÄÊ±ÇËÉåÊôØ"></a>ÈúÄÊ±ÇËÉåÊôØ</h4><p>ÂΩìÂâçÔºåÊØè‰∏™Êèí‰ª∂ÂèØ‰ª•ÈÄöËøáEventsToRegisterÂÆö‰πâ‰ΩïÊó∂ÈáçËØïË∞ÉÂ∫¶Ë¢´Êèí‰ª∂ÊãíÁªùÁöÑPod„ÄÇ</p><p>ÊØîÂ¶ÇÔºåNodeAffinity‰ºöÂú®ËäÇÁÇπÊ∑ªÂä†ÊàñÊõ¥Êñ∞Êó∂ÈáçËØïË∞ÉÂ∫¶PodÔºåÂõ†‰∏∫Êñ∞Ê∑ªÂä†ÊàñÊõ¥Êñ∞ÁöÑËäÇÁÇπÂèØËÉΩÂÖ∑Êúâ‰∏éPod‰∏äÁöÑNodeAffinityÂåπÈÖçÁöÑÊ†áÁ≠æ„ÄÇÁÑ∂ËÄåÔºåÂÆûÈôÖ‰∏äÔºåÂú®ÈõÜÁæ§‰∏≠‰ºöÂèëÁîüÂ§ßÈáèËäÇÁÇπÊõ¥Êñ∞‰∫ã‰ª∂ÔºåËøôÂπ∂‰∏çËÉΩ‰øùËØÅ‰πãÂâçË¢´NodeAffinityÊãíÁªùÁöÑPodËÉΩÂ§üÊàêÂäüË∞ÉÂ∫¶„ÄÇ</p><p>‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºåË∞ÉÂ∫¶Âô®ÂºïÂÖ•‰∫ÜÊõ¥Á≤æÁªÜÁöÑÂõûË∞ÉÂáΩÊï∞Ôºå‰ª•ËøáÊª§ÊéâÊó†ÂÖ≥ÁöÑ‰∫ã‰ª∂Ôºå‰ªéËÄåÂú®‰∏ã‰∏Ä‰∏™Ë∞ÉÂ∫¶Âë®Êúü‰∏≠‰ªÖÈáçËØïÂèØËÉΩÊàêÂäüË∞ÉÂ∫¶ÁöÑPod„ÄÇ</p><p>Âè¶Â§ñÔºåDRAÔºàÂä®ÊÄÅËµÑÊ∫êÂàÜÈÖçÔºâË∞ÉÂ∫¶Êèí‰ª∂ÊúâÊó∂ÈúÄË¶ÅÊãíÁªùPod‰ª•Á≠âÂæÖÊù•Ëá™ËÆæÂ§áÈ©±Âä®Á®ãÂ∫èÁöÑÁä∂ÊÄÅÊõ¥Êñ∞„ÄÇÂõ†Ê≠§ÔºåÊüê‰∫õPodÂèØËÉΩÈúÄË¶ÅÁªèËøáÂá†‰∏™Ë∞ÉÂ∫¶Âë®ÊúüÊâçËÉΩÂÆåÊàêË∞ÉÂ∫¶„ÄÇÈíàÂØπËøôÁßçÊÉÖÂÜµÔºå‰∏éÁ≠âÂæÖËÆæÂ§áÈ©±Âä®Á®ãÂ∫èÁä∂ÊÄÅÊõ¥Êñ∞Áõ∏ÊØîÔºåÂõûÈÄÄÁ≠âÂæÖÁöÑÊó∂Èó¥Êõ¥Èïø„ÄÇÂõ†Ê≠§ÔºåÂ∏åÊúõËÉΩÂ§ü‰ΩøÊèí‰ª∂Âú®ÁâπÂÆöÊÉÖÂÜµ‰∏ãË∑≥ËøáÂõûÈÄÄ‰ª•ÊîπÂñÑË∞ÉÂ∫¶ÊÄßËÉΩ„ÄÇ</p><h4 id="ÂÆûÁé∞ÁõÆÊ†á"><a href="#ÂÆûÁé∞ÁõÆÊ†á" class="headerlink" title="ÂÆûÁé∞ÁõÆÊ†á"></a>ÂÆûÁé∞ÁõÆÊ†á</h4><p>‰∏∫‰∫ÜÊèêÈ´òË∞ÉÂ∫¶ÂêûÂêêÈáèÔºåÁ§æÂå∫ÊèêÂá∫‰ª•‰∏ãÊîπËøõÔºö</p><ol><li><strong>ÂºïÂÖ•QueueingHint</strong><ul><li>Â∞Ü <code>QueueingHint</code> ÂºïÂÖ•Âà∞ <code>EventsToRegister</code> Êú∫Âà∂‰∏≠ÔºåÂÖÅËÆ∏Êèí‰ª∂Êèê‰æõÈíàÂØπPodsÈáçÊñ∞ÂÖ•ÈòüÁöÑÂª∫ËÆÆ</li></ul></li><li><strong>Â¢ûÂº∫ Pod Ë∑üË∏™ÂíåÈáçÊñ∞ÂÖ•ÈòüÊú∫Âà∂</strong>Ôºö<ul><li>‰ºòÂåñËøΩË∏™Ë∞ÉÂ∫¶ÈòüÂàóÂÜÖÊ≠£Âú®Â§ÑÁêÜÁöÑ PodsÂÆûÁé∞</li><li>ÂÆûÁé∞‰∏ÄÁßçÊú∫Âà∂ÔºåÂ∞ÜË¢´ÊãíÁªùÁöÑ Pods ÈáçÊñ∞ÂÖ•ÈòüÂà∞ÈÄÇÂΩìÁöÑÈòüÂàó</li><li>‰ºòÂåñË¢´ÊãíÁªùÁöÑPodsÁöÑÈÄÄÈÅøÁ≠ñÁï•ÔºåËÉΩÂ§ü‰ΩøÊèí‰ª∂Âú®ÁâπÂÆöÊÉÖÂÜµ‰∏ãË∑≥ËøáÂõûÈÄÄÔºå‰ªéËÄåÊèêÈ´òË∞ÉÂ∫¶ÂêûÂêêÈáè„ÄÇ</li></ul></li></ol><h4 id="ÊΩúÂú®È£éÈô©"><a href="#ÊΩúÂú®È£éÈô©" class="headerlink" title="ÊΩúÂú®È£éÈô©"></a>ÊΩúÂú®È£éÈô©</h4><p><em><strong>1. ÂÆûÁé∞‰∏≠ÁöÑÈîôËØØÂèØËÉΩÂØºËá¥ Pod Âú® unschedulablePods ‰∏≠ÈïøÊó∂Èó¥Êó†Ê≥ïË¢´Ë∞ÉÂ∫¶</strong></em></p><p>Â¶ÇÊûú‰∏Ä‰∏™Êèí‰ª∂ÈÖçÁΩÆ‰∫Ü QueueingHintÔºå‰ΩÜÂÆÉÈîôËøá‰∫Ü‰∏Ä‰∫õÂèØ‰ª•ËÆ© Pod ÂèØË∞ÉÂ∫¶ÁöÑ‰∫ã‰ª∂Ôºå Ë¢´ËØ•Êèí‰ª∂ÊãíÁªùÁöÑ Pod ÂèØËÉΩ‰ºöÈïøÊúüÂõ∞Âú® unschedulablePods ‰∏≠„ÄÇ</p><p>ËôΩÁÑ∂Ë∞ÉÂ∫¶ÈòüÂàó‰ºöÂÆöÊúüÊ∏ÖÁêÜunschedulablePods ‰∏≠ÁöÑ Pod„ÄÇÔºàÈªòËÆ§‰∏∫ 5 ÂàÜÈíüÔºåÂèØÈÖçÔºâ</p><p><em><strong>2. ÂÜÖÂ≠ò‰ΩøÁî®ÈáèÁöÑÂ¢ûÂä†</strong></em></p><p>Âõ†‰∏∫Ë∞ÉÂ∫¶ÈòüÂàóÈúÄË¶Å‰øùÁïôË∞ÉÂ∫¶ËøáÁ®ã‰∏≠ÂèëÁîüÁöÑ‰∫ã‰ª∂Ôºåkube-schedulerÁöÑÂÜÖÂ≠ò‰ΩøÁî®Èáè‰ºöÂ¢ûÂä†„ÄÇ ÊâÄ‰ª•ÈõÜÁæ§Ë∂äÁπÅÂøôÔºåÂÆÉÂèØËÉΩÈúÄË¶ÅÁöÑÂÜÖÂ≠òÂ∞±Ë∂äÂ§ö„ÄÇ</p><p>ËôΩÁÑ∂Êó†Ê≥ïÂÆåÂÖ®Ê∂àÈô§ÂÜÖÂ≠òÂ¢ûÈïøÔºå‰ΩÜÂ¶ÇÊûúËÉΩÂ§üÂ∞ΩÂø´ÈáäÊîæÁºìÂ≠òÁöÑ‰∫ã‰ª∂ÔºåÂ∞±ÂèØ‰ª•Âª∂ÁºìÂÜÖÂ≠òÂ¢ûÈïøÁöÑÈÄüÂ∫¶„ÄÇ</p><p><em><strong>3.<code>EnqueueExtension</code> ‰∏≠ <code>EventsToRegister</code> ‰∏≠ÁöÑÈáçÂ§ßÂèòÊõ¥</strong></em></p><p>Ëá™ÂÆö‰πâË∞ÉÂ∫¶Âô®Êèí‰ª∂ÁöÑÂºÄÂèëËÄÖÈúÄË¶ÅËøõË°åÂÖºÂÆπÊÄßÂçáÁ∫ßÔºå <code>EnqueueExtension</code> ‰∏≠ÁöÑ <code>EventsToRegister</code> Â∞ÜËøîÂõûÂÄº‰ªé <code>ClusterEvent</code> Êõ¥Êîπ‰∏∫ <code>ClusterEventWithHint</code>„ÄÇ<code>ClusterEventWithHint</code> ÂÖÅËÆ∏ÊØè‰∏™Êèí‰ª∂ÈÄöËøáÂêç‰∏∫ <code>QueueingHintFn</code> ÁöÑÂõûË∞ÉÂáΩÊï∞ËøáÊª§Êõ¥Â§öÊó†Áî®ÁöÑ‰∫ã‰ª∂„ÄÇ</p><p>Á§æÂå∫‰∏∫‰∫ÜÁÆÄÂåñËøÅÁßªÂ∑•‰ΩúÔºåÁ©∫ÁöÑ <code>QueueingHintFn</code> Ë¢´ËßÜ‰∏∫ÂßãÁªàËøîÂõû <code>Queue</code>„ÄÇ Âõ†Ê≠§ÔºåÂ¶ÇÊûú‰ªñ‰ª¨Âè™ÊÉ≥‰øùÊåÅÁé∞ÊúâË°å‰∏∫Ôºå‰ªñ‰ª¨Âè™ÈúÄË¶ÅÂ∞Ü <code>ClusterEvent</code> Êõ¥Êîπ‰∏∫ <code>ClusterEventWithHint</code> Âπ∂‰∏çÈúÄË¶ÅÊ≥®ÂÜå‰ªª‰Ωï <code>QueueingHintFn</code>„ÄÇ</p><h4 id="QueueingHintsËÆæËÆ°"><a href="#QueueingHintsËÆæËÆ°" class="headerlink" title="QueueingHintsËÆæËÆ°"></a>QueueingHintsËÆæËÆ°</h4><p>EventsToRegister ÊñπÊ≥ïÁöÑËøîÂõûÁ±ªÂûãÂ∑≤Êõ¥Êîπ‰∏∫ []ClusterEventWithHint</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// EnqueueExtensions ÊòØ‰∏Ä‰∏™ÂèØÈÄâÊé•Âè£ÔºåÊèí‰ª∂ÂèØ‰ª•ÂÆûÁé∞Âú®ÂÜÖÈÉ®Ë∞ÉÂ∫¶ÈòüÂàó‰∏≠ÁßªÂä®Êó†Ê≥ïË∞ÉÂ∫¶ÁöÑ Pod„ÄÇÂèØ‰ª•ÂØº</span><br><span class="line">// Ëá¥PodÊó†Ê≥ïË∞ÉÂ∫¶Ôºà‰æãÂ¶ÇÔºåFilter Êèí‰ª∂ÔºâÁöÑÊèí‰ª∂ÂèØ‰ª•ÂÆûÁé∞Ê≠§Êé•Âè£„ÄÇ</span><br><span class="line">type EnqueueExtensions interface &#123;</span><br><span class="line">Plugin</span><br><span class="line">...</span><br><span class="line">EventsToRegister() []ClusterEventWithHint</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÊØè‰∏™ ClusterEventWithHintÁªìÊûÑ‰ΩìÂåÖÂê´‰∏Ä‰∏™ ClusterEvent Âíå‰∏Ä‰∏™ QueueingHintFnÔºåÂΩì‰∫ã‰ª∂ÂèëÁîüÊó∂ÊâßË°å QueueingHintFnÔºåÂπ∂Á°ÆÂÆö‰∫ã‰ª∂ÊòØÂê¶ÂèØ‰ª•ËÆ© PodÊª°Ë∂≥Ë∞ÉÂ∫¶„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">type ClusterEventWithHint struct &#123;</span><br><span class="line">Event ClusterEvent</span><br><span class="line"></span><br><span class="line">QueueingHintFn QueueingHintFn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type QueueingHintFn func(logger klog.Logger, pod *v1.Pod, oldObj, newObj interface&#123;&#125;) (QueueingHint, error)</span><br><span class="line"></span><br><span class="line">type QueueingHint int</span><br><span class="line"></span><br><span class="line">const (</span><br><span class="line">// QueueSkip implies that the cluster event has no impact on</span><br><span class="line">// scheduling of the pod.</span><br><span class="line">QueueSkip QueueingHint = iota</span><br><span class="line"></span><br><span class="line">// Queue implies that the Pod may be schedulable by the event.</span><br><span class="line">Queue</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>Á±ªÂûã QueueingHintFn ÊòØ‰∏Ä‰∏™ÂáΩÊï∞ÔºåÂÖ∂ËøîÂõûÁ±ªÂûã‰∏∫ (QueueingHint, error)„ÄÇÂÖ∂‰∏≠ÔºåQueueingHint ÊòØ‰∏Ä‰∏™Êûö‰∏æÁ±ªÂûãÔºåÂèØËÉΩÁöÑÂÄºÊúâ QueueSkip Âíå Queue„ÄÇQueueingHintFn Ë∞ÉÁî®Êó∂Êú∫‰Ωç‰∫éÂ∞Ü Pod ‰ªé unschedulableQ ÁßªÂä®Âà∞ backoffQ Êàñ activeQ ‰πãÂâçÔºåÂ¶ÇÊûúËøîÂõûÈîôËØØÔºåÂ∞ÜÊääË∞ÉÁî®ÊñπËøîÂõûÁöÑ QueueingHint Â§ÑÁêÜ‰∏∫ <code>QueueAfterBackoff</code>ÔºåËøôÁßçÂ§ÑÁêÜÊó†ËÆ∫ËøîÂõûÁöÑÁªìÊûúÊòØ‰ªÄ‰πàÔºåÈÉΩÂèØ‰ª•Èò≤Ê≠¢ Pod Ê∞∏ËøúÂæÖÂú®unschedulableQ ÈòüÂàó‰∏≠„ÄÇ</p><p><em><strong>‰ΩïÊó∂Ë∑≥Ëøá&#x2F;‰∏çË∑≥Ëøá backoff</strong></em></p><p>BackoffQ ÈÄöËøáÈò≤Ê≠¢‚ÄúÈïøÊúüÊó†Ê≥ïË∞ÉÂ∫¶‚ÄùÁöÑ Pod ÈòªÂ°ûÈòüÂàó‰ª•‰øùÊåÅÈ´òÂêûÂêêÈáèÁöÑËΩªÈáèÁ∫ßÈòüÂàó„ÄÇ</p><p>Pod Âú®Ë∞ÉÂ∫¶Âë®Êúü‰∏≠Ë¢´ÊãíÁªùÁöÑÊ¨°Êï∞Ë∂äÂ§öÔºåPod ÈúÄË¶ÅÁ≠âÂæÖÁöÑÊó∂Èó¥Â∞±Ë∂äÈïøÔºåÂç≥Âú®BackoffQ ÂæÖÂæóÊó∂Èó¥Â∞±Ë∂äÈïø„ÄÇ</p><p>‰æãÂ¶ÇÔºåÂΩì NodeAffinity ÊãíÁªù‰∫Ü PodÔºåÂêéÊù•Âú®ÂÖ∂ QueueingHintFn ‰∏≠ËøîÂõû Queue Êó∂ÔºåPod ÈúÄË¶ÅÁ≠âÂæÖ backoff ÂêéÊâçËÉΩÈáçËØïË∞ÉÂ∫¶„ÄÇ</p><p>‰ΩÜÊòØÔºåÊüê‰∫õÊèí‰ª∂ÁöÑËÆæËÆ°Êú¨Ë∫´Â∞±ÈúÄË¶ÅÂú®Ë∞ÉÂ∫¶Âë®Êúü‰∏≠ÁªèÂéÜ‰∏Ä‰∫õÂ§±Ë¥•„ÄÇÊØîÂ¶ÇÂÜÖÁΩÆÊèí‰ª∂DRAÔºàÂä®ÊÄÅËµÑÊ∫êÂàÜÈÖçÔºâÔºåÂú® Reserve extensionÂ§ÑÔºåÂÆÉÂëäËØâËµÑÊ∫êÈ©±Âä®Á®ãÂ∫èË∞ÉÂ∫¶ÁªìÊûúÔºåÂπ∂ÊãíÁªù Pod ‰∏ÄÊ¨°‰ª•Á≠âÂæÖËµÑÊ∫êÈ©±Âä®Á®ãÂ∫èÁöÑÂìçÂ∫î„ÄÇÈíàÂØπËøôÁßçÊãíÁªùÊÉÖÂÜµÔºå‰∏çËÉΩÂ∞ÜÂÖ∂ËßÜ‰ΩúË∞ÉÂ∫¶Âë®ÊúüÁöÑÊµ™Ë¥πÔºåÂ∞ΩÁÆ°ÁâπÂÆöË∞ÉÂ∫¶Âë®ÊúüÂ§±Ë¥•‰∫ÜÔºå‰ΩÜÂü∫‰∫éËØ•Âë®ÊúüÁöÑË∞ÉÂ∫¶ÁªìÊûúÂèØ‰ª•‰øÉËøõ Pod ÁöÑË∞ÉÂ∫¶„ÄÇÂõ†Ê≠§ÔºåÁî±‰∫éËøôÁßçÂéüÂõ†Ë¢´ÊãíÁªùÁöÑ Pod ‰∏çÈúÄË¶ÅÂèóÂà∞ÊÉ©ÁΩöÔºàbackoffÔºâ„ÄÇ</p><p>‰∏∫‰∫ÜÊîØÊåÅËøôÁßçÊÉÖÂÜµÔºåÊàë‰ª¨ÂºïÂÖ•‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑÁä∂ÊÄÅ Pending„ÄÇÂΩì DRA Êèí‰ª∂‰ΩøÁî® Pending ÊãíÁªù PodÔºåÂπ∂‰∏îÂêéÁª≠Âú®ÂÖ∂ QueueingHintFn ‰∏≠ËøîÂõû Queue Êó∂ÔºåPod Ë∑≥Ëøá backoffÔºåPod Ë¢´ÈáçÊñ∞Ë∞ÉÂ∫¶„ÄÇ</p><p><em><strong>QueueingHint Â¶Ç‰ΩïÂ∑•‰Ωú</strong></em></p><p>ÂΩìK8sÈõÜÁæ§‰∫ã‰ª∂ÂèëÁîüÊó∂ÔºåË∞ÉÂ∫¶ÈòüÂàóÂ∞ÜÊâßË°åÂú®‰πãÂâçË∞ÉÂ∫¶Âë®Êúü‰∏≠ÊãíÁªù Pod ÁöÑÈÇ£‰∫õÊèí‰ª∂ÁöÑ QueueingHintFn„ÄÇ</p><p>ÈÄöËøá‰∏ãËø∞Âá†‰∏™Âú∫ÊôØÔºåÊèèËø∞‰∏Ä‰∏ãÂÆÉ‰ª¨Â¶Ç‰ΩïË¢´ÊâßË°å‰ª•ÂèäÂ¶Ç‰ΩïÁßªÂä® Pod„ÄÇ</p><p>a. PodË¢´‰∏Ä‰∏™ÊàñÂ§ö‰∏™Êèí‰ª∂ÊãíÁªù</p><p>ÂÅáËÆæÊúâ‰∏â‰∏™ËäÇÁÇπ„ÄÇÂΩì Pod ËøõÂÖ•Ë∞ÉÂ∫¶Âë®ÊúüÊó∂Ôºå‰∏Ä‰∏™ËäÇÁÇπÁî±‰∫éËµÑÊ∫ê‰∏çË∂≥ÊãíÁªù‰∫ÜPodÔºåÂÖ∂‰ªñ‰∏§‰∏™ËäÇÂõ†‰∏∫Pod ÁöÑ NodeAffinity‰∏çÂåπÈÖçÊãíÁªù‰∫ÜPod„ÄÇ</p><p>Âú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåPod Ë¢´ NodeResourceFit Âíå NodeAffinity Êèí‰ª∂ÊãíÁªùÔºåÊúÄÁªàË¢´ÊîæÂà∞ unschedulableQ ‰∏≠„ÄÇ</p><p>Ê≠§ÂêéÔºåÊØèÂΩìÊ≥®ÂÜåÂú®Ëøô‰∫õÊèí‰ª∂‰∏≠ÁöÑÈõÜÁæ§‰∫ã‰ª∂ÂèëÁîüÊó∂ÔºåË∞ÉÂ∫¶ÈòüÂàóÈÄöËøá QueueingHint ÈÄöÁü•ÂÆÉ‰ª¨„ÄÇÂ¶ÇÊûúÊù•Ëá™ NodeResourceFit Êàñ NodeAffinity ÁöÑ‰ªª‰Ωï‰∏Ä‰∏™ÁöÑ QueueingHintFn ËøîÂõû QueueÔºåÂàôÂ∞Ü Pod ÁßªÂä®Âà∞ activeQÊàñËÄÖbackoffQ‰∏≠„ÄÇ Ôºà‰æãÂ¶ÇÔºåÂΩì NodeAdded ‰∫ã‰ª∂ÂèëÁîüÊó∂ÔºåNodeResourceFit ÁöÑ QueueingHint ËøîÂõû QueueÔºåÂõ†‰∏∫ Pod ÂèØËÉΩÂèØË∞ÉÂ∫¶Âà∞ËØ•Êñ∞ËäÇÁÇπ„ÄÇÔºâ</p><p>ÂÆÉÊòØÁßªÂä®Âà∞ activeQ ËøòÊòØ backoffQÔºåËøôÂèñÂÜ≥‰∫éÊ≠§ Pod Âú®unschedulableQ ‰∏≠ÂÅúÁïôÁöÑÊó∂Èó¥ÊúâÂ§öÈïø„ÄÇÂ¶ÇÊûúÂú®unschedulableQ ÂÅúÁïôÁöÑÊó∂Èó¥Ë∂ÖËøá‰∫ÜÈ¢ÑÊúüÁöÑ Pod ÁöÑ backoff Âª∂ËøüÊó∂Èó¥ÔºåÂàôÂÆÉÂ∞ÜÁõ¥Êé•ÁßªÂä®Âà∞ activeQ„ÄÇÂê¶ÂàôÔºåÂÆÉÂ∞ÜÁßªÂä®Âà∞ backoffQ„ÄÇ</p><p>b. PodÂõ† Pending Áä∂ÊÄÅËÄåË¢´ÊãíÁªù </p><p>ÂΩì DRA Êèí‰ª∂Âú® Reserve extension Èò∂ÊÆµÈíàÂØπPodËøîÂõû PendingÊó∂ÔºåË∞ÉÂ∫¶ÈòüÂàóÂ∞Ü DRA Êèí‰ª∂Ê∑ªÂä†Âà∞ Pod ÁöÑpendingPlugins Â≠óÂÖ∏‰∏≠ÁöÑÂêåÊó∂ÔºåPod ËøîÂõûË∞ÉÂ∫¶ÈòüÂàó„ÄÇ</p><p>ÂΩì DRA Êèí‰ª∂ÁöÑ QueueingHint ‰πãÂêéÁöÑË∞ÉÁî®‰∏≠ËøîÂõû Queue Êó∂ÔºåË∞ÉÂ∫¶ÈòüÂàóÂ∞ÜÊ≠§ Pod Áõ¥Êé•ÊîæÂÖ• activeQ„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// Reserve reserves claims for the pod.</span><br><span class="line">func (pl *dynamicResources) Reserve(ctx context.Context, cs *framework.CycleState, pod *v1.Pod, nodeName string) *framework.Status &#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">if numDelayedAllocationPending == 1 || numClaimsWithStatusInfo == numDelayedAllocationPending &#123;</span><br><span class="line">...</span><br><span class="line">schedulingCtx.Spec.SelectedNode = nodeName</span><br><span class="line">logger.V(5).Info(&quot;start allocation&quot;, &quot;pod&quot;, klog.KObj(pod), &quot;node&quot;, klog.ObjectRef&#123;Name: nodeName&#125;)</span><br><span class="line">...</span><br><span class="line">return statusUnschedulable(logger, &quot;waiting for resource driver to allocate resource&quot;, &quot;pod&quot;, klog.KObj(pod), &quot;node&quot;, klog.ObjectRef&#123;Name: nodeName&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">return statusUnschedulable(logger, &quot;waiting for resource driver to provide information&quot;, &quot;pod&quot;, klog.KObj(pod))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>c. Ë∑üË∏™Ë∞ÉÂ∫¶ÈòüÂàó‰∏≠Ê≠£Âú®Â§ÑÁêÜÁöÑ Pod</p><p>ÈÄöËøáÂºïÂÖ• QueueingHintÔºåÊàë‰ª¨Âè™ËÉΩÂú®ÁâπÂÆö‰∫ã‰ª∂ÂèëÁîüÊó∂ÈáçËØïË∞ÉÂ∫¶„ÄÇ‰ΩÜÊòØÔºåÂ¶ÇÊûúËøô‰∫õ‰∫ã‰ª∂ÂèëÁîüÂú®Pod ÁöÑË∞ÉÂ∫¶ÊúüÈó¥Âë¢Ôºü</p><p>Ë∞ÉÂ∫¶Âô®ÂØπÈõÜÁæ§Êï∞ÊçÆËøõË°åÂø´ÁÖßÔºåÂπ∂Ê†πÊçÆÂø´ÁÖßË∞ÉÂ∫¶ Pod„ÄÇÊØèÊ¨°ÂêØÂä®Ë∞ÉÂ∫¶Âë®ÊúüÊó∂ÈÉΩ‰ºöÊõ¥Êñ∞Âø´ÁÖßÔºåÊç¢Âè•ËØùËØ¥ÔºåÁõ∏ÂêåÁöÑÂø´ÁÖßÂú®Áõ∏ÂêåÁöÑË∞ÉÂ∫¶Âë®Êúü‰∏≠‰ΩøÁî®„ÄÇ</p><p>ËÄÉËôëÂà∞ËøôÊ†∑‰∏Ä‰∏™ÊÉÖÊôØÔºåÊØîÂ¶ÇÔºåÂú®Ë∞ÉÂ∫¶‰∏Ä‰∏™ Pod Êó∂ÔºåÁî±‰∫éÊ≤°Êúâ‰ªª‰ΩïËäÇÁÇπÁ¨¶Âêà Pod ÁöÑËäÇÁÇπ‰∫≤ÂíåÊÄß(NodeAffinity)ÔºåÂõ†Ê≠§Ë¢´ÊãíÁªùÔºå‰ΩÜÊòØÂú®Ë∞ÉÂ∫¶ËøáÁ®ã‰∏≠Âä†ÂÖ•‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑËäÇÁÇπÔºåÂÆÉ‰∏é Pod ÁöÑËäÇÁÇπ‰∫≤ÂíåÊÄßÂåπÈÖç„ÄÇ</p><p>Â¶ÇÂâçÊâÄËø∞ÔºåËøô‰∏™Êñ∞ËäÇÁÇπÂú®Êú¨Ê¨°Ë∞ÉÂ∫¶Âë®ÊúüÂÜÖ‰∏çË¢´ËßÜ‰∏∫ÂÄôÈÄâËäÇÁÇπÔºåÂõ†Ê≠§ Pod ‰ªçÁÑ∂Ë¢´ËäÇÁÇπ‰∫≤ÂíåÊÄßÊèí‰ª∂ÊãíÁªù„ÄÇÈóÆÈ¢òÂú®‰∫éÔºåÂ¶ÇÊûúË∞ÉÂ∫¶ÈòüÂàóÂ∞Ü Pod ÊîæÂÖ•unschedulableQ‰∏≠ÔºåÈÇ£‰πàÂç≥‰ΩøÂ∑≤ÁªèÊúâ‰∏Ä‰∏™ËäÇÁÇπÂåπÈÖç‰∫Ü Pod ÁöÑËäÇÁÇπ‰∫≤ÂíåÊÄßË¶ÅÊ±ÇÔºåËØ• Pod ‰ªçÈúÄË¶ÅÁ≠âÂæÖÂè¶‰∏Ä‰∏™‰∫ã‰ª∂„ÄÇ</p><p>‰∏∫‰∫ÜÈÅøÂÖçÁ±ª‰ººPod Âú®Ë∞ÉÂ∫¶ËøáÁ®ã‰∏≠ÈîôËøá‰∫ã‰ª∂ÁöÑÂú∫ÊôØÔºåË∞ÉÂ∫¶ÈòüÂàó‰ºöËÆ∞ÂΩï Pod Ë∞ÉÂ∫¶ÊúüÈó¥ÂèëÁîüÁöÑ‰∫ã‰ª∂ÔºåÂπ∂Ê†πÊçÆËøô‰∫õ‰∫ã‰ª∂ÂíåQueueingHintÊù•ÂÜ≥ÂÆöPod ÂÖ•ÈòüÁöÑ‰ΩçÁΩÆ„ÄÇ</p><p>Âõ†Ê≠§ÔºåË∞ÉÂ∫¶ÈòüÂàó‰ºöÁºìÂ≠òËá™ Pod Á¶ªÂºÄË∞ÉÂ∫¶ÈòüÂàóÁõ¥Âà∞ Pod ËøîÂõûË∞ÉÂ∫¶ÈòüÂàóÊàñË¢´Ë∞ÉÂ∫¶ÁöÑÊâÄÊúâ‰∫ã‰ª∂„ÄÇÂΩì‰∏çÂÜçÈúÄË¶ÅÁºìÂ≠òÁöÑ‰∫ã‰ª∂Êó∂ÔºåÁºìÂ≠òÁöÑ‰∫ã‰ª∂Â∞ÜË¢´‰∏¢ÂºÉ„ÄÇ</p><h3 id="GolangÂèåÂêëÈìæË°®"><a href="#GolangÂèåÂêëÈìæË°®" class="headerlink" title="GolangÂèåÂêëÈìæË°®"></a>GolangÂèåÂêëÈìæË°®</h3><p><code>*list.List</code> ÊòØ Go ËØ≠Ë®ÄÊ†áÂáÜÂ∫ì <code>container/list</code> ÂåÖ‰∏≠ÁöÑ‰∏ÄÁßçÊï∞ÊçÆÁªìÊûÑÔºåË°®Á§∫‰∏Ä‰∏™ÂèåÂêëÈìæË°®„ÄÇÂú® Go ‰∏≠ÔºåÂèåÂêëÈìæË°®ÊòØ‰∏ÄÁßçÂ∏∏ËßÅÁöÑÊï∞ÊçÆÁªìÊûÑÔºåÁî®‰∫éÂú®ÂÖÉÁ¥†ÁöÑÊèíÂÖ•„ÄÅÂà†Èô§ÂíåÈÅçÂéÜÁ≠âÊìç‰Ωú‰∏äÊèê‰æõÈ´òÊïàÊÄßËÉΩ„ÄÇ</p><p>‰ª•‰∏ãÊòØ <code>*list.List</code> ÁªìÊûÑÁöÑÁÆÄË¶Å‰ªãÁªçÔºö</p><ul><li><strong>ÂÆö‰πâ</strong>Ôºö<code>*list.List</code> ÊòØ‰∏Ä‰∏™ÊåáÂêëÂèåÂêëÈìæË°®ÁöÑÊåáÈíàÔºåÂÆÉÂåÖÂê´‰∫ÜÈìæË°®ÁöÑÂ§¥ÈÉ®ÂíåÂ∞æÈÉ®ÊåáÈíàÔºå‰ª•ÂèäÈìæË°®ÁöÑÈïøÂ∫¶‰ø°ÊÅØ„ÄÇ</li><li><strong>ÁâπÊÄß</strong>ÔºöÂèåÂêëÈìæË°®‰∏≠ÁöÑÊØè‰∏™ËäÇÁÇπÈÉΩÂåÖÂê´ÊåáÂêëÂâç‰∏Ä‰∏™ËäÇÁÇπÂíåÂêé‰∏Ä‰∏™ËäÇÁÇπÁöÑÊåáÈíàÔºåËøô‰ΩøÂæóÂú®ÈìæË°®‰∏≠ÊèíÂÖ•ÂíåÂà†Èô§ÂÖÉÁ¥†ÁöÑÊìç‰ΩúÊïàÁéáÂæàÈ´ò„ÄÇ</li><li><strong>Áî®ÈÄî</strong>Ôºö<code>*list.List</code> Â∏∏Áî®‰∫éÈúÄË¶ÅÈ¢ëÁπÅÊèíÂÖ•ÂíåÂà†Èô§Êìç‰ΩúÁöÑÂú∫ÊôØÔºåÂ∞§ÂÖ∂ÊòØÂΩìÂÖÉÁ¥†ÁöÑÊï∞Èáè‰∏çÂõ∫ÂÆöÊàñÈ°∫Â∫èÂèØËÉΩÁªèÂ∏∏ÂèòÂåñÊó∂„ÄÇ</li></ul><p>ÊºîÁ§∫‰∫ÜÂ¶Ç‰ΩïÂú® Go ‰∏≠‰ΩøÁî® <code>*list.List</code>Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;container/list&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">    // ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÂèåÂêëÈìæË°®</span><br><span class="line">    l := list.New()</span><br><span class="line"></span><br><span class="line">    // Âú®ÈìæË°®Â∞æÈÉ®Ê∑ªÂä†ÂÖÉÁ¥†</span><br><span class="line">    l.PushBack(1)</span><br><span class="line">    l.PushBack(2)</span><br><span class="line">    l.PushBack(3)</span><br><span class="line"></span><br><span class="line">    // ÈÅçÂéÜÈìæË°®Âπ∂ÊâìÂç∞ÂÖÉÁ¥†</span><br><span class="line">    for e := l.Front(); e != nil; e = e.Next() &#123;</span><br><span class="line">        fmt.Println(e.Value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>PushBack</code> ÊñπÊ≥ï‰ºöÂêëÈìæË°®ÁöÑÂ∞æÈÉ®Ê∑ªÂä†‰∏Ä‰∏™Êñ∞ÂÖÉÁ¥†ÔºåÂπ∂ËøîÂõûË°®Á§∫Êñ∞ÂÖÉÁ¥†ÁöÑ <code>*list.Element</code> ÊåáÈíà„ÄÇËøô‰∏™ÊåáÈíàÂèØ‰ª•Áî®‰∫éÂêéÁª≠ÂØπËØ•ÂÖÉÁ¥†ÁöÑÊìç‰ΩúÔºå‰æãÂ¶ÇÂà†Èô§Êàñ‰øÆÊîπ„ÄÇ</p><p><code>*list.Element</code> ÁªìÊûÑ‰ΩìÂåÖÂê´‰∫ÜÊåáÂêëÈìæË°®‰∏≠Ââç‰∏Ä‰∏™ÂíåÂêé‰∏Ä‰∏™ÂÖÉÁ¥†ÁöÑÊåáÈíàÔºå‰ª•Âèä‰∏Ä‰∏™Â≠òÂÇ®ÂÖÉÁ¥†ÂÄºÁöÑÂ≠óÊÆµ„ÄÇÈÄöËøáËøîÂõû <code>*list.Element</code> ÊåáÈíàÔºåÊàë‰ª¨ÂèØ‰ª•Êñπ‰æøÂú∞Âú®ÈúÄË¶ÅÊó∂ËÆøÈóÆÂà∞Êñ∞Ê∑ªÂä†ÁöÑÂÖÉÁ¥†Ôºå‰ª•‰æøËøõË°åËøõ‰∏ÄÊ≠•ÁöÑÊìç‰Ωú„ÄÇË¶Å‰ªéÂèåÂêëÈìæË°®‰∏≠Âà†Èô§ÂÖÉÁ¥†Ôºå‰Ω†ÂèØ‰ª•‰ΩøÁî®<code>list.Remove()</code>ÊñπÊ≥ï„ÄÇËøô‰∏™ÊñπÊ≥ïÈúÄË¶Å‰º†ÂÖ•‰∏Ä‰∏™ÈìæË°®ÂÖÉÁ¥†ÔºåÁÑ∂Âêé‰ºöÂ∞ÜËØ•ÂÖÉÁ¥†‰ªéÈìæË°®‰∏≠ÁßªÈô§„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">&quot;container/list&quot;</span><br><span class="line">&quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">// ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÂèåÂêëÈìæË°®</span><br><span class="line">myList := list.New()</span><br><span class="line"></span><br><span class="line">// Âú®ÈìæË°®Â∞æÈÉ®Ê∑ªÂä†ÂÖÉÁ¥†</span><br><span class="line">myList.PushBack(1)</span><br><span class="line">myList.PushBack(2)</span><br><span class="line">myList.PushBack(3)</span><br><span class="line"></span><br><span class="line">// ÊâæÂà∞Ë¶ÅÂà†Èô§ÁöÑÂÖÉÁ¥†</span><br><span class="line">elementToRemove := myList.Front().Next()</span><br><span class="line"></span><br><span class="line">// ‰ªéÈìæË°®‰∏≠ÁßªÈô§ËØ•ÂÖÉÁ¥†</span><br><span class="line">myList.Remove(elementToRemove)</span><br><span class="line"></span><br><span class="line">// ÊâìÂç∞Ââ©‰ΩôÁöÑÂÖÉÁ¥†</span><br><span class="line">for element := myList.Front(); element != nil; element = element.Next() &#123;</span><br><span class="line">fmt.Println(element.Value)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ËøôÊÆµ‰ª£Á†Å‰ºöËæìÂá∫Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">3</span><br></pre></td></tr></table></figure><p>Âú®Ëøô‰∏™‰æãÂ≠ê‰∏≠ÔºåÊàë‰ª¨ÁßªÈô§‰∫ÜÈìæË°®‰∏≠Á¨¨‰∫å‰∏™ÂÖÉÁ¥†ÔºàÂÄº‰∏∫2Ôºâ„ÄÇ</p><h2 id="ÊµÖÊûê‰∏ÄÁï™"><a href="#ÊµÖÊûê‰∏ÄÁï™" class="headerlink" title="ÊµÖÊûê‰∏ÄÁï™"></a>ÊµÖÊûê‰∏ÄÁï™</h2><p>Áõ¥Êé•‰∏äpprofÊù•ÂàÜÊûê‰∏Ä‰∏ãÂÜÖÂ≠ò‰ΩøÁî®ÊÉÖÂÜµ,ÈÉ®ÂàÜpprofÂàóË°®ÔºåÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö</p><p><img src="https://pic.imgdb.cn/item/65dc98699f345e8d03f7c8e8.png" alt="K8s 1.28 scheduler OOM pprof"></p><p>ËøôÈáåÂèØ‰ª•ÂèëÁé∞ÔºåÂÜÖÂ≠ò‰∏ªË¶ÅÈõÜ‰∏≠Âú®protobufÁöÑDecodeÔºåÂú®‰∏çÂÖ∑‰ΩìÂàÜÊûêpprofÁöÑÂâçÊèê‰∏ãÔºåÊàë‰ª¨ÁöÑÊÄùË∑ØÊúâ‰∏âÁÇπÔºö</p><ul><li>grpc-goÊòØÂê¶ÊúâÂÜÖÂ≠òÈóÆÈ¢ò</li><li>goÊú¨Ë∫´ÊòØÂê¶ÈóÆÈ¢ò</li><li>K8sÂÜÖÂ≠òÈóÆÈ¢ò</li></ul><p>ÈíàÂØπÁ¨¨‰∏Ä‰∏™ÁöÑÂÅáËÆæÔºåÂèØ‰ª•Êçû‰∏Ä‰∏ãgrpc-goÁöÑÁõ∏ÂÖ≥issueÔºåÂèØ‰ª•ÂèëÁé∞ËøëÊúüÊú™ËßÅÁõ∏ÂÖ≥ÂÜÖÂ≠òÂºÇÂ∏∏ÁöÑÊä•ÂëäÔºågoÊú¨Ë∫´ÁöÑÈóÆÈ¢òÔºåÁúãËµ∑Êù•‰πü‰∏çÂ§™ÂÉèÔºå‰ΩÜÂÄíÊòØÊâæÂà∞‰∏Ä‰∏™THPÁöÑÁõ∏ÂÖ≥ÈóÆÈ¢òÔºå‰ª•ÂêéÂèØ‰ª•ÁÆÄÂçï‰ªãÁªç‰∏Ä‰∏ãÔºåÈÇ£‰πàÂè™Ââ©‰∏Ä‰∏™ÁªìÊûúÔºåÂ∞±ÊòØK8sÊú¨Ë∫´Â≠òÂú®ÈóÆÈ¢òÔºå‰ΩÜÂÖ∂‰∏≠<code>(*FieldsV1).Unmarshal</code>5Âπ¥Ê≤°Âä®‰∫ÜÔºåÂ§ßÊ¶ÇÁéá‰∏ç‰ºöÂ≠òÂú®ÈóÆÈ¢òÔºåÈÇ£‰πàÊàë‰ª¨Ê∑±ÂÖ•ÂàÜÊûê‰∏Ä‰∏ãpprofÂêß</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">k8s.io/apimachinery/pkg/apis/meta/v1.(*FieldsV1).Unmarshal</span><br><span class="line">vendor/k8s.io/apimachinery/pkg/apis/meta/v1/generated.pb.go</span><br><span class="line"></span><br><span class="line">  Total:      309611     309611 (flat, cum)  2.62%</span><br><span class="line">   6502            .          .           if postIndex &gt; l &#123; </span><br><span class="line">   6503            .          .           return io.ErrUnexpectedEOF </span><br><span class="line">   6504            .          .           &#125; </span><br><span class="line">   6505       309611     309611           m.Raw = append(m.Raw[:0], dAtA[iNdEx:postIndex]...) </span><br><span class="line">   6506            .          .           if m.Raw == nil &#123; </span><br><span class="line">   6507            .          .           m.Raw = []byte&#123;&#125; </span><br><span class="line">   6508            .          .           &#125; </span><br></pre></td></tr></table></figure><p>ËøáÊÆµÊó∂Èó¥Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">k8s.io/apimachinery/pkg/apis/meta/v1.(*FieldsV1).Unmarshal</span><br><span class="line">vendor/k8s.io/apimachinery/pkg/apis/meta/v1/generated.pb.go</span><br><span class="line"></span><br><span class="line">  Total:     2069705    2069705 (flat, cum)  2.49%</span><br><span class="line">   6502            .          .           if postIndex &gt; l &#123; </span><br><span class="line">   6503            .          .           return io.ErrUnexpectedEOF </span><br><span class="line">   6504            .          .           &#125; </span><br><span class="line">   6505      2069705    2069705           m.Raw = append(m.Raw[:0], dAtA[iNdEx:postIndex]...) </span><br><span class="line">   6506            .          .           if m.Raw == nil &#123; </span><br><span class="line">   6507            .          .           m.Raw = []byte&#123;&#125; </span><br><span class="line">   6508            .          .           &#125; </span><br></pre></td></tr></table></figure><p>Âú®ÊåÅÁª≠Â¢ûÈïøÁöÑ Pod ÂàóË°®‰∏≠ÔºåÂèëÁé∞‰∫Ü‰∏Ä‰∫õÊú™ÈáäÊîæÁöÑÊï∞ÊçÆ‰ºº‰πé‰∏éÂÖàÂâç‰ΩøÁî® pprof ÂàÜÊûêÁöÑÁªìÊûúÂêªÂêàÔºå‰ªÖÂèëÁé∞ Pod ÊòØÊåÅÁª≠ÂèòÊõ¥ÁöÑÂØπË±°„ÄÇÂõ†Ê≠§ÔºåÊàëÂ∞ùËØï‰∫ÜÂè¶‰∏ÄÁßçÊéíÊü•ÊñπÊ≥ïÔºåÈ™åËØÅÁ§æÂå∫ÊòØÂê¶Â∑≤Ëß£ÂÜ≥Ê≠§ÈóÆÈ¢ò„ÄÇÊàë‰ΩøÁî® minikube Âú®Êú¨Âú∞ÂêØÂä®‰∫Ü Kubernetes 1.18.5 ÁâàÊú¨ËøõË°åÊéíÊü•„ÄÇÂπ∏ËøêÁöÑÊòØÔºåÊàëÊú™ËÉΩÂ§çÁé∞Ëøô‰∏ÄÁé∞Ë±°ÔºåË°®ÊòéÈóÆÈ¢òÂèØËÉΩÂú® 1.18.5 ÁâàÊú¨ÂêéÂ∑≤‰øÆÂ§ç„ÄÇ</p><p>‰∏∫‰∫ÜËøõ‰∏ÄÊ≠•Áº©Â∞èÊéíÊü•ËåÉÂõ¥ÔºåÊàëËÆ©Âêå‰∫ãÊ£ÄÊü•‰∫ÜËøô‰∏â‰∏™Â∞èÁâàÊú¨‰πãÈó¥ÁöÑÊèê‰∫§ËÆ∞ÂΩï„ÄÇÊúÄÁªàÂèëÁé∞‰∫Ü‰∏Ä‰∏™ÂÖ≥Èó≠‰∫Ü SchedulerQueueingHints ÁâπÊÄßÁöÑ PR„ÄÇÊ≠£Â¶ÇÂú®ÊäÄÊúØËÉåÊôØ‰∏≠ÊèêÂà∞ÁöÑÔºåSchedulerQueueingHints ÁâπÊÄßÂèØËÉΩÂØºËá¥ÂÜÖÂ≠òÂ¢ûÈïøÈóÆÈ¢ò„ÄÇ</p><p>ÈÄöËøáPriorityQueueÁªìÊûÑ‰ΩìÂèØ‰ª•ÂèëÁé∞ÂÖ∂ÈÄöËøáisSchedulingQueueHintEnabledÊù•ÊéßÂà∂ÁâπÊÄßÁöÑÈÄªËæëÂ§ÑÁêÜÔºåÂ¶ÇÊûúÂºÄÂêØ‰∫Ü<code>QueueingHint</code> ÁâπÊÄßÔºåÈÇ£‰πàÂú®ÊâßË°åPopÊñπÊ≥ïÊù•Ë∞ÉÂ∫¶PodÊó∂ÔºåÈúÄË¶Å‰∏∫inFlightPodsÂØπÂ∫îpodÁöÑUIDÂ°´ÂÖÖÁõ∏ÂêåinFlightEventsÁöÑÈìæË°®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">func (p *PriorityQueue) Pop(logger klog.Logger) (*framework.QueuedPodInfo, error) &#123;</span><br><span class="line">p.lock.Lock()</span><br><span class="line">defer p.lock.Unlock()</span><br><span class="line"></span><br><span class="line">obj, err := p.activeQ.Pop()</span><br><span class="line">...</span><br><span class="line">// In flight, no concurrent events yet.</span><br><span class="line">if p.isSchedulingQueueHintEnabled &#123;</span><br><span class="line">p.inFlightPods[pInfo.Pod.UID] = p.inFlightEvents.PushBack(pInfo.Pod)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">return pInfo, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÈÇ£‰πàÈìæË°®Â≠óÊÆµ‰ΩïÊó∂ÁßªÈô§ÔºüÊàë‰ª¨ÂèØ‰ª•ËßÇÂØüÂà∞ÁßªÈô§ÁöÑÂîØ‰∏ÄÊó∂Èó¥ÁÇπÂú®podÂÆåÊàêË∞ÉÂ∫¶Âë®ÊúüÊó∂Ôºå‰πüÂ∞±ÊòØË∞ÉÁî®DoneÊñπÊ≥ïÊó∂</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">func (p *PriorityQueue) Done(pod types.UID) &#123;</span><br><span class="line">p.lock.Lock()</span><br><span class="line">defer p.lock.Unlock()</span><br><span class="line"></span><br><span class="line">p.done(pod)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (p *PriorityQueue) done(pod types.UID) &#123;</span><br><span class="line">if !p.isSchedulingQueueHintEnabled &#123;</span><br><span class="line">// do nothing if schedulingQueueHint is disabled.</span><br><span class="line">// In that case, we don&#x27;t have inFlightPods and inFlightEvents.</span><br><span class="line">return</span><br><span class="line">&#125;</span><br><span class="line">inFlightPod, ok := p.inFlightPods[pod]</span><br><span class="line">if !ok &#123;</span><br><span class="line">// This Pod is already done()ed.</span><br><span class="line">return</span><br><span class="line">&#125;</span><br><span class="line">delete(p.inFlightPods, pod)</span><br><span class="line"></span><br><span class="line">// Remove the pod from the list.</span><br><span class="line">p.inFlightEvents.Remove(inFlightPod)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for &#123;</span><br><span class="line">...</span><br><span class="line">p.inFlightEvents.Remove(e)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáåÂèØ‰ª•ÂèëÁé∞Â¶Ç‰ΩïdoneÁöÑÊó∂Êú∫Ë∂äÊôöÔºåÂÜÖÂ≠òÁöÑÂ¢ûÈïøÂ∞ÜË∂äÊòéÊòæÔºåÂπ∂‰∏îÂ¶ÇÊûúPodÁöÑ‰∫ã‰ª∂Ë¢´ÂøΩËßÜÊàñËÄÖÈÅóÊºèÔºåÈìæË°®ÁöÑÂÜÖÂ≠òÂêåÊ†∑‰ºöÂá∫Áé∞ÂºÇÂ∏∏Â¢ûÂä†ÁöÑÁé∞Ë±°ÔºåÂèØ‰ª•ÁúãÂà∞ÈíàÂØπ‰∏äËø∞Âú∫ÊôØÁöÑ‰∏Ä‰∫õ‰øÆÂ§çÔºö</p><ul><li>Âá∫Áé∞‰∫Ücall Done() as soon as possibleËøôÊ†∑ÁöÑPRÔºåÂèÇÁúãPR#120586</li><li>NodeAffinity&#x2F;NodeUnschedulableÊèí‰ª∂ÁöÑQueueingHint ÈÅóÊºèÁõ∏ÂÖ≥Node‰∫ã‰ª∂ÔºåÂèÇÁúãPR#122284</li></ul><h2 id="ÂºïÁî®"><a href="#ÂºïÁî®" class="headerlink" title="ÂºïÁî®"></a>ÂºïÁî®</h2><ol><li><a href="https://github.com/kubernetes/kubernetes/issues/122725">https://github.com/kubernetes/kubernetes/issues/122725</a></li><li><a href="https://github.com/kubernetes/kubernetes/issues/122284">https://github.com/kubernetes/kubernetes/issues/122284</a></li><li><a href="https://github.com/kubernetes/kubernetes/pull/122289">https://github.com/kubernetes/kubernetes/pull/122289</a></li><li><a href="https://github.com/kubernetes/kubernetes/issues/118893">https://github.com/kubernetes/kubernetes/issues/118893</a></li><li><a href="https://github.com/kubernetes/enhancements/blob/cf6ee34e37f00d838872d368ec66d7a0b40ee4e6/keps/sig-scheduling/4247-queueinghint/README.md?plain=1#L579">https://github.com/kubernetes/enhancements/blob/cf6ee34e37f00d838872d368ec66d7a0b40ee4e6/keps/sig-scheduling/4247-queueinghint/README.md?plain=1#L579</a></li><li><a href="https://github.com/kubernetes/kubernetes/issues/122661">https://github.com/kubernetes/kubernetes/issues/122661</a></li><li><a href="https://github.com/kubernetes/kubernetes/pull/120586">https://github.com/kubernetes/kubernetes/pull/120586</a></li><li><a href="https://github.com/kubernetes/kubernetes/issues/118059">https://github.com/kubernetes/kubernetes/issues/118059</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ÈóÆÈ¢òÊèèËø∞&quot;&gt;&lt;a href=&quot;#ÈóÆÈ¢òÊèèËø∞&quot; class=&quot;headerlink&quot; title=&quot;ÈóÆÈ¢òÊèèËø∞&quot;&gt;&lt;/a&gt;ÈóÆÈ¢òÊèèËø∞&lt;/h2&gt;&lt;p&gt;Âπ¥ÂâçÔºåÂêå‰∫ãÂçáÁ∫ßK8sË∞ÉÂ∫¶Âô®Ëá≥1.28.3ÔºåËßÇÂØüÂà∞ÂÜÖÂ≠òÂºÇÂ∏∏Áé∞Ë±°ÔºåÂ∏ÆÂøô‰∏ÄËµ∑ÁúãÁúãÔºåÂú®ÈõÜÁæ§podÂèänodeÈöè‰∏öÂä°ÊΩÆÊ±êÂèòÂä®ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂÜÖ</summary>
      
    
    
    
    <category term="‰∫ëÂéüÁîüÈù¢ËØïÊ°à‰æã50ÁØá" scheme="https://zoues.com/categories/%E4%BA%91%E5%8E%9F%E7%94%9F%E9%9D%A2%E8%AF%95%E6%A1%88%E4%BE%8B50%E7%AF%87/"/>
    
    
    <category term="cloudnative" scheme="https://zoues.com/tags/cloudnative/"/>
    
    <category term="kubernetes" scheme="https://zoues.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>Êè≠ÂºÄK8sÈÄÇÈÖçCgroupV2ÂÜÖÂ≠òËôöÈ´òÁöÑËø∑Â±Ä</title>
    <link href="https://zoues.com/posts/3f237e52/"/>
    <id>https://zoues.com/posts/3f237e52/</id>
    <published>2024-01-27T12:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.376Z</updated>
    
    <content type="html"><![CDATA[<p>Âú®AlmalinuxÊõøÊç¢CentOSÁöÑËøáÁ®ã‰∏≠ÔºåÊàë‰ª¨ÈÄöËøákubectl top nodesÂëΩ‰ª§ËßÇÂØüÂà∞‰∫Ü‰∏§‰∏™Áõ∏ÂêåËßÑÊ†ºÁöÑËäÇÁÇπÔºàÂè™ÊúâcgroupÁâàÊú¨‰∏çÂêåÔºâ„ÄÇÂú®ÂàÜÂà´Ë∞ÉÂ∫¶‰∏§‰∏™Áõ∏ÂêåÁöÑPodÂêéÔºåÊàë‰ª¨È¢ÑÊúüÂÆÉ‰ª¨ÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÈáèÂ∫îËØ•Áõ∏Ëøë„ÄÇÁÑ∂ËÄåÔºåÊàë‰ª¨ÂèëÁé∞‰ΩøÁî®‰∫Ücgroupv2ÁöÑËäÇÁÇπÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÈáèÊØî‰ΩøÁî®‰∫Ücgroupv1ÁöÑËäÇÁÇπÂ§ö‰∫ÜÁ∫¶280Mi„ÄÇ</p><p>ÂàùÊ≠•ÂàÜÊûêË°®ÊòéÔºåÂèØËÉΩÊòØcAdvisorÂú®ÁªüËÆ°cgroupv1Âíåv2ÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÈáèÊó∂Â≠òÂú®ÈÄªËæë‰∏äÁöÑ‰∏ç‰∏ÄËá¥„ÄÇ</p><p>ÁêÜËÆ∫‰∏äÔºåÊó†ËÆ∫‰ΩøÁî®cgroupv1ËøòÊòØcgroupv2Ôºå‰∏§‰∏™Áõ∏ÂêåÈÖçÁΩÆÁöÑËäÇÁÇπÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÈáèÂ∫îËØ•Áõ∏Ëøë„ÄÇÂÆûÈôÖ‰∏äÔºåÂú®ÊØîËæÉ&#x2F;proc&#x2F;meminfoÊó∂ÔºåÊàë‰ª¨ÂèëÁé∞‰∫ÜÊÄªÂÜÖÂ≠ò‰ΩøÁî®ÈáèËøë‰ººÁöÑÊÉÖÂÜµ„ÄÇÈÇ£‰πàÈóÆÈ¢òÂá∫Âú®Âì™ÈáåÂë¢Ôºü</p><p>Êàë‰ª¨ÂèëÁé∞ÔºåËøô‰∏™ÈóÆÈ¢òÂè™ÂΩ±Âìç‰∫ÜËäÇÁÇπÁ∫ßÂà´ÁöÑÂÜÖÂ≠òÁªüËÆ°Êï∞ÊçÆÔºåËÄå‰∏çÂΩ±ÂìçPodÁ∫ßÂà´ÁöÑÁªüËÆ°Êï∞ÊçÆ„ÄÇ</p><p>ÈóÆÈ¢òÁöÑÊ†πÊú¨ÂéüÂõ†ÊòØcAdvisorË∞ÉÁî®‰∫ÜruncÁöÑÊé•Âè£ÔºåÂÖ∂ËÆ°ÁÆóroot cgroupÁöÑÂÜÖÂ≠òÊï∞ÊçÆÊñπÈù¢Â≠òÂú®Â∑ÆÂºÇ„ÄÇÂú®cgroupv2‰∏≠Ôºåroot cgroup‰∏çÂ≠òÂú®memory.currentËøô‰∏™Êñá‰ª∂Ôºå‰ΩÜÂú®cgroupv1‰∏≠root cgroupÊòØÂ≠òÂú®memory.usage_in_bytesÊñá‰ª∂ÁöÑ„ÄÇËøôÂØºËá¥‰∫ÜÂú®ÁªüËÆ°cgroupv2ÂÜÖÂ≠ò‰ΩøÁî®ÈáèÊó∂Âá∫Áé∞‰∫Ü‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµ„ÄÇ</p><p>Ëøô‰∏™ÈóÆÈ¢òÂèØËÉΩÈúÄË¶ÅÂú®cAdvisorÊàñruncÁöÑÈÄªËæë‰∏≠ËøõË°å‰øÆÂ§çÔºå‰ª•Á°Æ‰øùÂú®cgroupv1Âíåcgroupv2‰∏≠ÁöÑÂÜÖÂ≠òÁªüËÆ°‰∏ÄËá¥ÊÄß„ÄÇ‰∏ãÈù¢Êàë‰ª¨Âü∫‰∫éÁ§æÂå∫issueÂ±ïÂºÄ‰ªãÁªç„ÄÇ</p><p>v1.28.3 commit:a8a1abc25cad87333840cd7d54be2efaf31a3177</p><blockquote><p>NOTE: Containerd:1.6.21ÔºåK8s:1.28, Kernel:5.15.0<br>(ÂêåÊ≠•‰ª•ÂâçÁöÑÊñáÁ´†)</p></blockquote><hr><h2 id="ÊäÄÊúØËÉåÊôØ"><a href="#ÊäÄÊúØËÉåÊôØ" class="headerlink" title="ÊäÄÊúØËÉåÊôØ"></a>ÊäÄÊúØËÉåÊôØ</h2><p>Âú®Kubernetes‰∏≠ÔºåGoogleÁöÑcAdvisorÈ°πÁõÆË¢´Áî®‰∫éËäÇÁÇπ‰∏äÂÆπÂô®ËµÑÊ∫êÂíåÊÄßËÉΩÊåáÊ†áÁöÑÊî∂ÈõÜ„ÄÇÂú®kubelet server‰∏≠ÔºåcAdvisorË¢´ÈõÜÊàêÁî®‰∫éÁõëÊéßËØ•ËäÇÁÇπ‰∏äkubepodsÔºàÈªòËÆ§cgroupÂêçÁß∞ÔºåsystemdÊ®°Âºè‰∏ã‰ºöÂä†‰∏ä.sliceÂêéÁºÄÔºâ cgroup‰∏ãÁöÑÊâÄÊúâÂÆπÂô®„ÄÇ‰ªé1.29.0-alpha.2ÁâàÊú¨‰∏≠ÂèØ‰ª•ÁúãÂà∞ÔºåkubeletÁõÆÂâçËøòÊòØÊèê‰æõ‰∫Ü‰ª•‰∏ã‰∏§ÁßçÈÖçÁΩÆÈÄâÈ°πÔºà‰ΩÜÊòØÁé∞Âú®useLegacyCadvisorStats‰∏∫falseÔºâÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">if kubeDeps.useLegacyCadvisorStats &#123;</span><br><span class="line">klet.StatsProvider = stats.NewCadvisorStatsProvider(</span><br><span class="line">klet.cadvisor,</span><br><span class="line">klet.resourceAnalyzer,</span><br><span class="line">klet.podManager,</span><br><span class="line">klet.runtimeCache,</span><br><span class="line">klet.containerRuntime,</span><br><span class="line">klet.statusManager,</span><br><span class="line">hostStatsProvider)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">klet.StatsProvider = stats.NewCRIStatsProvider(</span><br><span class="line">klet.cadvisor,</span><br><span class="line">klet.resourceAnalyzer,</span><br><span class="line">klet.podManager,</span><br><span class="line">klet.runtimeCache,</span><br><span class="line">kubeDeps.RemoteRuntimeService,</span><br><span class="line">kubeDeps.RemoteImageService,</span><br><span class="line">hostStatsProvider,</span><br><span class="line">utilfeature.DefaultFeatureGate.Enabled(features.PodAndContainerStatsFromCRI))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>kubelet‰ª•PrometheusÊåáÊ†áÊ†ºÂºèÂú®<code>/stats/</code>Êö¥Èú≤ÊâÄÊúâÁõ∏ÂÖ≥ËøêË°åÊó∂ÊåáÊ†áÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫ÔºåKubeletÂÜÖÁΩÆ‰∫ÜcadvisorÊúçÂä°</p><p>ÂõæÁâá</p><p>‰ªé Kubernetes 1.12 ÁâàÊú¨ÂºÄÂßãÔºåkubelet Áõ¥Êé•‰ªé cAdvisor Êö¥Èú≤‰∫ÜÂ§ö‰∏™Êé•Âè£„ÄÇÂåÖÊã¨‰ª•‰∏ãÊé•Âè£Ôºö</p><ul><li>cAdvisor ÁöÑ Prometheus ÊåáÊ†á‰Ωç‰∫é <code>/metrics/cadvisor</code>„ÄÇ</li><li>cAdvisor v1 Json API ‰Ωç‰∫é <code>/stats/</code>„ÄÅ<code>/stats/container</code>„ÄÅ<code>/stats/&#123;podName&#125;/&#123;containerName&#125;</code> Âíå <code>/stats/&#123;namespace&#125;/&#123;podName&#125;/&#123;uid&#125;/&#123;containerName&#125;</code>„ÄÇ</li><li>cAdvisor ÁöÑÊú∫Âô®‰ø°ÊÅØ‰Ωç‰∫é &#x2F;spec„ÄÇ</li></ul><p>Ê≠§Â§ñÔºåkubeletËøòÊö¥Èú≤‰∫Ü<code>summary API</code>ÔºåÂÖ∂‰∏≠cAdvisor ÊòØËØ•Êé•Âè£ÊåáÊ†áÊù•Ê∫ê‰πã‰∏Ä„ÄÇÂú®Á§æÂå∫ÁöÑÁõëÊéßÊû∂ÊûÑÊñáÊ°£‰∏≠ÊèèËø∞‰∫Ü‚ÄúÊ†∏ÂøÉ‚ÄùÊåáÊ†áÂíå‚ÄúÁõëÊéß‚ÄùÊåáÊ†áÁöÑÂÆö‰πâ„ÄÇËøô‰∏™ÊñáÊ°£‰∏≠ËßÑÂÆö‰∫Ü‰∏ÄÁªÑÊ†∏ÂøÉÊåáÊ†áÂèäÂÖ∂Áî®ÈÄîÔºåÂπ∂‰∏îÁõÆÊ†áÊòØÈÄöËøáÊãÜÂàÜÁõëÊéßÊû∂ÊûÑÊù•ÂÆûÁé∞‰ª•‰∏ã‰∏§‰∏™ÁõÆÊ†áÔºö</p><ul><li><p>ÂáèÂ∞èÊ†∏ÂøÉÊåáÊ†áÁöÑÁªüËÆ°Êî∂ÈõÜÊÄßËÉΩÂΩ±ÂìçÔºåÂÖÅËÆ∏Êõ¥È¢ëÁπÅÂú∞Êî∂ÈõÜËøô‰∫õÊåáÊ†á„ÄÇ</p></li><li><p>‰ΩøÁõëÊéßÊñπÊ°àÂèØÊõø‰ª£‰∏îÂèØÊâ©Â±ï„ÄÇ</p></li></ul><p>Âõ†Ê≠§ÁßªÈô§cadvisorÁöÑÊé•Âè£ÔºåÊàê‰∫Ü‰∏ÄÈ°πÈïøÊúüÁõÆÊ†áÔºåÁõÆÂâçËøõÂ∫¶Â¶Ç‰∏ã(ËøõÂ∫¶Áä∂ÊÄÅÁöÑÊ†áËÆ∞Áï•‰∏∫ÊªûÂêé)Ôºö</p><ul><li><p>[1.13] ÂºïÂÖ• Kubelet ÁöÑ pod-resources gRPC Á´ØÁÇπÔºõKEP: ÊîØÊåÅËÆæÂ§áÁõëÊéßÁ§æÂå∫#2454</p></li><li><p>[1.14] ÂºïÂÖ• Kubelet ËµÑÊ∫êÊåáÊ†á API</p></li><li><p>[1.15] ÈÄöËøáÊ∑ªÂä†ÂíåÂºÉÁî® <code>--enable-cadvisor-json-endpoints</code> Ê†áÂøóÔºåÂ∫üÂºÉ‚ÄúÁõ¥Êé•‚Äù cAdvisor API Á´ØÁÇπ</p></li><li><p>[1.18] ÈªòËÆ§Â∞Ü ‚Äìenable-cadvisor-json-endpoints Ê†áÂøóËÆæÁΩÆ‰∏∫Á¶ÅÁî®</p></li><li><p>[1.21] ÁßªÈô§ <code>--enable-cadvisor-json-endpoints</code> Ê†áÂøó</p></li><li><p>[1.21] Â∞ÜÁõëÊéßÊúçÂä°Âô®ËøáÊ∏°Âà∞ Kubelet ËµÑÊ∫êÊåáÊ†á APIÔºàÈúÄË¶Å3‰∏™ÁâàÊú¨ÁöÑÂ∑ÆÂºÇÔºâ</p></li><li><p>[TBD] ‰∏∫ kubelet ÁõëÊéßÁ´ØÁÇπÊèêÂá∫Â§ñÈÉ®Êõø‰ª£ÊñπÊ°à</p></li><li><p>[TBD] ÈÄöËøáÊ∑ªÂä†ÂíåÂ∫üÂºÉ <code>--enable-container-monitoring-endpoints</code> Ê†áÂøóÔºåÂ∫üÂºÉÊëòË¶Å API Âíå cAdvisor Prometheus Á´ØÁÇπ</p></li><li><p>[TBD+2] ÁßªÈô§‚ÄúÁõ¥Êé•‚ÄùÁöÑ cAdvisor API Á´ØÁÇπ</p></li><li><p>[TBD+2] ÈªòËÆ§Â∞Ü ‚Äìenable-container-monitoring-endpoints Ê†áÂøóËÆæÁΩÆ‰∏∫Á¶ÅÁî®</p></li><li><p>[TBD+4] ÁßªÈô§ÊëòË¶Å API„ÄÅcAdvisor Prometheus ÊåáÊ†áÂíåÁßªÈô§ ‚Äìenable-container-monitoring-endpoints Ê†áÂøó„ÄÇ</p></li></ul><p>ÂΩìÂâçÁâàÊú¨ÁöÑcadvisorÊé•Âè£Â∑≤ÁªèÂÅö‰∫ÜÈÉ®ÂàÜÂ∫üÂºÉÔºå‰æãÂ¶Ç<code>/specÂèä/stats/*</code>Á≠â<br><a href="https://pic.imgdb.cn/item/65b43ba0871b83018ac66a1f.png"></a></p><h2 id="ÂØªÊ†πÊ∫ØÊ∫ê"><a href="#ÂØªÊ†πÊ∫ØÊ∫ê" class="headerlink" title="ÂØªÊ†πÊ∫ØÊ∫ê"></a>ÂØªÊ†πÊ∫ØÊ∫ê</h2><p>kubelet ‰ΩøÁî® cadvisor Êù•Ëé∑ÂèñËäÇÁÇπÁ∫ßÂà´ÁöÑÁªüËÆ°‰ø°ÊÅØÔºàÊó†ËÆ∫ÊòØ‰ΩøÁî® cri ËøòÊòØÈÄöËøácadvisor Êù•ÁªüËÆ°Êèê‰æõÁ®ãÂ∫èÊù•Ëé∑Âèñ pod ÁöÑÁªüËÆ°‰ø°ÊÅØÔºâÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">kubernetes/pkg/kubelet/stats/provider.go</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// NewCRIStatsProvider returns a Provider that provides the node stats</span><br><span class="line">// from cAdvisor and the container stats from CRI.</span><br><span class="line">func NewCRIStatsProvider(</span><br><span class="line">cadvisor cadvisor.Interface,</span><br><span class="line">resourceAnalyzer stats.ResourceAnalyzer,</span><br><span class="line">podManager PodManager,</span><br><span class="line">runtimeCache kubecontainer.RuntimeCache,</span><br><span class="line">runtimeService internalapi.RuntimeService,</span><br><span class="line">imageService internalapi.ImageManagerService,</span><br><span class="line">hostStatsProvider HostStatsProvider,</span><br><span class="line">podAndContainerStatsFromCRI bool,</span><br><span class="line">) *Provider &#123;</span><br><span class="line">return newStatsProvider(cadvisor, podManager, runtimeCache, newCRIStatsProvider(cadvisor, resourceAnalyzer,</span><br><span class="line">runtimeService, imageService, hostStatsProvider, podAndContainerStatsFromCRI))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// NewCadvisorStatsProvider returns a containerStatsProvider that provides both</span><br><span class="line">// the node and the container stats from cAdvisor.</span><br><span class="line">func NewCadvisorStatsProvider(</span><br><span class="line">cadvisor cadvisor.Interface,</span><br><span class="line">resourceAnalyzer stats.ResourceAnalyzer,</span><br><span class="line">podManager PodManager,</span><br><span class="line">runtimeCache kubecontainer.RuntimeCache,</span><br><span class="line">imageService kubecontainer.ImageService,</span><br><span class="line">statusProvider status.PodStatusProvider,</span><br><span class="line">hostStatsProvider HostStatsProvider,</span><br><span class="line">) *Provider &#123;</span><br><span class="line">return newStatsProvider(cadvisor, podManager, runtimeCache, newCadvisorStatsProvider(cadvisor, resourceAnalyzer, imageService, statusProvider, hostStatsProvider))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂèØ‰ª•ÈÄöËøá‰∏ãËø∞‰∏§ÁßçÊñπÂºèËé∑ÂèñËäÇÁÇπÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÊÉÖÂÜµ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl top node</span><br><span class="line">kubectl get --raw /api/v1/nodes/foo/proxy/stats/summary | jq -C .node.memory</span><br></pre></td></tr></table></figure><p>ÁªìÊûúÊòæÁ§∫cgroupv2ËäÇÁÇπÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÈáèÊØîÁõ∏ÂêåËäÇÁÇπÈÖçÁΩÆ‰ΩÜ‰ΩøÁî® cgroupv1ÁöÑÈ´ò‰∏Ä‰∫õ„ÄÇkubectl top node Ëé∑ÂèñËäÇÁÇπ‰ø°ÊÅØÁöÑÈÄªËæëÂú®Ôºö<a href="https://github.com/kubernetes-sigs/metrics-server/blob/master/pkg/storage/node.go#L40">https://github.com/kubernetes-sigs/metrics-server/blob/master/pkg/storage/node.go#L40</a></p><p>kubelet‰ΩøÁî® cadvisor Êù•Ëé∑Âèñ cgroup ÁªüËÆ°‰ø°ÊÅØÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubernetes/pkg/kubelet/server/stats/summary.go</span><br><span class="line"></span><br><span class="line">rootStats, err := sp.provider.GetCgroupCPUAndMemoryStats(&quot;/&quot;, false)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return nil, fmt.Errorf(&quot;failed to get root cgroup stats: %v&quot;, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáåGetCgroupCPUAndMemoryStatsË∞ÉÁî®‰ª•‰∏ãcadvisorÈÄªËæë</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubernetes/pkg/kubelet/stats/helper.go</span><br><span class="line"></span><br><span class="line">infoMap, err := cadvisor.ContainerInfoV2(containerName, cadvisorapiv2.RequestOptions&#123;</span><br><span class="line">IdType:    cadvisorapiv2.TypeName,</span><br><span class="line">Count:     2, // 2 samples are needed to compute &quot;instantaneous&quot; CPU</span><br><span class="line">Recursive: false,</span><br><span class="line">MaxAge:    maxAge,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>cadvisor Âü∫‰∫é cgroup v1&#x2F;v2 Ëé∑Âèñ‰∏çÂêå cgroup managerÊé•Âè£ÂÆûÁé∞ÔºåÁÑ∂ÂêéË∞ÉÁî®GetStats()Ëé∑ÂèñÁõëÊéß‰ø°ÊÅØ„ÄÇ</p><p>Ëøô‰∫õÂÆûÁé∞Âú®ËÆ°ÁÆóroot cgroup ÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÊñπÈù¢Â≠òÂú®Â∑ÆÂºÇ„ÄÇ</p><ul><li><p>v1 ‰ΩøÁî®Êù•Ëá™ memory.usage_in_bytes ÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÊÉÖÂÜµÔºö<a href="https://github.com/opencontainers/runc/blob/92c71e725fc6421b6375ff128936a23c340e2d16/libcontainer/cgroups/fs/memory.go#L204-L224">https://github.com/opencontainers/runc/blob/92c71e725fc6421b6375ff128936a23c340e2d16/libcontainer/cgroups/fs/memory.go#L204-L224</a></p></li><li><p>v2 ‰ΩøÁî® &#x2F;proc&#x2F;meminfo Âπ∂ËÆ°ÁÆó‰ΩøÁî®ÊÉÖÂÜµ‰∏∫ÊÄªÂÜÖÂ≠ò - Á©∫Èó≤ÂÜÖÂ≠òÔºö<a href="https://github.com/opencontainers/runc/blob/92c71e725fc6421b6375ff128936a23c340e2d16/libcontainer/cgroups/fs2/memory.go#L217">https://github.com/opencontainers/runc/blob/92c71e725fc6421b6375ff128936a23c340e2d16/libcontainer/cgroups/fs2/memory.go#L217</a></p></li></ul><p>usage_in_bytes Â§ßËá¥Á≠â‰∫é RSS + Cache„ÄÇworkingsetÊòØ usage - ÈùûÊ¥ªÂä®Êñá‰ª∂„ÄÇ</p><p>Âú® cadvisor ‰∏≠ÔºåÂú®workingset‰∏≠ÊéíÈô§‰∫ÜÈùûÊ¥ªÂä®Êñá‰ª∂Ôºö<a href="https://github.com/google/cadvisor/blob/8164b38067246b36c773204f154604e2a1c962dc/container/libcontainer/handler.go#L835-L844">https://github.com/google/cadvisor/blob/8164b38067246b36c773204f154604e2a1c962dc/container/libcontainer/handler.go#L835-L844</a>‚Äú</p><p>Âõ†Ê≠§ÂèØ‰ª•Âà§Êñ≠Âú®cgroupv2ËÆ°ÁÆóÂÜÖÂ≠ò‰ΩøÁî®‰ΩøÁî®‰∫Ütotal-freeÔºåËøôÈáåÈù¢ÂåÖÂê´‰∫Üinactive_anonÔºåËÄåÂÜÖÊ†∏‰ª•Âèäcgroupv1ËÆ°ÁÆóÂÜÖÂ≠ò‰ΩøÁî®ÈáèÊó∂‰∏ç‰ºöËÆ°ÂÖ• inactive_anonÔºö<a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/memcontrol.c#n3720">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/memcontrol.c#n3720</a></p><p>ÈÄöËøá‰∏ãÈù¢ÁöÑÊµãËØï‰∏≠Ôºåinactive_anon Ëß£ÈáäÊï∞ÊçÆÁúãÂà∞‰∫ÜÂ∑ÆÂºÇ„ÄÇ</p><p>‰∏ãËø∞ÂàÜÂà´‰∏∫cgroupv1Âèäcgroupv2ÁöÑ‰∏§‰∏™ÈõÜÁæ§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~ # kubectl top node</span><br><span class="line">NAME    CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%</span><br><span class="line">node1   98m          2%     1512Mi          12%</span><br><span class="line">node2   99m          2%     1454Mi          11%</span><br><span class="line">node3   94m          2%     1448Mi          11%</span><br></pre></td></tr></table></figure><p>ÂÖ∂‰∏≠cgroupv1ËäÇÁÇπÁöÑroot cgroupÂÜÖÂ≠ò‰ΩøÁî®Â¶Ç‰∏ãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">~ # cat /sys/fs/cgroup/memory/memory.usage_in_bytes</span><br><span class="line">6236864512</span><br><span class="line">~ # cat /sys/fs/cgroup/memory/memory.stat</span><br><span class="line">cache 44662784</span><br><span class="line">rss 3260416</span><br><span class="line">rss_huge 2097152</span><br><span class="line">shmem 65536</span><br><span class="line">mapped_file 11083776</span><br><span class="line">dirty 135168</span><br><span class="line">writeback 0</span><br><span class="line">pgpgin 114774</span><br><span class="line">pgpgout 103506</span><br><span class="line">pgfault 165891</span><br><span class="line">pgmajfault 99</span><br><span class="line">inactive_anon 135168</span><br><span class="line">active_anon 3645440</span><br><span class="line">inactive_file 5406720</span><br><span class="line">active_file 39333888</span><br><span class="line">unevictable 0</span><br><span class="line">hierarchical_memory_limit 9223372036854771712</span><br><span class="line">total_cache 5471584256</span><br><span class="line">total_rss 767148032</span><br><span class="line">total_rss_huge 559939584</span><br><span class="line">total_shmem 1921024</span><br><span class="line">total_mapped_file 605687808</span><br><span class="line">total_dirty 270336</span><br><span class="line">total_writeback 0</span><br><span class="line">total_pgpgin 51679194</span><br><span class="line">total_pgpgout 50291069</span><br><span class="line">total_pgfault 97383769</span><br><span class="line">total_pgmajfault 5610</span><br><span class="line">total_inactive_anon 1081344</span><br><span class="line">total_active_anon 772235264</span><br><span class="line">total_inactive_file 4648124416</span><br><span class="line">total_active_file 820551680</span><br><span class="line">total_unevictable 0</span><br></pre></td></tr></table></figure><p>meminfoÊñá‰ª∂Â¶Ç‰∏ã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">~ # cat /proc/meminfo</span><br><span class="line">MemTotal:       16393244 kB</span><br><span class="line">MemFree:         9744148 kB</span><br><span class="line">MemAvailable:   15020900 kB</span><br><span class="line">Buffers:          132344 kB</span><br><span class="line">Cached:          5207356 kB</span><br><span class="line">SwapCached:            0 kB</span><br><span class="line">Active:          1557252 kB</span><br><span class="line">Inactive:        4526668 kB</span><br><span class="line">Active(anon):     745916 kB</span><br><span class="line">Inactive(anon):      792 kB</span><br><span class="line">Active(file):     811336 kB</span><br><span class="line">Inactive(file):  4525876 kB</span><br><span class="line">Unevictable:           0 kB</span><br><span class="line">Mlocked:               0 kB</span><br><span class="line">SwapTotal:             0 kB</span><br><span class="line">SwapFree:              0 kB</span><br><span class="line">Dirty:               636 kB</span><br><span class="line">Writeback:             0 kB</span><br><span class="line">AnonPages:        618992 kB</span><br><span class="line">Mapped:           624384 kB</span><br><span class="line">Shmem:              2496 kB</span><br><span class="line">KReclaimable:     285824 kB</span><br><span class="line">Slab:             423600 kB</span><br><span class="line">SReclaimable:     285824 kB</span><br><span class="line">SUnreclaim:       137776 kB</span><br><span class="line">KernelStack:        8400 kB</span><br><span class="line">PageTables:         9060 kB</span><br><span class="line">NFS_Unstable:          0 kB</span><br><span class="line">Bounce:                0 kB</span><br><span class="line">WritebackTmp:          0 kB</span><br><span class="line">CommitLimit:     8196620 kB</span><br><span class="line">Committed_AS:    2800016 kB</span><br><span class="line">VmallocTotal:   34359738367 kB</span><br><span class="line">VmallocUsed:       40992 kB</span><br><span class="line">VmallocChunk:          0 kB</span><br><span class="line">Percpu:             4432 kB</span><br><span class="line">HardwareCorrupted:     0 kB</span><br><span class="line">AnonHugePages:    270336 kB</span><br><span class="line">ShmemHugePages:        0 kB</span><br><span class="line">ShmemPmdMapped:        0 kB</span><br><span class="line">FileHugePages:         0 kB</span><br><span class="line">FilePmdMapped:         0 kB</span><br><span class="line">CmaTotal:              0 kB</span><br><span class="line">CmaFree:               0 kB</span><br><span class="line">HugePages_Total:       0</span><br><span class="line">HugePages_Free:        0</span><br><span class="line">HugePages_Rsvd:        0</span><br><span class="line">HugePages_Surp:        0</span><br><span class="line">Hugepagesize:       2048 kB</span><br><span class="line">Hugetlb:               0 kB</span><br><span class="line">DirectMap4k:      302344 kB</span><br><span class="line">DirectMap2M:     3891200 kB</span><br><span class="line">DirectMap1G:    14680064 kB</span><br></pre></td></tr></table></figure><p>ÂΩìÂâçÁöÑËÆ°ÁÆó</p><p>memory.current - memory.stat.total_inactive_file &#x3D; 6236864512 - 4648124416 &#x3D; 1515 Mi -&gt; kubelet Êä•ÂëäÁöÑÁªìÊûú</p><p>cgroupv2 ÈõÜÁæ§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~ # kubectl top node</span><br><span class="line">NAME    CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%</span><br><span class="line">node1   113m         2%     2196Mi          17%</span><br><span class="line">node2   112m         2%     2171Mi          17%</span><br><span class="line">node3   113m         2%     2180Mi          17%</span><br></pre></td></tr></table></figure><p>ÂÖ∂‰∏≠‰∏ÄËäÇÁÇπÁöÑmeminfoÊñá‰ª∂Â¶Ç‰∏ãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">MemTotal:       16374584 kB</span><br><span class="line">MemFree:         9505980 kB</span><br><span class="line">MemAvailable:   14912544 kB</span><br><span class="line">Buffers:          155164 kB</span><br><span class="line">Cached:          5335576 kB</span><br><span class="line">SwapCached:            0 kB</span><br><span class="line">Active:           872420 kB</span><br><span class="line">Inactive:        5399340 kB</span><br><span class="line">Active(anon):       2568 kB</span><br><span class="line">Inactive(anon):   791340 kB</span><br><span class="line">Active(file):     869852 kB</span><br><span class="line">Inactive(file):  4608000 kB</span><br><span class="line">Unevictable:       30740 kB</span><br><span class="line">Mlocked:           27668 kB</span><br><span class="line">SwapTotal:             0 kB</span><br><span class="line">SwapFree:              0 kB</span><br><span class="line">Dirty:               148 kB</span><br><span class="line">Writeback:             0 kB</span><br><span class="line">AnonPages:        716552 kB</span><br><span class="line">Mapped:           608424 kB</span><br><span class="line">Shmem:              6320 kB</span><br><span class="line">KReclaimable:     274360 kB</span><br><span class="line">Slab:             355976 kB</span><br><span class="line">SReclaimable:     274360 kB</span><br><span class="line">SUnreclaim:        81616 kB</span><br><span class="line">KernelStack:        8064 kB</span><br><span class="line">PageTables:         7692 kB</span><br><span class="line">NFS_Unstable:          0 kB</span><br><span class="line">Bounce:                0 kB</span><br><span class="line">WritebackTmp:          0 kB</span><br><span class="line">CommitLimit:     8187292 kB</span><br><span class="line">Committed_AS:    2605012 kB</span><br><span class="line">VmallocTotal:   34359738367 kB</span><br><span class="line">VmallocUsed:       48092 kB</span><br><span class="line">VmallocChunk:          0 kB</span><br><span class="line">Percpu:             3472 kB</span><br><span class="line">HardwareCorrupted:     0 kB</span><br><span class="line">AnonHugePages:    409600 kB</span><br><span class="line">ShmemHugePages:        0 kB</span><br><span class="line">ShmemPmdMapped:        0 kB</span><br><span class="line">FileHugePages:         0 kB</span><br><span class="line">FilePmdMapped:         0 kB</span><br><span class="line">HugePages_Total:       0</span><br><span class="line">HugePages_Free:        0</span><br><span class="line">HugePages_Rsvd:        0</span><br><span class="line">HugePages_Surp:        0</span><br><span class="line">Hugepagesize:       2048 kB</span><br><span class="line">Hugetlb:               0 kB</span><br><span class="line">DirectMap4k:      271624 kB</span><br><span class="line">DirectMap2M:     8116224 kB</span><br><span class="line">DirectMap1G:    10485760 kB</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">usage = total - free = 16374584 - 9505980</span><br><span class="line"></span><br><span class="line">workingset = ÊÄªÂÜÖÂ≠ò - Á©∫Èó≤ÂÜÖÂ≠ò - ÈùûÊ¥ªÂä®Êñá‰ª∂ = 16374584 - 9505980 - 4608000 = 2207 MiÔºàkubelet Êä•ÂëäÁöÑÁªìÊûúÔºâ</span><br></pre></td></tr></table></figure><h2 id="ÁªìËÆ∫"><a href="#ÁªìËÆ∫" class="headerlink" title="ÁªìËÆ∫"></a>ÁªìËÆ∫</h2><p>Â¶Ç‰∏äÊâÄËø∞ÔºåÂú®Linux kernelÂèärunc cgroupv1ËÆ°ÁÆóÂÜÖÂ≠ò‰ΩøÁî®‰∏∫</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mem_cgroup_usage =NR_FILE_PAGES + NR_ANON_MAPPED + nr_swap_pages (Â¶ÇÊûúswapÂêØÁî®ÁöÑËØù)</span><br><span class="line"></span><br><span class="line">// - rss (NR_ANON_MAPPED)</span><br><span class="line">// - cache (NR_FILE_PAGES)</span><br></pre></td></tr></table></figure><p>‰ΩÜÊòØruncÂú®cgroupv2ËÆ°ÁÆó‰ΩøÁî®‰∫Ütotal-freeÔºåÂõ†Ê≠§Âú®Áõ∏‰ººË¥üËΩΩ‰∏ãÔºåÂêå‰∏ÄÂè∞Êú∫Âô®‰∏äv1Âíåv2ÁâàÊú¨ÁöÑËäÇÁÇπÁ∫ßÂà´Êä•ÂëäÁ°ÆÂÆû‰ºöÁõ∏Â∑ÆÁ∫¶250-750MiÔºå‰∏∫‰∫ÜËÆ©cgroup v2ÁöÑÂÜÖÂ≠ò‰ΩøÁî®ËÆ°ÁÆóÊõ¥Êé•Ëøë cgroupv1Ôºå  cgroup v2Ë∞ÉÊï¥ËÆ°ÁÆóÂÜÖÂ≠ò‰ΩøÁî®ÈáèÊñπÂºè‰∏∫</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stats.MemoryStats.Usage.Usage = stats.MemoryStats.Stats[&quot;anon&quot;] + stats.MemoryStats.Stats[&quot;file&quot;]</span><br></pre></td></tr></table></figure><p>ÂΩìÁÑ∂ÔºåÊàë‰ª¨ÂêåÊó∂ËøòÈúÄË¶ÅÂ§ÑÁêÜcadvisorÁöÑworingsetÁöÑÂ§ÑÁêÜÈÄªËæë</p><p>Áî±‰∫éÁ¨îËÄÖÊó∂Èó¥„ÄÅËßÜÈáé„ÄÅËÆ§Áü•ÊúâÈôêÔºåÊú¨ÊñáÈöæÂÖçÂá∫Áé∞ÈîôËØØ„ÄÅÁñèÊºèÁ≠âÈóÆÈ¢òÔºåÊúüÂæÖÂêÑ‰ΩçËØªËÄÖÊúãÂèã„ÄÅ‰∏öÁïå‰∏ìÂÆ∂ÊåáÊ≠£‰∫§ÊµÅÔºå‰∏äËø∞ÊéíÈöú‰ø°ÊÅØÂ∑≤‰øÆÊîπ‰∏∫Á§æÂå∫ÂÜÖÂÆπ„ÄÇ</p><h2 id="ÂèÇËÄÉÊñáÁåÆ"><a href="#ÂèÇËÄÉÊñáÁåÆ" class="headerlink" title="ÂèÇËÄÉÊñáÁåÆ"></a>ÂèÇËÄÉÊñáÁåÆ</h2><p>1.<a href="https://github.com/torvalds/linux/blob/06c2afb862f9da8dc5efa4b6076a0e48c3fbaaa5/mm/memcontrol.c#L3673-L3680">https://github.com/torvalds/linux/blob/06c2afb862f9da8dc5efa4b6076a0e48c3fbaaa5/mm/memcontrol.c#L3673-L3680</a><br>2.<a href="https://github.com/kubernetes/kubernetes/issues/68522">https://github.com/kubernetes/kubernetes/issues/68522</a><br>3.<a href="https://kubernetes.io/docs/reference/instrumentation/cri-pod-container-metrics/">https://kubernetes.io/docs/reference/instrumentation/cri-pod-container-metrics/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Âú®AlmalinuxÊõøÊç¢CentOSÁöÑËøáÁ®ã‰∏≠ÔºåÊàë‰ª¨ÈÄöËøákubectl top nodesÂëΩ‰ª§ËßÇÂØüÂà∞‰∫Ü‰∏§‰∏™Áõ∏ÂêåËßÑÊ†ºÁöÑËäÇÁÇπÔºàÂè™ÊúâcgroupÁâàÊú¨‰∏çÂêåÔºâ„ÄÇÂú®ÂàÜÂà´Ë∞ÉÂ∫¶‰∏§‰∏™Áõ∏ÂêåÁöÑPodÂêéÔºåÊàë‰ª¨È¢ÑÊúüÂÆÉ‰ª¨ÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÈáèÂ∫îËØ•Áõ∏Ëøë„ÄÇÁÑ∂ËÄåÔºåÊàë‰ª¨ÂèëÁé∞‰ΩøÁî®‰∫Ücgroupv2ÁöÑËäÇÁÇπÁöÑÂÜÖÂ≠ò‰ΩøÁî®ÈáèÊØî‰ΩøÁî®‰∫Ü</summary>
      
    
    
    
    <category term="‰∫ëÂéüÁîüÈù¢ËØïÊ°à‰æã50ÁØá" scheme="https://zoues.com/categories/%E4%BA%91%E5%8E%9F%E7%94%9F%E9%9D%A2%E8%AF%95%E6%A1%88%E4%BE%8B50%E7%AF%87/"/>
    
    
    <category term="cloudnative" scheme="https://zoues.com/tags/cloudnative/"/>
    
    <category term="kubernetes" scheme="https://zoues.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>‰∏ÄÊù°K8sÂëΩ‰ª§Ë°åÂºïÂèëÁöÑË°ÄÊ°à</title>
    <link href="https://zoues.com/posts/5a8a6c8d/"/>
    <id>https://zoues.com/posts/5a8a6c8d/</id>
    <published>2024-01-27T01:25:08.000Z</published>
    <updated>2024-02-03T06:32:45.375Z</updated>
    
    <content type="html"><![CDATA[<h2 id="‰∏ÄÊù°K8sÂëΩ‰ª§Ë°åÂºïÂèëÁöÑË°ÄÊ°à"><a href="#‰∏ÄÊù°K8sÂëΩ‰ª§Ë°åÂºïÂèëÁöÑË°ÄÊ°à" class="headerlink" title="‰∏ÄÊù°K8sÂëΩ‰ª§Ë°åÂºïÂèëÁöÑË°ÄÊ°à"></a>‰∏ÄÊù°K8sÂëΩ‰ª§Ë°åÂºïÂèëÁöÑË°ÄÊ°à</h2><h2 id="ÈóÆÈ¢òÊèèËø∞"><a href="#ÈóÆÈ¢òÊèèËø∞" class="headerlink" title="ÈóÆÈ¢òÊèèËø∞"></a>ÈóÆÈ¢òÊèèËø∞</h2><p>Âõ†‰∏∫Centos EOLÁöÑÁºòÊïÖÔºåÂéªÂπ¥ÂÜÖÈÉ®ÂøôÁùÄÊç¢OSÔºåÊâìÁÆóË∂ÅÊ≠§Êú∫‰ºö‰ªécgroup v1ÂàáÂà∞cgroup v2ÔºåÁÑ∂ËÄåÔºåÂú®‰ΩéÁâàÊú¨K8sÈÄÇÈÖçcgroupv2ÁöÑËøáÁ®ã‰∏≠ÔºåÈÅáÂà∞‰∫Ü‰∏Ä‰∫õÈóÆÈ¢òÔºåÂâçÊúükubeletÂú®cgroup v1ÁöÑÁéØÂ¢É‰∏ãÔºå‰ΩøÁî®<code>-enable_load_reader</code>Êö¥Èú≤ÂÆπÂô®ÁöÑcpu loadÁ≠âÁõ∏ÂÖ≥ÁõëÊéßÊï∞ÊçÆÔºå‰ΩÜÂú®cgroup v2ÁéØÂ¢É‰∏ãÔºå‰ΩøÁî®ËØ•ÈÖçÁΩÆ‰ºöÂØºËá¥kubeletÂèëÁîüpanic</p><p>‰∏ãËø∞‰∏∫ÂÖ≥ÈîÆÊÄß‰ø°ÊÅØÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">container.go:422] Could not initialize cpu load reader for &quot;/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podXXX.slice&quot;: failed to create a netlink based cpuload reader: failed to get netlink family id for task stats: binary.Read: invalid type int32</span><br></pre></td></tr></table></figure><h2 id="ÊäÄÊúØËÉåÊôØ"><a href="#ÊäÄÊúØËÉåÊôØ" class="headerlink" title="ÊäÄÊúØËÉåÊôØ"></a>ÊäÄÊúØËÉåÊôØ</h2><p>ËØ•Á´†ËäÇ‰ªãÁªç‰ª•‰∏ãÂÜÖÂÆπÔºö</p><ul><li>ÂÆπÂô®ÊåáÊ†áÂ¶Ç‰ΩïÁîüÊàê</li><li>K8sÂ¶Ç‰ΩïÈõÜÊàêÂÆπÂô®ÁõëÊéß</li><li>cpu loadÂ¶Ç‰ΩïËÆ°ÁÆóÁ≠â</li></ul><h3 id="cadvisor"><a href="#cadvisor" class="headerlink" title="cadvisor"></a>cadvisor</h3><p>cAdvisorÊòØ‰∏ÄÊ¨æÂº∫Â§ßÁöÑDockerÂÆπÂô®ÁõëÊéßÂ∑•ÂÖ∑Ôºå‰∏ì‰∏∫ÂÆπÂô®Âú∫ÊôØËÆæËÆ°ÔºåÊñπ‰æøÁõëÊéßËµÑÊ∫ê‰ΩøÁî®ÂíåÊÄßËÉΩÂàÜÊûê„ÄÇÂÆÉÁî®‰∫éÊî∂ÈõÜ„ÄÅÊ±áÊÄª„ÄÅÂ§ÑÁêÜÂíåËæìÂá∫ÂÆπÂô®ÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØ„ÄÇcAdvisorÊîØÊåÅDockerÂÆπÂô®ÔºåÂêåÊó∂ÊîØÊåÅÂÖ∂‰ªñÁ±ªÂûãÁöÑÂÆπÂô®ËøêË°åÊó∂„ÄÇ</p><p>KubeletÂÜÖÁΩÆ‰∫ÜÂØπcAdvisorÁöÑÊîØÊåÅÔºåÁî®Êà∑ÂèØ‰ª•Áõ¥Êé•ÈÄöËøáKubeletÁªÑ‰ª∂Ëé∑ÂèñÊúâÂÖ≥ËäÇÁÇπ‰∏äÂÆπÂô®ÁöÑÁõëÊéßÊåáÊ†á„ÄÇ</p><blockquote><p>K8s 1.19‰ΩøÁî®ÁöÑcAdvisorÁâàÊú¨‰∏∫0.39.3ÔºåËÄåËøôÈáåÁöÑÁÆÄË¶Å‰ªãÁªç‰ΩøÁî®ÁöÑÊòØÁâàÊú¨0.48.1„ÄÇ</p></blockquote><p>‰ª•‰∏ãÊòØ‰∏ªË¶ÅÂäüËÉΩ‰ª£Á†ÅÔºåÂÖ∂‰∏≠ÂåÖÂê´‰∫Ü‰∏Ä‰∫õÊ≥®Èáä‰ª•ÊèêÈ´òÂèØËØªÊÄß„ÄÇ‰ª£Á†ÅË∑ØÂæÑ‰∏∫Ôºö&#x2F;cadvisor&#x2F;cmd&#x2F;cadvisor.go„ÄÇ</p><p>cAdvisor‰∏ªË¶ÅÂÆåÊàê‰ª•‰∏ãÂá†È°π‰ªªÂä°Ôºö</p><ul><li>ÂØπÂ§ñÊèê‰æõÂ§ñÈÉ®‰ΩøÁî®ÁöÑAPIÔºåÂåÖÊã¨‰∏ÄËà¨ÁöÑAPIÊé•Âè£ÂíåPrometheusÊé•Âè£„ÄÇ</li><li>ÊîØÊåÅÁ¨¨‰∏âÊñπÊï∞ÊçÆÂ≠òÂÇ®ÔºåÂåÖÊã¨BigQuery„ÄÅElasticsearch„ÄÅInfluxDB„ÄÅKafka„ÄÅPrometheus„ÄÅRedis„ÄÅStatsDÂíåÊ†áÂáÜËæìÂá∫„ÄÇ</li><li>Êî∂ÈõÜ‰∏éÂÆπÂô®„ÄÅËøõÁ®ã„ÄÅÊú∫Âô®„ÄÅGoËøêË°åÊó∂‰ª•ÂèäËá™ÂÆö‰πâ‰∏öÂä°Áõ∏ÂÖ≥ÁöÑÁõëÊéß„ÄÇ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func init() &#123;</span><br><span class="line">optstr := container.AllMetrics.String()</span><br><span class="line">flag.Var(&amp;ignoreMetrics, &quot;disable_metrics&quot;, fmt.Sprintf(&quot;comma-separated list of `metrics` to be disabled. Options are %s.&quot;, optstr))</span><br><span class="line">flag.Var(&amp;enableMetrics, &quot;enable_metrics&quot;, fmt.Sprintf(&quot;comma-separated list of `metrics` to be enabled. If set, overrides &#x27;disable_metrics&#x27;. Options are %s.&quot;, optstr))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰ªé‰∏äËø∞‰ª£Á†ÅÂèØ‰ª•ÁúãÂà∞ÔºåcadvisorÊîØÊåÅÊòØÂê¶ÂºÄÂêØÁõ∏ÂÖ≥ÊåáÊ†áÁöÑËÉΩÂäõÔºåÂÖ∂‰∏≠<code>AllMetrics</code>‰∏ªË¶ÅÊòØ‰∏ãËø∞ÊåáÊ†á:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/google/cadvisor/blob/master/container/factory.go#L72</span><br><span class="line"></span><br><span class="line">var AllMetrics = MetricSet&#123;</span><br><span class="line">CpuUsageMetrics:                struct&#123;&#125;&#123;&#125;,</span><br><span class="line">ProcessSchedulerMetrics:        struct&#123;&#125;&#123;&#125;,</span><br><span class="line">PerCpuUsageMetrics:             struct&#123;&#125;&#123;&#125;,</span><br><span class="line">MemoryUsageMetrics:             struct&#123;&#125;&#123;&#125;,</span><br><span class="line">MemoryNumaMetrics:              struct&#123;&#125;&#123;&#125;,</span><br><span class="line">CpuLoadMetrics:                 struct&#123;&#125;&#123;&#125;,</span><br><span class="line">DiskIOMetrics:                  struct&#123;&#125;&#123;&#125;,</span><br><span class="line">DiskUsageMetrics:               struct&#123;&#125;&#123;&#125;,</span><br><span class="line">NetworkUsageMetrics:            struct&#123;&#125;&#123;&#125;,</span><br><span class="line">NetworkTcpUsageMetrics:         struct&#123;&#125;&#123;&#125;,</span><br><span class="line">NetworkAdvancedTcpUsageMetrics: struct&#123;&#125;&#123;&#125;,</span><br><span class="line">NetworkUdpUsageMetrics:         struct&#123;&#125;&#123;&#125;,</span><br><span class="line">ProcessMetrics:                 struct&#123;&#125;&#123;&#125;,</span><br><span class="line">AppMetrics:                     struct&#123;&#125;&#123;&#125;,</span><br><span class="line">HugetlbUsageMetrics:            struct&#123;&#125;&#123;&#125;,</span><br><span class="line">PerfMetrics:                    struct&#123;&#125;&#123;&#125;,</span><br><span class="line">ReferencedMemoryMetrics:        struct&#123;&#125;&#123;&#125;,</span><br><span class="line">CPUTopologyMetrics:             struct&#123;&#125;&#123;&#125;,</span><br><span class="line">ResctrlMetrics:                 struct&#123;&#125;&#123;&#125;,</span><br><span class="line">CPUSetMetrics:                  struct&#123;&#125;&#123;&#125;,</span><br><span class="line">OOMMetrics:                     struct&#123;&#125;&#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">func main() &#123;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">var includedMetrics container.MetricSet</span><br><span class="line">if len(enableMetrics) &gt; 0 &#123;</span><br><span class="line">includedMetrics = enableMetrics</span><br><span class="line">&#125; else &#123;</span><br><span class="line">includedMetrics = container.AllMetrics.Difference(ignoreMetrics)</span><br><span class="line">&#125;</span><br><span class="line">// ‰∏äËø∞Â§ÑÁêÜÈúÄË¶ÅÂºÄÂêØÁöÑÊåáÊ†á</span><br><span class="line">klog.V(1).Infof(&quot;enabled metrics: %s&quot;, includedMetrics.String())</span><br><span class="line">setMaxProcs()</span><br><span class="line">// ÂÜÖÂ≠òÊñπÂºèÂ≠òÂú®ÁõëÊéßÊåáÊ†á</span><br><span class="line">memoryStorage, err := NewMemoryStorage()</span><br><span class="line">if err != nil &#123;</span><br><span class="line">klog.Fatalf(&quot;Failed to initialize storage driver: %s&quot;, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sysFs := sysfs.NewRealSysFs()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ËøôÊòØcadvisorÊ†∏ÂøÉÈÄªËæëÔºåkubeletÂÜÖÈÉ®Â∞±ÊòØÁõ¥Êé•Ë∞ÉÁî®ÁöÑmanager.New</span><br><span class="line">resourceManager, err := manager.New(memoryStorage, sysFs, manager.HousekeepingConfigFlags, includedMetrics, &amp;collectorHTTPClient, strings.Split(*rawCgroupPrefixWhiteList, &quot;,&quot;), strings.Split(*envMetadataWhiteList, &quot;,&quot;), *perfEvents, *resctrlInterval)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">klog.Fatalf(&quot;Failed to create a manager: %s&quot;, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// Ê≥®ÂÜåÂØπÂ§ñÁöÑHTTPÊé•Âè£.</span><br><span class="line">err = cadvisorhttp.RegisterHandlers(mux, resourceManager, *httpAuthFile, *httpAuthRealm, *httpDigestFile, *httpDigestRealm, *urlBasePrefix)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">klog.Fatalf(&quot;Failed to register HTTP handlers: %v&quot;, err)</span><br><span class="line">&#125;</span><br><span class="line">// ËøôÈáåÊòØÂÆπÂô®Ê†áÁ≠æÁöÑÂ§ÑÁêÜÔºåkubelet 1.28ÂàáÊç¢Âà∞CRI‰πãÂêéÈúÄË¶Å‰øÆÊîπkubelet</span><br><span class="line">containerLabelFunc := metrics.DefaultContainerLabels</span><br><span class="line">if !*storeContainerLabels &#123;</span><br><span class="line">whitelistedLabels := strings.Split(*whitelistedContainerLabels, &quot;,&quot;)</span><br><span class="line">// Trim spacing in labels</span><br><span class="line">for i := range whitelistedLabels &#123;</span><br><span class="line">whitelistedLabels[i] = strings.TrimSpace(whitelistedLabels[i])</span><br><span class="line">&#125;</span><br><span class="line">containerLabelFunc = metrics.BaseContainerLabels(whitelistedLabels)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂÖ∂‰∏≠cpu loadÊòØÂê¶ÁîüÊàêÊåáÊ†áÔºåÂêåÊó∂‰πüÁî±ÂëΩ‰ª§Ë°å<code>enable_load_reader</code>ÊéßÂà∂</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/google/cadvisor/blob/42bb3d13a0cf9ab80c880a16c4ebb4f36e51b0c9/manager/container.go#L455</span><br><span class="line"></span><br><span class="line">if *enableLoadReader &#123;</span><br><span class="line">// Create cpu load reader.</span><br><span class="line">loadReader, err := cpuload.New()</span><br><span class="line">if err != nil &#123;</span><br><span class="line">klog.Warningf(&quot;Could not initialize cpu load reader for %q: %s&quot;, ref.Name, err)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">cont.loadReader = loadReader</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Kubelet"><a href="#Kubelet" class="headerlink" title="Kubelet"></a>Kubelet</h3><p>Âú®Kubernetes‰∏≠ÔºåGoogleÁöÑcAdvisorÈ°πÁõÆË¢´Áî®‰∫éËäÇÁÇπ‰∏äÂÆπÂô®ËµÑÊ∫êÂíåÊÄßËÉΩÊåáÊ†áÁöÑÊî∂ÈõÜ„ÄÇÂú®kubelet server‰∏≠ÔºåcAdvisorË¢´ÈõÜÊàêÁî®‰∫éÁõëÊéßËØ•ËäÇÁÇπ‰∏äkubepodsÔºàÈªòËÆ§cgroupÂêçÁß∞ÔºåsystemdÊ®°Âºè‰∏ã‰ºöÂä†‰∏ä.sliceÂêéÁºÄÔºâ cgroup‰∏ãÁöÑÊâÄÊúâÂÆπÂô®„ÄÇ‰ªé1.29.0-alpha.2ÁâàÊú¨‰∏≠ÂèØ‰ª•ÁúãÂà∞ÔºåkubeletÁõÆÂâçËøòÊòØÊèê‰æõ‰∫Ü‰ª•‰∏ã‰∏§ÁßçÈÖçÁΩÆÈÄâÈ°πÔºà‰ΩÜÊòØÁé∞Âú®useLegacyCadvisorStats‰∏∫<strong>false</strong>ÔºâÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">if kubeDeps.useLegacyCadvisorStats &#123;</span><br><span class="line">    klet.StatsProvider = stats.NewCadvisorStatsProvider(</span><br><span class="line">      klet.cadvisor,</span><br><span class="line">      klet.resourceAnalyzer,</span><br><span class="line">      klet.podManager,</span><br><span class="line">      klet.runtimeCache,</span><br><span class="line">      klet.containerRuntime,</span><br><span class="line">      klet.statusManager,</span><br><span class="line">      hostStatsProvider)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    klet.StatsProvider = stats.NewCRIStatsProvider(</span><br><span class="line">      klet.cadvisor,</span><br><span class="line">      klet.resourceAnalyzer,</span><br><span class="line">      klet.podManager,</span><br><span class="line">      klet.runtimeCache,</span><br><span class="line">      kubeDeps.RemoteRuntimeService,</span><br><span class="line">      kubeDeps.RemoteImageService,</span><br><span class="line">      hostStatsProvider,</span><br><span class="line">      utilfeature.DefaultFeatureGate.Enabled(features.PodAndContainerStatsFromCRI))</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>kubelet‰ª•PrometheusÊåáÊ†áÊ†ºÂºèÂú®&#x2F;stats&#x2F;Êö¥Èú≤ÊâÄÊúâÁõ∏ÂÖ≥ËøêË°åÊó∂ÊåáÊ†áÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫ÔºåKubeletÂÜÖÁΩÆ‰∫ÜcadvisorÊúçÂä°</p><p><img src="https://pic.imgdb.cn/item/65b43ba0871b83018ac66a1f.png"></p><p>ÊúÄÁªàÂèØ‰ª•ÁúãÂà∞cadvisorÁªÑ‰ª∂Â¶Ç‰ΩïÂú®kubeletÂÆåÊàêÂàùÂßãÂåñ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/cadvisor/cadvisor_linux.go#L80</span><br><span class="line"></span><br><span class="line">func New(imageFsInfoProvider ImageFsInfoProvider, rootPath string, cgroupRoots []string, usingLegacyStats, localStorageCapacityIsolation bool) (Interface, error) &#123;</span><br><span class="line">sysFs := sysfs.NewRealSysFs()</span><br><span class="line">// ËøôÈáåÂ∞±ÊòØkubeletÈªòËÆ§Êö¥Èú≤ÁöÑÁõëÊéßÊåáÊ†áÁ±ªÂûã</span><br><span class="line">includedMetrics := cadvisormetrics.MetricSet&#123;</span><br><span class="line">...</span><br><span class="line">cadvisormetrics.CpuLoadMetrics:      struct&#123;&#125;&#123;&#125;,</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">// ÂàõÂª∫cAdvisor container manager.</span><br><span class="line">m, err := manager.New(memory.New(statsCacheDuration, nil), sysFs, housekeepingConfig, includedMetrics, http.DefaultClient, cgroupRoots, nil /* containerEnvMetadataWhiteList */, &quot;&quot; /* perfEventsFile */, time.Duration(0) /*resctrlInterval*/)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ËøôÈáåÂ∞±ÊòØÁõ¥Êé•Ë∞ÉÁî®ÁöÑcadvisorÁöÑmanager.NewÁöÑÂáΩÊï∞Êé•Âè£ÔºåÊõ¥ËØ¶ÁªÜÁöÑ‰ø°ÊÅØÂèØÂèÇÁúãÔºö<a href="https://zoues.com/posts/3f237e52/">https://zoues.com/posts/3f237e52/</a></p><h3 id="CPU-LoadÊåáÊ†á"><a href="#CPU-LoadÊåáÊ†á" class="headerlink" title="CPU LoadÊåáÊ†á"></a>CPU LoadÊåáÊ†á</h3><p>CPU‰ΩøÁî®ÁéáÂèçÊò†ÁöÑÊòØÂΩìÂâçcpuÁöÑÁπÅÂøôÁ®ãÂ∫¶ÔºåCPUÂπ≥ÂùáË¥üËΩΩÔºàload averageÔºâÊòØÊåáÊüêÊÆµÊó∂Èó¥ÂÜÖÂç†Áî®cpuÊó∂Èó¥ÁöÑËøõÁ®ãÂíåÁ≠âÂæÖcpuÊó∂Èó¥ÁöÑËøõÁ®ãÊï∞ÔºåËøôÈáåÁ≠âÂæÖcpuÊó∂Èó¥ÁöÑËøõÁ®ãÊòØÊåáÁ≠âÂæÖË¢´Âî§ÈÜíÁöÑËøõÁ®ãÔºå‰∏çÂåÖÊã¨Â§Ñ‰∫éwaitÁä∂ÊÄÅËøõÁ®ã„ÄÇ</p><p>Âú®ÂØπËÆæÂ§áÂÅöÁõ∏ÂÖ≥ËØäÊñ≠Êó∂ÔºåÈúÄË¶ÅÁªìÂêàcpu‰ΩøÁî®Áéá„ÄÅÂπ≥ÂùáË¥üËΩΩ‰ª•Âèä‰ªªÂä°Áä∂ÊÄÅÊù•ËøõË°åÂà§Êñ≠ÔºåÊØîÂ¶ÇCPU‰ΩøÁî®Áéá‰Ωé‰ΩÜË¥üËΩΩÈ´òÔºåÂèØËÉΩÊòØIOÁì∂È¢àÁ≠âÔºåÂØπÊ≠§‰∏ç‰ΩúÊ∑±ÂÖ•‰ªãÁªç„ÄÇ</p><p>Âú®cadvisor‰∏≠ÂØπÂ§ñÊö¥Èú≤ÁöÑÊåáÊ†áÂêçÁß∞‰∏∫</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">container_cpu_load_average_10s</span><br></pre></td></tr></table></figure><p>ÈÇ£‰πàÊàë‰ª¨Êù•ÁúãÁúãÊòØÂ¶Ç‰ΩïË¢´ËÆ°ÁÆóÂá∫Êù•ÁöÑ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/google/cadvisor/blob/master/manager/container.go#L632</span><br><span class="line"></span><br><span class="line">// Calculate new smoothed load average using the new sample of runnable threads.</span><br><span class="line">// The decay used ensures that the load will stabilize on a new constant value within</span><br><span class="line">// 10 seconds.</span><br><span class="line">func (cd *containerData) updateLoad(newLoad uint64) &#123;</span><br><span class="line">if cd.loadAvg &lt; 0 &#123;</span><br><span class="line">cd.loadAvg = float64(newLoad) // initialize to the first seen sample for faster stabilization.</span><br><span class="line">&#125; else &#123;</span><br><span class="line">cd.loadAvg = cd.loadAvg*cd.loadDecay + float64(newLoad)*(1.0-cd.loadDecay)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂÖ¨ÂºèËÆ°ÁÆóÔºö<code>cd.loadAvg = cd.loadAvg*cd.loadDecay + float64(newLoad)*(1.0-cd.loadDecay)</code></p><p>Â§ß‰ΩìÊÑèÊÄùÊòØÂèñÁöÑ‰∏ä‰∏ÄÊ¨°ÈááÈõÜËÆ°ÁÆóÂá∫Êù•ÁöÑÂÄºcd.loadAvg‰πò‰ª•ËÆ°ÁÆóÂõ†Â≠êcd.loadDecayÔºåÁÑ∂ÂêéÂä†‰∏äÂΩìÂâçÈááÈõÜ</p><p>Âà∞ÁöÑnewLoadÂÄº‰πò‰ª•(1.0-cd.loadDecay)ÊúÄÂêéÂæóÂá∫ÂΩìÂâçÁöÑcd.loadAvgÂÄº</p><p>ÂÖ∂‰∏≠<code>cont.loadDecay</code>ËÆ°ÁÆóÈÄªËæëÂ¶Ç‰∏ãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/google/cadvisor/blob/master/manager/container.go#L453</span><br><span class="line"></span><br><span class="line">cont.loadDecay = math.Exp(float64(-cont.housekeepingInterval.Seconds() / 10))</span><br></pre></td></tr></table></figure><p>ËøôÈáåÊòØË∑ü<code>housekeepingInterval</code>Áõ∏ÂÖ≥ÁöÑÂõ∫ÂÆöÂÄºÔºåË°∞ÂèòÁ™óÂè£</p><blockquote><p>ÂÖ≥‰∫éÂÆπÂô®cpu loadÁöÑËØ¶ÁªÜ‰ªãÁªçÂèØ‰ª•ÁúãÂºïÁî®ÈìæÊé•</p></blockquote><h2 id="ÂØªÊ†πÊ∫ØÊ∫ê"><a href="#ÂØªÊ†πÊ∫ØÊ∫ê" class="headerlink" title="ÂØªÊ†πÊ∫ØÊ∫ê"></a>ÂØªÊ†πÊ∫ØÊ∫ê</h2><p>cpu loadÁöÑcd.loadAvgÂâçÂÄºÈÄöËøáÂ¶Ç‰∏ãÊñπÂºèËé∑ÂèñÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/google/cadvisor/blob/master/manager/container.go#L650</span><br><span class="line"></span><br><span class="line">if cd.loadReader != nil &#123;</span><br><span class="line">// TODO(vmarmol): Cache this path.</span><br><span class="line">path, err := cd.handler.GetCgroupPath(&quot;cpu&quot;)</span><br><span class="line">if err == nil &#123;</span><br><span class="line">loadStats, err := cd.loadReader.GetCpuLoad(cd.info.Name, path)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return fmt.Errorf(&quot;failed to get load stat for %q - path %q, error %s&quot;, cd.info.Name, path, err)</span><br><span class="line">&#125;</span><br><span class="line">stats.TaskStats = loadStats</span><br><span class="line">cd.updateLoad(loadStats.NrRunning)</span><br><span class="line">// convert to &#x27;milliLoad&#x27; to avoid floats and preserve precision.</span><br><span class="line">stats.Cpu.LoadAverage = int32(cd.loadAvg * 1000)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ê∑±ÂÖ•Êé¢Á©∂ÂèØ‰ª•ÂèëÁé∞‰ΩøÁî®‰∫ÜnetlinkÊù•Ëé∑ÂèñÁ≥ªÁªüÊåáÊ†áÔºåÂÖ≥ÈîÆË∞ÉÁî®Ë∑ØÂæÑ:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updateStats-&gt;GetCpuLoad-&gt;getLoadStats-&gt;prepareCmdMessage-&gt;prepareMessage</span><br></pre></td></tr></table></figure><p>ÁªèËøá‰∏äËø∞ÂàÜÊûêÂèØÁü•Ôºå cAdvisorÈÄöËøáÂèëÈÄÅCGROUPSTATS_CMD_GETËØ∑Ê±ÇÊù•Ëé∑ÂèñCPUË¥üËΩΩ‰ø°ÊÅØÔºåÈÄöËøánetlinkÊ∂àÊÅØËøõË°åÈÄö‰ø°Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cadvisor/utils/cpuload/netlink/netlink.go</span><br></pre></td></tr></table></figure><p>Âú®<code>v0.48.1</code>ÂàÜÊîØÁöÑÁ¨¨128Âà∞132Ë°åÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func prepareCmdMessage(id uint16, cfd uintptr) (msg netlinkMessage) &#123; </span><br><span class="line">buf := bytes.NewBuffer([]byte&#123;&#125;) </span><br><span class="line">addAttribute(buf, unix.CGROUPSTATS_CMD_ATTR_FD, uint32(cfd), 4) </span><br><span class="line">return prepareMessage(id, unix.CGROUPSTATS_CMD_GET, buf.Bytes()) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÊúÄÁªàÂÜÖÊ†∏Âú®<code>cgroupstats_user_cmd</code>‰∏≠Â§ÑÁêÜËé∑ÂèñËØ∑Ê±ÇÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/* user-&gt;kernel request/get-response */</span><br></pre></td></tr></table></figure><p><a href="https://github.com/torvalds/linux/blob/master/kernel/taskstats.c#L407"><code>kernel/taskstats.c#L407</code></a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">static int cgroupstats_user_cmd(struct sk_buff *skb, struct genl_info *info)</span><br><span class="line">&#123;</span><br><span class="line">int rc = 0;</span><br><span class="line">struct sk_buff *rep_skb;</span><br><span class="line">struct cgroupstats *stats;</span><br><span class="line">struct nlattr *na;</span><br><span class="line">size_t size;</span><br><span class="line">u32 fd;</span><br><span class="line">struct fd f;</span><br><span class="line"></span><br><span class="line">na = info-&gt;attrs[CGROUPSTATS_CMD_ATTR_FD];</span><br><span class="line">if (!na)</span><br><span class="line">return -EINVAL;</span><br><span class="line"></span><br><span class="line">fd = nla_get_u32(info-&gt;attrs[CGROUPSTATS_CMD_ATTR_FD]);</span><br><span class="line">f = fdget(fd);</span><br><span class="line">if (!f.file)</span><br><span class="line">return 0;</span><br><span class="line"></span><br><span class="line">size = nla_total_size(sizeof(struct cgroupstats));</span><br><span class="line"></span><br><span class="line">rc = prepare_reply(info, CGROUPSTATS_CMD_NEW, &amp;rep_skb,</span><br><span class="line">size);</span><br><span class="line">if (rc &lt; 0)</span><br><span class="line">goto err;</span><br><span class="line"></span><br><span class="line">na = nla_reserve(rep_skb, CGROUPSTATS_TYPE_CGROUP_STATS,</span><br><span class="line">sizeof(struct cgroupstats));</span><br><span class="line">if (na == NULL) &#123;</span><br><span class="line">nlmsg_free(rep_skb);</span><br><span class="line">rc = -EMSGSIZE;</span><br><span class="line">goto err;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stats = nla_data(na);</span><br><span class="line">memset(stats, 0, sizeof(*stats));</span><br><span class="line"></span><br><span class="line">rc = cgroupstats_build(stats, f.file-&gt;f_path.dentry);</span><br><span class="line">if (rc &lt; 0) &#123;</span><br><span class="line">nlmsg_free(rep_skb);</span><br><span class="line">goto err;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rc = send_reply(rep_skb, info);</span><br><span class="line"></span><br><span class="line">err:</span><br><span class="line">fdput(f);</span><br><span class="line">return rc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Âπ∂Âú®<code>cgroupstats_build</code>ÂáΩÊï∞‰∏≠ÊûÑÂª∫cgroup statsÁªìÊûúÔºö</p><p><a href="https://github.com/torvalds/linux/blob/5c1ee569660d4a205dced9cb4d0306b907fb7599/kernel/cgroup/cgroup-v1.c#L699"><code>kernel/cgroup/cgroup-v1.c#L699</code></a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * cgroupstats_build - build and fill cgroupstats</span><br><span class="line"> * @stats: cgroupstats to fill information into</span><br><span class="line"> * @dentry: A dentry entry belonging to the cgroup for which stats have</span><br><span class="line"> * been requested.</span><br><span class="line"> *</span><br><span class="line"> * Build and fill cgroupstats so that taskstats can export it to user</span><br><span class="line"> * space.</span><br><span class="line"> *</span><br><span class="line"> * Return: %0 on success or a negative errno code on failure</span><br><span class="line"> */</span><br><span class="line">int cgroupstats_build(struct cgroupstats *stats, struct dentry *dentry)</span><br><span class="line">&#123;</span><br><span class="line">‚Ä¶‚Ä¶</span><br><span class="line">/* it should be kernfs_node belonging to cgroupfs and is a directory */</span><br><span class="line">if (dentry-&gt;d_sb-&gt;s_type != &amp;cgroup_fs_type || !kn ||</span><br><span class="line">    kernfs_type(kn) != KERNFS_DIR)</span><br><span class="line">return -EINVAL;  // ÂØºËá¥ËøîÂõûEINVALÈîôËØØÁ†Å</span><br></pre></td></tr></table></figure><p>ËøôÈáåÂèØ‰ª•ÂèëÁé∞<code>cgroup_fs_type</code>ÊòØcgroup v1ÁöÑÁ±ªÂûãÔºåËÄåÊ≤°ÊúâÂ§ÑÁêÜcgroup v2„ÄÇÂõ†Ê≠§Ôºå<code>cgroupstats_build</code>ÂáΩÊï∞Âú®Ë∑ØÂæÑÁ±ªÂûãÂà§Êñ≠ËØ≠Âè•‰∏äËøîÂõûEINVAL„ÄÇ</p><p>Âú®ÂÜÖÊ†∏Á§æÂå∫‰πüÊúâÁõ∏ÂÖ≥ÈóÆÈ¢òÁöÑËØ¥ÊòéÔºö<a href="https://lore.kernel.org/all/20200910055207.87702-1-zhouchengming@bytedance.com/T/#r50c826a171045e42d0b40a552e0d4d1b2a2bab4d">kernel community issue</a></p><p>ÈÇ£‰πàÊàë‰ª¨ÁúãÁúãtejun(metaÔºåcgroupv2 owner)Â¶Ç‰ΩïËß£ÈáäÁöÑÔºö</p><blockquote><p>The exclusion of cgroupstats from v2 interface was intentional due to the duplication and inconsistencies with other statistics. If you need these numbers, please justify and add them to the appropriate cgroupfs stat file.</p></blockquote><p>ÁÆÄÂçïÁøªËØëÔºöÂØπv2Êé•Âè£‰∏≠ÊéíÈô§cgroupstatsÁöÑÊìç‰ΩúÊòØÊúâÊÑèÁöÑÔºåÂõ†‰∏∫ÂÆÉ‰∏éÂÖ∂‰ªñÁªüËÆ°Êï∞ÊçÆÂ≠òÂú®ÈáçÂ§çÂíå‰∏ç‰∏ÄËá¥‰πãÂ§Ñ„ÄÇ</p><h2 id="ÁªìËÆ∫"><a href="#ÁªìËÆ∫" class="headerlink" title="ÁªìËÆ∫"></a>ÁªìËÆ∫</h2><p>ÈÇ£‰πà‰ªñÁöÑÂª∫ËÆÆÊòØ‰ªÄ‰πàÔºü</p><p>‰ªñÂª∫ËÆÆÊàë‰ª¨‰ΩøÁî®psiÔºåËÄå‰∏çÊòØÈÄöËøáCGROUPSTATS_CMD_GET netlink apiËé∑ÂèñCPUÁªüËÆ°‰ø°ÊÅØÔºåÁõ¥Êé•‰ªé<code>cpu.pressure</code>„ÄÅ<code>memory.pressure</code>‰ª•Âèä<code>io.pressure</code>Êñá‰ª∂‰∏≠Ëé∑ÂèñÔºåÂêéÁª≠Êàë‰ª¨‰ºö‰ªãÁªçpsiÂú®ÂÆπÂô®È¢ÜÂüüÁöÑÁõ∏ÂÖ≥ËøõÂ±ïÔºåÂΩìÂâçContainerdÂ∑≤ÁªèÊîØÊåÅPSIÁõ∏ÂÖ≥ÁõëÊéß.</p><h2 id="ÂèÇËÄÉÈìæÊé•"><a href="#ÂèÇËÄÉÈìæÊé•" class="headerlink" title="ÂèÇËÄÉÈìæÊé•"></a>ÂèÇËÄÉÈìæÊé•</h2><ol><li><a href="https://github.com/containerd/cgroups/pull/308">https://github.com/containerd/cgroups/pull/308</a></li><li><a href="https://cloud.tencent.com/developer/article/2329489">https://cloud.tencent.com/developer/article/2329489</a></li><li><a href="https://github.com/google/cadvisor/issues/3137">https://github.com/google/cadvisor/issues/3137</a></li><li><a href="https://www.cnblogs.com/vinsent/p/15830271.html">https://www.cnblogs.com/vinsent/p/15830271.html</a></li><li><a href="https://lore.kernel.org/all/20200910055207.87702-1-zhouchengming@bytedance.com/T/#r50c826a171045e42d0b40a552e0d4d1b2a2bab4d">https://lore.kernel.org/all/20200910055207.87702-1-zhouchengming@bytedance.com/T/#r50c826a171045e42d0b40a552e0d4d1b2a2bab4d</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;‰∏ÄÊù°K8sÂëΩ‰ª§Ë°åÂºïÂèëÁöÑË°ÄÊ°à&quot;&gt;&lt;a href=&quot;#‰∏ÄÊù°K8sÂëΩ‰ª§Ë°åÂºïÂèëÁöÑË°ÄÊ°à&quot; class=&quot;headerlink&quot; title=&quot;‰∏ÄÊù°K8sÂëΩ‰ª§Ë°åÂºïÂèëÁöÑË°ÄÊ°à&quot;&gt;&lt;/a&gt;‰∏ÄÊù°K8sÂëΩ‰ª§Ë°åÂºïÂèëÁöÑË°ÄÊ°à&lt;/h2&gt;&lt;h2 id=&quot;ÈóÆÈ¢òÊèèËø∞&quot;&gt;&lt;a href=&quot;#ÈóÆÈ¢òÊèèËø∞&quot;</summary>
      
    
    
    
    <category term="‰∫ëÂéüÁîüÈù¢ËØïÊ°à‰æã50ÁØá" scheme="https://zoues.com/categories/%E4%BA%91%E5%8E%9F%E7%94%9F%E9%9D%A2%E8%AF%95%E6%A1%88%E4%BE%8B50%E7%AF%87/"/>
    
    
    <category term="cloudnative" scheme="https://zoues.com/tags/cloudnative/"/>
    
    <category term="kubernetes" scheme="https://zoues.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>Rust vs. ZigÔºöÁ©∂Á´üË∞ÅÊõ¥ËÉú‰∏ÄÁ≠πÔºüÊÄßËÉΩ„ÄÅÂÆâÂÖ®ÊÄßÁ≠âÂÖ®Èù¢ÂØπÂÜ≥ÔºÅ</title>
    <link href="https://zoues.com/posts/423bdf96/"/>
    <id>https://zoues.com/posts/423bdf96/</id>
    <published>2024-01-21T12:23:48.000Z</published>
    <updated>2024-02-03T06:32:45.374Z</updated>
    
    <content type="html"><![CDATA[<p>RustÂíåZigÔºåËøô‰∏§ÁßçËØ≠Ë®ÄÈÉΩÊó®Âú®ÁºñÂÜôÈ´òÊïà„ÄÅÊÄßËÉΩ‰ºòÂºÇÁöÑ‰ª£Á†ÅÔºåÁÑ∂ËÄåÂÆÉ‰ª¨Âú®ÂÆûÁé∞Ëøô‰∏ÄÁõÆÊ†áÊó∂ÈááÁî®‰∫Ü‰∏çÂêåÁöÑÊñπÂºè„ÄÇ</p><p>ÂÄºÂæóÊ≥®ÊÑèÁöÑÊòØÔºåRustÂíåZigÊ†πÊ§ç‰∫éÊà™ÁÑ∂‰∏çÂêåÁöÑÁêÜÂøµÔºåËøôÂèØËÉΩÂΩ±ÂìçÂºÄÂèëËÄÖÈÄâÊã©Êó∂ÁöÑÂèñËàç„ÄÇ‰∏∫‰∫ÜÊõ¥Ê∑±ÂÖ•Âú∞‰∫ÜËß£ÂÆÉ‰ª¨Âú®Áõ∏‰∫íÊØîËæÉ‰∏≠ÁöÑË°®Áé∞ÔºåÊàë‰ª¨Â∞ÜËøõ‰∏ÄÊ≠•Êé¢ËÆ®ÂÆÉ‰ª¨ÂêÑËá™ÁöÑÁâπÁÇπ„ÄÇ</p><h2 id="‰ªÄ‰πàÊòØRustÔºü"><a href="#‰ªÄ‰πàÊòØRustÔºü" class="headerlink" title="‰ªÄ‰πàÊòØRustÔºü"></a>‰ªÄ‰πàÊòØRustÔºü</h2><p>RustÊòØ‰∏ÄÁßç‰ª•ÊïàÁéá„ÄÅÊÄßËÉΩÂíåÂÜÖÂ≠òÂÆâÂÖ®ËëóÁß∞ÁöÑÈÄöÁî®ÂûãÁºñÁ®ãËØ≠Ë®Ä„ÄÇÂÆÉÂºïÂÖ•‰∫Ü‰∏ÄÁßçÊñ∞ÁöÑÁºñÁ®ãÊñπÂºèÔºå‰ΩøÂºÄÂèëËÄÖ‰ªçÁÑ∂ËÉΩÂ§ü‰ΩøÁî®Èù¢ÂêëÂØπË±°‰ª•ÂèäÂáΩÊï∞ÂºèÁºñÁ®ã„ÄÇ</p><p>‰ΩøÁî®RustËøõË°åÁºñÁ†ÅÈúÄË¶Å‰∏ÄÁßç‰∏çÂêåÂæÄÂ∏∏ÁöÑÊÄùÁª¥ÊñπÂºèÔºåËøôÈÉ®ÂàÜ‰∏ªË¶ÅÂõ¥ÁªïÁùÄËØ≠Ë®ÄËßÑÂàô‰∏≠ÁöÑÊâÄÊúâÊùÉÂíåÂÄüÁî®Â±ïÂºÄ„ÄÇ</p><p>ËôΩÁÑ∂ËøôÁßçÊÄùÁª¥ÊñπÂºèËÉΩÂ§üËÆ©ÂºÄÂèëËÄÖÊõ¥ÂÆπÊòìÁºñÂÜôÂá∫ÂÆâÂÖ®È´òÊïàÁöÑ‰ª£Á†ÅÔºå‰ΩÜ‰∏éCÂíåC++Á≠âËØ≠Ë®ÄÁõ∏ÊØîÔºåÁâπÂà´ÊòØÂØπ‰∫éÊñ∞ÊâãÊù•ËØ¥ÔºåÂÖÖÊª°ÊåëÊàòÊÄß„ÄÇ</p><p>RustÊ∂àÈô§‰∫ÜCÂíåC++Ë∑®Âπ≥Âè∞ÁöÑÈôêÂà∂ÔºåÂÖÅËÆ∏Â∞Ü‰ª£Á†ÅÁºñËØë‰∏∫ÁõÆÊ†áÁ≥ªÁªüËøêË°åÁöÑÂèØÊâßË°åÊñá‰ª∂„ÄÇËøôÊÑèÂë≥ÁùÄÂèØ‰ª•Âú®‰∏çÂÅöÈáçÂ§ß‰øÆÊîπÁöÑÊÉÖÂÜµ‰∏ãÂ∞Ü‰ª£Á†ÅÁºñËØë‰∏∫Â§öÁ≥ªÁªüÁâàÊú¨„ÄÇ</p><p>ËÆ©Êàë‰ª¨Áúã‰∏Ä‰∏™RustÁâàÁöÑHello worldÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let text: &amp;str = &quot;World&quot;;</span><br><span class="line">    println!(&quot;Hello, &#123;&#125;!&quot;, text);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Á±ª‰ºº‰∫éÂÖ∂‰ªñÁºñËØëÂûãÁºñÁ®ãËØ≠Ë®ÄÔºåÂú®Rust‰∏≠ÔºåÊØè‰∏™ÂèØÊâßË°åÁ®ãÂ∫èÂêåÊ†∑‰πüÈÉΩ‰ªémainÂáΩÊï∞ÂºÄÂßã„ÄÇÂ¶ÇÊûúËøêË°å‰∏äËø∞Á§∫‰æãÔºåÂ∞ÜÂú®‰Ω†ÁöÑÁªàÁ´Ø‰∏äËæìÂá∫‚ÄúHello, World!‚Äù„ÄÇ</p><h3 id="Rust‰ºòÂäø‰∏éÁü≠Êùø"><a href="#Rust‰ºòÂäø‰∏éÁü≠Êùø" class="headerlink" title="Rust‰ºòÂäø‰∏éÁü≠Êùø"></a>Rust‰ºòÂäø‰∏éÁü≠Êùø</h3><p>Âú®Rust‰∏≠Ôºå‰∏Ä‰∫õÁâπÊÄßÂØπÂºÄÂèëËÄÖÊòØÊúâÁõäÁöÑÔºåËÄåÂè¶‰∏Ä‰∫õÂàôËÆ©ÂºÄÂèëÂèòÂæóÊõ¥ÂÖ∑ÊåëÊàòÊÄß„ÄÇÂú®Ëøô‰∏ÄÁ´†ËäÇÔºåÊàë‰ª¨Â∞ÜÂàÜÂà´‰ªãÁªç‰∏Ä‰∏ãRustÁöÑ‰ºòÂäø‰∏éÂä£Âäø„ÄÇ</p><p>RustÁöÑ‰∏Ä‰∫õ<strong>‰ºòÂäø</strong>ÂåÖÊã¨‰ª•‰∏ãÂá†ÁÇπÔºö</p><ul><li><p>Âπ∂ÂèëÂíåÂπ∂Ë°åÔºöRustÂÜÖÁΩÆÂØπÂπ∂Ë°åÁºñÁ®ãÁöÑÊîØÊåÅÔºå‰ª•ÂèäÂÆâÂÖ®È´òÊïàÁöÑÂ§öÁ∫øÁ®ãÁâπÊÄß</p></li><li><p>ÊÄßËÉΩÔºöÁî±‰∫éRust‰ª£Á†Å‰∏çÈúÄË¶ÅËøêË°åÊó∂ÔºåÂêåÊó∂ÂÆÉ‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÁöÑÂûÉÂúæÂõûÊî∂Âô®ÂäüËÄóÔºå‰ªéËÄåÂèØ‰ª•‰ΩøÁî®Êõ¥Â∞ëÁöÑËµÑÊ∫êÂπ∂ÊèêÈ´òÊÄßËÉΩÔºå</p></li><li><p>ÂÜÖÂ≠òÂÆâÂÖ®‰∏îÊó†ÂûÉÂúæÂõûÊî∂ÔºöÁî±‰∫éÊâÄÊúâÊùÉÂíåÂÄüÁî®Á≠âËßÑÂàôÔºåRustÂú®Ê≤°ÊúâÂûÉÂúæÂõûÊî∂Âô®ÁöÑÊÉÖÂÜµ‰∏ãÁÆ°ÁêÜÂÜÖÂ≠òÔºå‰ªéËÄåÂÆûÁé∞Êõ¥È´òÊïàÂíåÂèØÈ¢ÑÊµãÁöÑÊÄßËÉΩ</p></li><li><p>Ë∑®Âπ≥Âè∞ÂÖºÂÆπÊÄßÔºöRustÊîØÊåÅË∑®Âπ≥Âè∞ÂºÄÂèëÔºåÊÑèÂë≥ÁùÄÂèØ‰ª•Âú®Â§ö‰∏™Á≥ªÁªü‰∏äÁºñËØë‰ª£Á†ÅËÄå‰∏çÈúÄË¶ÅÂ§™Â§öÁöÑ‰øÆÊîπ‰ª£Á†Å</p></li><li><p>Âº∫Â§ßÁöÑÁîüÊÄÅÁ≥ªÁªüÔºöRustÊã•ÊúâÂº∫Â§ßÁöÑÂ∑•ÂÖ∑ÂíåÂ∫ìÁîüÊÄÅÁ≥ªÁªü„ÄÇÂÆÉÁöÑÂåÖÁÆ°ÁêÜÂô®CargoÊòæËëóÁÆÄÂåñ‰∫Ü‰æùËµñÁÆ°ÁêÜÂíå‰∏éÂ§ñÈÉ®Â∫ìÈõÜÊàêÁöÑÈöæÂ∫¶</p></li></ul><p>RustÁöÑ‰∏Ä‰∫õ<strong>Âä£Âäø</strong>ÂåÖÊã¨‰ª•‰∏ãÂá†ÁÇπÔºö</p><ul><li><p>Â≠¶‰π†Êõ≤Á∫øÔºöRustÁöÑËØ≠Ê≥ïÂØπÊñ∞ÂºÄÂèëËÄÖÂèØËÉΩÊúâ‰∫õÊ£òÊâã„ÄÇÂÖ∂ËØ≠Ê≥ïËûçÂêà‰∫ÜÂáΩÊï∞ÂºèÂíåÁ≥ªÁªüÁºñÁ®ãÔºåÂèóÊâÄÊúâÊùÉÂíåÂÄüÁî®ËßÑÂàôÁöÑÂΩ±ÂìçÂæàÂ§ß„ÄÇÊ≠§Â§ñÔºåÊñ∞ÂºÄÂèëËÄÖËøòÂøÖÈ°ªÂ≠¶‰π†ÊâÄÊúâÊùÉÁ≥ªÁªü„ÄÅÁîüÂëΩÂë®ÊúüÂíåÂÄüÁî®ËßÑÂàôÁ≠âÊ¶ÇÂøµÔºåÈúÄË¶Å‰ªòÂá∫‰∏ÄÂÆöÁöÑÂä™Âäõ Ôºå‰∏ãÂõæÊòØÊµÅ‰º†ÁîöÂπøÁöÑ‰∏ÄÂº†Â≠¶‰π†Êõ≤Á∫øÂõæ(Êù•Ê∫ê‰∫éÊûÅÂÆ¢ÈÇ¶)</p><p><img src="https://pic.imgdb.cn/item/65ad10c7871b83018ac90c50.png" alt="Rust ÁºñÁ®ãÁ¨¨‰∏ÄËØæÔºåÂÆûÊàòÈ©±Âä®ÔºåÂø´ÈÄü‰∏äÊâã Rust"></p></li><li><p>ÁºñËØëËÄóÊó∂ÔºöRustÁöÑÂÆâÂÖ®ÈúÄÊ±ÇÂØºËá¥ËæÉÈïøÁöÑÁºñËØëÊó∂Èó¥„ÄÇRust‰ºöÂΩªÂ∫ïÊ£ÄÊü•‰Ω†ÁöÑ‰ª£Á†Å‰ª•Èò≤Ê≠¢ËøêË°åÊó∂ÂèØËÉΩÂá∫Áé∞ÁöÑÈóÆÈ¢òÔºåËøôÊÑèÂë≥ÁùÄÂÆÉÁöÑÁºñËØëÊó∂Èó¥‰ºöÊØîÂ§ßÂ§öÊï∞ËØ≠Ë®ÄÊõ¥Èïø</p></li><li><p>ÊúâÈôêÁöÑËµÑÊ∫êÔºöÂ∞ΩÁÆ°CargoÊòØ‰∏Ä‰∏™ÊúâÁî®ÁöÑÂåÖÁÆ°ÁêÜÂô®ÔºåÊèê‰æõ‰∫ÜËÆ∏Â§öÂèØÁî®ÁöÑÂ∑•ÂÖ∑ÂíåÂ∫ìÔºå‰ΩÜ‰ªéÊï¥‰ΩìÊù•ÁúãÔºåRustÁöÑÁîüÊÄÅÁ≥ªÁªüÁõ∏ËæÉÂ§ßÂ§öÊï∞ËØ≠Ë®ÄÊù•ËØ¥ÈÉΩ‰∏çÂ§üÊàêÁÜü„ÄÇÂú®‰∏Ä‰∫õ‰∏ì‰∏öÈ¢ÜÂüüÔºåRustÁöÑËµÑÊ∫êÂèØËÉΩËæÉÂ∞ëÔºåËø´‰ΩøÂºÄÂèëËÄÖÊõ¥Â§öÂú∞‰ªéÈõ∂ÂºÄÂßãÁºñÂÜô‰ª£Á†Å</p></li><li><p>ÁπÅÁêêÁöÑÂºÄÂèëËøáÁ®ãÔºöÁî±‰∫éÂº∫Ë∞ÉÂÆâÂÖ®ÂíåÂáÜÁ°ÆÊÄßÔºå‰ΩøÁî®‰∏•Ê†ºÁöÑËßÑÂàôÂíåÊòéÁ°ÆÊÄßÔºåÂºÄÂèëËÄÖÈÄöÂ∏∏Âú®Rust‰∏≠ÈúÄË¶ÅÁºñÂÜôÊõ¥Â§öÁöÑ‰ª£Á†ÅÔºåËôΩÁÑ∂ÂèØËÉΩ‰ºöÊúâÈ´òË¥®ÈáèÁöÑËæìÂá∫Ôºå‰ΩÜÂæÄÂæÄ‰ºö‰ΩøÂºÄÂèëËøáÁ®ãÂèòÂæóÊõ¥ÈïøÔºåÂØπÂ∞èÈ°πÁõÆÂΩ±ÂìçÊòæËëó</p></li><li><p>‰∫íÊìç‰ΩúÊÄßÔºöÂ∞ÜRust‰ª£Á†ÅÊï¥ÂêàÂà∞ÂÖ∂‰ªñËØ≠Ë®ÄÁºñÂÜôÁöÑ‰ª£Á†Å‰∏≠ÂèØËÉΩÊúâ‰∫õÂõ∞Èöæ„ÄÇ</p></li></ul><p>ËôΩÁÑ∂RustÊúâÂÖ∂Âä£ÂäøÔºå‰ΩÜÂÆÉ‰ªçÁÑ∂ÊòØÂºÄÂèëËÄÖÁöÑÁÉ≠Èó®ÈÄâÊã©„ÄÇÂú®2023Âπ¥Stack OverflowÂºÄÂèëËÄÖË∞ÉÊü•‰∏≠ÔºåRustËç£Ëé∑ÊúÄÂèóÂñúÁà±ÁöÑËØ≠Ë®ÄÁöÑÊ°ÇÂÜ†ÔºåË∂ÖËøá80%ÁöÑÂèóËÆøËÄÖË°®Á§∫ÊòéÂπ¥‰ªçÁÑ∂ÊÉ≥Ë¶Å‰ΩøÁî®ÂÆÉ„ÄÇ</p><h3 id="RustÁöÑÂ∏∏ËßÅ‰ΩøÁî®Âú∫ÊôØ"><a href="#RustÁöÑÂ∏∏ËßÅ‰ΩøÁî®Âú∫ÊôØ" class="headerlink" title="RustÁöÑÂ∏∏ËßÅ‰ΩøÁî®Âú∫ÊôØ"></a>RustÁöÑÂ∏∏ËßÅ‰ΩøÁî®Âú∫ÊôØ</h3><p>Êó¢ÁÑ∂‰Ω†Â∑≤Áªè‰∫ÜËß£‰∫ÜRustÁöÑÂäüËÉΩÔºåËÆ©Êàë‰ª¨ÁúãÁúãÂÆÉÂ∑≤ÁªèÂú®Âì™‰∫õÂú∫ÊôØËêΩÂú∞„ÄÇ</p><ul><li><p>Âú®Á≥ªÁªüÁºñÁ®ã‰∏≠ÔºåRustÂØπ‰∫éÊûÑÂª∫Êìç‰ΩúÁ≥ªÁªü„ÄÅÊï∞ÊçÆÂ∫ìÁ≥ªÁªü„ÄÅËÆæÂ§áÈ©±Âä®Á®ãÂ∫èÂíåÂµåÂÖ•ÂºèÁ≥ªÁªüÁ≠âÂú∫ÊôØÈùûÂ∏∏ÊúâÁî®„ÄÇ</p></li><li><p>ÂâçÂêéÁ´ØWebÂºÄÂèëËÄÖ‰πü‰ΩøÁî®RustÔºå‰∏éÂÉèRocketÊàñActixËøôÊ†∑ÁöÑÊµÅË°åÊ°ÜÊû∂‰∏ÄËµ∑ËøõË°åÂêéÁ´ØÂºÄÂèëÔºå‰ª•Âèä‰ΩøÁî®WebAssemblyÊàñTauriËøõË°åÂâçÁ´ØÂºÄÂèë„ÄÇ</p></li></ul><p>RustËøòË¢´Áî®‰∫éÁΩëÁªúÊúçÂä°ÔºåÂ¶ÇÁΩëÁªúÂçèËÆÆ„ÄÅ‰ª£ÁêÜ„ÄÅË¥üËΩΩÂùáË°°Âô®„ÄÅVPNËΩØ‰ª∂Á≠â„ÄÇ</p><p>‰∏Ä‰∫õRustÁöÑÊõ¥‰∏ì‰∏öÁî®‰æãÂåÖÊã¨Ôºö</p><ul><li>Ê∏∏ÊàèÂºÄÂèëÔºå‰ΩøÁî®ÂÉèAmethystÂíåBevyËøôÊ†∑ÁöÑÊ∏∏ÊàèÂºïÊìé</li><li>Âú®Âå∫ÂùóÈìæÂíåÂä†ÂØÜË¥ßÂ∏ÅÈ¢ÜÂüüÔºåÁî®‰∫éÂºÄÂèëÊô∫ËÉΩÂêàÁ∫¶ÂíåÈ°πÁõÆ‰∏≠ÁöÑÂå∫ÂùóÈìæÁΩëÁªúÔºåÂ¶ÇSolana Âú®Áâ©ËÅîÁΩëÔºàIoTÔºâ‰∏≠ÔºåÁî®‰∫éÁºñÁ®ãÂæÆÊéßÂà∂Âô®Âíå‰º†ÊÑüÂô®Á≠âËÆæÂ§á</li></ul><h2 id="‰ªÄ‰πàÊòØZigÔºü"><a href="#‰ªÄ‰πàÊòØZigÔºü" class="headerlink" title="‰ªÄ‰πàÊòØZigÔºü"></a>‰ªÄ‰πàÊòØZigÔºü</h2><p>ËôΩÁÑ∂ZigÊõ¥Á±ª‰ºº‰∫é‰º†ÁªüÁöÑÁºñÁ®ãËØ≠Ë®ÄÔºåÂ¶ÇCÂíåC++Ôºå‰ΩÜÂÆÉÂÉèRust‰∏ÄÊ†∑Ê≥®ÈáçÂÜÖÂ≠òÂÆâÂÖ®ÂíåÊïàÁéá„ÄÇÁÑ∂ËÄåÔºå‰∏éRust‰∏çÂêåÁöÑÊòØÔºåZig‰∏éÁé∞ÊúâÁöÑCÂíåC++‰ª£Á†ÅÊï¥ÂêàËâØÂ•ΩÔºåÊó†ÈúÄÂÉèFFIËøôÊ†∑ÁöÑÂ§ñÈÉ®Êú∫Âà∂Êù•ÁÆÄÂåñ‰∫íÊìç‰ΩúÊÄß„ÄÇ</p><p>‰∏éRust„ÄÅCÂíåC++‰∏ÄÊ†∑ÔºåZig‰∏ç‰ΩøÁî®ÂûÉÂúæÊî∂ÈõÜÂô®„ÄÇ‰∏∫‰∫ÜÂÆûÁé∞Á±ª‰ººRustÁöÑÂÜÖÂ≠òÂÆâÂÖ®ÊÄßÔºåZigÊèê‰æõ‰∫Ü‰øÉËøõÂÜÖÂ≠òÂÆâÂÖ®ÁöÑÊú∫Âà∂Ôºå‰æãÂ¶ÇÔºö</p><ul><li>‰∏•Ê†ºÁöÑÁºñËØëÊó∂Ê£ÄÊü•</li><li>Áî®‰∫éÂ§ÑÁêÜÊΩúÂú®Á©∫ÂÄºÁöÑÂèØÈÄâÁ±ªÂûã</li><li>Â∏¶ÊúâErrorÁ±ªÂûãÁöÑÊòéÁ°ÆÈîôËØØÂ§ÑÁêÜ</li><li>ÂÜÖÁΩÆÂàÜÈÖçÂô®ÁöÑÂ¢ûÂº∫ÂÜÖÂ≠òÂàÜÈÖç</li></ul><p>Ëøô‰∫õÊú∫Âà∂‰∏ç‰ºöÂÉèRust‰∏≠ÈÇ£Ê†∑‰∏•ÈáçÂΩ±ÂìçÁºñÁ†Å‰π†ÊÉØ„ÄÇËÆ©Êàë‰ª¨Áúã‰∏Ä‰∏™Zig‰∏≠ÁöÑHello world‰æãÂ≠êÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zigCopy codeconst std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    std.debug.print(&quot;Hello, world&quot;, .&#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂØπÂºÄÂèëËÄÖÊù•ËØ¥ÔºåËÆ∏Â§öÁºñÁ®ãËØ≠Ë®ÄËÉåÂêéÈÉΩÊúâ‰∏ÄÁßçÁêÜÂøµÂíåËÆæËÆ°Âì≤Â≠¶„ÄÇ‰æãÂ¶ÇÔºåRustÊ≥®ÈáçÂÜÖÂ≠òÂÆâÂÖ®ÊÄß„ÄÅÊïàÁéá„ÄÅÊó†ÂûÉÂúæÊî∂ÈõÜÂíåÊÄßËÉΩ„ÄÇ</p><p>ÈÇ£‰πàZigÂë¢ÔºüÂÆÉÁöÑÂì≤Â≠¶ÂåÖÊã¨Ôºö</p><ul><li>‰∏éCÂíåC++‰ª£Á†ÅËΩªÊùæÊï¥Âêà</li><li>ÁîüÊàê‰∏ç‰æùËµñÁ≥ªÁªü‰æùËµñÈ°πÁöÑÁã¨Á´ã‰∫åËøõÂà∂Êñá‰ª∂</li><li>ËΩªÊùæÁöÑË∑®Âπ≥Âè∞ÂºÄÂèë</li><li>Âø´ÈÄüÁöÑÁºñËØëÊó∂Èó¥</li></ul><p>Êé•‰∏ãÊù•ÔºåÊàë‰ª¨Â∞ÜÁúã‰∏ÄÁúãZigÁöÑ‰ºòÂäøÂíåÂä£ÂäøÔºå‰πãÂêéÂÜçÁúãÂÆÉÁöÑÁî®‰æã„ÄÇ</p><h3 id="ZigÁöÑ‰ºòÂäø‰∏éÁü≠Êùø"><a href="#ZigÁöÑ‰ºòÂäø‰∏éÁü≠Êùø" class="headerlink" title="ZigÁöÑ‰ºòÂäø‰∏éÁü≠Êùø"></a>ZigÁöÑ‰ºòÂäø‰∏éÁü≠Êùø</h3><p>‰∏éÊàë‰ª¨Âú®Rust‰∏≠ÊâÄÂÅöÁöÑ‰∏ÄÊ†∑ÔºåËÆ©Êàë‰ª¨‰ªé‰ºòÂäøÂºÄÂßãÔºåÁÑ∂ÂêéÂÜçÁúãÂä£Âäø„ÄÇ</p><p>Zig‰∏∫ÂºÄÂèëËÄÖÊèê‰æõÁöÑ‰∏Ä‰∫õÂ•ΩÂ§ÑÂåÖÊã¨Ôºö</p><ul><li><p>ÊéßÂà∂Âíå‰ΩéÁ∫ßËÉΩÂäõÔºöZigÈùûÂ∏∏ÈÄÇÂêàÁ≥ªÁªüÁºñÁ®ãÂíåÈúÄË¶ÅÁõ¥Êé•ÁÆ°ÁêÜÁ≥ªÁªüËµÑÊ∫êÁöÑÊÉÖÂú∫ÊôØ</p></li><li><p>ÂÆâÂÖ®ÂäüËÉΩÔºöÂÜÖÁΩÆÂàÜÈÖçÂô®Á≠âÂäüËÉΩ‰ΩøÂºÄÂèëËÄÖËÉΩÂ§üËΩªÊùæÈò≤Ê≠¢ÈîôËØØÔºåÊèêÈ´ò‰ª£Á†ÅÂèØÈù†ÊÄßÔºåÂπ∂ÂáèÂ∞ëÈîôËØØÂíåÊºèÊ¥û</p></li><li><p>ÊÄßËÉΩ‰ºòÂåñÔºöZigÊòØ‰∏Ä‰∏™‰∏∫È´òÊïàÊâßË°åÂíåÊÄßËÉΩË∞É‰ºòËÄå‰ºòÂåñ‰ª£Á†ÅÁöÑÂ∑•ÂÖ∑„ÄÇÂÆÉÊèê‰æõÊâãÂä®ÂÜÖÂ≠òÁÆ°ÁêÜ„ÄÅÁºñËØëÊó∂Ê£ÄÊü•‰ª•ÂèäÁõ¥Êé•ËÆøÈóÆCPUÊåá‰ª§ÁöÑÂäüËÉΩÔºå‰ª•ÂÆûÁé∞Êõ¥È´òÊÄßËÉΩÁöÑÂ∫îÁî®Á®ãÂ∫è</p></li><li><p>ÁÆÄÂçïÂíåÂèØËØªÊÄßÔºöZigÂÖ∑Êúâ‰∏éCÁ±ª‰ººÁöÑÁÆÄÂçïËØ≠Ê≥ïÂíåËØ≠Ë®ÄËÆæËÆ°„ÄÇËøô‰ΩøÂæóÈòÖËØª„ÄÅÁºñÂÜôÂíåÁª¥Êä§‰ª£Á†ÅÂèòÂæóÁÆÄÂçï</p></li><li><p>ÊúÄÂ∞èÁöÑÂ§ñÈÉ®‰æùËµñÔºöZigÊúÄÂ∞èÂåñ‰∫ÜÊûÑÂª∫ÂíåËøêË°åÁ®ãÂ∫èÊâÄÈúÄÁöÑÂ§ñÈÉ®‰æùËµñÔºåÁÆÄÂåñ‰∫ÜÂºÄÂèëÔºåÂ¢ûÂº∫‰∫ÜÂèØÁßªÊ§çÊÄßÔºåÂπ∂ÂáèËΩª‰∫ÜË∑®Âπ≥Âè∞‰æùËµñÁÆ°ÁêÜÁöÑË¥üÊãÖ</p></li><li><p>ÂÖÉÁºñÁ®ãËÉΩÂäõÔºöZigÁöÑÁºñËØëÊó∂ÂÖÉÁºñÁ®ãÈÄöËøáÂáèÂ∞ëÊ†∑Êùø‰ª£Á†ÅÁöÑÈúÄÊ±ÇÂíåÂêØÁî®‰ª£Á†Å‰ºòÂåñÊù•ÊèêÈ´ò‰ª£Á†ÅÁöÑÁÅµÊ¥ªÊÄßÂíåÁîü‰∫ßÂäõ</p></li></ul><p>ZigÁöÑ‰∏Ä‰∫õÂä£ÂäøÂåÖÊã¨Ôºö</p><ul><li>ÊúâÈôêÁöÑÁîüÊÄÅÁ≥ªÁªüÔºöÂõ†‰∏∫ÂÆÉ‰ªçÂ§Ñ‰∫éÊó©ÊúüÈò∂ÊÆµÔºåZigËØ≠Ë®ÄÁöÑÁîüÊÄÅÁ≥ªÁªüÊØîÊàêÁÜüËØ≠Ë®ÄÊõ¥Â∞è</li><li>Â≠¶‰π†Êõ≤Á∫øÔºöÂØπ‰∫é‰∏çÁÜüÊÇâ‰ΩéÁ∫ßÁºñÁ®ãÊ¶ÇÂøµÁöÑÂºÄÂèëËÄÖÊù•ËØ¥ÔºåÁêÜËß£ZigÂèØËÉΩÈúÄË¶Å‰∏Ä‰∫õÊó∂Èó¥ ÔºàÁõ∏ËæÉRustÊù•ËØ¥ÔºåÊâÄÈúÄÁöÑÊó∂Èó¥ÂæàÁü≠Ôºâ</li><li>ÊàêÁÜüÂ∫¶ÂíåÂ∑•ÂÖ∑ÔºöZigÊòØ‰∏ÄÁßçÊñ∞ËØ≠Ë®ÄÔºåËøòÊúâÊîπËøõÁöÑÁ©∫Èó¥„ÄÇ‰ΩÜËØ∑Ê≥®ÊÑèÔºå‰ªçÁÑ∂Êúâ‰∏Ä‰∏™Âº∫Â§ßËÄåÊ¥ªË∑ÉÁöÑÁ§æÂå∫ÊîØÊåÅÂÆÉ</li><li>‰∫íÊìç‰ΩúÊÄßÊåëÊàòÔºöZigÊèê‰æõ‰∫ÜÁî®‰∫éÂÖºÂÆπÊÄßÁöÑCÊé•Âè£Ôºå‰ΩÜ‰∏éÂÖ∂‰ªñËØ≠Ë®ÄÈõÜÊàêÂèØËÉΩÈúÄË¶ÅÈ¢ùÂ§ñÁöÑÂ∑•‰ΩúÔºåÊØîÂ¶ÇÁÆ°ÁêÜÊï∞ÊçÆËΩ¨Êç¢ÂíåËØ≠Ë®Ä‰πãÈó¥ÁöÑÈÄö‰ø°</li><li>ÊñáÊ°£ÂèØÁî®ÊÄßÔºöZigÊòØ‰∏ÄÁßçÁõ∏ÂØπËæÉÊñ∞ÁöÑËØ≠Ë®ÄÔºåÂõ†Ê≠§ÊñáÊ°£ÊúâÈôêÔºåÁ§æÂå∫Ê≠£Âú®Âä™ÂäõÊèêÈ´òÊñáÊ°£ÁöÑÂèØÁî®ÊÄß</li></ul><h3 id="ZigÁöÑÂ∏∏ËßÅ‰ΩøÁî®Âú∫ÊôØ"><a href="#ZigÁöÑÂ∏∏ËßÅ‰ΩøÁî®Âú∫ÊôØ" class="headerlink" title="ZigÁöÑÂ∏∏ËßÅ‰ΩøÁî®Âú∫ÊôØ"></a>ZigÁöÑÂ∏∏ËßÅ‰ΩøÁî®Âú∫ÊôØ</h3><p>ËÆ©Êàë‰ª¨Ê∑±ÂÖ•‰∏Ä‰∫õZigÁöÑÂÆûÈôÖÁî®‰æãÔºåÁúãÁúãÂÆÉÂú®ÂÆûÈôÖÂú∫ÊôØ‰∏≠ÊòØÂ¶Ç‰ΩïËêΩÂú∞ÁöÑÔºÅ</p><p>ÂºÄÂèëËÄÖÂèØ‰ª•Âú®Á≥ªÁªüÁºñÁ®ã‰∏≠‰ΩøÁî®ZigÊù•ÊûÑÂª∫Êìç‰ΩúÁ≥ªÁªü„ÄÅËÆæÂ§áÈ©±Âä®Á®ãÂ∫èÂíåÂµåÂÖ•ÂºèÁ≥ªÁªü„ÄÇÂÖ∂ËøòÂú®ÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑‰∏≠‰πüÊúâÂæàÂ§öÂ∫îÁî®Âú∫ÊôØÔºåÂèØÁî®‰∫éÂàõÂª∫È´òÊïàÂíåÂø´ÈÄüÁöÑÂëΩ‰ª§Ë°åÁïåÈù¢ÔºåÊûÑÂª∫Á≥ªÁªüËÑöÊú¨ÔºåÊàñ‰ºòÂåñÁé∞ÊúâÂ∑•ÂÖ∑ÁöÑÊÄßËÉΩ„ÄÇ</p><p>Âú®ÁºñËØëÂô®ÂíåËØ≠Ë®ÄÂºÄÂèë‰∏≠ÔºåZig‰ª•ÂÖ∂ÂÖÉÁºñÁ®ãËÉΩÂäõÂíåÂØπÁÆÄÊòìÊÄßÁöÑËøΩÊ±ÇËÄåÈóªÂêç„ÄÇÊØîËæÉËëóÂêçÁöÑÂºÄÊ∫êÈ°πÁõÆÊòØBunÔºåÂÖ∂ÊòØ‰∏Ä‰∏™‰ΩøÁî®ZigÂºÄÂèëÁöÑJavaScriptËøêË°åÊó∂„ÄÇ</p><p>‰∏éRust‰∏ÄÊ†∑ÔºåZig‰πüÊúâ‰∏Ä‰∫õÊõ¥‰∏∫‰∏ì‰∏öÁöÑ‰ΩøÁî®Âú∫ÊôØÔºö</p><ul><li>Ê∏∏ÊàèÂºÄÂèëÔºåÂõ†ÊîØÊåÅÈ´òÊÄßËÉΩÊ∏∏ÊàèÂºïÊìé„ÄÅËÉΩÂ§üÂÆûÊó∂Ê®°Êãü</li><li>Âú®ÂµåÂÖ•ÂºèÁ≥ªÁªüÂíåÁâ©ËÅîÁΩë‰∏≠ÔºåÁî®‰∫éÁºñÁ®ãÂæÆÊéßÂà∂Âô®„ÄÅ‰º†ÊÑüÂô®ÂíåÂÖ∂‰ªñËµÑÊ∫êÂèóÈôêËÆæÂ§á</li><li>Âú®ÂØÜÁ†ÅÂ∫îÁî®‰∏≠ÔºåÁî®‰∫éÂÆûÁé∞Âä†ÂØÜÁÆóÊ≥ï„ÄÅÊï∞Â≠óÁ≠æÂêç„ÄÅÂÆâÂÖ®ÈÄö‰ø°ÂçèËÆÆÂíåÂÖ∂‰ªñÂÆâÂÖ®ÊïèÊÑüÁªÑ‰ª∂</li></ul><h2 id="Rust-vs-Zig-Áõ∏‰ºº‰πãÂ§Ñ‰∏éÂ∑ÆÂºÇ"><a href="#Rust-vs-Zig-Áõ∏‰ºº‰πãÂ§Ñ‰∏éÂ∑ÆÂºÇ" class="headerlink" title="Rust vs. Zig: Áõ∏‰ºº‰πãÂ§Ñ‰∏éÂ∑ÆÂºÇ"></a>Rust vs. Zig: Áõ∏‰ºº‰πãÂ§Ñ‰∏éÂ∑ÆÂºÇ</h2><p>ÂâçÈù¢Êàë‰ª¨Â∑≤ÁªèÂàÜÂà´ÁúãËøáRustÂíåZigÔºåÁé∞Âú®ÊòØÊó∂ÂÄôÂ∞ÜÂÆÉ‰ª¨ÊîæÂú®‰∏ÄËµ∑ËøõË°åÊØîËæÉ‰∫Ü„ÄÇÊØîËæÉ‰∏çÂêåÁöÑÁºñÁ®ãËØ≠Ë®ÄÊÄªÊòØÂæàÊúâË∂£ÔºåÁâπÂà´ÊòØÂΩìÂÆÉ‰ª¨ÊúâÁùÄÁõ∏‰ººÁöÑÁõÆÊ†áÊó∂„ÄÇ</p><p>ËÆ©Êàë‰ª¨‰ªéÂÆÉ‰ª¨ÁöÑÂÖ±Âêå‰πãÂ§ÑÂºÄÂßãÔºö</p><ul><li>ÂÜÖÂ≠òÂÆâÂÖ®ÊÄßÔºöRustÂíåZigÈÉΩ‰ºòÂÖàËÄÉËôëÂÜÖÂ≠òÂÆâÂÖ®ÊÄßÔºåÂπ∂ÈÄöËøá‰∏•Ê†ºÁöÑÁºñËØëÂô®Ê£ÄÊü•„ÄÅÈùôÊÄÅÁ±ªÂûãÂíåÈÄÇÁî®‰∫éÊØèÁßçËØ≠Ë®ÄÁöÑÁâπÊÆäËßÑÂàôÊù•Èò≤Ê≠¢Â∏∏ËßÅÁöÑÁºñÁ®ãÈîôËØØ„ÄÇ</li><li>‰ΩéÁ∫ßÊéßÂà∂Ôºö‰∏§ËÄÖÈÉΩÊèê‰æõÂØπÁ≥ªÁªüËµÑÊ∫êÊõ¥Â§öÁöÑÊéßÂà∂Ôºå‰ΩøÂÆÉ‰ª¨ÈùûÂ∏∏ÈÄÇÂêà‰ΩéÁ∫ß‰ªªÂä°ÂíåÁ≥ªÁªüÁºñÁ®ã„ÄÇ</li><li>ÊÄßËÉΩ‰ºòÂåñÔºöËøô‰∏§ÁßçÁºñÁ®ãËØ≠Ë®ÄÈÉΩ‰ª•È´òÂ∫¶‰ºòÂåñÁöÑ‰ª£Á†ÅËÄåÈóªÂêçÔºåÂÖ∑ÊúâÊâãÂä®ÂÜÖÂ≠òÁÆ°ÁêÜ„ÄÅÁõ¥Êé•CPUËÆøÈóÆÂíåÁºñËØëÊó∂ËØÑ‰º∞ÁöÑÁâπÊÄß„ÄÇ</li><li>Á§æÂå∫ÂíåÂèØÁî®ÊÄßÔºöRustÂíåZigÈÉΩÊòØÂºÄÊ∫êÈ°πÁõÆÔºåÊã•ÊúâÁßØÊûÅÁöÑÁ§æÂå∫„ÄÅÊñáÊ°£ÂíåÂ∑•ÂÖ∑ÊîØÊåÅ„ÄÇ</li><li>Êó†Êú™ÂÆö‰πâË°å‰∏∫ÔºöËøô‰∏§ÁßçÁºñÁ®ãËØ≠Ë®ÄÈÉΩÊúâ‰∏•Ê†ºÁöÑÁºñËØëÂô®Ê£ÄÊü•ÂíåÂÖ∂‰ªñÂäüËÉΩÔºåÂèØ‰ª•Èò≤Ê≠¢Êú™ÂÆö‰πâÁöÑË°å‰∏∫„ÄÇÈÄöËøáÂú®ÁºñËØëÊó∂ÊçïËé∑ÈóÆÈ¢òÔºåÊèêÈ´ò‰∫ÜÁ®ãÂ∫èÁöÑÁ®≥ÂÆöÊÄßÂíåÂÆâÂÖ®ÊÄß„ÄÇ</li></ul><p>‰∏éÊ≠§ÂêåÊó∂ÔºåÊÇ®ÂèØ‰ª•‰ΩøÁî®‰∏ãÈù¢ÁöÑÊØîËæÉ‰∫ÜËß£RustÂíåZig‰πãÈó¥ÁöÑÂ∑ÆÂºÇÔºö</p><table><thead><tr><th>ÁâπÂæÅ</th><th>Rust ‰ΩøÁî®ÂÖ∂‰∏•Ê†ºÁöÑÊâÄÊúâÊùÉÂíåÂÄüÁî®ËßÑÂàôÊù•Á°Æ‰øùÂºÄÂèëËÄÖÁºñÂÜôÁöÑ‰ªª‰Ωï‰ª£Á†ÅÈÉΩÊòØÂÆâÂÖ®ÁöÑ„ÄÇ</th><th>Zig ‰ΩøÁî®Ë∑üË∏™ÂíåÊéßÂà∂ÂÜÖÂ≠òÂàÜÈÖçÂíåÈáäÊîæÁöÑÊú∫Âà∂Êù•Èò≤Ê≠¢ÂºÄÂèëËÄÖÁºñÂÜôÁöÑ‰ªª‰Ωï‰ª£Á†ÅÈÉΩÊòØ‰∏çÂÆâÂÖ®ÁöÑ„ÄÇ</th></tr></thead><tbody><tr><td>ËØ≠Ê≥ï</td><td>Rust ÈÄöËøáÊòæÂºèÊ≥®Ëß£Âº∫Ë∞ÉÊâÄÊúâÊùÉÂíåÁîüÂëΩÂë®ÊúüÔºåÂèØËÉΩÂØºËá¥‰ª£Á†ÅÊõ¥Èïø„ÄÇ</td><td>Zig ÈÅµÂæ™Á±ª‰ºº‰∫éCÁöÑËØ≠Ê≥ï„ÄÇ</td></tr><tr><td>ÁîüÊÄÅÁ≥ªÁªü</td><td>Rust Êèê‰æõ‰∫ÜÂº∫Â§ßÁöÑÁîüÊÄÅÁ≥ªÁªüÔºåÂåÖÊã¨Â∫ì„ÄÅÂ∑•ÂÖ∑ÂíåÁ§æÂå∫ÊîØÊåÅ„ÄÇ</td><td>Zig ÊòØ‰∏Ä‰∏™ËæÉÂπ¥ËΩªÁöÑËØ≠Ë®ÄÔºåÁîüÊÄÅÁ≥ªÁªüÁõ∏ÂØπËæÉÂ∞è„ÄÇ</td></tr><tr><td>‰∫íÊìç‰ΩúÊÄß</td><td>Rust ÂÖ∑ÊúâËâØÂ•ΩÁöÑFFIÂÖºÂÆπÊÄß„ÄÇÂÆÉÂú®‰ªéCË∞ÉÁî®RustÂáΩÊï∞ÊñπÈù¢Ë°®Áé∞ËâØÂ•ΩÔºå‰ΩÜ‰ªéRustË∞ÉÁî®CÂáΩÊï∞ÂèØËÉΩ‰ºöÊúâÈöæÂ∫¶„ÄÇ</td><td>Zig ÂÖ∑ÊúâÊõ¥Âá∫Ëâ≤ÁöÑFFI„ÄÇÂÆÉÂú®‰ªéCË∞ÉÁî®ZigÂáΩÊï∞Âíå‰ªéCË∞ÉÁî®ZigÂáΩÊï∞ÊñπÈù¢Ë°®Áé∞ËâØÂ•Ω„ÄÇ</td></tr><tr><td>ÈîôËØØÂ§ÑÁêÜ</td><td>Rust ‰ΩøÁî®ResultÂíåOptionÁ±ªÂûãËøõË°åÊòæÂºèÈîôËØØÂ§ÑÁêÜ„ÄÇ</td><td>Zig ‰ΩøÁî®ÈîôËØØÁ±ªÂûã„ÄÅÈîôËØØËÅîÂêàÂíåÂª∂ËøüËØ≠Âè•ËøõË°åÈîôËØØÂ§ÑÁêÜ„ÄÇ</td></tr><tr><td>ÂåÖÁÆ°ÁêÜÂô®</td><td>Rust ‰ΩøÁî®CargoÂåÖÁÆ°ÁêÜÂô®Â§ÑÁêÜÂåÖÂíå‰æùËµñÂÖ≥Á≥ª„ÄÇ</td><td>Zig ‰ΩøÁî®ÂÖ∂ÂÜÖÁΩÆÁöÑÂåÖÁÆ°ÁêÜÂô®Â§ÑÁêÜÂåÖÂíå‰æùËµñÂÖ≥Á≥ª„ÄÇ</td></tr></tbody></table><p>Èô§‰∫ÜÂÆÉ‰ª¨ÁöÑÁõ∏‰ºº‰πãÂ§ÑÂíåÂ∑ÆÂºÇ‰πãÂ§ñÔºåÊàë‰ª¨ËøòÂèØ‰ª•ÈÄöËøáÊÄßËÉΩ„ÄÅÊµÅË°åÂ∫¶‰ª•ÂèäÂÆÉ‰ª¨ÁöÑÁ®ãÂ∫èÂëòËñ™ÈÖ¨Êù•ÊØîËæÉRustÂíåZig„ÄÇËÆ©Êàë‰ª¨Êõ¥‰ªîÁªÜÂú∞Áúã‰∏ÄÁúã„ÄÇ</p><h3 id="Rust-vs-Zig-ÊÄßËÉΩ"><a href="#Rust-vs-Zig-ÊÄßËÉΩ" class="headerlink" title="Rust vs. Zig: ÊÄßËÉΩ"></a>Rust vs. Zig: ÊÄßËÉΩ</h3><p>ÂÆ¢ËßÇÊù•ÁúãÔºåÂú®RustÂíåZig‰πãÈó¥ÔºåÂπ∂Ê≤°ÊúâÁªùÂØπÊÄßËÉΩÊõ¥Â•ΩÁöÑËØ≠Ë®Ä„ÄÇRustÂú®ÁâπÂÆöÂ∫îÁî®‰∏≠ÂèØËÉΩ‰ºöËÉúËøáZigÔºåËÄåZigÂú®ÂÖ∂‰ªñÊñπÈù¢ÂèØËÉΩ‰ºöË∂ÖË∂äRust„ÄÇ</p><p>ËÆ©Êàë‰ª¨ÈÄöËøá‰ªéÁºñÁ®ãËØ≠Ë®ÄÂíåÁºñËØëÂô®Âü∫ÂáÜÊµãËØï‰∏≠ËøõË°åÊØîËæÉÔºå‰ªîÁªÜÁ†îÁ©∂ÊØèÁßçËØ≠Ë®ÄÁöÑÊÄßËÉΩÔºö</p><p><img src="https://pic.imgdb.cn/item/65ad10df871b83018ac973e8.png" alt="Screenshot Taken From Programming Languages And Compiler Benchmark Project Showing Rust Vs Zig Performance For Two Example Programs"></p><p>Ëøô‰∏™Âü∫ÂáÜÊµãËØïÈ°πÁõÆÂåÖÂê´Áî®Â§öÁßçÁºñÁ®ãËØ≠Ë®ÄÁºñÂÜôÔºåÂπ∂ÂêåÊó∂ËøêË°åÁöÑÁ®ãÂ∫è„ÄÇ‰ª•Ë°®Ê†ºÂΩ¢ÂºèÂëàÁé∞ÂÆÉ‰ª¨ÁöÑËøêË°åÁªìÊûúÔºåÂèØ‰ª•ÁúãÂà∞ÊØèÁßçÁºñÁ®ãËØ≠Ë®ÄÂú®‰ªªÂä°‰∏≠ÁöÑË°®Áé∞Âà∞Â∫ïÂ¶Ç‰Ωï„ÄÇ</p><p>Âú®‰∏äÈù¢ÁöÑÂõæÁâá‰∏≠ÔºåÊàë‰ª¨‰ΩøÁî®RustÂíåZigÁºñÂÜôÁöÑmandelbrotÂíånbodyÁ®ãÂ∫èÔºå‰ªéÊÄßËÉΩ<strong>Áî±Â•ΩÂà∞Â∑Æ</strong>ËøõË°åÊéíÂàó„ÄÇ</p><p>‰Ω†‰ºöÊ≥®ÊÑèÂà∞Âú®Êüê‰∫õÊÉÖÂÜµ‰∏ãÔºåZigÁöÑÊÄßËÉΩ‰ºò‰∫éRustÔºåËÄåÂú®ÂÖ∂‰ªñÊÉÖÂÜµ‰∏ãÔºåRustÁöÑÊÄßËÉΩ‰ºò‰∫éZig„ÄÇ‰∏§ËÄÖÈÉΩÊòØÈ´òÊÄßËÉΩÁöÑËØ≠Ë®ÄÔºåÂõ†Ê≠§Âú®È°πÁõÆ‰∏≠ÈÄâÊã©‰ªª‰∏ÄÈÄâÈ°πÈÉΩÂ∫îËØ•ËÉΩÂ§üÊª°Ë∂≥‰Ω†ÁöÑÈúÄÊ±Ç„ÄÇ</p><h3 id="Rust-vs-ZigÔºöÊµÅË°åÂ∫¶"><a href="#Rust-vs-ZigÔºöÊµÅË°åÂ∫¶" class="headerlink" title="Rust vs. ZigÔºöÊµÅË°åÂ∫¶"></a>Rust vs. ZigÔºöÊµÅË°åÂ∫¶</h3><p>Âú®ÈÄâÊã©Ë¶ÅÂ≠¶‰π†ÁöÑÁºñÁ®ãËØ≠Ë®ÄÊó∂ÔºåÊµÅË°åÂ∫¶ÂèØËÉΩÊòØ‰∏Ä‰∏™ÈáçË¶ÅÂõ†Á¥†„ÄÇÈÄâÊã©‰∏ÄÁßçÊµÅË°åÁöÑËØ≠Ë®Ä‰∏ç‰ªÖÂ¢ûÂä†‰∫Ü‰Ω†ÊâæÂà∞ËµÑÊ∫êÂíåÊîØÊåÅÁöÑÊú∫‰ºöÔºåËøòÊÑèÂë≥ÁùÄ‰Ω†Êõ¥ÊúâÂèØËÉΩÊâæÂà∞Âêà‰ΩúÁöÑÂºÄÂèëËÄÖ„ÄÇ</p><p>StackOverflowÊúÄÊñ∞ÁöÑÂºÄÂèëËÄÖË∞ÉÊü•Êèê‰æõ‰∫Ü‰∏Ä‰∫õÊúâË∂£ÁöÑËßÇÂØüËßÜËßí„ÄÇÊ≠£Â¶ÇÂâçÈù¢ÊèêÂà∞ÁöÑÔºåRustÊòØ‰ªäÂπ¥ÊúÄÂèóÈí¶‰Ω©ÁöÑËØ≠Ë®ÄÔºåÊúâ84.66ÔºÖÁöÑÂèóËÆøËÄÖË°®Á§∫‰ªñ‰ª¨ÊòéÂπ¥ÊÉ≥ÂÜçÊ¨°‰ΩøÁî®ÂÆÉÔºåËÄåZigÂè™Êúâ71.33ÔºÖ„ÄÇ</p><p>RustÂú®ÂèóÊ¨¢ËøéËØ≠Ë®ÄÂàóË°®‰∏≠ÊéíÂêçÁ¨¨14‰ΩçÔºåËÄåZigÂú®ÊÄªÂÖ±ÂàóÂá∫ÁöÑ51ÁßçËØ≠Ë®Ä‰∏≠ÊéíÂêçÁ¨¨41‰Ωç„ÄÇ</p><p>ÂèØËÉΩÊòØÂõ†‰∏∫ÂÆÉ‰ªçÂ§Ñ‰∫éÊó©ÊúüÈò∂ÊÆµÔºåÂõ†Ê≠§ZigÂú®Ëøô‰∏§ÁßçÊÉÖÂÜµ‰∏ãÊâçËé∑ÂæóËæÉ‰ΩéÁöÑÊµÅË°åÂ∫¶„ÄÇÊó†ËÆ∫Â¶Ç‰ΩïÔºåËÄÉËôë‰Ω†ÈÄâÊã©Â∑•‰ΩúÁöÑËØ≠Ë®ÄÁöÑÊµÅË°åÂ∫¶ÊòØËá≥ÂÖ≥ÈáçË¶ÅÁöÑ„ÄÇ</p><h3 id="Rust-vs-ZigÔºöËñ™ÈÖ¨"><a href="#Rust-vs-ZigÔºöËñ™ÈÖ¨" class="headerlink" title="Rust vs. ZigÔºöËñ™ÈÖ¨"></a>Rust vs. ZigÔºöËñ™ÈÖ¨</h3><p>StackOverflowÁöÑÂºÄÂèëËÄÖË∞ÉÊü•ËøòÂåÖÂê´‰∫ÜÂèóËÆøËÄÖÊä•ÂëäÁöÑÊúÄÈ´òËñ™ÈÖ¨ÁöÑ‰ø°ÊÅØ„ÄÇÂ¶ÇÊûú‰Ω†ÂØπËøõÂÖ•ËΩØ‰ª∂ÂºÄÂèëÂ∏ÇÂú∫ÊÑüÂÖ¥Ë∂£ÔºåËøôÂº†ÂõæË°®ÂèØËÉΩÂØπ‰Ω†ÂæàÊúâÂ∏ÆÂä©„ÄÇ</p><p>ÊúâË∂£ÁöÑÊòØÔºåÂ∞ΩÁÆ°ZigÊòØ‰∏Ä‰∏™Êñ∞ÁöÑÈÄâÊã©Ôºå‰ΩÜÂÆûÈôÖ‰∏äÊòØ‰ªäÂπ¥ÊúÄÈ´òËñ™ÈÖ¨ÁöÑËØ≠Ë®ÄÔºåËÄåRustÂú®ÂàóË°®‰∏≠ÊéíÂêçÁ¨¨14‰Ωç„ÄÇÂ¶ÇÊûú‰Ω†Âá∫‰∫é‰∏ì‰∏öÂéüÂõ†ÊÉ≥Ë¶ÅÂ≠¶‰π†RustÊàñZigÔºåËøô‰∫õ‰ø°ÊÅØÂèØËÉΩ‰ºöÊúâÊâÄÂ∏ÆÂä©Ôºö</p><p><img src="https://pic.imgdb.cn/item/65ad10f2871b83018ac9cd1e.png" alt="Red Bar Chart With Dark Grey Background And White Labels Comparing Reported Pay For Developers By Language Ordered From Highest Pay To Lowest Pay"></p><p>Â∞ΩÁÆ°ËøôÂº†ÂõæË°®ÈùûÂ∏∏ÊúâÂ∏ÆÂä©Ôºå‰ΩÜÂÆÉÂè™Êèê‰æõ‰∫ÜÂ±ÄÈÉ®ÁöÑ‰∏Ä‰∫õ‰ø°ÊÅØ„ÄÇÂΩìÁ°ÆÂÆö‰∏Ä‰∏™ÂºÄÂèëËÄÖÁöÑËñ™ÈÖ¨Êó∂ÔºåËøòÊúâÂÖ∂‰ªñÂõ†Á¥†ÈúÄË¶ÅËÄÉËôëÔºåÊØîÂ¶Ç‰ªñ‰ª¨ÁöÑÁªèÈ™åÊ∞¥Âπ≥Âíå‰ªñ‰ª¨ÊâÄÂú®ÂÖ¨Âè∏„ÄÇ</p><h2 id="ÁªìËÆ∫"><a href="#ÁªìËÆ∫" class="headerlink" title="ÁªìËÆ∫"></a>ÁªìËÆ∫</h2><p>ÂÖ≥‰∫éRustÂíåZigÔºåÂæàÈöæËØ¥Âì™‰∏Ä‰∏™ÊòØÊòéÊòæÁöÑËµ¢ÂÆ∂„ÄÇÊØèÁßçËØ≠Ë®ÄÈÉΩÊúâÂÖ∂‰ºòÁÇπÂíåÁº∫ÁÇπ„ÄÇÂú®Ê∑±ÂÖ•‰ΩøÁî®‰ªª‰Ωï‰∏ÄÁßçËØ≠Ë®Ä‰πãÂâçÔºåËøõË°åÁ†îÁ©∂ÊòØËá≥ÂÖ≥ÈáçË¶ÅÁöÑ„ÄÇËøôÂ∞±ÊòØ‰∏∫‰ªÄ‰πàÊàëÂ∏åÊúõËøôÁØáÊñáÁ´†ËÉΩÂ∏ÆÂä©‰Ω†ÊâæÂà∞Ê≠£Á°ÆÁöÑÈÄâÊã©„ÄÇ</p><p><a href="https://blog.logrocket.com/comparing-rust-vs-zig-performance-safety-more/">https://blog.logrocket.com/comparing-rust-vs-zig-performance-safety-more/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;RustÂíåZigÔºåËøô‰∏§ÁßçËØ≠Ë®ÄÈÉΩÊó®Âú®ÁºñÂÜôÈ´òÊïà„ÄÅÊÄßËÉΩ‰ºòÂºÇÁöÑ‰ª£Á†ÅÔºåÁÑ∂ËÄåÂÆÉ‰ª¨Âú®ÂÆûÁé∞Ëøô‰∏ÄÁõÆÊ†áÊó∂ÈááÁî®‰∫Ü‰∏çÂêåÁöÑÊñπÂºè„ÄÇ&lt;/p&gt;
&lt;p&gt;ÂÄºÂæóÊ≥®ÊÑèÁöÑÊòØÔºåRustÂíåZigÊ†πÊ§ç‰∫éÊà™ÁÑ∂‰∏çÂêåÁöÑÁêÜÂøµÔºåËøôÂèØËÉΩÂΩ±ÂìçÂºÄÂèëËÄÖÈÄâÊã©Êó∂ÁöÑÂèñËàç„ÄÇ‰∏∫‰∫ÜÊõ¥Ê∑±ÂÖ•Âú∞‰∫ÜËß£ÂÆÉ‰ª¨Âú®Áõ∏‰∫íÊØîËæÉ‰∏≠ÁöÑË°®Áé∞ÔºåÊàë‰ª¨Â∞ÜËøõ‰∏ÄÊ≠•Êé¢ËÆ®ÂÆÉ‰ª¨ÂêÑËá™ÁöÑÁâπÁÇπ„ÄÇ&lt;</summary>
      
    
    
    
    
    <category term="zig" scheme="https://zoues.com/tags/zig/"/>
    
  </entry>
  
  <entry>
    <title>Optimizing the construction of the VM ecosystem with KubeVirt</title>
    <link href="https://zoues.com/posts/a78d5062/"/>
    <id>https://zoues.com/posts/a78d5062/</id>
    <published>2024-01-20T05:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.374Z</updated>
    
    <content type="html"><![CDATA[<p>Two months ago, we were thrilled to share insights in the article ‚ÄúBest Practices for Migrating VM Clusters to KubeVirt 1.0.‚Äù As previously mentioned, we have selected AlmaLinux and Kubernetes 1.28 as the foundation for virtualization, employing cgroup v2 for resource isolation. Before moving to the production phase, we encountered additional challenges, particularly related to Kubernetes, containerd, and specific issues within KubeVirt. Therefore, in this second article, our goal is to share practical experiences and insights gained before the deployment of KubeVirt into a production environment.</p><h3 id="Latest-Developments"><a href="#Latest-Developments" class="headerlink" title="Latest Developments"></a>Latest Developments</h3><p>KubeVirt containerizes the trusted virtualization layer of QEMU and libvirt, enabling the management of VMs as standard Kubernetes resources. This approach offers users a more flexible, scalable, and contemporary solution for virtual machine management. As the project progresses, we‚Äôve identified specific misconceptions, configuration errors, and opportunities to enhance KubeVirt functionality, especially in the context of utilizing Kubernetes 1.28 and containerd. The details are outlined below:</p><h4 id="kubernetes"><a href="#kubernetes" class="headerlink" title="kubernetes"></a>kubernetes</h4><ul><li>kubelet ready-only port</li></ul><p>To address security concerns, we have taken measures to mitigate potential malicious attacks on pods and containers. Specifically, we have discontinued the default opening of the insecure read-only port 10255 for the kubelet in K8s clusters running Kubernetes 1.26 or later. Instead, the authentication port 10250 is now opened and utilized by the kubelet.</p><ul><li>service account token expiration</li></ul><p>To enhance data security, Kubernetes 1.21 defaults to enabling the BoundServiceAccountTokenVolume feature. This feature specifies the validity period of service account tokens, automatically renews them before expiration, and invalidates tokens after associated pods are deleted. If using client-go version 11.0.0 or later, or 0.15.0 or later, the kubelet automatically reloads service account tokens from disks to facilitate token renewal.</p><ul><li>securing controller-manager and scheduler metrics</li></ul><p>Secure serving on port 10257 to kube-controller-manager (configurable via ‚Äìsecure-port) is now enabled. Delegated authentication and authorization are to be configured using the same flags as for aggregated API servers. Without configuration, the secure port will only allow access to &#x2F;healthz. (#64149, @sttts) Courtesy of SIG API Machinery, SIG Auth, SIG Cloud Provider, SIG Scheduling, and SIG Testing</p><p>Added secure port 10259 to the kube-scheduler (enabled by default) and deprecate old insecure port 10251. Without further flags self-signed certs are created on startup in memory. (#69663, @sttts)</p><h4 id="containerd"><a href="#containerd" class="headerlink" title="containerd"></a>containerd</h4><ul><li>private registry</li></ul><p>Modify your config.toml file (usually located at &#x2F;etc&#x2F;containerd&#x2F;config.toml) as shown below:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">version = 2</span><br><span class="line"></span><br><span class="line">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry]</span><br><span class="line">config_path = &quot;/etc/containerd/certs.d&quot;</span><br></pre></td></tr></table></figure><p>In containerd registry configuration, a registry host namespace refers to the path of the hosts.toml file specified by the registry host name or IP address, along with an optional port identifier. When submitting a pull request for an image, the typical format is as follows:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pull [registry_host_name|IP address][:port][/v2][/org_path]&lt;image_name&gt;[:tag|@DIGEST]</span><br></pre></td></tr></table></figure><p>The registry host namespace part is <code>[registry_host_name|IP address][:port]</code>. For example, the directory structure for docker.io looks like this:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plaintextCopy code$ tree /etc/containerd/certs.d</span><br><span class="line">/etc/containerd/certs.d</span><br><span class="line">‚îî‚îÄ‚îÄ docker.io</span><br><span class="line">‚îî‚îÄ‚îÄ hosts.toml</span><br></pre></td></tr></table></figure><p>Alternatively, you can use the _default registry host namespace as a fallback if no other namespace matches.</p><ul><li>systemd cgroup</li></ul><p>While containerd and Kubernetes default to using the legacy cgroupfs driver for managing cgroups, it is recommended to utilize the systemd driver on systemd-based hosts to adhere to the ‚Äúsingle-writer‚Äù rule of cgroups.</p><p>To configure containerd to use the systemd driver, add the following option in <code>/etc/containerd/config.toml</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">version = 2</span><br><span class="line">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]</span><br><span class="line">SystemdCgroup = true</span><br></pre></td></tr></table></figure><p>Additionally, apart from configuring containerd, you need to set the KubeletConfiguration to use the ‚Äúsystemd‚Äù cgroup driver. The KubeletConfiguration is typically found at <code>/var/lib/kubelet/config.yaml</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kind: KubeletConfiguration</span><br><span class="line">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class="line">cgroupDriver: &quot;systemd&quot;</span><br></pre></td></tr></table></figure><ul><li>[community issue]containerd startup hangs when &#x2F;etc is ready-only</li></ul><p>We observed that, following the update from containerd v1.6.21 to v1.6.22, the systemd service failed to start successfully. Upon closer inspection during debugging, it was revealed that containerd did not fully initialize (lacking the ‚Äúcontainerd successfully booted in ‚Ä¶‚Äù message) and did not send the sd notification READY&#x3D;1 event.</p><ul><li>migration docker to containerd</li></ul><p>you have to configure the KubeletConfiguration to use the ‚Äúcontainerd‚Äù endpoint. The KubeletConfiguration is typically located at &#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;config.yaml:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kind: KubeletConfiguration</span><br><span class="line">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class="line">containerRuntimeEndpoint: &quot;unix:///run/containerd/containerd.sock&quot;</span><br></pre></td></tr></table></figure><p>Because <code>/var/lib/docker</code> is mounted on a separate disk, switching to containerd requires navigating to the root directory of containerd.</p><h3 id="kubevirt"><a href="#kubevirt" class="headerlink" title="kubevirt"></a>kubevirt</h3><ul><li>containerDisk data persistent<br>The containerDisk feature provides the ability to store and distribute VM disks in the container image registry. containerDisks can be assigned to VMs in the disks section of the VirtualMachineInstance spec.containerDisks are ephemeral storage devices that can be assigned to any number of active VirtualMachineInstances.We can persist data locally through incremental backups.</li><li>hostdisk support qcow2 format</li><li>hostdisk support hostpath capacity expansion</li></ul><h3 id="Storage-Solution"><a href="#Storage-Solution" class="headerlink" title="Storage Solution"></a>Storage Solution</h3><h4 id="VM-Image-storage-Soultion"><a href="#VM-Image-storage-Soultion" class="headerlink" title="VM Image storage Soultion"></a>VM Image storage Soultion</h4><p>In KubeVirt, the original virtual machine image file is incorporated into the &#x2F;disk path of the Docker base image and subsequently pushed to the image repository for utilization in virtual machine creatio.</p><p>Example: we could Inject a local VirtualMachineInstance disk into a container image</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; END &gt; Dockerfile</span><br><span class="line">FROM scratch</span><br><span class="line">ADD --chown=107:107 almalinux.qcow2 /disk/</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">docker build -t kubevirt/alamlinux:latest .</span><br></pre></td></tr></table></figure><p>When initiating a virtual machine, a Virtual Machine Instance (VMI) Custom Resource Definition (CRD) is created, capturing the specified virtual machine image‚Äôs name. Subsequent to VMI creation, the virt-controller generates a corresponding virt-launcher pod for the VMI. This pod comprises threee containers: compute container hosting the compute process for virt-launcher, named container-disk, responsible for managing the storage of the virtual machine image and guest-console-log container. The imageName of the container-disk container corresponds to the virtual machine image name recorded in the VMI. Once the virt-launcher pod is created, kubelet retrieves the container-disk image and initiates the container-disk container. During startup, the container-disk consistently monitors the disk_0.sock file under the -copy-path, with the sock file mapped to the path &#x2F;var&#x2F;run&#x2F;kubevirt&#x2F;container-disk&#x2F;{vmi-uuid}&#x2F; on the host machine through hostPath.</p><p>To facilitate the retrieval of necessary information during virtual machine creation, the virt-handler pod utilizes HostPid, enabling visibility of the host machine‚Äôs pid and mount details within the virt-handler container. During the virtual machine creation process, virt-handler identifies the pid of the container-disk process by referencing the disk_0.sock file of the VMI. It proceeds to determine the disk number of the container-disk container‚Äôs root disk using &#x2F;proc&#x2F;{pid}&#x2F;mountInfo. Subsequently, by cross-referencing the disk number of the container-disk root disk with the mount information of the host machine , it pinpoints the physical location of the container-disk root disk. Finally, it constructs the path for the virtual machine image file (&#x2F;disk&#x2F;disk.qcow2), retrieves the actual storage location (sourceFile) of the original virtual machine image on the host machine, and mounts the sourceFile to the targetFile for subsequent use as a backingFile during virtual machine creation.</p><h4 id="Host-Disk-Storage"><a href="#Host-Disk-Storage" class="headerlink" title="Host Disk Storage"></a>Host Disk Storage</h4><p>A hostDisk volume type provides the ability to create or use a disk image located somewhere on a node. It works similar to a hostPath in Kubernetes and provides two usage types:</p><p>DiskOrCreate if a disk image does not exist at a given location then create one<br>Disk a disk image must exist at a given location<br>need to enable the HostDisk feature gate.</p><p>Currently, hostdisk feature has some limitations. The expansion of hostdisk is only supported in the manner of using Persistent Volume Claims (PVC), and the disk format is limited to raw files.</p><p>Details regarding the above will be elaborated in the Feature Expansion section.</p><h3 id="Feature-Expansion"><a href="#Feature-Expansion" class="headerlink" title="Feature Expansion"></a>Feature Expansion</h3><h4 id="Support-VM-static-expansion"><a href="#Support-VM-static-expansion" class="headerlink" title="Support VM static expansion"></a>Support VM static expansion</h4><p>The CPU&#x2F;Mem is also provided with a synchronous interface when the CPU&#x2F;Mem disk is stopped and expanded. The CPU hotplug feature was introduced in KubeVirt v1. 0, making it possible to configure the VM workload to allow for adding or removing virtual CPUs while the VM is running,While the current version supports online expansion, we still opt for static expansion, primarily due to the temporary nature of VMs. The challenge here is that when resources are insufficient, the VM will not start.</p><h4 id="hostdisk-support-qcow2-and-online-expand"><a href="#hostdisk-support-qcow2-and-online-expand" class="headerlink" title="hostdisk support qcow2 and online expand"></a>hostdisk support qcow2 and online expand</h4><p>The current hostdisk has some limitations. The expansion of hostdisk is only supported in the manner of using Persistent Volume Claims (PVC), and the disk is limited to raw format,To implement this feature, we made minor adjustments to all components.</p><h4 id="cold-migration"><a href="#cold-migration" class="headerlink" title="cold migration"></a>cold migration</h4><p>We refrain from employing live migration capabilities due to their complexity and several limitations in our specific scenario. Instead, with data locally persisted and VMs scheduled in a fixed manner, we utilize cold migration through the rsync command.</p><h4 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h4><p>In addition to the enhanced features mentioned earlier, we have integrated support for both static and dynamic addition or removal of host disks for virtual machines, password reset capabilities, pass-through of physical machine disks, and addressed various user requirements to deliver a more versatile and comprehensive usage experience.</p><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>KubeVirt simplifies running virtual machines on Kubernetes, making it as easy as managing containers. It provides a cloud-native approach to managing virtual machines. KubeVirt addresses the challenge of unifying the management of virtual machines and containers, effectively harnessing the strengths of both. However, there is still a long way to go in practice.</p><p><a href="https://github.com/k8snetworkplumbingwg/multus-cni/issues/1132">https://github.com/k8snetworkplumbingwg/multus-cni/issues/1132</a></p><p><a href="https://segmentfault.com/a/1190000040926384/en">https://segmentfault.com/a/1190000040926384/en</a></p><p><a href="https://www.alibabacloud.com/help/en/ack/product-overview/solution-to-serviceaccount-token-expiration-after-upgrading-122-version">https://www.alibabacloud.com/help/en/ack/product-overview/solution-to-serviceaccount-token-expiration-after-upgrading-122-version</a></p><p><a href="https://github.com/containerd/containerd/issues/9139">https://github.com/containerd/containerd/issues/9139</a></p><p><a href="https://github.com/containerd/containerd/blob/main/docs/cri/config.md">https://github.com/containerd/containerd/blob/main/docs/cri/config.md</a></p><p><a href="https://www.cncf.io/blog/2023/09/22/best-practices-for-transitioning-vm-clusters-to-kubevirt-1-0/https://kubevirt.io/user-guide/virtualmachines/disksand_volumes/#hostdisk">https://www.cncf.io/blog/2023/09/22/best-practices-for-transitioning-vm-clusters-to-kubevirt-1-0/https://kubevirt.io/user-guide/virtualmachines/disksand_volumes/#hostdisk</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Two months ago, we were thrilled to share insights in the article ‚ÄúBest Practices for Migrating VM Clusters to KubeVirt 1.0.‚Äù As previous</summary>
      
    
    
    
    <category term="kubevirt" scheme="https://zoues.com/categories/kubevirt/"/>
    
    
    <category term="kubernetes" scheme="https://zoues.com/tags/kubernetes/"/>
    
    <category term="cncf" scheme="https://zoues.com/tags/cncf/"/>
    
    <category term="kubevirt" scheme="https://zoues.com/tags/kubevirt/"/>
    
  </entry>
  
  <entry>
    <title>Best practices for transitioning VM clusters to KubeVirt 1.0</title>
    <link href="https://zoues.com/posts/912f3650/"/>
    <id>https://zoues.com/posts/912f3650/</id>
    <published>2024-01-20T05:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.375Z</updated>
    
    <content type="html"><![CDATA[<p>The KubeVirt community is thrilled to announce the highly-anticipated release of KubeVirt v1.0! This momentous release signifies the remarkable achievements and widespread adoption within the community, marking a significant milestone for all stakeholders involved. This project became part of CNCF as a sandbox project in September 2019 and attained incubation status in April 2022. KubeVirt has evolved into a production-ready virtual machine management project that seamlessly operates as a native Kubernetes API. We have also chosen KubeVirt as our ultimate solution for virtual machine orchestration. Currently, we are utilizing AlmaLinux as the virtualization foundation and cgroup v2 as the resource isolation mechanism. Throughout the process of implementing KubeVirt, we encountered certain challenges. Therefore, we aim to share some of the practical experiences and insights we‚Äôve gained from working with KubeVirt in this article.</p><h3 id="Why-KubeVirt"><a href="#Why-KubeVirt" class="headerlink" title="Why KubeVirt?"></a>Why KubeVirt?</h3><p>While OpenStack has seen widespread adoption, its architecture is relatively complex. By utilizing KubeVirt, virtual machine management is streamlined, offering an improved integration experience. With KubeVirt‚Äôs inclusion in the CNCF sandbox project and its integration with the CNCF ecosystem, Kubernetes API has been extended with custom resource definitions (CRDs) to enable native VM operation within Kubernetes.</p><p>KubeVirt containerizes the trusted virtualization layer of QEMU and libvirt, allowing VMs to be handled just like any other Kubernetes resource. This approach provides users with a more flexible, scalable, and modern virtual machine management solution, offering the following key advantages:</p><ul><li>Simplified Architecture and Management: Compared to OpenStack, KubeVirt offers a simplified architecture and management requirements. OpenStack can be unwieldy and costly to maintain, while KubeVirt leverages Kubernetes for the automated lifecycle management of VMs. It eliminates separate processes for VMs and containers, facilitating the integration of workflows for both virtualization and containerization. This simplifies the underlying infrastructure stack and reduces management costs.</li><li>Modern, Scalable, Kubernetes-Based Solution: KubeVirt is a modern, scalable, Kubernetes-based virtual machine management solution. By standardizing automated testing and deployment of all applications using Kubernetes, and unifying metadata within Kubernetes, it reduces the risk of deployment errors and enables faster iteration. This minimizes the operational workload for DevOps teams and accelerates day-to-day operations.</li><li>Tight Integration with the Kubernetes Ecosystem: KubeVirt seamlessly integrates with the Kubernetes ecosystem, offering improved scalability and performance. When VMs are migrated to Kubernetes, it can lead to cost reductions for software and application use and minimize performance overhead at the virtualization layer.</li><li>Ideal for Lightweight, Flexible, and Modern VM Management: KubeVirt is well-suited for scenarios requiring lightweight, flexible, and modern virtual machine management. Users can run their virtual workloads alongside container workloads, managing them in the same manner. They can also leverage familiar cloud-native tools such as Tekton, Istio, ArgoCD, and more, which are already favored by cloud-native users.</li></ul><h3 id="What‚Äòs-new-in-kubeVirt-1-0-Ôºü"><a href="#What‚Äòs-new-in-kubeVirt-1-0-Ôºü" class="headerlink" title="What‚Äòs new in kubeVirt 1.0 Ôºü"></a>What‚Äòs new in kubeVirt 1.0 Ôºü</h3><p>In POC phase, two RPM-based packages and six container images were used, providing an extension for virtual machine management within Kubernetes:</p><ol><li>kubevirt-virtctl: This package can be installed on any machine with administrator access to the cluster. It contains the virtctl tool, which simplifies virtual machine management using kubectl. While kubectl can be used for this purpose, managing VMs can be complex due to their stateful nature. The virtctl tool abstracts this complexity, enabling operations like starting, stopping, pausing, unpausing, and migrating VMs. It also provides access to the virtual machine‚Äôs serial console and graphics server.</li><li>kubevirt-manifests: This package contains manifests for installing KubeVirt. Key files include kubevirt-cr.yaml, representing the KubeVirt Custom Resource definition, and kubevirt-operator.yaml, which deploys the KubeVirt operator responsible for managing the KubeVirt service within the cluster.<br>The container images are as follows:</li></ol><ul><li>virt-api: Provides a Kubernetes API extension for virtual machine resources.</li><li>virt-controller: Watches for new or updated objects created via virt-api and ensures object states match the requested state.</li><li>virt-handler: A DaemonSet and node component that keeps cluster-level virtual machine objects in sync with libvirtd domains running in virt-launcher. It can also perform node-centric operations like configuring networking and storage.</li><li>virt-launcher: A node component that runs libvirt and QEMU to provide the virtual machine environment.</li><li>virt-operator: Implements the Kubernetes operator pattern for managing the KubeVirt application.</li><li>libguestfs-tools: Provides utilities for accessing and modifying VM disk images.<br>The v1.0 release signifies significant growth for the KubeVirt community, progressing from an idea to a production-ready Virtual Machine Management solution over the past six years. This release emphasizes maintaining APIs while expanding the project. The release cadence has shifted to align with Kubernetes practices, enabling better stability, compatibility, and support.</li></ul><p>The project has embraced Kubernetes community practices, including SIGs for test and review responsibilities, a SIG release repo for release-related tasks, and regular SIG meetings covering areas like scale, performance, and storage.</p><p>Notable features in v1.0 include memory over-commit support, persistent vTPM for easier BitLocker usage on Windows, initial CPU Hotplug support, hot plug, and hot unplug (in alpha), and further developments in API stabilization and SR-IOV interface support.</p><p>The focus is on aligning KubeVirt with Kubernetes and fostering community collaboration to enhance virtual machine management within the Kubernetes ecosystem.</p><h3 id="What-issues-in-kubeVirt-1-0Ôºü"><a href="#What-issues-in-kubeVirt-1-0Ôºü" class="headerlink" title="What issues in kubeVirt 1.0Ôºü"></a>What issues in kubeVirt 1.0Ôºü</h3><h4 id="CgroupV2-support"><a href="#CgroupV2-support" class="headerlink" title="CgroupV2 support"></a>CgroupV2 support</h4><p>When using cgroup v2, starting a VM with a non-hotpluggable volume can be problematic because cgroup v2 doesn‚Äôt provide information about the currently allowed devices for a container. KubeVirt addresses this issue by tracking device rules internally using a global variable:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/kubevirt/7/pkg/virt-handler/cgroup/cgroup_v2_manager.go#L10</span><br><span class="line"></span><br><span class="line">var rulesPerPid = make(map[string][]*devices.Rule)</span><br></pre></td></tr></table></figure><p>However, this approach has some drawbacks:</p><p>The variable won‚Äôt survive a crash or restart of the virt-handler pod, resulting in data loss.<br>The state is stored in a dynamic structure (a map), and stale data is not removed, causing memory consumption to continuously increase.<br>A potential solution is to store the state in a file, for example, <code>/var/run/kubevirt-private/devices.list</code>. This file should be updated each time a device is added or removed. Additionally, it should be removed when the corresponding VM is destroyed, or periodic cleanup can be performed. The file can follow the same data format as devices.list on cgroup v1 hosts, allowing the same code to parse the current state for both v1 and v2.</p><p>However, managing the file introduces the challenge of performing transactions, i.e., applying actual device rules and writing the state to the file atomically.</p><p>You can find more details and discussions about this issue in GitHub issue #7710.</p><h4 id="Cilium-Support"><a href="#Cilium-Support" class="headerlink" title="Cilium Support"></a>Cilium Support</h4><ul><li>cilium multi-homing<br>In Kubernetes, each pod typically has only one network interface (aside from a loopback interface). Cilium-native multi-homing aims to enable the attachment of additional network interfaces to pods. This functionality is similar to what the Multus CNI offers, which allows the attachment of multiple network interfaces to pods. However, Cilium-native multi-homing distinguishes itself by relying exclusively on the Cilium CNI as the sole CNI installed.</li></ul><p>This feature should provide robust support for all existing Cilium datapath capabilities, including network policies, observability, datapath acceleration, and service discovery. Furthermore, it aims to offer a straightforward developer experience that aligns with the simplicity and usability that Cilium already provides today.</p><ul><li>multus<br>When utilizing Cilium version 1.14.0 alongside multus-cni, there seems to be an issue where the secondary interface does not become visible. Here‚Äôs a list of files you can find under the &#x2F;etc&#x2F;cni directory after installing multus in a Cilium 1.14 environment:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l</span><br><span class="line">/etc/cni/net.d/05-cilium.conflist</span><br><span class="line">/etc/cni/net.d/00-multus.conf.cilium_bak</span><br><span class="line">/etc/cni/net.d/100-crio-bridge.conflist.cilium_bak</span><br><span class="line">/etc/cni/net.d/200-loopback.conflist.cilium_bak</span><br><span class="line">/etc/cni/net.d/multus.d/multus.kubeconfig</span><br></pre></td></tr></table></figure>The issue with multus installation in Cilium 1.14 has been resolved by setting cni.exclusive to false.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Make Cilium take ownership over the `/etc/cni/net.d` directory on the</span><br><span class="line"># node, renaming all non-Cilium CNI configurations to `*.cilium_bak`.</span><br><span class="line"># This ensures no Pods can be scheduled using other CNI plugins during Cilium</span><br><span class="line"># agent downtime.</span><br><span class="line">exclusive: false</span><br></pre></td></tr></table></figure></li></ul><h4 id="Harbor-limit"><a href="#Harbor-limit" class="headerlink" title="Harbor limit"></a>Harbor limit</h4><p>We encountered an issue when attempting to push a container with a single layer size which contain win.qcow2 image exceeding 10.25GB to our Harbor instance hosted on an EC2 instance. Our Harbor version is v2.1.2, and we are using S3 as the storage backend.</p><p>Our system has successfully handled containers with total sizes exceeding 15GB in the past. However, this specific container with a single layer size of 13.5GB repeatedly fails to push. On the client side, we receive limited feedback:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Sep 10 22:29:19 backend-ci dockerd[934]:</span><br><span class="line">time=&quot;2023-09-10T22:29:19.628869277+02:00&quot; level=error msg=&quot;Upload failed, retrying: blob upload unknown&quot;</span><br><span class="line">Although the push activity completes successfully, the client-side error only appears afterward. In the registry.log, we‚Äôve noticed the following error:</span><br><span class="line"></span><br><span class="line">registry[885]: time=&quot;2023-09-10T08:47:25.330317861Z&quot; level=error msg=&quot;upload resumed at wrong offest: 10485760000 != 12341008872&quot;</span><br></pre></td></tr></table></figure><p>We would greatly appreciate any insights or advice on this matter. Perhaps others have encountered similar issues with very large layers, especially when using S3 as a storage backend, where pushing layers larger than 10GB is not supported. We‚Äôve also come across potential fixes proposed in this GitHub pull request:</p><p><a href="https://github.com/goharbor/harbor/pull/16322">https://github.com/goharbor/harbor/pull/16322</a></p><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>KubeVirt simplifies running virtual machines on Kubernetes, making it as easy as managing containers. It provides a cloud-native approach to managing virtual machines. KubeVirt addresses the challenge of unifying the management of virtual machines and containers, effectively harnessing the strengths of both. However, there is still a long way to go in practice. Nevertheless, the release of version 1.0 is significant for the community and users. We look forward to the widespread adoption of KubeVirt and its full support for cgroupv2.</p><ul><li><p><a href="https://documentation.suse.com/container/kubevirt/html/SLE-kubevirt/index.html">https://documentation.suse.com/container/kubevirt/html/SLE-kubevirt/index.html</a></p></li><li><p><a href="https://kubevirt.io/2023/KubeVirt-v1-has-landed.html">https://kubevirt.io/2023/KubeVirt-v1-has-landed.html</a></p></li><li><p>CFP: Cilium-native multi-homing ¬∑ Issue #20129</p></li><li><p><a href="https://github.com/goharbor/harbor/issues/15719">https://github.com/goharbor/harbor/issues/15719</a></p></li><li><p><a href="https://github.com/kubevirt/kubevirt/issues/398">https://github.com/kubevirt/kubevirt/issues/398</a></p></li><li><p><a href="https://github.com/k8snetworkplumbingwg/multus-cni/issues/1132">https://github.com/k8snetworkplumbingwg/multus-cni/issues/1132</a></p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;The KubeVirt community is thrilled to announce the highly-anticipated release of KubeVirt v1.0! This momentous release signifies the rema</summary>
      
    
    
    
    <category term="kubevirt" scheme="https://zoues.com/categories/kubevirt/"/>
    
    
    <category term="kubernetes" scheme="https://zoues.com/tags/kubernetes/"/>
    
    <category term="cncf" scheme="https://zoues.com/tags/cncf/"/>
    
    <category term="kubevirt" scheme="https://zoues.com/tags/kubevirt/"/>
    
  </entry>
  
  <entry>
    <title>Embracing Cgroup V2:Best Practices for Migrating Kubernetes Clusters to AlmaLinux</title>
    <link href="https://zoues.com/posts/58fc8d19/"/>
    <id>https://zoues.com/posts/58fc8d19/</id>
    <published>2024-01-20T05:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.375Z</updated>
    
    <content type="html"><![CDATA[<p>With the announcement of CentOS discontinuation by the CentOS community , along with the set dates for service termination, we have put the switch to a new container operating system on our agenda. Based on factors such as migration cost, smoothness of transition, and maintenance difficulty, we have chosen AlmaLinux from the RHEL series as an alternative solution.</p><p>NOTE: AlmaLinux is just one of the replacement options available within the RHEL ecosystem. Our choice is based on our specific production needs and does not necessarily apply to everyone.</p><p>AlmaLinux 9 defaults to using cgroup v2, and this configuration affects some underlying components. Therefore, certain adaptations and compatibility work need to be done. This article presents the best practices for migrating Kubernetes cluster nodes from CentOS to AlmaLinux which involves removing dockershim and utilizing cgroup v2 for node resource management.</p><h2 id="Why-Cgroup-v2"><a href="#Why-Cgroup-v2" class="headerlink" title="Why Cgroup v2?"></a>Why Cgroup v2?</h2><p>Effective resource management is a critical aspect of Kubernetes. This involves managing the finite resources in your nodes, such as CPU, memory, and storage.</p><p><em>cgroups</em> are a Linux kernel capability that establish resource management functionality like limiting CPU usage or setting memory limits for running processes.</p><p>When you use the resource management capabilities in Kubernetes, such as configuring requests and limits for Pods and containers, Kubernetes uses cgroups to enforce your resource requests and limits.</p><p>The Linux kernel offers two versions of cgroups: cgroup v1 and v2.</p><p>Here is our comparison between the two versions based on our research:</p><table><thead><tr><th></th><th>cgroup v1</th><th>cgroup v2</th></tr></thead><tbody><tr><td>Maintainability</td><td>deprecate and systemd community intend to remove cgroup v1 support from systemd release after the end of 2023</td><td>Many recent releases of Linux distributions have switched over to cgroup v2 by default</td></tr><tr><td>Compatibility</td><td>support</td><td>1. Components such as kubelet need to be adapted for cgroup v2 2. Business applications require JDK version upgrades, which can be achieved by replacing the base image</td></tr><tr><td>hierarchy</td><td>multiple hierarchiesÔºåit wasn‚Äôt useful and complicated in practice</td><td>single unified hierarchy</td></tr><tr><td>resource allocation management</td><td>basic</td><td>more powerful„ÄÅdynamic and enhanced resource allocation managementÔºåsuch as the followingÔºö ‚Ä¢ Unified accounting for different types of memory allocations (network and kernel memory, etc) ‚Ä¢ Accounting for non-immediate resource changes such as page cache write backs ‚Ä¢ Safer sub-tree delegation to containers</td></tr><tr><td>Performance</td><td>support for multiple hierarchies came at a steep cost</td><td>better</td></tr><tr><td>Scalability</td><td>it seemed to provide a high level of flexibility,  but it wasn‚Äôt useful in practice</td><td>provide a high level of flexibility Ôºånew features like PSI</td></tr><tr><td>Security</td><td>the known CVEs, such as cve-2022-0492„ÄÅcve-2021-4154</td><td>support rootless container</td></tr></tbody></table><p>cgroup v2 has been in development in the Linux Kernel since 2016 and in recent years has matured across the container ecosystem. With Kubernetes 1.25, cgroup v2 support has graduated to general availability.</p><h2 id="What-issues-were-encounteredÔºü"><a href="#What-issues-were-encounteredÔºü" class="headerlink" title="What issues were encounteredÔºü"></a>What issues were encounteredÔºü</h2><h3 id="Java-applications"><a href="#Java-applications" class="headerlink" title="Java applications"></a>Java applications</h3><p><a href="https://bugs.openjdk.org/browse/JDK-8146115">JDK-8146115</a> added Hotspot runtime support for JVMs running in Docker containers. At the time Docker used cgroups v1 and, hence, runtime support only includes cgroup v1 controllers.</p><p>JDK-8230305 extended functionality of <a href="https://bugs.openjdk.org/browse/JDK-8146115">JDK-8146115</a> to also detect cgroups v2. That is iff cgroups v2 unified hierarchy is available only, use the cgroups v2 backend. Otherwise fall back to existing cgroups v1 container support.</p><p>require versionÔºöjdk8u372, 11.0.16, 15 and later</p><h3 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h3><p>Currently,  the version of Kubernetes in production is 1.19 and enabling cgroup v2 support for kubelet is proving to be challenging. While a comprehensive upgrade of Kubernetes is being researched and prepared, we are currently focusing on implementing cgroup v2 support specifically for kubelet. This approach allows for a shorter implementation time while laying the foundation for the subsequent comprehensive upgrade.</p><p>To enable cgroup v2 support, several adjustments need to be made to various components:</p><ol><li>Kernel Version: We are currently using kernel version 5.15, which meets the minimum requirement for cgroup v2 (4.14). However, it is recommended to use kernel version 5.2 or newer due to the lack of freezer support in older versions.</li><li>Systemd and Runc: It is highly recommended to run runc with the systemd cgroup driver (<code>runc --systemd-cgroup</code>), although it is not mandatory. To ensure compatibility, it is recommended to use systemd version 244 or later, as older versions do not support delegation of the <code>cpuset</code> controller.</li><li>Kubelet : The vendor for kubelet needs to upgrade the runc version. Currently, the latest fully supported version of runc for cgroup v2 is rc93. To minimize changes, we have chosen rc94 and modified the kubelet code to internally maintain runc rc94. This allows us to merge the necessary cgroup v2-related pull requests. However, in rc95, there are significant changes to the cgroup.Manager interface, which does not align with the principle of minimal changes.</li></ol><p>metrics-server retrieves resource usage information of nodes and pods using kubelet summary and other interfaces. This data is crucial for Horizontal Pod Autoscaling (HPA) based on resource scaling. To eliminate dockershim, the kubelet should utilize the systemd cgroup driver and configure the runtime accordingly.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--container-runtime=remote --container-runtime-endpoint=unix:///run/containerd/containerd.sock</span><br></pre></td></tr></table></figure><ol start="4"><li>Containerd : starting from version 1.4, containerd supports cgroup v2. We have successfully validated the removal of dockershim and conducted thorough testing of business operations in the testing environment. With the successful testing, we will proceed with the production rollout. Similar to kubelet, containerd also requires the systemd cgroup driver. Use the following configuration for the systemd cgroup driver:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[plugins.<span class="string">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runc]</span><br><span class="line">  ...</span><br><span class="line">  [plugins.<span class="string">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runc.options]</span><br><span class="line">    SystemdCgroup = <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>The configuration of the sandbox image and registry can be customized based on specific requirements.</p><h3 id="Systemd-with-cilium"><a href="#Systemd-with-cilium" class="headerlink" title="Systemd with cilium"></a>Systemd with cilium</h3><p>SystemD versions greater than 245 automatically set the rp_filter value to 1 for all network interfaces. This conflicts with Cilium, which requires rp_filter to be 0 on its interfaces, leading to a disruption in out-of-node IPv4 traffic.</p><p>Therefore, it is crucial to exercise caution before upgrading SystemD, as demonstrated by the failure experienced by Datadog, which served as a significant warning.</p><p>on March 8, 2023, at 06:00 UTC, a security update to systemd was automatically applied to several VMs, which caused a latent adverse interaction in the network stack (on Ubuntu 22.04 via systemd v249) to manifest upon systemd-networkd restarting.Namely, <code>systemd-networkd</code> forcibly deleted the routes managed by the Container Network Interface (CNI) plugin (Cilium) we use for communication between containers. This caused the affected nodes to go offline.</p><p>Additionally, when container runtimes are configured with cgroup v2, the Cilium agent pod is deployed in a separate cgroup namespace. For example, Docker container runtime with cgroupv2 support defaults to private cgroup namespace mode. Due to cgroup namespaces, the Cilium pod‚Äôs cgroup filesystem points to a virtualized hierarchy instead of the host cgroup root. Consequently, BPF programs are attached to the nested cgroup root, rendering socket load balancing ineffective for other pods. To address this limitation, work is being done in the Cilium project  to revisit assumptions made around cgroup hierarchies and enable socket load balancing in different environments.</p><p>Don‚Äôt worry, these issues have already been fixed by the community.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>During the testing process of Cgroup V2 and removing dockershim in our testing environment, we conducted extensive adaptation and stability tests. Our long-term analysis revealed that the benefits of adopting this technology roadmap far outweigh the initial investment. As part of our plan, we intend to promote the adoption of Cgroup V2-based machines in production. This will involve a meticulous testing and validation process, followed by a gradual rollout in production environments. We will start with offline applications such as logging and big data applications.</p><p>The Cloud Native Computing Foundation‚Äôs flagship conference gathers adopters and technologists from leading open source and cloud native communities in Shanghai, China from 26-28 September, 2023.  We are considering submitting a proposal for a presentation at KubeCon 2023, where we will have the opportunity to share the latest developments and insights with the conference attendees.</p><p><a href="https://bugs.openjdk.org/browse/JDK-8230305">https://bugs.openjdk.org/browse/JDK-8230305</a></p><p><a href="https://kubernetes.io/blog/2022/08/31/cgroupv2-ga-1-25/">https://kubernetes.io/blog/2022/08/31/cgroupv2-ga-1-25/</a></p><p><a href="https://www.kernel.org/doc/html/latest/admin-guide/cgroup-v2.html">https://www.kernel.org/doc/html/latest/admin-guide/cgroup-v2.html</a></p><p><a href="https://github.com/cilium/cilium/issues/10645">https://github.com/cilium/cilium/issues/10645</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;With the announcement of CentOS discontinuation by the CentOS community , along with the set dates for service termination, we have put t</summary>
      
    
    
    
    <category term="cgroupv2" scheme="https://zoues.com/categories/cgroupv2/"/>
    
    
    <category term="kubernetes" scheme="https://zoues.com/tags/kubernetes/"/>
    
    <category term="cncf" scheme="https://zoues.com/tags/cncf/"/>
    
    <category term="almalinux" scheme="https://zoues.com/tags/almalinux/"/>
    
  </entry>
  
  <entry>
    <title>ZiglangÁÆÄÊòéÊïôÁ®ã</title>
    <link href="https://zoues.com/posts/5941d835/"/>
    <id>https://zoues.com/posts/5941d835/</id>
    <published>2024-01-14T05:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.375Z</updated>
    
    <content type="html"><![CDATA[<p>Ëøô‰ªΩzigÁÆÄÊòéÊïôÁ®ãÈÄÇÂêàÂ∑≤ÁªèÊúâÁºñÁ®ãÂü∫Á°ÄÁü•ËØÜÁöÑÂêåÂ≠¶Âø´ÈÄü‰∫ÜËß£zigËØ≠Ë®ÄÔºåÂêåÊó∂‰πüÈÄÇÂêàÊ≤°ÊúâÁºñÁ®ãÁªèÈ™å‰ΩÜÊòØÊáÇÂæóÂñÑÁî®ÊêúÁ¥¢ÂºïÊìéÁöÑÂêåÂ≠¶,ËØ•ÊñáÁ´†ËØ¶ÁªÜ‰ªãÁªçZigÁºñÁ®ãËØ≠Ë®ÄÂêÑÁßçÊ¶ÇÂøµÔºå‰∏ªË¶ÅÂåÖÊã¨Âü∫Á°ÄÁü•ËØÜ„ÄÅÂáΩÊï∞„ÄÅÁªìÊûÑ‰Ωì„ÄÅÊûö‰∏æ„ÄÅÊï∞ÁªÑ„ÄÅÂàáÁâá„ÄÅÊéßÂà∂ÁªìÊûÑ„ÄÅÈîôËØØÂ§ÑÁêÜ„ÄÅÊåáÈíà„ÄÅÂÖÉÁºñÁ®ãÂíåÂ†ÜÁÆ°ÁêÜÁ≠âÂÜÖÂÆπ„ÄÇ</p><h3 id="Âü∫Á°ÄÁü•ËØÜ"><a href="#Âü∫Á°ÄÁü•ËØÜ" class="headerlink" title="Âü∫Á°ÄÁü•ËØÜ"></a>Âü∫Á°ÄÁü•ËØÜ</h3><p>ÂëΩ‰ª§ <code>zig run my_code.zig</code> Â∞ÜÁºñËØëÂπ∂Á´ãÂç≥ËøêË°å‰Ω†ÁöÑ Zig Á®ãÂ∫è„ÄÇÊØè‰∏™ÂçïÂÖÉÊ†ºÈÉΩÂåÖÂê´‰∏Ä‰∏™ Zig Á®ãÂ∫èÔºå‰Ω†ÂèØ‰ª•Â∞ùËØïËøêË°åÂÆÉ‰ª¨ÔºàÂÖ∂‰∏≠‰∏Ä‰∫õÂåÖÂê´ÁºñËØëÊó∂ÈîôËØØÔºå‰Ω†ÂèØ‰ª•Ê≥®ÈáäÊéâÂêéÂÜçÂ∞ùËØïÔºâ„ÄÇ</p><p>È¶ñÂÖàÈúÄË¶ÅÂ£∞Êòé‰∏Ä‰∏™ <code>main()</code> ÂáΩÊï∞Êù•ËøêË°å‰ª£Á†Å„ÄÇ</p><p>‰∏ãÈù¢ÁöÑ‰ª£Á†Å‰ªÄ‰πàÈÉΩ‰∏ç‰ºöÂÅöÔºåÂè™ÊòØÁÆÄÂçïÁöÑÁ§∫‰æãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// comments look like this and go to the end of the line</span><br><span class="line">pub fn main() void &#123;&#125;</span><br></pre></td></tr></table></figure><p>ÂèØ‰ª•‰ΩøÁî® ÂÜÖÁΩÆÂáΩÊï∞<code>@import</code> ÂØºÂÖ•Ê†áÂáÜÂ∫ìÔºåÂπ∂Â∞ÜÂëΩÂêçÁ©∫Èó¥ËµãÂÄºÁªô‰∏Ä‰∏™ <code>const</code> ÂÄº„ÄÇZig ‰∏≠ÁöÑÂá†‰πéÊâÄÊúâ‰∏úË•øÈÉΩÂøÖÈ°ªÊòéÁ°ÆÂú∞Ë¢´Ëµã‰∫àÊ†áËØÜÁ¨¶„ÄÇ‰Ω†‰πüÂèØ‰ª•ÈÄöËøáËøôÁßçÊñπÂºèÂØºÂÖ•ÂÖ∂‰ªñ Zig Êñá‰ª∂ÔºåÁ±ª‰ººÂú∞Ôºå‰Ω†ÂèØ‰ª•‰ΩøÁî® <code>@cImport</code> ÂØºÂÖ• C Êñá‰ª∂„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    std.debug.print(&quot;hello world!\n&quot;, .&#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ê≥®ÊÑèÔºöÂêéÁª≠‰ºöÂú®ÁªìÊûÑÈÉ®ÂàÜÈÉ®ÂàÜËß£Èáä <code>print</code> ËØ≠Âè•‰∏≠ÁöÑÁ¨¨‰∫å‰∏™ÂèÇÊï∞„ÄÇ</p><p>‰∏ÄËà¨Áî®<code>var</code> Êù•Â£∞ÊòéÂèòÈáèÔºåÂêåÊó∂Âú®Â§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÔºåÈúÄË¶ÅÂ∏¶‰∏äÂ£∞ÊòéÂèòÈáèÁ±ªÂûã„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var x: i32 = 47; // declares &quot;x&quot; of type i32 to be 47.</span><br><span class="line">    std.debug.print(&quot;x: &#123;&#125;\n&quot;, .&#123;x&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>const</code> Â£∞Êòé‰∏Ä‰∏™ÂèòÈáèÁöÑÂÄºÊòØ‰∏çÂèØÂèòÁöÑ„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pub fn main() void &#123;</span><br><span class="line">    const x: i32 = 47;</span><br><span class="line">    x = 42; // error: cannot assign to constant</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Zig ÈùûÂ∏∏‰∏•ËãõÔºå‰∏çÂÖÅËÆ∏‰Ω†‰ªéÂ§ñÈÉ®‰ΩúÁî®ÂüüÂ±èËîΩÊ†áËØÜÁ¨¶Ôºå‰ª•Èò≤Ê≠¢Ê∑∑Ê∑ÜÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const x: i32 = 47;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var x: i32 = 42;  // error: redefinition of &#x27;x&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂÖ®Â±Ä‰ΩúÁî®ÂüüÁöÑÂ∏∏ÈáèÈªòËÆ§‰∏∫ÁºñËØëÊó∂ÁöÑ ‚Äúcomptime‚Äù ÂÄºÔºåÂ¶ÇÊûúÁúÅÁï•‰∫ÜÁ±ªÂûãÔºåÂÆÉ‰ª¨Â∞±ÊòØÁºñËØëÊó∂Á±ªÂûãÔºåÂπ∂‰∏îÂèØ‰ª•Âú®ËøêË°åÊó∂ËΩ¨Êç¢‰∏∫ËøêË°åÊó∂Á±ªÂûã„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const x: i32 = 47;</span><br><span class="line">const y = -47;  // comptime integer.</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var a: i32 = y; // comptime constant coerced into correct type</span><br><span class="line">    var b: i64 = y; // comptime constant coerced into correct type</span><br><span class="line">    var c: u32 = y; // error: cannot cast negative value -47 to unsigned integer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Â¶ÇÊûúÂ∏åÊúõÂú®ÂêéÈù¢ËÆæÁΩÆÂÆÉÔºå‰πüÂèØ‰ª•ÊòéÁ°ÆÈÄâÊã©Â∞ÜÂÖ∂‰øùÁïô‰∏∫Êú™ÂÆö‰πâ„ÄÇÂ¶ÇÊûú‰Ω†Âú®Ë∞ÉËØïÊ®°Âºè‰∏ãÊÑèÂ§ñ‰ΩøÁî®ÂÆÉÂºïÂèëÈîôËØØÔºåZig Â∞Ü‰ΩøÁî® 0XAA Â≠óËäÇÂ°´ÂÖÖ‰∏Ä‰∏™ËôöÊãüÂÄºÔºå‰ª•Â∏ÆÂä©Ê£ÄÊµãÈîôËØØ„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">  var x: i32 = undefined;</span><br><span class="line">  std.debug.print(&quot;undefined: &#123;&#125;\n&quot;, .&#123;x&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Âú®Êüê‰∫õÊÉÖÂÜµ‰∏ãÔºåÂ¶ÇÊûú Zig ÂèØ‰ª•Êé®Êñ≠Âá∫Á±ªÂûã‰ø°ÊÅØÔºåÊâçÂÖÅËÆ∏‰Ω†ÁúÅÁï•Á±ªÂûã‰ø°ÊÅØ„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var x: i32 = 47;</span><br><span class="line">    var y: i32 = 47;</span><br><span class="line">    var z = x + y; // declares z and sets it to 94.</span><br><span class="line">    std.debug.print(&quot;z: &#123;&#125;\n&quot;, .&#123;z&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰ΩÜÊòØÈúÄË¶ÅÊ≥®ÊÑèÔºåÊï¥Êï∞Â≠óÈù¢ÂÄºÊòØÁºñËØëÊó∂Á±ªÂûãÔºåÊâÄ‰ª•‰∏ãÈù¢ÁöÑÁ§∫‰æãÊòØË°å‰∏çÈÄöÁöÑÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pub fn main() void &#123;</span><br><span class="line">    var x = 47; // error: variable of type &#x27;comptime_int&#x27; must be const or comptime</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ÂáΩÊï∞"><a href="#ÂáΩÊï∞" class="headerlink" title="ÂáΩÊï∞"></a>ÂáΩÊï∞</h3><p>ÂáΩÊï∞ÂèØ‰ª•Â∏¶ÂèÇÊï∞ÂíåËøîÂõûÂÄºÔºå‰ΩøÁî®<code>fn</code>ÂÖ≥ÈîÆÂ≠óÂ£∞Êòé„ÄÇ<code>pub</code>ÂÖ≥ÈîÆÂ≠óË°®Á§∫ÂáΩÊï∞ÂèØ‰ª•‰ªéÂΩìÂâç‰ΩúÁî®ÂüüÂØºÂá∫Ôºå‰ΩøÂÖ∂ÂÆÉÂú∞ÊñπÂèØ‰ª•Ë∞ÉÁî®„ÄÇ‰∏ãÈù¢Á§∫‰æãÊòØ‰∏Ä‰∏™‰∏çËøîÂõû‰ªª‰ΩïÂÄºÁöÑÂáΩÊï∞ÔºàfooÔºâ„ÄÇ<code>pub</code>ÂÖ≥ÈîÆÂ≠óË°®Á§∫ËØ•ÂáΩÊï∞ÂèØ‰ª•‰ªéÂΩìÂâç‰ΩúÁî®ÂüüÂØºÂá∫ÔºåËøôÂ∞±ÊòØ‰∏∫‰ªÄ‰πà<code>main</code>ÂáΩÊï∞ÂøÖÈ°ªÊòØ<code>pub</code>ÁöÑ„ÄÇ‰Ω†ÂèØ‰ª•ÂÉèÂ§ßÂ§öÊï∞ÁºñÁ®ãËØ≠Ë®Ä‰∏≠‰∏ÄÊ†∑Ë∞ÉÁî®ÂáΩÊï∞Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">fn foo() void &#123;</span><br><span class="line">    std.debug.print(&quot;foo!\n&quot;, .&#123;&#125;);</span><br><span class="line"></span><br><span class="line">    //optional:</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    foo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰∏ãÈù¢Á§∫‰æãÊòØ‰∏Ä‰∏™ËøîÂõûÊï¥Êï∞ÂÄºÁöÑÂáΩÊï∞Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">fn foo() i32 &#123;</span><br><span class="line">    return 47;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var result = foo();</span><br><span class="line">    std.debug.print(&quot;foo: &#123;&#125;\n&quot;, .&#123;result&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Zig‰∏çÂÖÅËÆ∏‰Ω†ÂøΩÁï•ÂáΩÊï∞ÁöÑËøîÂõûÂÄºÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn foo() i32 &#123;</span><br><span class="line">    return 47;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    foo(); // error: expression value is ignored</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰ΩÜÊòØ‰Ω†ÂèØ‰ª•Â∞ÜÂÖ∂ËµãÂÄºÁªô‰∏¢ÂºÉÂèòÈáè <code>_</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn foo() i32 &#123;</span><br><span class="line">    return 47;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">  _ = foo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰πüÂèØ‰ª•Â£∞ÊòéÂáΩÊï∞Êó∂Â∏¶‰∏äÂèÇÊï∞ÁöÑÁ±ªÂûãÔºåËøôÊ†∑ÂáΩÊï∞Ë∞ÉÁî®Êó∂ÂèØ‰ª•‰º†ÂÖ•ÂèÇÊï∞Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">fn foo(x: i32) void &#123;</span><br><span class="line">    std.debug.print(&quot;foo param: &#123;&#125;\n&quot;, .&#123;x&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    foo(47);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ÁªìÊûÑ‰Ωì"><a href="#ÁªìÊûÑ‰Ωì" class="headerlink" title="ÁªìÊûÑ‰Ωì"></a>ÁªìÊûÑ‰Ωì</h3><p>ÁªìÊûÑ‰ΩìÈÄöËøá‰ΩøÁî®<code>const</code>ÂÖ≥ÈîÆÂ≠óÂàÜÈÖç‰∏Ä‰∏™ÂêçÁß∞Êù•Â£∞ÊòéÔºåÂÆÉ‰ª¨ÁöÑËµãÂÄºÈ°∫Â∫èÂèØ‰ª•ÊòØ‰ªªÊÑèÁöÑÔºåÂπ∂‰∏îÂèØ‰ª•‰ΩøÁî®Â∏∏ËßÑÁöÑÁÇπËØ≠Ê≥ïËøõË°åËß£ÂºïÁî®„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">const Vec2 = struct &#123;</span><br><span class="line">    x: f64,</span><br><span class="line">    y: f64</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var v = Vec2&#123;.y = 1.0, .x = 2.0&#125;;</span><br><span class="line">    std.debug.print(&quot;v: &#123;&#125;\n&quot;, .&#123;v&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁªìÊûÑ‰ΩìÂèØ‰ª•ÊúâÈªòËÆ§ÂÄºÔºõÁªìÊûÑ‰Ωì‰πüÂèØ‰ª•ÊòØÂåøÂêçÁöÑÔºåÂπ∂‰∏îÂèØ‰ª•Âº∫Âà∂ËΩ¨Êç¢‰∏∫Âè¶‰∏Ä‰∏™ÁªìÊûÑ‰ΩìÔºåÂè™Ë¶ÅÊâÄÊúâÁöÑÂÄºÈÉΩËÉΩÁ°ÆÂÆöÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">const Vec3 = struct&#123;</span><br><span class="line">    x: f64 = 0.0,</span><br><span class="line">    y: f64,</span><br><span class="line">    z: f64</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var v: Vec3 = .&#123;.y = 0.1, .z = 0.2&#125;;  // ok</span><br><span class="line">    var w: Vec3 = .&#123;.y = 0.1&#125;; // error: missing field: &#x27;z&#x27;</span><br><span class="line">    std.debug.print(&quot;v: &#123;&#125;\n&quot;, .&#123;v&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂèØ‰ª•Â∞ÜÂáΩÊï∞ÊîæÂÖ•ÁªìÊûÑ‰Ωì‰∏≠Ôºå‰ΩøÂÖ∂ÂÉèÈù¢ÂêëÂØπË±°ÁºñÁ®ã‰∏≠ÁöÑÂØπË±°‰∏ÄÊ†∑Â∑•‰Ωú„ÄÇËøôÈáåÊúâ‰∏Ä‰∏™ËØ≠Ê≥ïÁ≥ñÔºåÂ¶ÇÊûú‰Ω†ÂÆö‰πâÁöÑÂáΩÊï∞ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞‰∏∫ÂØπË±°ÁöÑÊåáÈíàÔºåÊàë‰ª¨Áß∞‰πã‰∏∫‚ÄùÈù¢ÂêëÂØπË±°ÁºñÁ®ã‚ÄùÔºåÁ±ª‰ºº‰∫éPythonÂ∏¶selfÂèÇÊï∞ÁöÑÂáΩÊï∞„ÄÇ‰∏ÄËà¨Á∫¶ÂÆöÊòØÈÄöËøáÂ∞ÜÂèòÈáèÂëΩÂêç‰∏∫selfÊù•Ë°®Á§∫„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">const LikeAnObject = struct&#123;</span><br><span class="line">    value: i32,</span><br><span class="line"></span><br><span class="line">    fn print(self: *LikeAnObject) void &#123;</span><br><span class="line">        std.debug.print(&quot;value: &#123;&#125;\n&quot;, .&#123;self.value&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var obj = LikeAnObject&#123;.value = 47&#125;;</span><br><span class="line">    obj.print();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Êàë‰ª¨‰∏ÄÁõ¥‰º†ÈÄíÁªô<code>std.debug.print</code>ÁöÑÁ¨¨‰∫å‰∏™ÂèÇÊï∞ÊòØ‰∏Ä‰∏™ÂÖÉÁªÑÔºåÂÆÉÊòØ‰∏Ä‰∏™Â∏¶ÊúâÊï∞Â≠óÂ≠óÊÆµÁöÑÂåøÂêçÁªìÊûÑ‰Ωì„ÄÇÂú®ÁºñËØëÊó∂Ôºå<code>std.debug.print</code>‰ºöÊâæÂá∫ÂÖÉÁªÑ‰∏≠ÂèÇÊï∞ÁöÑÁ±ªÂûãÔºåÂπ∂ÁîüÊàê‰∏Ä‰∏™ÈíàÂØπ‰Ω†Êèê‰æõÁöÑÂèÇÊï∞Â≠óÁ¨¶‰∏≤ÁöÑÁâàÊú¨ÔºåËøôÂ∞±ÊòØ‰∏∫‰ΩïZigÁü•ÈÅìÂ¶Ç‰ΩïÂ∞ÜÊâìÂç∞ÁöÑÂÜÖÂÆπÂèòÂæóÊºÇ‰∫ÆÁöÑÂéüÂõ†„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    std.debug.print(&quot;&#123;&#125;\n&quot;, .&#123;1, 2&#125;); #  error: Unused arguments</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Êûö‰∏æ"><a href="#Êûö‰∏æ" class="headerlink" title="Êûö‰∏æ"></a>Êûö‰∏æ</h3><p>Êûö‰∏æÈÄöËøá‰ΩøÁî®<code>const</code>ÂÖ≥ÈîÆÂ≠óÂ∞ÜÊûö‰∏æÁªÑ‰ª•Á±ªÂûãÊñπÂºèÊù•Â£∞Êòé„ÄÇ</p><p>Ê≥®ÊÑèÔºöÂú®Êüê‰∫õÊÉÖÂÜµ‰∏ãÔºåÂèØ‰ª•ÁÆÄÂåñÊûö‰∏æÁöÑÂêçÁß∞„ÄÇ ÂÖ∂ÂèØ‰ª•Â∞ÜÊûö‰∏æÁöÑÂÄºËÆæÁΩÆ‰∏∫Êï¥Êï∞Ôºå‰ΩÜÂÆÉ‰∏ç‰ºöËá™Âä®Âº∫Âà∂ËΩ¨Êç¢Ôºå‰Ω†ÂøÖÈ°ª‰ΩøÁî®<code>@enumToInt</code>Êàñ<code>@intToEnum</code>Êù•ËøõË°åËΩ¨Êç¢„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">const EnumType = enum&#123;</span><br><span class="line">    EnumOne,</span><br><span class="line">    EnumTwo,</span><br><span class="line">    EnumThree = 3</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    std.debug.print(&quot;One: &#123;&#125;\n&quot;, .&#123;EnumType.EnumOne&#125;);</span><br><span class="line">    std.debug.print(&quot;Two?: &#123;&#125;\n&quot;, .&#123;EnumType.EnumTwo == .EnumTwo&#125;);</span><br><span class="line">    std.debug.print(&quot;Three?: &#123;&#125;\n&quot;, .&#123;@enumToInt(EnumType.EnumThree) == 3&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Êï∞ÁªÑÂíåÂàáÁâá"><a href="#Êï∞ÁªÑÂíåÂàáÁâá" class="headerlink" title="Êï∞ÁªÑÂíåÂàáÁâá"></a>Êï∞ÁªÑÂíåÂàáÁâá</h3><p>ZigÊúâÊï∞ÁªÑÊ¶ÇÂøµÔºåÂÆÉ‰ª¨ÊòØÂÖ∑ÊúâÂú®ÁºñËØëÊó∂Â∑≤Áü•ÈïøÂ∫¶ÁöÑËøûÁª≠ÂÜÖÂ≠ò„ÄÇ‰Ω†ÂèØ‰ª•ÈÄöËøáÂú®ÂâçÈù¢Â£∞ÊòéÁ±ªÂûãÂπ∂Êèê‰æõÂÄºÂàóË°®Êù•ÂàùÂßãÂåñÂÆÉ‰ª¨ÔºåÂêåÊó∂ÂèØ‰ª•ÈÄöËøáÊï∞ÁªÑÁöÑ<code>len</code>Â≠óÊÆµËÆøÈóÆÂÆÉ‰ª¨ÁöÑÈïøÂ∫¶„ÄÇ</p><p>Ê≥®ÊÑèÔºöZig‰∏≠ÁöÑÊï∞ÁªÑ‰πüÊòØ‰ªéÈõ∂ÂºÄÂßãÁ¥¢ÂºïÁöÑ„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var array: [3]u32 = [3]u32&#123;47, 47, 47&#125;;</span><br><span class="line"></span><br><span class="line">    // also valid:</span><br><span class="line">    // var array = [_]u32&#123;47, 47, 47&#125;;</span><br><span class="line"></span><br><span class="line">    var invalid = array[4]; // error: index 4 outside array of size 3.</span><br><span class="line">    std.debug.print(&quot;array[0]: &#123;&#125;\n&quot;, .&#123;array[0]&#125;);</span><br><span class="line">    std.debug.print(&quot;length: &#123;&#125;\n&quot;, .&#123;array.len&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ë∑ügolangÁ±ª‰ººÔºåZig‰πüÊúâÂàáÁâáÔºàslicesÔºâÔºåÂÆÉ‰ª¨ÁöÑÈïøÂ∫¶Âú®ËøêË°åÊó∂Â∑≤Áü•„ÄÇ‰Ω†ÂèØ‰ª•‰ΩøÁî®ÂàáÁâáÊìç‰Ωú‰ªéÊï∞ÁªÑÊàñÂÖ∂‰ªñÂàáÁâáÊûÑÈÄ†ÂàáÁâá„ÄÇ‰∏éÊï∞ÁªÑÁ±ª‰ººÔºåÂàáÁâáÊúâ‰∏Ä‰∏™<code>len</code>Â≠óÊÆµÔºåÂëäËØâÂÆÉÁöÑÈïøÂ∫¶„ÄÇ</p><p>Ê≥®ÊÑèÔºöÂàáÁâáÊìç‰Ωú‰∏≠ÁöÑÈó¥ÈöîÂèÇÊï∞ÊòØÂºÄÂè£ÁöÑÔºà‰∏çÂåÖÂê´Âú®ÂÜÖÔºâ„ÄÇ Â∞ùËØïËÆøÈóÆË∂ÖÂá∫ÂàáÁâáËåÉÂõ¥ÁöÑÂÖÉÁ¥†‰ºöÂºïÂèëËøêË°åÊó∂panic„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var array: [3]u32 = [_]u32&#123;47, 47, 47&#125;;</span><br><span class="line">    var slice: []u32 = array[0..2];</span><br><span class="line"></span><br><span class="line">    // also valid:</span><br><span class="line">    // var slice = array[0..2];</span><br><span class="line"></span><br><span class="line">    var invalid = slice[3]; // panic: index out of bounds</span><br><span class="line"></span><br><span class="line">    std.debug.print(&quot;slice[0]: &#123;&#125;\n&quot;, .&#123;slice[0]&#125;);</span><br><span class="line">    std.debug.print(&quot;length: &#123;&#125;\n&quot;, .&#123;slice.len&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Â≠óÁ¨¶‰∏≤ÊñáÂ≠óÊòØ‰ª•nullÁªìÂ∞æÁöÑutf-8ÁºñÁ†ÅÁöÑconst u8Â≠óËäÇÊï∞ÁªÑ„ÄÇUnicodeÂ≠óÁ¨¶Âè™ÂÖÅËÆ∏Âú®Â≠óÁ¨¶‰∏≤ÊñáÂ≠óÂíåÊ≥®Èáä‰∏≠‰ΩøÁî®„ÄÇ</p><p>Ê≥®ÊÑèÔºöÈïøÂ∫¶‰∏çÂåÖÊã¨nullÁªàÊ≠¢Á¨¶ÔºàÂÆòÊñπÁß∞‰∏∫‚Äùsentinel termination‚ÄùÔºâ„ÄÇ ËÆøÈóÆnullÁªàÊ≠¢Á¨¶ÊòØÂÆâÂÖ®ÁöÑ„ÄÇ Á¥¢ÂºïÊòØÊåâÂ≠óËäÇËÄå‰∏çÊòØUnicodeÂ≠óÁ¨¶„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line">const string = &quot;hello ‰∏ñÁïå&quot;;</span><br><span class="line">const world = &quot;world&quot;;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var slice: []const u8 = string[0..5];</span><br><span class="line"></span><br><span class="line">    std.debug.print(&quot;string &#123;&#125;\n&quot;, .&#123;string&#125;);</span><br><span class="line">    std.debug.print(&quot;length &#123;&#125;\n&quot;, .&#123;world.len&#125;);</span><br><span class="line">    std.debug.print(&quot;null &#123;&#125;\n&quot;, .&#123;world[5]&#125;);</span><br><span class="line">    std.debug.print(&quot;slice &#123;&#125;\n&quot;, .&#123;slice&#125;);</span><br><span class="line">    std.debug.print(&quot;huh? &#123;&#125;\n&quot;, .&#123;string[0..7]&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>constÊï∞ÁªÑÂèØ‰ª•Âº∫Âà∂ËΩ¨Êç¢‰∏∫constÂàáÁâá„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">fn foo() []const u8 &#123;  // note function returns a slice</span><br><span class="line">    return &quot;foo&quot;;      // but this is a const array.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    std.debug.print(&quot;foo: &#123;&#125;\n&quot;, .&#123;foo()&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ÊµÅÁ®ãÊéßÂà∂"><a href="#ÊµÅÁ®ãÊéßÂà∂" class="headerlink" title="ÊµÅÁ®ãÊéßÂà∂"></a>ÊµÅÁ®ãÊéßÂà∂</h3><p>ZigÊèê‰æõ‰∫Ü‰∏éÂÖ∂‰ªñËØ≠Ë®ÄÁ±ª‰ººÁöÑifËØ≠Âè•„ÄÅswitchËØ≠Âè•„ÄÅforÂæ™ÁéØÂíåwhileÂæ™ÁéØ„ÄÇÁ§∫‰æãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">fn foo(v: i32) []const u8 &#123;</span><br><span class="line">    if (v &lt; 0) &#123;</span><br><span class="line">        return &quot;negative&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        return &quot;non-negative&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    std.debug.print(&quot;positive &#123;&#125;\n&quot;, .&#123;foo(47)&#125;);</span><br><span class="line">    std.debug.print(&quot;negative &#123;&#125;\n&quot;, .&#123;foo(-47)&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>switchÊñπÂºè</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">fn foo(v: i32) []const u8 &#123;</span><br><span class="line">    switch (v) &#123;</span><br><span class="line">        0 =&gt; return &quot;zero&quot;,</span><br><span class="line">        else =&gt; return &quot;nonzero&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    std.debug.print(&quot;47 &#123;&#125;\n&quot;, .&#123;foo(47)&#125;);</span><br><span class="line">    std.debug.print(&quot;0 &#123;&#125;\n&quot;, .&#123;foo(0)&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>for-loop</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var array = [_]i32&#123;47, 48, 49&#125;;</span><br><span class="line"></span><br><span class="line">    for (array) | value | &#123;</span><br><span class="line">        std.debug.print(&quot;array &#123;&#125;\n&quot;, .&#123;value&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    for (array) | value, index | &#123;</span><br><span class="line">        std.debug.print(&quot;array &#123;&#125;:&#123;&#125;\n&quot;, .&#123;index, value&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var slice = array[0..2];</span><br><span class="line"></span><br><span class="line">    for (slice) | value | &#123;</span><br><span class="line">        std.debug.print(&quot;slice &#123;&#125;\n&quot;, .&#123;value&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    for (slice) | value, index | &#123;</span><br><span class="line">        std.debug.print(&quot;slice &#123;&#125;:&#123;&#125;\n&quot;, .&#123;index, value&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>while loop</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var array = [_]i32&#123;47, 48, 49&#125;;</span><br><span class="line">    var index: u32 = 0;</span><br><span class="line"></span><br><span class="line">    while (index &lt; 2) &#123;</span><br><span class="line">        std.debug.print(&quot;value: &#123;&#125;\n&quot;, .&#123;array[index]&#125;);</span><br><span class="line">        index += 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ÈîôËØØÂ§ÑÁêÜ"><a href="#ÈîôËØØÂ§ÑÁêÜ" class="headerlink" title="ÈîôËØØÂ§ÑÁêÜ"></a>ÈîôËØØÂ§ÑÁêÜ</h3><p>ÈîôËØØÊòØÁâπÊÆäÁöÑËÅîÂêàÁ±ªÂûãÔºå‰Ω†ÂèØ‰ª•Âú®ÂáΩÊï∞ÂâçÈù¢Âä†‰∏ä ! Êù•Ë°®Á§∫ËØ•ÂáΩÊï∞ÂèØËÉΩËøîÂõûÈîôËØØ„ÄÇ‰Ω†ÂèØ‰ª•ÈÄöËøáÁÆÄÂçïÂú∞Â∞ÜÈîôËØØ‰Ωú‰∏∫Ê≠£Â∏∏ËøîÂõûÂÄºËøîÂõûÊù•ÊäõÂá∫ÈîôËØØ„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const MyError = error&#123;</span><br><span class="line">    GenericError,</span><br><span class="line">    OtherError</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">pub fn main() !void &#123;</span><br><span class="line">    return MyError.GenericError;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn wrap_foo(v: i32) void &#123;</span><br><span class="line">    if (foo(v)) |value| &#123;</span><br><span class="line">        std.debug.print(&quot;value: &#123;&#125;\n&quot;, .&#123;value&#125;);</span><br><span class="line">    &#125; else |err| &#123;</span><br><span class="line">        std.debug.print(&quot;error: &#123;&#125;\n&quot;, .&#123;err&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Â¶ÇÊûú‰Ω†ÁºñÂÜô‰∏Ä‰∏™ÂèØËÉΩÂá∫ÈîôÁöÑÂáΩÊï∞ÔºåÂΩìÂÆÉËøîÂõûÊó∂‰Ω†ÂøÖÈ°ªÂÜ≥ÂÆöÂ¶Ç‰ΩïÂ§ÑÁêÜÈîôËØØ„ÄÇ‰∏§‰∏™Â∏∏ËßÅÁöÑÈÄâÊã©ÊòØ <code>try</code> Âíå <code>catch</code>„ÄÇ<code>try</code> ÊñπÂºèÂæàÊëÜÁÉÇÔºåÂÆÉÂè™ÊòØÁÆÄÂçïÂú∞Â∞ÜÈîôËØØËΩ¨Âèë‰∏∫ÂáΩÊï∞ÁöÑÈîôËØØ„ÄÇËÄå <code>catch</code> ÈúÄË¶ÅÂ§ÑÁêÜÈîôËØØ„ÄÇ</p><p><code>try</code> ÂÖ∂ÂÆûÂ∞±ÊòØ <code>catch | err | &#123;return err&#125;</code> ÁöÑËØ≠Ê≥ïÁ≥ñ„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line">const MyError = error&#123;</span><br><span class="line">    GenericError</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">fn foo(v: i32) !i32 &#123;</span><br><span class="line">    if (v == 42) return MyError.GenericError;</span><br><span class="line">    return v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() !void &#123;</span><br><span class="line">    // catch traps and handles errors bubbling up</span><br><span class="line">    _ = foo(42) catch |err| &#123;</span><br><span class="line">        std.debug.print(&quot;error: &#123;&#125;\n&quot;, .&#123;err&#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // try won&#x27;t get activated here.</span><br><span class="line">    std.debug.print(&quot;foo: &#123;&#125;\n&quot;, .&#123;try foo(47)&#125;);</span><br><span class="line"></span><br><span class="line">    // this will ultimately cause main to print an error trace and return nonzero</span><br><span class="line">    _ = try foo(42);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Êàë‰ª¨‰πüÂèØ‰ª•‰ΩøÁî® <code>if</code> Êù•Ê£ÄÊü•ÈîôËØØ„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line">const MyError = error&#123;</span><br><span class="line">    GenericError</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">fn foo(v: i32) !i32 &#123;</span><br><span class="line">    if (v == 42) return MyError.GenericError;</span><br><span class="line">    return v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// note that it is safe for wrap_foo to not have an error ! because</span><br><span class="line">// we handle ALL cases and don&#x27;t return errors.</span><br><span class="line">fn wrap_foo(v: i32) void &#123;    </span><br><span class="line">    if (foo(v)) | value | &#123;</span><br><span class="line">        std.debug.print(&quot;value: &#123;&#125;\n&quot;, .&#123;value&#125;);</span><br><span class="line">    &#125; else | err | &#123;</span><br><span class="line">        std.debug.print(&quot;error: &#123;&#125;\n&quot;, .&#123;err&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    wrap_foo(42);</span><br><span class="line">    wrap_foo(47);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ÊåáÈíà"><a href="#ÊåáÈíà" class="headerlink" title="ÊåáÈíà"></a>ÊåáÈíà</h3><p>Zig‰ΩøÁî®<code>*</code>Ë°®Á§∫ÊåáÈíàÁ±ªÂûãÔºåÂèØ‰ª•ÈÄöËøá<code>.*</code>ËØ≠Ê≥ïËÆøÈóÆÊåáÈíàÊåáÂêëÁöÑÂÄº„ÄÇÁ§∫‰æãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn printer(value: *i32) void &#123;</span><br><span class="line">    std.debug.print(&quot;pointer: &#123;&#125;\n&quot;, .&#123;value&#125;);</span><br><span class="line">    std.debug.print(&quot;value: &#123;&#125;\n&quot;, .&#123;value.*&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var value: i32 = 47;</span><br><span class="line">    printer(&amp;value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ê≥®ÊÑèÔºöÂú®Zig‰∏≠ÔºåÊåáÈíàÈúÄË¶ÅÊ≠£Á°ÆÂØπÈΩêÂà∞ÂÆÉÊâÄÊåáÂêëÁöÑÂÄºÁöÑÂØπÈΩêÊñπÂºè„ÄÇ ÂØπ‰∫éÁªìÊûÑ‰ΩìÔºåÁ±ª‰ºº‰∫éJavaÔºåÊÇ®ÂèØ‰ª•Ëß£ÂºïÁî®ÊåáÈíàÂπ∂‰∏ÄÊ¨°Ëé∑ÂèñÂ≠óÊÆµÔºå‰ΩøÁî® . ËøêÁÆóÁ¨¶„ÄÇÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåËøô‰ªÖÈÄÇÁî®‰∫é‰∏ÄÂ±ÇÈó¥Êé•ÂºïÁî®ÔºåÂõ†Ê≠§Â¶ÇÊûúÊÇ®ÊúâÊåáÂêëÊåáÈíàÁöÑÊåáÈíàÔºåÊÇ®ÂøÖÈ°ªÈ¶ñÂÖàËß£ÂºïÁî®Â§ñÈÉ®ÊåáÈíà„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">const MyStruct = struct &#123;</span><br><span class="line">    value: i32</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">pub fn printer(s: *MyStruct) void &#123;</span><br><span class="line">    std.debug.print(&quot;value: &#123;&#125;\n&quot;, .&#123;s.value&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var value = MyStruct&#123;.value = 47&#125;;</span><br><span class="line">    printer(&amp;value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ZigÂÖÅËÆ∏‰ªª‰ΩïÁ±ªÂûãÔºà‰∏ç‰ªÖ‰ªÖÊòØÊåáÈíàÔºâÂèØ‰∏∫Á©∫Ôºå‰ΩÜËØ∑Ê≥®ÊÑèÂÆÉ‰ª¨ÊòØÂü∫Êú¨Á±ªÂûãÂíåÁâπÊÆäÂÄº null ÁöÑËÅîÂêà‰Ωì„ÄÇË¶ÅËÆøÈóÆÊú™ÂåÖË£ÖÁöÑÂèØÈÄâÁ±ªÂûãÔºåËØ∑‰ΩøÁî® .? Â≠óÊÆµÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var value: i32 = 47;</span><br><span class="line">    var vptr: ?*i32 = &amp;value;</span><br><span class="line">    var throwaway1: ?*i32 = null;</span><br><span class="line">    var throwaway2: *i32 = null; // error: expected type &#x27;*i32&#x27;, found &#x27;(null)&#x27;</span><br><span class="line"></span><br><span class="line">    std.debug.print(&quot;value: &#123;&#125;\n&quot;, .&#123;vptr.*&#125;); // error: attempt to dereference non-pointer type</span><br><span class="line">    std.debug.print(&quot;value: &#123;&#125;\n&quot;, .&#123;vptr.?.*&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ê≥®ÊÑèÔºöÂΩìÊàë‰ª¨‰ΩøÁî®Êù•Ëá™C ABIÂáΩÊï∞ÁöÑÊåáÈíàÊó∂ÔºåÂÆÉ‰ª¨‰ºöËá™Âä®ËΩ¨Êç¢‰∏∫ÂèØ‰∏∫Á©∫ÊåáÈíà„ÄÇ Ëé∑ÂæóÊú™ÂåÖË£ÖÁöÑÂèØÈÄâÊåáÈíàÁöÑÂè¶‰∏ÄÁßçÊñπÊ≥ïÊòØ‰ΩøÁî® if ËØ≠Âè•Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">fn nullChoice(value: ?*i32) void &#123;</span><br><span class="line">    if (value) | v | &#123;</span><br><span class="line">        std.debug.print(&quot;value: &#123;&#125;\n&quot;, .&#123;v.*&#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        std.debug.print(&quot;null!\n&quot;, .&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var value: i32 = 47;</span><br><span class="line">    var vptr1: ?*i32 = &amp;value;</span><br><span class="line">    var vptr2: ?*i32 = null;</span><br><span class="line"></span><br><span class="line">    nullChoice(vptr1);</span><br><span class="line">    nullChoice(vptr2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ÂÖÉÁºñÁ®ã"><a href="#ÂÖÉÁºñÁ®ã" class="headerlink" title="ÂÖÉÁºñÁ®ã"></a>ÂÖÉÁºñÁ®ã</h3><p>ZigÁöÑÂÖÉÁºñÁ®ãÂèóÂá†‰∏™Âü∫Êú¨Ê¶ÇÂøµÈ©±Âä®Ôºö</p><ul><li><p>Á±ªÂûãÂú®ÁºñËØëÊó∂ÊòØÊúâÊïàÁöÑÂÄº„ÄÇ</p></li><li><p>Â§ßÂ§öÊï∞ËøêË°åÊó∂‰ª£Á†ÅÂú®ÁºñËØëÊó∂‰πüËÉΩÂ∑•‰Ωú„ÄÇ</p></li><li><p>ÁªìÊûÑ‰ΩìÂ≠óÊÆµÁöÑËØÑ‰º∞ÊòØÁºñËØëÊó∂ÁöÑÈ∏≠Â≠êÁ±ªÂûãÔºàduck-typedÔºâ„ÄÇ</p></li><li><p>ZigÊ†áÂáÜÂ∫ìÊèê‰æõ‰∫ÜÊâßË°åÁºñËØëÊó∂ÂèçÂ∞ÑÁöÑÂ∑•ÂÖ∑„ÄÇ</p><p>‰∏ãÈù¢ÊòØÂÖÉÁºñÁ®ãÁöÑ‰∏Ä‰∏™Á§∫‰æãÔºö</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">fn foo(x : anytype) @TypeOf(x) &#123;</span><br><span class="line">    // note that this if statement happens at compile-time, not runtime.</span><br><span class="line">    if (@TypeOf(x) == i64) &#123;</span><br><span class="line">        return x + 2;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return 2 * x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var x: i64 = 47;</span><br><span class="line">    var y: i32 =  47;</span><br><span class="line"></span><br><span class="line">    std.debug.print(&quot;i64-foo: &#123;&#125;\n&quot;, .&#123;foo(x)&#125;);</span><br><span class="line">    std.debug.print(&quot;i32-foo: &#123;&#125;\n&quot;, .&#123;foo(y)&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰ª•‰∏ãÊòØÊ≥õÂûãÁ±ªÂûãÁöÑ‰∏Ä‰∏™Á§∫‰æãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">fn Vec2Of(comptime T: type) type &#123;</span><br><span class="line">    return struct&#123;</span><br><span class="line">        x: T,</span><br><span class="line">        y: T</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const V2i64 = Vec2Of(i64);</span><br><span class="line">const V2f64 = Vec2Of(f64);</span><br><span class="line"></span><br><span class="line">pub fn main() void &#123;</span><br><span class="line">    var vi = V2i64&#123;.x = 47, .y = 47&#125;;</span><br><span class="line">    var vf = V2f64&#123;.x = 47.0, .y = 47.0&#125;;</span><br><span class="line">    </span><br><span class="line">    std.debug.print(&quot;i64 vector: &#123;&#125;\n&quot;, .&#123;vi&#125;);</span><br><span class="line">    std.debug.print(&quot;f64 vector: &#123;&#125;\n&quot;, .&#123;vf&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÈÄöËøáËøô‰∫õÊ¶ÇÂøµÔºåÊàë‰ª¨ÂèØ‰ª•ÊûÑÂª∫ÈùûÂ∏∏Âº∫Â§ßÁöÑÊ≥õÂûãÁ±ªÂûãÔºÅ</p><h3 id="Â†ÜÁÆ°ÁêÜ"><a href="#Â†ÜÁÆ°ÁêÜ" class="headerlink" title="Â†ÜÁÆ°ÁêÜ"></a>Â†ÜÁÆ°ÁêÜ</h3><p>Zig‰∏∫Êàë‰ª¨Êèê‰æõ‰∫Ü‰∏éÂ†Ü‰∫§‰∫íÁöÑÂ§öÁßçÊñπÂºèÔºåÈÄöÂ∏∏Ë¶ÅÊ±ÇÊÇ®ÊòéÁ°ÆÈÄâÊã©‰ΩøÁî®Âì™ÁßçÊñπÂºè„ÄÇÂÆÉ‰ª¨ÈÉΩÈÅµÂæ™‰∏ãËø∞Áõ∏ÂêåÁöÑÊ®°ÂºèÔºö</p><ol><li>ÂàõÂª∫‰∏Ä‰∏™ÂàÜÈÖçÂô®Â∑•ÂéÇÁªìÊûÑ‰Ωì„ÄÇ</li><li>Ê£ÄÁ¥¢Áî±ÂàÜÈÖçÂô®Â∑•ÂéÇÂàõÂª∫ÁöÑ<code>std.mem.Allocator</code>ÁªìÊûÑ‰Ωì„ÄÇ</li><li>‰ΩøÁî®<code>alloc/free</code>Âíå<code>create/destroy</code>ÂáΩÊï∞Êù•Êìç‰ΩúÂ†Ü„ÄÇ</li><li>ÔºàÂèØÈÄâÔºâÈîÄÊØÅÂàÜÈÖçÂô®Â∑•ÂéÇ„ÄÇ</li></ol><p>Ëøô‰πàÂ§ÑÁêÜÁöÑÁõÆÁöÑÊòØÔºö</p><ul><li>‰∏∫‰∫ÜÈòªÊ≠¢ÊÇ®ËøáÂ∫¶‰ΩøÁî®Â†Ü„ÄÇ</li><li>Ëøô‰ΩøÂæóË∞ÉÁî®Â†ÜÁöÑ‰ªª‰Ωï‰∏úË•øÔºàÂü∫Êú¨‰∏äÊòØÂèØÂ§±Ë¥•ÁöÑÊìç‰ΩúÔºâÈÉΩÊòØÊòæÂºèÁöÑ„ÄÇ</li><li>ÊÇ®ÂèØ‰ª•‰ªîÁªÜË∞ÉÊï¥ÊùÉË°°ÔºåÂπ∂‰ΩøÁî®Ê†áÂáÜÊï∞ÊçÆÁªìÊûÑËÄåÊó†ÈúÄÈáçÂÜôÊ†áÂáÜÂ∫ì„ÄÇ</li><li>ÊÇ®ÂèØ‰ª•Âú®ÊµãËØï‰∏≠ËøêË°åÈùûÂ∏∏ÂÆâÂÖ®ÁöÑÂàÜÈÖçÂô®ÔºåÂπ∂Âú®ÂèëÂ∏É&#x2F;Áîü‰∫ßÁéØÂ¢É‰∏≠ÂàáÊç¢Âà∞‰∏çÂêåÁöÑÂàÜÈÖçÂô®„ÄÇ</li></ul><p>Â•ΩÁöÑÔºå‰ΩÜÊòØ‰Ω†‰πüÂèØ‰ª•ÂÅ∑ÁÇπÊáí„ÄÇ‰Ω†ÊòØ‰∏çÊòØÊÉ≥‰∏ÄÁõ¥‰ΩøÁî®jemallocÔºü Âè™ÈúÄÈÄâÊã©‰∏Ä‰∏™ÂÖ®Â±ÄÂàÜÈÖçÂô®ÔºåÂπ∂Âú®ÊâÄÊúâÂú∞Êñπ‰ΩøÁî®ÂÆÉÔºàËØ∑Ê≥®ÊÑèÔºåÊüê‰∫õÂàÜÈÖçÂô®ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÔºåËÄåÊüê‰∫õÂàô‰∏çÊòØÔºâ„ÄÇ</p><p>Âú®Ëøô‰∏™Á§∫‰æã‰∏≠ÔºåÊàë‰ª¨Â∞Ü‰ΩøÁî®<code>std.heap.GeneralPurposeAllocator</code>Â∑•ÂéÇÂàõÂª∫‰∏Ä‰∏™ÂÖ∑ÊúâÂ§öÁßçÁâπÊÄßÔºàÂåÖÊã¨Ê≥ÑÊºèÊ£ÄÊµãÔºâÁöÑÂàÜÈÖçÂô®ÔºåÂπ∂ÁúãÁúãÂÆÉÊòØÂ¶Ç‰ΩïÁªÑÂêàÂú®‰∏ÄËµ∑ÁöÑ„ÄÇ</p><p>ÊúÄÂêé‰∏Ä‰ª∂‰∫ãÔºåËøôÈáå‰ΩøÁî®‰∫Ü<code>defer</code>ÂÖ≥ÈîÆÂ≠óÔºåÂÆÉÈùûÂ∏∏Á±ª‰ºº‰∫éGoËØ≠Ë®Ä‰∏≠ÁöÑ<code>defer</code>ÂÖ≥ÈîÆÂ≠óÔºÅËøòÊúâ‰∏Ä‰∏™<code>errdefer</code>ÂÖ≥ÈîÆÂ≠óÔºåÂ¶ÇÊûúÈúÄË¶Å‰∫ÜËß£Êõ¥Â§ö‰ø°ÊÅØÔºåËØ∑Êü•ÈòÖZigÊñáÊ°£„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">// factory type</span><br><span class="line">const Gpa = std.heap.GeneralPurposeAllocator(.&#123;&#125;);</span><br><span class="line"></span><br><span class="line">pub fn main() !void &#123;</span><br><span class="line">    // instantiates the factory</span><br><span class="line">    var gpa = Gpa&#123;&#125;;</span><br><span class="line">    </span><br><span class="line">    // retrieves the created allocator.</span><br><span class="line">    var galloc = &amp;gpa.allocator;</span><br><span class="line">    </span><br><span class="line">    // scopes the lifetime of the allocator to this function and</span><br><span class="line">    // performs cleanup; </span><br><span class="line">    defer _ = gpa.deinit();</span><br><span class="line"></span><br><span class="line">    var slice = try galloc.alloc(i32, 2);</span><br><span class="line">    // uncomment to remove memory leak warning</span><br><span class="line">    // defer galloc.free(slice);</span><br><span class="line">    </span><br><span class="line">    var single = try galloc.create(i32);</span><br><span class="line">    // defer gallo.destroy(single);</span><br><span class="line"></span><br><span class="line">    slice[0] = 47;</span><br><span class="line">    slice[1] = 48;</span><br><span class="line">    single.* = 49;</span><br><span class="line"></span><br><span class="line">    std.debug.print(&quot;slice: [&#123;&#125;, &#123;&#125;]\n&quot;, .&#123;slice[0], slice[1]&#125;);</span><br><span class="line">    std.debug.print(&quot;single: &#123;&#125;\n&quot;, .&#123;single.*&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h3><p>Áé∞Âú®Êàë‰ª¨Â∑≤ÁªèÊéåÊè°‰∫ÜÁõ∏ÂΩìÂ§ßÁöÑZigÂü∫Á°ÄÁü•ËØÜ„ÄÇÊ≤°ÊúâË¶ÜÁõñÁöÑ‰∏Ä‰∫õÔºàÈùûÂ∏∏ÈáçË¶ÅÁöÑÔºâÂÜÖÂÆπÂåÖÊã¨Ôºö</p><ul><li>ÊµãËØïÔºàZig‰ΩøÂæóÁºñÂÜôÊµãËØïÈùûÂ∏∏ÂÆπÊòìÔºâ</li><li>Ê†áÂáÜÂ∫ì</li><li>ÂÜÖÂ≠òÊ®°ÂûãÔºàZigÂú®ÂàÜÈÖçÂô®ÊñπÈù¢Ê≤°ÊúâÂÄæÂêëÊÄßÔºâ</li><li>ÂºÇÊ≠•ÁºñÁ®ãÔºàZig ÁöÑÂºÇÊ≠•ÁâπÊÄßÂú®ÁºñËØëÂô®‰∏≠Âá∫Áé∞‰∫ÜÊÄßËÉΩÈÄÄÂåñÔºåÂú® 0.11 ÁâàÊú¨ÁöÑ Zig ‰∏≠Â∑≤Áªè‰∏çÂ≠òÂú®‰∫ÜÔºåÂπ∂‰∏îÂú® Zig 0.12 ÁâàÊú¨‰∏≠‰πüÂèØËÉΩ‰∏ç‰ºöÂá∫Áé∞„ÄÇÔºâ</li><li>‰∫§ÂèâÁºñËØë</li><li><code>build.zig</code> Êñá‰ª∂</li></ul><p>Â¶ÇÊûúÊÉ≥Ë¶Å‰∫ÜËß£Êõ¥Â§öÁªÜËäÇÔºåËØ∑Êü•ÈòÖÊúÄÊñ∞ÁöÑÊñáÊ°£Ôºö</p><ul><li><a href="https://ziglang.org/documentation/master/">https://ziglang.org/documentation/master/</a></li><li><a href="https://gist.github.com/ityonemo/769532c2017ed9143f3571e5ac104e50">https://gist.github.com/ityonemo/769532c2017ed9143f3571e5ac104e50</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Ëøô‰ªΩzigÁÆÄÊòéÊïôÁ®ãÈÄÇÂêàÂ∑≤ÁªèÊúâÁºñÁ®ãÂü∫Á°ÄÁü•ËØÜÁöÑÂêåÂ≠¶Âø´ÈÄü‰∫ÜËß£zigËØ≠Ë®ÄÔºåÂêåÊó∂‰πüÈÄÇÂêàÊ≤°ÊúâÁºñÁ®ãÁªèÈ™å‰ΩÜÊòØÊáÇÂæóÂñÑÁî®ÊêúÁ¥¢ÂºïÊìéÁöÑÂêåÂ≠¶,ËØ•ÊñáÁ´†ËØ¶ÁªÜ‰ªãÁªçZigÁºñÁ®ãËØ≠Ë®ÄÂêÑÁßçÊ¶ÇÂøµÔºå‰∏ªË¶ÅÂåÖÊã¨Âü∫Á°ÄÁü•ËØÜ„ÄÅÂáΩÊï∞„ÄÅÁªìÊûÑ‰Ωì„ÄÅÊûö‰∏æ„ÄÅÊï∞ÁªÑ„ÄÅÂàáÁâá„ÄÅÊéßÂà∂ÁªìÊûÑ„ÄÅÈîôËØØÂ§ÑÁêÜ„ÄÅÊåáÈíà„ÄÅÂÖÉÁºñÁ®ãÂíåÂ†ÜÁÆ°ÁêÜÁ≠âÂÜÖÂÆπ„ÄÇ&lt;/p&gt;
&lt;h3 id</summary>
      
    
    
    
    <category term="ZiglangÁÆÄÊòéÊïôÁ®ã" scheme="https://zoues.com/categories/Ziglang%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="zig" scheme="https://zoues.com/tags/zig/"/>
    
  </entry>
  
  <entry>
    <title>OpenAIÂÖ≥‰∫éKubernetesÈõÜÁæ§Ëøë‰∏áËäÇÁÇπÁöÑÁîü‰∫ßÂÆûË∑µ</title>
    <link href="https://zoues.com/posts/1df3dc63/"/>
    <id>https://zoues.com/posts/1df3dc63/</id>
    <published>2021-01-28T00:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.373Z</updated>
    
    <content type="html"><![CDATA[<p>OpenAIÂ∑≤ÁªèÂ∞ÜKubernetesÈõÜÁæ§ËßÑÊ®°Êâ©Â±ïËá≥7500‰∏™ËäÇÁÇπÔºå‰∏∫Â§ßÂûãÁ•ûÁªèÁΩëÁªúÊ®°ÂûãÔºàÂ¶ÇGPT-3ÔºåCLIPÂíåDALL¬∑EÔºâÂèäÂ∞èÂûãÂÆûÈ™åÊÄßÁ†îÁ©∂Êèê‰æõ‰∫ÜÂèØÊâ©Â±ïÁöÑÂü∫Á°ÄÊû∂ÊûÑ„ÄÇ ÂæàÂ∞ëÂ∞ÜÂçï‰∏™KubernetesÈõÜÁæ§Êâ©Â±ïÂà∞Â¶ÇÊ≠§ËßÑÊ®°Ôºå‰∏∫Ê≠§ËøõË°å‰∫Ü‰∏Ä‰∫õÂøÖË¶ÅÁöÑÊîπËøõÔºå‰ΩÜÂ•ΩÂ§ÑÊòØÂçï‰∏ÄÁöÑÂü∫Á°ÄÊû∂ÊûÑ‰ΩøÊàë‰ª¨ÁöÑÊú∫Âô®Â≠¶‰π†Á†îÁ©∂Âõ¢ÈòüÂèØ‰ª•Âú®‰∏ç‰øÆÊîπ‰ª£Á†ÅÁöÑÂâçÊèê‰∏ãÔºåÂø´ÈÄüÊâ©Â±ï‰ª•Áº©Áü≠ÂÆûÈ™åÊó∂Èó¥„ÄÅÂä†ÈÄüÁ†îÂèëËøõÂ∫¶„ÄÇ</p><hr><p>‰ΩúËÄÖÔºöBenjamin Chess„ÄÅEric Sigler</p><p>ËØëËÄÖÔºözouyee</p><p>ÂéüÊñáÔºö<a href="https://openai.com/blog/scaling-kubernetes-to-7500-nodes/">https://openai.com/blog/scaling-kubernetes-to-7500-nodes/</a></p><p><img src="https://s3.ax1x.com/2021/01/28/yS7JHA.png"></p><p>Ëá™‰∏ä‰∏ÄÁØáÊúâÂÖ≥Êâ©Â±ïÂà∞2500‰∏™ËäÇÁÇπÁöÑÊñáÁ´†‰ª•Êù•ÔºåÊàë‰ª¨‰∏ÄÁõ¥Âú®‰∏çÊñ≠Êâ©Â±ïÂü∫Á°ÄÊû∂ÊûÑ‰ª•Êª°Ë∂≥Á†îÁ©∂‰∫∫ÂëòÁöÑÈúÄÊ±ÇÔºåÂπ∂Âú®Ê≠§ËøáÁ®ã‰∏≠Â≠¶‰π†‰∫ÜËÆ∏Â§öÂÖ∂‰ªñÁõ∏ÂÖ≥Áü•ËØÜ„ÄÇ ËØ•ÁØáÊñáÁ´†ÊÄªÁªì‰∫ÜÁõ∏ÂÖ≥ÁªèÈ™åÔºå‰ª•‰æøKubernetesÁ§æÂå∫‰∏≠ÁöÑÂÖ∂‰ªñ‰∫∫ÂèØ‰ª•‰ªé‰∏≠ÂèóÁõäÔºåÊé•‰∏ãÊù•‰ªãÁªçÔºåÈúÄË¶ÅËß£ÂÜ≥ÁöÑÈóÆÈ¢ò„ÄÇ</p><h4 id="‰∏Ä„ÄÅÂ∑•‰ΩúË¥üËΩΩ"><a href="#‰∏Ä„ÄÅÂ∑•‰ΩúË¥üËΩΩ" class="headerlink" title="‰∏Ä„ÄÅÂ∑•‰ΩúË¥üËΩΩ"></a>‰∏Ä„ÄÅÂ∑•‰ΩúË¥üËΩΩ</h4><p>È¶ñÂÖàÈúÄË¶ÅËØ¥ÊòéÁöÑÊòØÔºåÈíàÂØπÂ∑•‰ΩúË¥üËΩΩÔºåÊàë‰ª¨Âú®KubernetesÈõÜÁæ§‰∏äËøêË°åÁöÑÂ∫îÁî®Á®ãÂ∫èÂíåÁ°¨‰ª∂‰∏éÂÖ∂‰ªñÂÖ¨Âè∏‰∏≠ÁöÑÂú∫ÊôØÂÆåÂÖ®‰∏çÂêå„ÄÇÊàë‰ª¨Èù¢‰∏¥ÁöÑÈóÆÈ¢òÂíåÁõ∏Â∫îÁöÑËß£ÂÜ≥ÊñπÊ°àÂèØËÉΩ‰∏éËØªËÄÖÊâÄÂ§ÑÁöÑÂÆûÈôÖÂú∫ÊôØ‰∏çÊòØÂ§™‰∏ÄËá¥„ÄÇ</p><p>Â§ßÂûãÁöÑÊú∫Âô®Â≠¶‰π†‰Ωú‰∏öÂèØ‰ª•ËÆøÈóÆÂ§ö‰∏™ËäÇÁÇπÔºåÂèäÊØè‰∏™ËäÇÁÇπ‰∏äÁöÑÊâÄÊúâÁ°¨‰ª∂ËµÑÊ∫êÔºåÂõ†Ê≠§ËøêË°åÊïàÁéáÊúÄÈ´ò„ÄÇÂÖÅËÆ∏GPU‰ΩøÁî®NVLinkËøõË°å‰∫§ÂèâÈÄö‰ø°ÔºåÊàñËÄÖGPU‰ΩøÁî®GPUDirect‰∏éNICÈÄö‰ø°„ÄÇÂõ†Ê≠§ÔºåÂØπ‰∫éÊàë‰ª¨ÁöÑËÆ∏Â§öÂ∑•‰ΩúË¥üËΩΩÔºåÂçï‰∏™podÂç†ÊçÆ‰∫ÜÊï¥‰∏™ËäÇÁÇπÔºåÂõ†Ê≠§Ë∞ÉÂ∫¶‰∏çÊ∂âÂèä‰ªª‰ΩïNUMAÔºåCPUÊàñPCIEËµÑÊ∫êÊä¢Âç†„ÄÇÂΩìÂâçÁöÑÈõÜÁæ§ÂÖ∑ÊúâÂÆåÊï¥ÁöÑÂèåÂêëÂ∏¶ÂÆΩ‰∫íÈÄöÔºåÂõ†Ê≠§Êó†ÈúÄËÄÉËôë‰ªª‰ΩïÁΩëÁªúÊãìÊâë„ÄÇÂõ†Ê≠§ÔºåË∞ÉÂ∫¶Á®ãÂ∫èÁöÑÂéãÂäõÁõ∏ÂØπËæÉ‰Ωé„ÄÇ</p><p>Âõ†‰∏∫‰∏Ä‰∏™Êñ∞ÁöÑ‰ªªÂä°ÂèØËÉΩÂåÖÂê´Êï∞Áôæ‰∏™PodË∞ÉÂ∫¶ÁöÑÈúÄÊ±ÇÔºåkube-schedulerÂ≠òÂú®ÊØõÂà∫Áé∞Ë±°„ÄÇ</p><p><img src="https://s3.ax1x.com/2021/01/28/yS7GBd.png"></p><p>ÊúÄÂ§ßÁöÑjobÊòØËøêË°åMPIÔºàÂπ∂Ë°åËÆ°ÁÆóÔºâÔºåjob‰∏≠ÁöÑÊâÄÊúâPodÈÉΩÂ∑•‰ΩúÂú®Âêå‰∏Ä‰∏™MPIÈÄö‰ø°Âô®‰∏≠„ÄÇ‰ªª‰ΩïPodÁöÑÊ∂à‰∫°ÔºåÈÉΩ‰ºöÂØºËá¥Êï¥‰∏™jobÊöÇÂÅúÔºåÂπ∂ÈáçÊñ∞ÂêØÂä®„ÄÇjobÂÆöÊúüÂ§á‰ªΩÁõ∏ÂÖ≥‰ø°ÊÅØÔºàÂç≥checkpointÔºâÔºåÂú®ÈáçÊñ∞ÂêØÂä®Êó∂‰ªéÊúÄËøëÁöÑÂ§á‰ªΩ‰ø°ÊÅØÂ§ÑÊÅ¢Â§ç„ÄÇ</p><p>Êàë‰ª¨‰∏çÂÆåÂÖ®‰æùËµñKubernetesËøõË°åË¥üËΩΩÂπ≥Ë°°„ÄÇÊàë‰ª¨ÁöÑ‰∏ÉÂ±ÇÊµÅÈáèÂæàÂ∞ëÔºåÂõ†‰∏∫‰∏çÈúÄË¶ÅËøõË°åA &#x2F; BÊµãËØïÔºåËìùÁªøÂçáÁ∫ßÊàñÈáë‰∏ùÈõÄÂèëÂ∏ÉÁ≠â„ÄÇ PodÈÄöËøáSSH‰∏éÂÖ∂‰ªñPodÁöÑMPIÁõ¥Êé•ÈÄö‰ø°(ËøôÈÉ®ÂàÜË≤å‰ººÊúâÁÇπÁñëÈóÆ)ÔºåËÄå‰∏çÊòØ<code>service endpoint</code>„ÄÇÊúçÂä°ÂèëÁé∞ÂäüËÉΩÁõ∏ÂØπÊúâÈôêÔºåÂõ†‰∏∫Êàë‰ª¨Âè™ÊâßË°å‰∏ÄÊ¨°Êü•ÊâæÔºåÂç≥Âú®Â∑•‰ΩúÂêØÂä®Êó∂ÔºàpodÂàöÂèÇ‰∏éMPIÊó∂Ôºâ„ÄÇ</p><p>Â§ßÂ§öÊï∞jobÈÉΩ‰∏éBlobÁ±ªÂûãÂ≠òÂÇ®ËøõË°å‰∫§‰∫íÔºåÈÄöÂ∏∏Áõ¥Êé•ÂêëBlob‰º†Ëæì‰∏Ä‰∫õÊï∞ÊçÆÈõÜÁöÑÂàÜÁâáÔºåÊàñÂ∞ÜÂÖ∂ÁºìÂ≠òÂà∞Êú¨Âú∞Áõò„ÄÇÊàë‰ª¨‰πü‰ΩøÁî®‰∫Ü‰∏Ä‰∫õPersistentVolumesÔºå‰ΩÜÊòØblobÁ±ªÂûãÂ≠òÂÇ®ÂÖ∑ÊúâÊõ¥Â•ΩÁöÑ‰º∏Áº©ÊÄßÔºåÂπ∂‰∏î‰∏çÈúÄË¶ÅÊåÇËΩΩ„ÄÅÂç∏ËΩΩÊìç‰Ωú„ÄÇ</p><p>Ë∂ÖÁ∫ßËÆ°ÁÆóÂõ¢ÈòüÂä™ÂäõËá¥Âäõ‰∫éÊèê‰æõÁîü‰∫ßÁ∫ßÂà´ÁöÑËÆ°ÁÆóÂü∫Á°ÄÊû∂ÊûÑÔºåÂΩìÂâçÂú®ËØ•ÈõÜÁæ§‰∏äËøêË°åÁöÑÂ∫îÁî®ÂØøÂëΩËæÉÁü≠ÔºåÂºÄÂèë‰∫∫ÂëòÊ≠£Âú®Âø´ÈÄüËø≠‰ª£‰∏≠„ÄÇ‰ªª‰ΩïÊó∂ÂÄôÈÉΩÊúâÂèØËÉΩÂá∫Áé∞Êñ∞ÁöÑÂ∫îÁî®Âú∫ÊôØÔºåËøôÈúÄË¶ÅÊàë‰ª¨ÂØπË∂ãÂäøËøõË°åÈ¢ÑÂà§ÔºåÂπ∂ÂÅöÂá∫ÈÄÇÂΩìÊäòË°∑ÁöÑËÆæÊÉ≥„ÄÇ</p><hr><h4 id="‰∫å„ÄÅÁΩëÁªú"><a href="#‰∫å„ÄÅÁΩëÁªú" class="headerlink" title="‰∫å„ÄÅÁΩëÁªú"></a>‰∫å„ÄÅÁΩëÁªú</h4><p>ÈöèÁùÄÈõÜÁæ§‰∏≠ËäÇÁÇπÂíåPodÊï∞ÈáèÁöÑÂ¢ûÂä†ÔºåÊàë‰ª¨ÂèëÁé∞<code>Flannel</code>Èöæ‰ª•Êª°Ë∂≥ÈúÄÊ±Ç„ÄÇËΩ¨ËÄå‰ΩøÁî®‰∏ªÊú∫podÁΩëÁªúÊäÄÊúØËøõË°åAzure VMSSesÂíåÁõ∏ÂÖ≥CNIÊèí‰ª∂ÁöÑIPÈÖçÁΩÆ„ÄÇËøô‰ΩøÊàë‰ª¨ËÉΩÂ§üÂú®Pod‰∏äËé∑Âæó‰∏ªÊú∫Á∫ßÂà´ÁöÑÁΩëÁªúÂêûÂêêÈáè„ÄÇ</p><p>Êàë‰ª¨ÊîπÁî®Âü∫‰∫éÂà´ÂêçÁöÑIPÂØªÂùÄÁöÑÂè¶‰∏Ä‰∏™ÂéüÂõ†ÊòØÔºåÂú®Êàë‰ª¨ÊúÄÂ§ßÁöÑÈõÜÁæ§‰∏äÔºåÊàë‰ª¨ÂèØËÉΩÈöèÊó∂ÊúâÂ§ßÁ∫¶200,000‰∏™IPÂú∞ÂùÄÊ≠£Âú®‰ΩøÁî®„ÄÇÂú®ÊµãËØïÂü∫‰∫éË∑ØÁî±ÁöÑPodÁΩëÁªúÊó∂ÔºåÊàë‰ª¨ÂèëÁé∞Ë∑ØÁî±Êï∞ÈáèÂ≠òÂú®ÊòéÊòæÁöÑÈôêÂà∂„ÄÇ</p><p>ÊîπÈÄ†SDNÊàñË∑ØÁî±ÂºïÊìéËôΩÁÑ∂È∫ªÁÉ¶Ôºå‰ΩÜÂÆÉ‰ºö‰ΩøÊàë‰ª¨ÁöÑÁΩëÁªúËÆæÁΩÆÂèòÂæóÁÆÄÂçï„ÄÇÊó†ÈúÄ‰ªª‰ΩïÂÖ∂‰ªñÈÄÇÈÖçÂô®Âç≥ÂèØÊ∑ªÂä†VPNÊàñÈößÈÅì„ÄÇÂêåÊó∂Êàë‰ª¨‰∏çÂøÖÊãÖÂøÉÊï∞ÊçÆÂåÖÂàÜÁâáÔºåÂõ†‰∏∫ÁΩëÁªúÁöÑÊüê‰∫õÈÉ®ÂàÜÁöÑMTUËæÉ‰Ωé„ÄÇÁΩëÁªúÁ≠ñÁï•ÂíåÊµÅÈáèÁõëÊéßÈùûÂ∏∏ÁÆÄÂçïÔºõÊï∞ÊçÆÂåÖÁöÑÊù•Ê∫êÂíåÁõÆÁöÑÂú∞Ê≤°Êúâ‰ªª‰ΩïÊ≠ß‰πâ„ÄÇ</p><p>Êàë‰ª¨Âú®‰∏ªÊú∫‰∏ä‰ΩøÁî®iptablesÊù•Ë∑üË∏™ÊØè‰∏™ÂëΩÂêçÁ©∫Èó¥ÂíåpodÁöÑÁΩëÁªúËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµ„ÄÇËøô‰ΩøÁ†îÁ©∂‰∫∫ÂëòÂèØ‰ª•ÂèØËßÜÂåñÂÖ∂ÁΩëÁªú‰ΩøÁî®„ÄÇÁî±‰∫éÊàë‰ª¨ÁöÑËÆ∏Â§öÂÆûÈ™åÈÉΩÂÖ∑ÊúâÁã¨ÁâπÁöÑÂ§ñÈÉ®ÂíåPodÂÜÖÈÉ®ÈÄö‰ø°Ê®°ÂºèÔºåÂõ†Ê≠§ÂØπ‰∫éË∞ÉÊü•ÂèØËÉΩÂá∫Áé∞Áì∂È¢àÁöÑ‰ΩçÁΩÆÂæàÊúâÁî®„ÄÇ</p><p>iptables mangleËßÑÂàôÂèØÁî®‰∫éÊ†áËÆ∞‰ªªÊÑèÁ¨¶ÂêàÁâπÂÆöÊù°‰ª∂ÁöÑÊï∞ÊçÆÂåÖ„ÄÇÂ¶Ç‰∏ãÊòØÊàë‰ª¨Áî®Êù•Ê£ÄÊµãÊµÅÈáèÊòØÂÜÖÈÉ®ÊµÅÈáèËøòÊòØÂ§ñÈÉ®ÊµÅÈáèÁöÑËßÑÂàô„ÄÇ FORWARDËßÑÂàôÊ∂µÁõñÊù•Ëá™PodÁöÑÊµÅÈáèÔºå‰ª•ÂèäÊù•Ëá™‰∏ªÊú∫ÁöÑINPUTÂíåOUTPUTÊµÅÈáèÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -t mangle -A INPUT ! -s 10.0.0.0/8 -m comment --comment &quot;iptables-exporter openai traffic=internet-in&quot;</span><br><span class="line">iptables -t mangle -A FORWARD ! -s 10.0.0.0/8 -m comment --comment &quot;iptables-exporter openai traffic=internet-in&quot;</span><br><span class="line">iptables -t mangle -A OUTPUT ! -d 10.0.0.0/8 -m comment --comment &quot;iptables-exporter openai traffic=internet-out&quot;</span><br><span class="line">iptables -t mangle -A FORWARD ! -d 10.0.0.0/8 -m comment --comment &quot;iptables-exporter openai traffic=internet-out&quot;</span><br></pre></td></tr></table></figure><p>‰∏ÄÊó¶Ê†áËÆ∞ÔºåiptablesÂ∞ÜÂêØÂä®ËÆ°Êï∞Âô®‰ª•Ë∑üË∏™‰∏éÊ≠§ËßÑÂàôÂåπÈÖçÁöÑÂ≠óËäÇÂíåÊï∞ÊçÆÂåÖ„ÄÇ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">% iptables -t mangle -L -v</span><br><span class="line">Chain FORWARD (policy ACCEPT 50M packets, 334G bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">....</span><br><span class="line">1253K  555M            all  --  any    any     anywhere            !10.0.0.0/8           /* iptables-exporter openai traffic=internet-out */</span><br><span class="line">1161K 7937M            all  --  any    any    !10.0.0.0/8           anywhere             /* iptables-exporter openai traffic=internet-in */</span><br></pre></td></tr></table></figure><p>Êàë‰ª¨‰ΩøÁî®Âü∫‰∫éPrometheusÁöÑ<code>iptables-exporter</code>ÁöÑÊñπÊ°àÔºåÁÑ∂ÂêéÂ∞ÜÂÖ∂Êé•ÂÖ•Âà∞Êàë‰ª¨ÁöÑÁõëÊéßÁ≥ªÁªü„ÄÇ </p><p><img src="https://s3.ax1x.com/2021/01/28/yS7tAI.png"></p><p>Êàë‰ª¨ÁΩëÁªúÊ®°ÂûãÁöÑ‰∏Ä‰∏™ÁâπÂà´ÁöÑÂú∞ÊñπÊòØÔºåÊàë‰ª¨ÂêëÁ†îÁ©∂‰∫∫ÂëòÂÖ¨ÂºÄ‰∫ÜËäÇÁÇπÔºåÂÆπÂô®ÂíåÊúçÂä°ÁΩëÁªúCIDRËåÉÂõ¥„ÄÇ Êàë‰ª¨Êúâ‰∏Ä‰∏™ËæêÂ∞ÑÁä∂ÁΩëÁªúÊ®°ÂûãÔºåÂπ∂‰ΩøÁî®Êú¨Êú∫ËäÇÁÇπÂíåPod CIDRËåÉÂõ¥Êù•Ë∑ØÁî±ËØ•ÊµÅÈáè„ÄÇ Á†îÁ©∂‰∫∫ÂëòËøûÊé•Âà∞‰∏≠Êû¢ËäÇÁÇπÔºå‰ªéÈÇ£ÈáåÂèØ‰ª•ËÆøÈóÆ‰ªª‰ΩïÂçï‰∏™ÈõÜÁæ§„ÄÇ ‰ΩÜÊòØÈõÜÁæ§Êú¨Ë∫´Êó†Ê≥ïÁõ∏‰∫íÈÄö‰ø°„ÄÇ ËøôÊ†∑ÂèØ‰ª•Á°Æ‰øùÈõÜÁæ§Èó¥Áõ∏‰∫íÈöîÁ¶ªÔºå‰∏îÊ≤°ÊúâË∑®ÈõÜÁæ§ÁöÑ‰æùÂ≠òÂÖ≥Á≥ª‰ª•Á†¥ÂùèÈöîÁ¶ªÔºàËØëËÄÖË°®Á§∫‚Ä¶Ôºâ„ÄÇ</p><p>Êàë‰ª¨‰ΩøÁî®‰∏ªÊú∫<code> NAT</code>Êù•ËΩ¨Êç¢ÊúçÂä°ÁΩëÁªúCIDRÔºå‰ª•Â§ÑÁêÜÊù•Ëá™ÈõÜÁæ§Â§ñÈÉ®ÁöÑÊµÅÈáè„ÄÇ ËøôÁßçËÆæÁΩÆ‰ΩøÊàë‰ª¨ÁöÑÁ†îÁ©∂‰∫∫ÂëòÂú®ÈÄâÊã©ÂÆûÈ™åÊñπÂºèÂíåÈÄâÊã©Âì™ÁßçÁΩëÁªúÈÖçÁΩÆ‰∏äÂÖ∑ÊúâÊûÅÂ§ßÁöÑÁÅµÊ¥ªÊÄß„ÄÇ</p><hr><h5 id="‰∏â„ÄÅAPI-Server"><a href="#‰∏â„ÄÅAPI-Server" class="headerlink" title="‰∏â„ÄÅAPI Server"></a>‰∏â„ÄÅAPI Server</h5><p>KubernetesÁöÑAPI ServerÂíåetcdÈõÜÁæ§ÊòØÈõÜÁæ§ÂÅ•Â∫∑ËøêË°åÁöÑÂÖ≥ÈîÆÁªÑ‰ª∂ÔºåÂõ†Ê≠§Êàë‰ª¨ÁâπÂà´Ê≥®ÊÑèËøô‰∫õÁ≥ªÁªü‰∏äÁöÑÂéãÂäõ„ÄÇ Êàë‰ª¨‰ΩøÁî®kube-prometheusÈ°πÁõÆÊèê‰æõÁöÑGrafana‰ª•ÂèäÂÖ∂‰ªñÂÜÖÈÉ®‰ª™Ë°®Êùø„ÄÇ Êàë‰ª¨ÂèëÁé∞ÈíàÂØπAPI ServerÁöÑHTTPÔºàÂ¶Ç429„ÄÅ5xxÁ≠âÁä∂ÊÄÅÔºâÂëäË≠¶ËøòÊòØÂæàÊúâÊïàÁöÑ„ÄÇ</p><p><img src="https://s3.ax1x.com/2021/01/28/yS78nH.png"></p><p>Â∞ΩÁÆ°Â§ßÂ§öÊï∞‰∫∫Âú®k8sÈõÜÁæ§ÂÜÖËøêË°åAPI ServerÔºå‰ΩÜÊàë‰ª¨ÈÄâÊã©Âú®ÈõÜÁæ§Â§ñËøêË°å„ÄÇ etcdÂíåAPI ServerÊúçÂä°ÈÉΩÂú®ÂÆÉ‰ª¨Ëá™Â∑±ÁöÑ‰∏ìÁî®ËäÇÁÇπ‰∏äËøêË°å„ÄÇ Êàë‰ª¨ÊúÄÂ§ßÁöÑÈõÜÁæ§ËøêË°å‰∫Ü5‰∏™API  ServerÂíå5‰∏™etcdËäÇÁÇπÔºå‰ª•ÂàÜÊï£Ë¥üËΩΩÂπ∂ÊúÄÂ§ßÁ®ãÂ∫¶Âú∞Èôç‰ΩéÂΩ±ÂìçÔºàÂ¶ÇÊûúÂÖ∂‰∏≠‰∏ÄÂè∞ÂèëÁîüÊïÖÈöúÔºâ„ÄÇ Ëá™‰ªéÊàë‰ª¨Âú®‰∏ä‰∏ÄÁØáÊñáÁ´†‰∏≠Â∞ÜKubernetes EventsÂÜôÂÖ•Âà∞ÂÖ∂‰ªñetcdÈõÜÁæ§‰ª•Êù•ÔºåÊàë‰ª¨Âú®etcdÊñπÈù¢Ê≤°ÊúâÈÅáÂà∞‰ªª‰ΩïÈ∫ªÁÉ¶„ÄÇ API ServerÊòØÊó†Áä∂ÊÄÅÁöÑÔºåÈÄöÂ∏∏ÂæàÂÆπÊòìÂú®Ëá™ÊÑàÂÆû‰æãÁªÑÊàñËßÑÊ®°ÈõÜ‰∏≠ËøêË°å„ÄÇ Êàë‰ª¨Â∞öÊú™Â∞ùËØïÂª∫Á´ãetcdÈõÜÁæ§ÁöÑ‰ªª‰ΩïËá™ÊÑàÁ≠âËá™Âä®ÂåñÂäüËÉΩ„ÄÇ</p><p>API  Server‰ºöÂç†Áî®Áõ∏ÂΩìÂ§ßÁöÑÂÜÖÂ≠òÔºåÂπ∂‰∏î‰ºöÈöèÁùÄÈõÜÁæ§‰∏≠ËäÇÁÇπÁöÑÊï∞ÈáèÁ∫øÊÄß‰∏äÂçá„ÄÇ ÂØπ‰∫éÂÖ∑Êúâ7500‰∏™ËäÇÁÇπÁöÑÈõÜÁæ§ÔºåÊàë‰ª¨ËßÇÂØüÂà∞ÊØè‰∏™API ServerÊúÄÂ§ö‰ΩøÁî®‰∫Ü70GB„ÄÇ</p><p><img src="https://s3.ax1x.com/2021/01/28/yS71je.png"></p><p>API Server‰∏äÁöÑÂè¶‰∏ÄÂ§ßÂéãÂäõÊòØAPI‰∏äÁöÑWATCHËÉΩÂäõÔºå‰æãÂ¶Ç<code>kubelet</code>Âíå<code> node-exporter</code>„ÄÇ ÂΩì‰ªéÈõÜÁæ§‰∏≠Ê∑ªÂä†ÊàñÂà†Èô§ËäÇÁÇπÊó∂ÔºåÂ∞ÜËß¶ÂèëÊ≠§WATCH„ÄÇ Âπ∂‰∏îÁî±‰∫éÈÄöÂ∏∏ÊØè‰∏™ËäÇÁÇπÊú¨Ë∫´ÈÉΩÈÄöËøá<code>kube-proxy</code>ÁõëËßÜ<code>kubelet</code>ÊúçÂä°ÔºàËØëËÄÖÔºöÂèØÈÄöËøáÊú¨Âú∞LB‰ºòÂåñÔºåÂπ∂ÂàÜÈÖçÂõ∫ÂÆöÂá†‰∏™MasterÔºâÔºåÂõ†Ê≠§Ëøô‰∫õÂìçÂ∫îÊâÄÈúÄÁöÑÂ∏¶ÂÆΩ‰∏∫ËäÇÁÇπÁöÑ‰∫åÊ¨°ÊñπÔºåÊúâÊó∂ÁîöËá≥ËææÂà∞1GB &#x2F; sÊàñÊõ¥È´ò„ÄÇ Âú®Kubernetes 1.17‰∏≠ÁöÑEndpointSlicesÁâπÊÄßÂ∏¶Êù•Â∑®Â§ßÁöÑ‰ºòÂåñÔºå‰ΩøÊ≠§Ë¥üËΩΩÈôç‰Ωé‰∫Ü1000ÂÄç„ÄÇ</p><p><img src="https://s3.ax1x.com/2021/01/28/yS7NNt.png"></p><p>ÈÄöÂ∏∏ÔºåÊàë‰ª¨ÂØÜÂàáÂÖ≥Ê≥®‰ªª‰ΩïÈöèÈõÜÁæ§Â§ßÂ∞èÊâ©Â±ïÁöÑAPI ServerËØ∑Ê±Ç„ÄÇ Êàë‰ª¨Â∞ùËØïÈÅøÂÖçËÆ©‰ªª‰ΩïDaemonSet‰∏éAPI ServerËøõË°å‰∫§‰∫í„ÄÇ Âú®Á°ÆÂÆûÈúÄÊ±ÇÊõ¥ÊîπÊâÄÊúâËäÇÁÇπÁöÑÁõëÊéßÁªÑ‰ª∂Êó∂ÔºåÂºïÂÖ•‰∏≠Èó¥ÁºìÂ≠òÊúçÂä°Ôºà‰æãÂ¶ÇDatadog Cluster AgentÔºâ‰ºº‰πéÊàê‰∫Ü‰∏ÄÁßçÈÅøÂÖçÈõÜÁæ§ËåÉÂõ¥Áì∂È¢àÁöÑÊúÄ‰Ω≥ÂÆûË∑µ„ÄÇ</p><p>ÈöèÁùÄÈõÜÁæ§Êï∞ÈáèÁöÑÂ¢ûÈïøÔºåÊàë‰ª¨ÂØπÈõÜÁæ§ÁöÑËá™Âä®‰º∏Áº©Êìç‰ΩúÈÄêÊ≠•ÂáèÂ∞ë„ÄÇ ÊúâÊó∂Ëá™Âä®‰º∏Áº©Ë∂ÖÊ†áÊó∂ÔºåÊàë‰ª¨Â∞±‰ºöÈÅáÂà∞È∫ªÁÉ¶„ÄÇ ÂΩìÊñ∞ËäÇÁÇπÂä†ÂÖ•ÈõÜÁæ§Êó∂ÔºåÂ∞±‰ºö‰∫ßÁîüËÆ∏Â§öËØ∑Ê±ÇÔºåÂπ∂‰∏î‰∏ÄÊ¨°Ê∑ªÂä†Êï∞Áôæ‰∏™ËäÇÁÇπÂèØËÉΩ‰ºö‰ΩøAPI ServerÊúçÂä°ËøáËΩΩ„ÄÇ</p><hr><h5 id="Âõõ„ÄÅÁõëÊéß"><a href="#Âõõ„ÄÅÁõëÊéß" class="headerlink" title="Âõõ„ÄÅÁõëÊéß"></a>Âõõ„ÄÅÁõëÊéß</h5><p>Êàë‰ª¨‰ΩøÁî®PrometheusÊî∂ÈõÜÊåáÊ†áÔºåÂπ∂‰ΩøÁî®GrafanaÈÖçÁΩÆÂõæÂΩ¢ÁïåÈù¢ÔºåÁÆ°ÁêÜ‰ª™Ë°®ÊùøÂíåË≠¶Êä•„ÄÇÊàë‰ª¨‰ªéÈÉ®ÁΩ≤<code>kube-prometheus</code>È°πÁõÆÂºÄÂßãÔºåËØ•È°πÁõÆÊî∂ÈõÜÂêÑÁßçÊåáÊ†áÔºåÂπ∂Êèê‰æõËâØÂ•ΩÁöÑ‰ª™Ë°®Êùø‰ª•ÂÆåÊàêÂèØËßÜÂåñ„ÄÇÈöèÁùÄÊó∂Èó¥ÁöÑÊé®ÁßªÔºåÊàë‰ª¨Ê∑ªÂä†‰∫ÜËÆ∏Â§öËá™Â∑±ÁâπÊúâÁöÑ‰ª™Ë°®ÊùøÔºåÊåáÊ†áÂíåË≠¶Êä•„ÄÇ</p><p>ÈöèÁùÄËäÇÁÇπÊó•ÁõäÂ¢ûÂ§öÔºåÊàë‰ª¨ÂèëÁé∞PrometheusÊî∂ÈõÜÁöÑÂ§ßÈáèÊåáÊ†áÊØ´Êó†Áî®Â§Ñ„ÄÇÂ∞ΩÁÆ°kube-prometheusÂÖ¨ÂºÄ‰∫ÜËÆ∏Â§öÊúâÁî®ÁöÑÊï∞ÊçÆÔºå‰ΩÜÂÖ∂‰∏≠ÊúâÈÉ®ÂàÜÊàë‰ª¨‰ªéÊú™‰ΩøÁî®Ëøá„ÄÇÊàë‰ª¨‰ΩøÁî®PrometheusÊé•Âè£<code>Âà†Èô§</code>ÂÖ∂‰∏≠ÁöÑÊüê‰∫õÊåáÊ†á„ÄÇ</p><p>‰∏ÄÊÆµÊó∂Èó¥‰ª•Êù•ÔºåÊàë‰ª¨‰∏ÄÁõ¥Âú®Âä™ÂäõËß£ÂÜ≥‰∏Ä‰∏™ÈóÆÈ¢òÔºåÂç≥Prometheus‰ºöÊ∂àËÄóË∂äÊù•Ë∂äÂ§öÁöÑÂÜÖÂ≠òÔºåÁõ¥Âà∞ÊúÄÁªàOOM„ÄÇÂç≥‰ΩøÂú®ËÆæÁΩÆ‰∫ÜË∂ÖÂ§ßÂÜÖÂ≠òÂÆπÈáè‰πãÂêéÔºåËøôÁßçÊÉÖÂÜµ‰ºº‰πé‰ªç‰ºöÂèëÁîüÔºàËØëËÄÖÔºöËØ•ÈóÆÈ¢òÂ∫îËØ•ÊòØÂèëÁîüÂú®ÊóßÁâàÊú¨Ôºâ„ÄÇÊõ¥Á≥üÁ≥ïÁöÑÊòØÔºåÂΩìÂÆÉÂ¥©Ê∫ÉÊó∂ÔºåÂêØÂä®ÂêéÈúÄË¶ÅËä±Ë¥πÂæàÂ§öÊó∂Èó¥ËøõË°åÊÅ¢Â§ç„ÄÇ</p><p>ÊúÄÁªàÔºåÊàë‰ª¨ÊâæÂà∞‰∫ÜËøô‰∫õOOMÁöÑÊù•Ê∫êÔºåÊòØGrafanaÂíåPrometheus‰πãÈó¥ÁöÑ‰∫§‰∫íÔºåÂÖ∂‰∏≠GrafanaË∞ÉÁî®PrometheusÊé•Âè£<code>/api/v1/series</code>Êü•ËØ¢„ÄÇ<code> /api/v1/series</code>Êé•Âè£Ëé∑ÂèñÊâÄÊúâÁõëÊéßÊåáÊ†áÔºåËøôÂ∞ÜÂ∏¶Êù•ÂÜÖÂ≠òÁöÑÊåÅÁª≠Â¢ûÈïø„ÄÇÊàë‰ª¨ÊîπËøõ‰∫ÜPrometheusÔºå‰ΩøÂÖ∂Âú®Context‰∏≠ÂåÖÂê´Ê≠§Ë∂ÖÊó∂ÊéßÂà∂„ÄÇ</p><p>ËôΩÁÑ∂PrometheusÂ¥©Ê∫ÉÁöÑÈ¢ëÁéáÈôç‰Ωé‰∫ÜÂæàÂ§öÔºå‰ΩÜÂú®Á°ÆÂÆûÈúÄË¶ÅÈáçÊñ∞ÂêØÂä®ÂÆÉÁöÑÊó∂ÂÄôÔºåWALÊÅ¢Â§ç‰ªçÁÑ∂ÊòØ‰∏Ä‰∏™ÈóÆÈ¢ò„ÄÇÂú®PrometheusÊî∂ÈõÜÊñ∞ÊåáÊ†áÂíå‰∏∫Êü•ËØ¢Êèê‰æõÊúçÂä°‰πãÂâçÔºåÈÄöÂ∏∏ÈúÄË¶ÅËä±Ë¥πÂæàÈïøÊó∂Èó¥Êù•ÊÅ¢Â§çÊâÄÊúâWALÊó•Âøó„ÄÇÂú®Robust PerceptionÁöÑÂ∏ÆÂä©‰∏ãÔºåÊàë‰ª¨ÂèëÁé∞ÈÄöËøáÈÖçÁΩÆGOMAXPROCS &#x3D; 24ËøõË°å‰ºòÂåñ„ÄÇ Prometheus‰ºöÂú®WALÈáçÊîæÊúüÈó¥Â∞ùËØï‰ΩøÁî®ÊâÄÊúâÂÜÖÊ†∏ÔºåËÄåÂØπ‰∫éÂÖ∑ÊúâÂ§ßÈáèÂÜÖÊ†∏ÁöÑÊúçÂä°Âô®Êù•ËØ¥ÔºåÊä¢Âç†‰ºöÂâäÂáèÊÄßËÉΩ„ÄÇ</p><hr><h5 id="‰∫î„ÄÅÂÅ•Â∫∑Ê£ÄÊü•"><a href="#‰∫î„ÄÅÂÅ•Â∫∑Ê£ÄÊü•" class="headerlink" title="‰∫î„ÄÅÂÅ•Â∫∑Ê£ÄÊü•"></a>‰∫î„ÄÅÂÅ•Â∫∑Ê£ÄÊü•</h5><p>ÂØπ‰∫éËßÑÊ®°Â¶ÇÊ≠§Â§ßÁöÑÈõÜÁæ§ÔºåÂΩìÁÑ∂ÈúÄË¶Å‰æùÈù†Ëá™Âä®ÂåñÊù•Ê£ÄÊµãÂíåÂà†Èô§ÈõÜÁæ§‰∏≠Ë°å‰∏∫ÂºÇÂ∏∏ÁöÑËäÇÁÇπ„ÄÇ Èöè‰πãÈÄêÊ≠•Ê∑±ÂÖ•ÔºåÊàë‰ª¨Â∑≤ÁªèÂª∫Á´ã‰∫Ü‰∏ÄÂ•óÂÆåÂñÑÁöÑÂÅ•Â∫∑Ê£ÄÊü•Á≥ªÁªü„ÄÇ</p><h5 id="a-Ë¢´Âä®Ê£ÄÊü•"><a href="#a-Ë¢´Âä®Ê£ÄÊü•" class="headerlink" title="a. Ë¢´Âä®Ê£ÄÊü•"></a>a. Ë¢´Âä®Ê£ÄÊü•</h5><p>ÔºàËØëËÄÖÔºöÂèØ‰ª•Â∞Ü‰πãÁß∞‰∏∫ÊÄßËÉΩÁõëÊéßÔºâÊüê‰∫õËøêË°åÁä∂ÂÜµÊ£ÄÊü•ÊòØË¢´Âä®ÁöÑÔºåÂßãÁªàÂú®ÊâÄÊúâËäÇÁÇπ‰∏äËøêË°å„ÄÇÂÆÉ‰ª¨ÁõëËßÜÂü∫Êú¨ÁöÑÁ≥ªÁªüËµÑÊ∫êÔºå‰æãÂ¶ÇÁΩëÁªúÂèØËææÊÄßÔºåÁ£ÅÁõòÊçüÂùèÊàñÁ£ÅÁõòÂ∑≤Êª°ÊàñGPUÈîôËØØÁ≠â„ÄÇ GPU‰ºöÂá∫Áé∞Â§öÁßç‰∏çÂêåÁöÑÈóÆÈ¢òÔºå‰ΩÜ‰∏Ä‰∏™ÊØîËæÉÂ∏∏ËßÅÁöÑÈîôËØØÊòØ<code>Êó†Ê≥ïÁ∫†Ê≠£ÁöÑECCÈîôËØØ</code>„ÄÇ NvidiaÁöÑÊï∞ÊçÆ‰∏≠ÂøÉGPUÁÆ°ÁêÜÂô®ÔºàDCGMÔºâÂ∑•ÂÖ∑‰ΩøÊü•ËØ¢Ê≠§ÈîôËØØÂíåËÆ∏Â§öÂÖ∂‰ªñ<code>Xid</code>ÈîôËØØÂèòÂæóÂÆπÊòì‰∫ÜËÆ∏Â§ö„ÄÇÊàë‰ª¨Ë∑üË∏™Ëøô‰∫õÈîôËØØÁöÑ‰∏ÄÁßçÊñπÊ≥ïÊòØÈÄöËøá<code>dcgm-exporter</code>Â∞ÜÊåáÊ†áÊäìÂèñÂà∞Êàë‰ª¨ÁöÑÁõëÊéßÁ≥ªÁªüPrometheus‰∏≠„ÄÇÂÖ∂‰∏∫DCGM_FI_DEV_XID_ERRORSÊåáÊ†á„ÄÇÊ≠§Â§ñÔºåNVMLËÆæÂ§áÊü•ËØ¢APIÂÖ¨ÂºÄ‰∫ÜÊúâÂÖ≥GPUÁöÑËøêË°åÁä∂ÂÜµÂíåÊìç‰ΩúÁöÑËØ¶ÁªÜ‰ø°ÊÅØ„ÄÇ</p><p>‰∏ÄÊó¶Êàë‰ª¨Ê£ÄÊµãÂà∞ÈîôËØØÔºåÈÄöÂ∏∏ÂèØ‰ª•ÈÄöËøáÈáçÁΩÆGPUÊàñÁ≥ªÁªüÊù•‰øÆÂ§çÂÆÉ‰ª¨„ÄÇ</p><p>ÂÅ•Â∫∑Ê£ÄÊü•ÁöÑÂè¶‰∏ÄÁßçÂΩ¢ÂºèÊòØË∑üË∏™Êù•Ëá™‰∏äÊ∏∏‰∫ëÊèê‰æõÂïÜÁöÑÁª¥Êä§‰∫ã‰ª∂„ÄÇÂ§ßÂ§öÊï∞‰∫ëÊèê‰æõÂïÜÈÉΩÊèê‰æõ‰∫Ü‰∏ÄÁßçÊñπÊ≥ïÊù•‰∫ÜËß£ÂΩìÂâçËôöÊãüÊú∫ÊòØÂê¶Áî±‰∫éÂç≥Â∞ÜÂèëÁîüÁöÑÁª¥Êä§‰∫ã‰ª∂ËÄåÂØºËá¥ÁöÑ‰∏≠Êñ≠„ÄÇÂ¶ÇÂÆâË£ÖÂçáÁ∫ßË°•‰∏Å„ÄÅÊõøÊç¢Á°¨‰ª∂Á≠â„ÄÇ</p><p>Ëøô‰∫õË¢´Âä®ËøêË°åÁöÑÁõëÊéßËøêË°åÂú®ÊâÄÊúâËäÇÁÇπ‰∏ä„ÄÇÂ¶ÇÊûúÂÅ•Â∫∑Ê£ÄÊü•ÂºÄÂßãÂ§±Ë¥•ÔºåËØ•ËäÇÁÇπÂ∞ÜËá™Âä®Âª∫Á´ãÊä•Ë≠¶ÔºåÂØπ‰∫éÊõ¥‰∏•ÈáçÁöÑÂÅ•Â∫∑Ê£ÄÊü•ÊïÖÈöúÔºåÊàë‰ª¨ËøòÂ∞ÜÂ∞ùËØïÈ©±ÈÄêÂÆπÂô®ÔºåËØ•ÊìçÁªÑÁî±PodÊú¨Ë∫´ÂÜ≥ÂÆöÔºåÂèØ‰ª•ÈÄöËøáPod Disruption BudgetËøõË°åÈÖçÁΩÆÔºå‰ª•ÂÜ≥ÂÆöÊòØÂê¶ÂÖÅËÆ∏ËøôÁßçÈ©±ÈÄê„ÄÇ</p><h5 id="b-GPUÂä®ÊÄÅÊµãËØï"><a href="#b-GPUÂä®ÊÄÅÊµãËØï" class="headerlink" title="b. GPUÂä®ÊÄÅÊµãËØï"></a>b. GPUÂä®ÊÄÅÊµãËØï</h5><p>‰∏çÂπ∏ÁöÑÊòØÔºåÂπ∂ÈùûÊâÄÊúâGPUÈóÆÈ¢òÈÉΩË°®Áé∞‰∏∫ÈÄöËøáDCGMÂèØËßÅÁöÑÈîôËØØ‰ª£Á†Å„ÄÇÊàë‰ª¨Â∑≤ÁªèÂª∫Á´ã‰∫ÜËá™Â∑±ÁöÑÊµãËØïÂ∫ìÔºåËøô‰∫õÊµãËØïÂ∫ìÂèØ‰ª•Âà©Áî®GPUÊù•ÊçïËé∑ÂÖ∂‰ªñÈóÆÈ¢òÔºåÂπ∂Á°Æ‰øùÁ°¨‰ª∂ÂíåÈ©±Âä®Á®ãÂ∫èÁöÑËøêË°åÊÉÖÂÜµÁ¨¶ÂêàÈ¢ÑÊúü„ÄÇËøô‰∫õÊµãËØïÊó†Ê≥ïÂú®ÂêéÂè∞ËøêË°åÔºåÂÆÉ‰ª¨ÈúÄË¶ÅÂú®Âá†ÁßíÈíüÊàñÂá†ÂàÜÈíüÂÜÖÁã¨Âç†GPU„ÄÇ</p><p>ÊâÄÊúâËäÇÁÇπÈÉΩ‰ª•<code>preflight</code>Ê±°ÁÇπÂíåÊ†áÁ≠æÂä†ÂÖ•ÈõÜÁæ§„ÄÇÊ≠§Ê±°ÁÇπ‰ºöÈòªÊ≠¢Âú®ËäÇÁÇπ‰∏äË∞ÉÂ∫¶Â∏∏ËßÑPod„ÄÇÂ∞ÜDaemonSetÈÖçÁΩÆ‰∏∫Âú®Â∏¶ÊúâÊ≠§Ê†áÁ≠æÁöÑËäÇÁÇπ‰∏äËøêË°åÈ¢ÑÊ£ÄÊµãËØïPod„ÄÇÊàêÂäüÂÆåÊàêÊµãËØïÂêéÔºåÊµãËØïÊú¨Ë∫´Â∞ÜÂéªÈô§<code>preflight</code>Ê±°ÁÇπÂíåÊ†áÁ≠æÔºåÁÑ∂ÂêéËØ•ËäÇÁÇπÂç≥ÂèØÁî®‰∫éÂ∏∏ËßÑÁî®ÈÄî„ÄÇ</p><p>ÈöèÂêéÔºåÊàë‰ª¨Â∞ÜÂú®ËäÇÁÇπÁöÑÁîüÂëΩÂë®ÊúüÂÜÖÂÆöÊúüËøêË°åËøô‰∫õÊµãËØï„ÄÇÊàë‰ª¨‰ª•CronJobÊñπÂºèËøêË°åÔºå‰ΩøÂÖ∂ÂèØ‰ª•Âú®Áæ§ÈõÜ‰∏≠ÁöÑ‰ªª‰ΩïÂèØÁî®ËäÇÁÇπ‰∏äËøêË°å„ÄÇ</p><hr><h5 id="‰∫î„ÄÅËµÑÊ∫êÈÖçÈ¢ùÂèäÁî®Èáè"><a href="#‰∫î„ÄÅËµÑÊ∫êÈÖçÈ¢ùÂèäÁî®Èáè" class="headerlink" title="‰∫î„ÄÅËµÑÊ∫êÈÖçÈ¢ùÂèäÁî®Èáè"></a>‰∫î„ÄÅËµÑÊ∫êÈÖçÈ¢ùÂèäÁî®Èáè</h5><p>ÈöèÁùÄÊàë‰ª¨ÈõÜÁæ§ËßÑÊ®°ÁöÑ‰∏çÊñ≠Êâ©Â§ßÔºåÁÑ∂ËÄåÁ†îÁ©∂‰∫∫ÂëòÂºÄÂßãÂèëÁé∞Ëá™Â∑±Èöæ‰ª•Ëé∑ÂæóÂàÜÈÖçÁöÑÊâÄÊúâÂÆπÈáè„ÄÇ ‰º†ÁªüÁöÑË∞ÉÂ∫¶Á≥ªÁªüÂÖ∑ÊúâËÆ∏Â§ö‰∏çÂêåÁöÑËÉΩÂäõ‰ª•Á°Æ‰øùÂõ¢Èòü‰πãÈó¥ÂÖ¨Âπ≥Âú∞ËøêË°å‰ªªÂä°ÔºåËÄåKubernetesÂàôÊ≤°Êúâ„ÄÇÊàë‰ª¨‰ªéËøô‰∫õË∞ÉÂ∫¶Á≥ªÁªü‰∏≠Ëé∑Âæó‰∫ÜÁÅµÊÑüÔºåÂπ∂‰ª•KubernetesÂéüÁîüÁöÑÊñπÂºèÊûÑÂª∫‰∫Ü‰∏Ä‰∫õÂäüËÉΩ„ÄÇ</p><p><em><strong>Ê±°ÁÇπ</strong></em></p><p>Êàë‰ª¨Âú®ÊØè‰∏™ÈõÜÁæ§‰∏≠ÈÉΩÊúâ‰∏Ä‰∏™ÊúçÂä°ÔºåÂç≥<code>team-resource-manager</code>ÔºåÂÆÉÂÖ∑ÊúâÂ§öÁßçÂäüËÉΩ„ÄÇ ÂÆÉÁöÑÊï∞ÊçÆÊ∫êÊòØConfigMapÔºåÂÆÉ‰∏∫Âú®ÁªôÂÆöÈõÜÁæ§‰∏≠ÂÖ∑ÊúâÂÆπÈáèÁöÑÊâÄÊúâÁ†îÁ©∂Âõ¢ÈòüÊåáÂÆöÂÖÉÁªÑÔºàËäÇÁÇπÈÄâÊã©Âô®ÔºåË¶ÅÂ∫îÁî®ÁöÑÂõ¢ÈòüÊ†áÁ≠æÔºåÂàÜÈÖçÊï∞ÈáèÔºâ„ÄÇ ÂÆÉ‰ΩøÁî®openai.com&#x2F;team&#x3D;teamname:NoScheduleË∞ÉÊï¥ÈÄÇÂΩìÊï∞ÈáèÁöÑËäÇÁÇπ„ÄÇ</p><p><code>team-resource-manager</code>ËøòÈÖçÁΩÆ‰∏Ä‰∏™<code>admission webhook</code>(ËØëËÄÖÔºöÂç≥ÂáÜÂÖ•ÊúçÂä°Êèí‰ª∂)ÊúçÂä°Ôºå‰ª•‰æøÂú®Êèê‰∫§ÊØè‰∏™‰Ωú‰∏öÊó∂ÔºåÊ†πÊçÆÊèê‰∫§ËÄÖÁöÑÂõ¢ÈòüÊàêÂëòË∫´‰ªΩÂ∫îÁî®Áõ∏Â∫îÁöÑÂÆπÂøçÂ∫¶„ÄÇ ÈÄöËøá‰ΩøÁî®Ê±°ÁÇπÔºåÊàë‰ª¨ÂèØ‰ª•ÁÅµÊ¥ªÂú∞Á∫¶ÊùüKubernetes Pod SchedulerÔºå‰æãÂ¶ÇÂÖÅËÆ∏ÂØπ‰ºòÂÖàÁ∫ßËæÉ‰ΩéÁöÑPodÂÖÅËÆ∏<code>‰ªªÊÑè</code>ÂÆπÂøçÔºåËøôÂÖÅËÆ∏Âõ¢ÈòüÂú®Êó†ÈúÄÂº∫ÂäõÂçèË∞ÉÁöÑÊÉÖÂÜµ‰∏ãËµÑÊ∫êÂÖ±‰∫´„ÄÇ</p><p><em><strong>CPU &amp; GPU balloons</strong></em></p><p>Èô§‰∫Ü‰ΩøÁî®cluster-autoscalerÂä®ÊÄÅÊâ©Â±ïËôöÊãüÊú∫ÈõÜÁæ§Â§ñÔºåÊàë‰ª¨Ëøò‰ΩøÁî®ÂÆÉÊù•ÁÆ°ÁêÜÔºàÂà†Èô§ÂíåÈáçÊñ∞Ê∑ªÂä†ÔºâÈõÜÁæ§‰∏≠‰∏çÊ≠£Â∏∏ÁöÑËäÇÁÇπ„ÄÇ‰∏∫Ê≠§ÔºåÊàë‰ª¨Â∞ÜÊøÄÊÉÖÁöÑ<code>ÊúÄÂ∞è</code>ËÆæÁΩÆ‰∏∫Èõ∂ÔºåÂπ∂Â∞ÜÈõÜÁæ§ÁöÑ<code>ÊúÄÂ§ß</code>ËÆæÁΩÆ‰∏∫ÂèØÁî®ÂÆπÈáè„ÄÇ‰ΩÜÊòØÔºåÂ¶ÇÊûúcluster-autoscalerÁúãÂà∞Á©∫Èó≤ËäÇÁÇπÔºåÂàôÂ∞ÜÂ∞ùËØïÁº©Â∞èÂà∞‰ªÖÊâÄÈúÄÁöÑÂÆπÈáè„ÄÇÁî±‰∫éÂ§öÁßçÂéüÂõ†ÔºàVMÂêØÂä®Âª∂ËøüÔºåÈ¢ÑÂàÜÈÖçÁöÑÊàêÊú¨Ôºå‰∏äËø∞API ServerÁöÑÂΩ±ÂìçÔºâÔºåËøôÁßçÁ©∫Èó≤Êâ©Â±ïÂπ∂‰∏çÁêÜÊÉ≥„ÄÇ</p><p>Âõ†Ê≠§ÔºåÊàë‰ª¨‰∏∫CPUÂíåGPU‰∏ªÊú∫ÂºïÂÖ•‰∫Üballoons Deployment„ÄÇËØ•DeploymentÂåÖÂê´‰∏Ä‰∏™ÂÖ∑Êúâ<code>ÊúÄÂ§ßÂÄº</code>Êï∞ÈáèÁöÑ‰Ωé‰ºòÂÖàÁ∫ßÂÆπÂô®ÈÖçÁΩÆ„ÄÇËøô‰∫õPodÂç†Áî®‰∫ÜËäÇÁÇπÂÜÖÁöÑËµÑÊ∫êÔºåÂõ†Ê≠§Ëá™cluster-autoscaler‰∏ç‰ºöÂ∞ÜÂÖ∂ËßÜ‰∏∫Á©∫Èó≤„ÄÇ‰ΩÜÊòØÔºåÁî±‰∫éÂÆÉ‰ª¨ÁöÑ‰ºòÂÖàÁ∫ßËæÉ‰ΩéÔºåÂõ†Ê≠§Ë∞ÉÂ∫¶Á®ãÂ∫èÂèØ‰ª•Á´ãÂç≥Â∞ÜÂÖ∂ÈÄêÂá∫Ôºå‰ª•‰æø‰∏∫ÂÆûÈôÖÂ∑•‰ΩúËÖæÂá∫Á©∫Èó¥„ÄÇ ÔºàÊàë‰ª¨ÈÄâÊã©‰ΩøÁî®DeploymentËÄå‰∏çÊòØDaemonSetÔºå‰ª•ÈÅøÂÖçÂ∞ÜDaemonSetËßÜ‰∏∫ËäÇÁÇπ‰∏äÁöÑÁ©∫Èó≤Â∑•‰ΩúË¥üËΩΩ„ÄÇÔºâ</p><p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑ‰∏Ä‰ª∂‰∫ãÊòØÔºåÊàë‰ª¨‰ΩøÁî®ÂÆπÂô®Êäó‰∫≤ÂíåÂäõÊù•Á°Æ‰øùÂÆπÂô®Âú®ËäÇÁÇπ‰∏äÂùáÂåÄÂàÜÂ∏É„ÄÇËá™Kubernetes 1.18Ëµ∑Â∑≤Êõ¥Ê≠£‰∫ÜËØ•ÁÆóÊ≥ïÁöÑÊÄßËÉΩÈóÆÈ¢ò„ÄÇ</p><hr><h5 id="ÂÖ≠„ÄÅÊàêÁªÑË∞ÉÂ∫¶-Gang-scheduling"><a href="#ÂÖ≠„ÄÅÊàêÁªÑË∞ÉÂ∫¶-Gang-scheduling" class="headerlink" title="ÂÖ≠„ÄÅÊàêÁªÑË∞ÉÂ∫¶(Gang scheduling)"></a>ÂÖ≠„ÄÅÊàêÁªÑË∞ÉÂ∫¶(Gang scheduling)</h5><p>Êàë‰ª¨ÁöÑÂÆûÈ™åÈÄöÂ∏∏Ê∂âÂèä‰∏Ä‰∏™ÊàñÂ§ö‰∏™StatefulSetÔºåÊØè‰∏™StatefulSetÈÉΩÂú®ËÆ≠ÁªÉÂ∑•‰ΩúÁöÑ‰∏çÂêåÈÉ®ÂàÜËøõË°å„ÄÇÂØπ‰∫é‰ºòÂåñÂô®ÔºåÁ†îÁ©∂‰∫∫ÂëòÈúÄË¶ÅÂú®ËøõË°å‰ªª‰ΩïËÆ≠ÁªÉ‰πãÂâçË∞ÉÂ∫¶ÂÆåStatefulSetÁöÑÊâÄÊúâpodÔºàÂõ†‰∏∫Êàë‰ª¨ÁªèÂ∏∏Âú®‰ºòÂåñÂô®ÊàêÂëò‰πãÈó¥‰ΩøÁî®MPIËøõË°åÂçè‰ΩúÔºåÂπ∂‰∏îMPIÂØπÁªÑÊàêÂëòË∫´‰ªΩÊõ¥ÊîπÂæàÊïèÊÑüÔºâ„ÄÇ</p><p>‰ΩÜÊòØÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåKubernetesÂπ∂‰∏ç‰∏ÄÂÆöË¶Å‰ºòÂÖàÊâßË°å‰∏Ä‰∏™StatefulSetÁöÑËØ∑Ê±Ç„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûú‰∏§‰∏™ÂÆûÈ™å‰Ωú‰∏öÂêÑËá™ËØ∑Ê±ÇÈõÜÁæ§ÂÆπÈáèÁöÑ100ÔºÖÔºå‰ΩÜKubernetesÂèØËÉΩÂè™Ë∞ÉÂ∫¶ÊØè‰∏™ÂÆûÈ™åPodÁöÑ‰∏ÄÂçäÔºå‰ªéËÄåÂØºËá¥Ë∞ÉÂ∫¶ÂÉµÂ±ÄÔºåËøô‰∏§‰∏™ÂÆûÈ™å‰Ωú‰∏öÈÉΩÊó†Ê≥ïÂÆåÊàê„ÄÇ</p><p>Êàë‰ª¨Â∞ùËØï‰∫ÜÂÆûÁé∞Ëá™ÂÆö‰πâË∞ÉÂ∫¶Á®ãÂ∫èÔºå‰ΩÜÊòØÈÅáÂà∞‰∫Ü‰∏Ä‰∫õÊûÅÁ´ØÊÉÖÂÜµÔºåËøô‰∫õÊÉÖÂÜµÂØºËá¥‰∏éÂ∏∏ËßÑPodÁöÑË∞ÉÂ∫¶ÊñπÂºèÂèëÁîüÂÜ≤Á™Å„ÄÇ Kubernetes 1.18ÂºïÂÖ•‰∫ÜKubernetes framwork pluginÊû∂ÊûÑÔºåËøô‰ΩøÂæóÂú®Êú¨Âú∞Ê∑ªÂä†Ê≠§Á±ªÂäüËÉΩÂèòÂæóÊõ¥Âä†ÂÆπÊòì„ÄÇÊàë‰ª¨ÊúÄËøëÂºïÂÖ•CoschedulingÊèí‰ª∂Ëß£ÂÜ≥Ê≠§ÈóÆÈ¢ò„ÄÇ</p><hr><h5 id="‰∏É„ÄÅÁªìËÆ∫"><a href="#‰∏É„ÄÅÁªìËÆ∫" class="headerlink" title="‰∏É„ÄÅÁªìËÆ∫"></a>‰∏É„ÄÅÁªìËÆ∫</h5><p>Âú®Êâ©Â±ïKubernetesÈõÜÁæ§Êó∂Ôºå‰ªçÊúâËÆ∏Â§öÈóÆÈ¢òÈúÄË¶ÅËß£ÂÜ≥„ÄÇ ÂÖ∂‰∏≠‰∏Ä‰∫õÂåÖÊã¨Ôºö</p><p>a. ÁõëÊéßÊåáÊ†á</p><p>Â∞±Êàë‰ª¨ÁöÑËßÑÊ®°ËÄåË®ÄÔºåPrometheusÁöÑÂÜÖÁΩÆTSDBÂ≠òÂÇ®ÂºïÊìéÁöÑÂéãÁº©ÈÄüÂ∫¶ÂæàÊÖ¢ÔºåÂπ∂‰∏îÊØèÊ¨°ÈáçÊñ∞ÂêØÂä®Êó∂ÈÉΩÈúÄË¶ÅËä±Ë¥πÂæàÈïøÁöÑÊó∂Èó¥Êù•ÊÅ¢Â§çWALÔºàWrite-Ahead-LogÔºâÔºåËøôÁªôÊàë‰ª¨Â∏¶Êù•‰∫ÜÂæàÂ§ßÁöÑÈ∫ªÁÉ¶„ÄÇ Êàë‰ª¨Ê≠£Âú®ËøÅÁßªÂà∞ÂÖ∂‰ªñ‰∏éPrometheusÂÖºÂÆπÁöÑÂ≠òÂÇ®ÂíåÊü•ËØ¢ÂºïÊìé„ÄÇ ÊúüÂæÖÂ∞ÜÊù•ÊúâÂÖ≥ÂÆÉÂ¶Ç‰ΩïÂèëÂ±ïÁöÑÂçöÂÆ¢ÊñáÁ´†ÔºÅ</p><p>b. PodÁΩëÁªúÊµÅÈáèÊï¥ÂΩ¢</p><p>ÂΩìÊàë‰ª¨Êâ©Â±ïÁæ§ÈõÜÊó∂ÔºåÊØè‰∏™PodÈÉΩ‰ºöË¢´ËÆ°ÁÆó‰∏∫ÂÖ∑Êúâ‰∏ÄÂÆöÊï∞ÈáèÁöÑInternetÂ∏¶ÂÆΩÔºåÈÇ£‰πàÊâÄÊúâPodÊÄª‰ΩìÊµÅÈáèÂ∞ÜÈùûÂ∏∏ÊÉä‰∫∫ÔºåÂõ†ËÄåÈúÄË¶ÅÂºïÂÖ•ÊµÅÈáèÊï¥ÂΩ¢ÊäÄÊúØÔºåÈò≤Ê≠¢ÁΩëÁªúÈ£éÊö¥„ÄÅÊµÅÈáèÊ≥õÊª•Á≠âÈóÆÈ¢ò„ÄÇ</p><p>Êàë‰ª¨ÂèëÁé∞KubernetesÊòØÊª°Ë∂≥Êàë‰ª¨Á†îÁ©∂ÈúÄÊ±ÇÁöÑÂºÇÂ∏∏ÁÅµÊ¥ªÁöÑÂπ≥Âè∞„ÄÇ ÂÆÉÂÖ∑ÊúâÊâ©Â±ïËÉΩÂäõÔºåÂèØ‰ª•Êª°Ë∂≥Êàë‰ª¨Ë¶ÅÊ±ÇÁöÑÊúÄËãõÂàªÁöÑÂ∑•‰ΩúË¥üËΩΩ„ÄÇ Â∞ΩÁÆ°ËøòÊúâÂæàÂ§öÂú∞ÊñπÈúÄË¶ÅÊîπËøõÔºå‰ΩÜOpenAIÁöÑË∂ÖÁ∫ßËÆ°ÁÆóÂõ¢ÈòüÂ∞ÜÁªßÁª≠Êé¢Á¥¢KubernetesÂ¶Ç‰ΩïÊâ©Â±ï„ÄÇ </p><hr><h4 id="ÂèÇËÄÉËµÑÊñô"><a href="#ÂèÇËÄÉËµÑÊñô" class="headerlink" title="ÂèÇËÄÉËµÑÊñô"></a>ÂèÇËÄÉËµÑÊñô</h4><ul><li>[scaling-kubernetes-to-7500-nodes](<a href="https://openai.com/blog/scaling-kubernetes-to-7500-nodes/%EF%BC%89">https://openai.com/blog/scaling-kubernetes-to-7500-nodes/Ôºâ</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;OpenAIÂ∑≤ÁªèÂ∞ÜKubernetesÈõÜÁæ§ËßÑÊ®°Êâ©Â±ïËá≥7500‰∏™ËäÇÁÇπÔºå‰∏∫Â§ßÂûãÁ•ûÁªèÁΩëÁªúÊ®°ÂûãÔºàÂ¶ÇGPT-3ÔºåCLIPÂíåDALL¬∑EÔºâÂèäÂ∞èÂûãÂÆûÈ™åÊÄßÁ†îÁ©∂Êèê‰æõ‰∫ÜÂèØÊâ©Â±ïÁöÑÂü∫Á°ÄÊû∂ÊûÑ„ÄÇ ÂæàÂ∞ëÂ∞ÜÂçï‰∏™KubernetesÈõÜÁæ§Êâ©Â±ïÂà∞Â¶ÇÊ≠§ËßÑÊ®°Ôºå‰∏∫Ê≠§ËøõË°å‰∫Ü‰∏Ä‰∫õÂøÖË¶ÅÁöÑÊîπËøõÔºå‰ΩÜÂ•ΩÂ§ÑÊòØÂçï‰∏ÄÁöÑÂü∫Á°ÄÊû∂ÊûÑ‰ΩøÊàë‰ª¨ÁöÑ</summary>
      
    
    
    
    
    <category term="cloudnative" scheme="https://zoues.com/tags/cloudnative/"/>
    
    <category term="kubernetes" scheme="https://zoues.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>KubernetesÂ∫üÂºÉPodSecurityPolicyÂêéÁª≠</title>
    <link href="https://zoues.com/posts/aa6cf752/"/>
    <id>https://zoues.com/posts/aa6cf752/</id>
    <published>2021-01-21T00:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.373Z</updated>
    
    <content type="html"><![CDATA[<p>KubernetesÁ§æÂå∫Â∞ÜÂú®1.21ÁâàÊú¨‰∏≠ÂºÉÁî®PSPÔºåÂπ∂Â∞Ü1.25ÁâàÊú¨‰∏≠ÁßªÈô§ËØ•API„ÄÇÁõÆÂâçCNCFÁîüÊÄÅÂúàÁ±ª‰ººÈ°πÁõÆÔºöKyverno‰∏éOpen Policy Agen(OPA).</p><p>PodSecurityPolicyÊòØÈõÜÁæ§Á∫ßÂà´ÁöÑPodÂÆâÂÖ®Á≠ñÁï•ÔºåÂÖ∂ÂØπPodÁöÑÊìç‰ΩúËøõË°åÁªÜÁ≤íÂ∫¶ÁöÑÊéàÊùÉ„ÄÇÂú®KubernetesÊû∂ÊûÑ‰∏≠‰ª•Admission ControllerÔºàÂáÜÂÖ•ÊéßÂà∂ÔºåÁ±ª‰ººNamespaceLifecycle„ÄÅResourceQuotaÁ≠âÔºâÔºåÈÄö‰øóÊù•ËÆ≤Â∞±ÊòØ‰∏ÄÁßçÂÜôÂÖ•ÂâçÊ£ÄÊü•Êèí‰ª∂</p><hr><h4 id="‰∏Ä„ÄÅPSPÂõ∞Â¢É"><a href="#‰∏Ä„ÄÅPSPÂõ∞Â¢É" class="headerlink" title="‰∏Ä„ÄÅPSPÂõ∞Â¢É"></a>‰∏Ä„ÄÅPSPÂõ∞Â¢É</h4><p>ÂΩìÂâçPodSecurityPolicyÁâπÊÄßÂ≠òÂú®‰ª•‰∏ãÈóÆÈ¢òÔºö</p><ol><li>ÊéàÊùÉÊ®°ÂûãÂ≠òÂú®Áº∫Èô∑</li><li>ÂäüËÉΩÊòìÂºÄÈöæÂÖ≥</li><li>APIÊé•Âè£Áº∫‰πè‰∏ÄËá¥ÊÄßÂèäÊâ©Â±ïÊÄß,Â¶ÇMustRunAsNonRoot„ÄÅAllowPrivilegeEscalationÊ≠§Á±ªÈÖçÁΩÆ</li><li>Êó†Ê≥ïÂ§ÑÁêÜÂä®ÊÄÅÊ≥®ÂÖ•ÁöÑside-carÔºàÂ¶ÇknativeÔºâ</li><li>Âú®CI&#x2F;CDÂú∫ÊôØÈöæ‰ª•ËêΩÂú∞</li></ol><hr><h4 id="‰∫å„ÄÅÂ§áÈÄâÊñπÊ°à"><a href="#‰∫å„ÄÅÂ§áÈÄâÊñπÊ°à" class="headerlink" title="‰∫å„ÄÅÂ§áÈÄâÊñπÊ°à"></a>‰∫å„ÄÅÂ§áÈÄâÊñπÊ°à</h4><h5 id="KyvernoÁÆÄ‰ªã"><a href="#KyvernoÁÆÄ‰ªã" class="headerlink" title="KyvernoÁÆÄ‰ªã"></a>KyvernoÁÆÄ‰ªã</h5><p>KyvernoÊòØ‰∏∫KubernetesËÆæËÆ°ÁöÑÁ≠ñÁï•ÂºïÊìéÔºàCNCF sandboxÈ°πÁõÆÔºâ„ÄÇÂÖ∂ÂÖ∑Â§á‰ª•‰∏ãÂäüËÉΩÔºö</p><ul><li><p>Áõ∏ÂÖ≥Á≠ñÁï•Á±ª‰ººKubernetesÂØπË±°Ôºå‰∏äÊâãÂÆπÊòì</p></li><li><p>ÈÖçÁΩÆÁÆ°ÁêÜ‰æøÂà©</p></li><li><p>‰∏∫KubernetesËµÑÊ∫êÁöÑÁ≠ñÁï•ËøõË°åÂ£∞ÊòéÂºèÈ™åËØÅÔºåÊõ¥ÊîπÂíåÁîüÊàêËµÑÊ∫êÈÖçÁΩÆ„ÄÇ</p></li><li><p>Âú®KubernetesÈõÜÁæ§‰∏≠‰Ωú‰∏∫Âä®ÊÄÅÂáÜÂÖ•ÊéßÂà∂Âô®ËøêË°å„ÄÇ</p></li><li><p>ÂèØ‰ª•‰ΩøÁî®ËµÑÊ∫êÁßçÁ±ªÔºåÂêçÁß∞ÂíåÊ†áÁ≠æÈÄâÊã©Âô®Êù•ÂåπÈÖçËµÑÊ∫ê„ÄÇÂêçÁß∞‰∏≠ÊîØÊåÅÈÄöÈÖçÁ¨¶Á≠â</p></li></ul><p>ÂΩìÂâçÈááÁ∫≥ËØ•ÊñπÊ°àÁöÑÂºÄÊ∫êÈ°πÁõÆÔºöfluxcd v2Á≠â</p><h5 id="OPAÁÆÄ‰ªã"><a href="#OPAÁÆÄ‰ªã" class="headerlink" title="OPAÁÆÄ‰ªã"></a>OPAÁÆÄ‰ªã</h5><p>Open Policy AgentÔºàÂç≥OPA, CNCFÂ≠µÂåñÈ°πÁõÆÔºâ, ‰∏∫Á≠ñÁï•ÂÜ≥Á≠ñÈúÄÊ±ÇÊèê‰æõ‰∫Ü‰∏Ä‰∏™Áªü‰∏ÄÁöÑÊ°ÜÊû∂„ÄÇÂÆÉÂ∞ÜÁ≠ñÁï•ÂÜ≥Á≠ñ‰ªéËΩØ‰ª∂‰∏öÂä°ÈÄªËæë‰∏≠Ëß£ËÄ¶Ââ•Á¶ªÔºåÂ∞ÜÁ≠ñÁï•ÂÆö‰πâ„ÄÅÂÜ≥Á≠ñËøáÁ®ãÊäΩË±°‰∏∫ÈÄöÁî®Ê®°ÂûãÔºåÂÆûÁé∞‰∫Ü‰∏Ä‰∏™ÈÄöÁî®Á≠ñÁï•ÂºïÊìéÔºå</p><p>ÂÖ∂ÂèØÁî®‰∫éÂæÆÊúçÂä°„ÄÅKubernetes„ÄÅ CI&#x2F;CD„ÄÅAPIÁΩëÂÖ≥Á≠âÂ∫îÁî®Âú∫ÊôØ„ÄÇ</p><p>OPAÂèØ‰ª•ÈÄöËøásidecar„ÄÅÂ§ñÈÉ®ÊúçÂä°ÊàñÊòØ‰æùËµñÂ∫ìÁöÑÊñπÂºè‰∏éÂ∑≤ÊúâÁöÑËΩØ‰ª∂Á≥ªÁªüËøõË°åÈõÜÊàê„ÄÇOPA ÂèØ‰ª•Êé•Âèó‰ªª‰ΩïÁ±ªÂûãÁöÑÁªìÊûÑÂåñÊï∞ÊçÆÔºåÂÜ≥Á≠ñÊµÅÁ®ãÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p><p><img src="https://s3.ax1x.com/2021/01/20/sRWx7d.png"></p><p>OPAÈÄöËøáÊï∞ÊçÆËæìÂÖ•ÂíåÁ≠ñÁï•Êù•ËøõË°åÂÜ≥Á≠ñÔºåÂÜ≥Á≠ñËøáÁ®ãÂíåÊï∞ÊçÆÊó†ÂÖ≥„ÄÇ‰æãÂ¶ÇÔºö</p><ul><li>Âà§Êñ≠ÊüêÁî®Êà∑ÂèØ‰ª•ËÆøÈóÆÂì™‰∫õËµÑÊ∫ê</li><li>ÂÖÅËÆ∏Âì™‰∫õÂ≠êÁΩëÂØπÂ§ñËÆøÈóÆ</li><li>Â∑•‰ΩúË¥üËΩΩÂèØ‰ª•ÈÉ®ÁΩ≤Âú®Âì™‰∏™ÈõÜÁæ§</li><li>ÂèØ‰ª•‰ΩøÁî®Âì™‰∫õÈïúÂÉè</li><li>ÂÆπÂô®ÂèØ‰ª•‰ΩøÁî®Âì™‰∫õÁ≥ªÁªüÂäüËÉΩ</li><li>‰ªÄ‰πàÊó∂Èó¥ÂèØ‰ª•ËÆøÈóÆÁ≠â</li></ul><hr><h4 id="ÂèÇËÄÉËµÑÊñô"><a href="#ÂèÇËÄÉËµÑÊñô" class="headerlink" title="ÂèÇËÄÉËµÑÊñô"></a>ÂèÇËÄÉËµÑÊñô</h4><ul><li>[deprecate PSP](<a href="https://github.com/kubernetes/kubernetes/pull/9717%EF%BC%89">https://github.com/kubernetes/kubernetes/pull/9717Ôºâ</a></li><li><a href="https://docs.google.com/document/d/1VKqjUlpU888OYtIrBwidL43FOLhbmOD5tesYwmjzO4E/edit#">PodSecurityPolicy Options</a></li><li><a href="https://servicesblog.redhat.com/2019/10/16/open-policy-agent-part-i-the-introduction/">redhatÂÖ≥‰∫éOPAÁ≥ªÂàó</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;KubernetesÁ§æÂå∫Â∞ÜÂú®1.21ÁâàÊú¨‰∏≠ÂºÉÁî®PSPÔºåÂπ∂Â∞Ü1.25ÁâàÊú¨‰∏≠ÁßªÈô§ËØ•API„ÄÇÁõÆÂâçCNCFÁîüÊÄÅÂúàÁ±ª‰ººÈ°πÁõÆÔºöKyverno‰∏éOpen Policy Agen(OPA).&lt;/p&gt;
&lt;p&gt;PodSecurityPolicyÊòØÈõÜÁæ§Á∫ßÂà´ÁöÑPodÂÆâÂÖ®Á≠ñÁï•ÔºåÂÖ∂ÂØπPodÁöÑÊìç‰ΩúËøõË°åÁªÜ</summary>
      
    
    
    
    
    <category term="cloudnative" scheme="https://zoues.com/tags/cloudnative/"/>
    
    <category term="kubernetes" scheme="https://zoues.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>KubernetesË∞ÉÂ∫¶Áî±ÊµÖÂÖ•Ê∑±ÔºöÊ°ÜÊû∂</title>
    <link href="https://zoues.com/posts/27bb006d/"/>
    <id>https://zoues.com/posts/27bb006d/</id>
    <published>2021-01-19T13:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.372Z</updated>
    
    <content type="html"><![CDATA[<p>‰ªäÂ§©zouyeeÂÖàÂ∏¶ÂêÑ‰ΩçÁõòÁÇπCNCF‰∏äÂë®ÁöÑ‰∏Ä‰∫õÊúâË∂£ÁöÑ‰∫ãÊÉÖÔºö</p><ol><li><p>KubernetesÁ§æÂå∫GB‰ª£Ë°®ÈÄâ‰∏æÁªìÊùü Paris PittmanÂΩìÈÄâ</p></li><li><p>CNCFÂ≠µÂåñÈ°πÁõÆOPAËøõÂÖ•ÊØï‰∏öÊµÅÁ®ã</p></li><li><p>‰∏äÂë®<code>helm</code>È°πÁõÆÂèëÂ∏Év3.5.0ÂäüËÉΩÊÄßÁâàÊú¨</p></li><li><p>CoreDNSÈ°πÁõÆÈÄöËøáDockerÈïúÂÉè‰ªìÂ∫ìÊîæÂºÄÊãâÂèñÈôêÂà∂ÁöÑÁî≥ËØ∑</p></li></ol><p>‰π¶Êé•‰∏äÊñá„ÄäKubernetesË∞ÉÂ∫¶Á≥ªÁªüÁî±ÊµÖÂÖ•Ê∑±Á≥ªÂàóÔºöÂàùÊé¢„ÄãÔºå‰ªäÂ§©zouyee‰∏∫Â§ßÂÆ∂Â∏¶Êù•„ÄäkuberneterË∞ÉÂ∫¶Áî±ÊµÖÂÖ•Ê∑±ÔºöÊ°ÜÊû∂„ÄãÔºåËØ•Á≥ªÂàóÂØπÂ∫îÁâàÊú¨‰∏∫<code>1.20.+</code>.</p><hr><h4 id="‰∏Ä„ÄÅÂâçÊñáÂõûÈ°æ"><a href="#‰∏Ä„ÄÅÂâçÊñáÂõûÈ°æ" class="headerlink" title="‰∏Ä„ÄÅÂâçÊñáÂõûÈ°æ"></a>‰∏Ä„ÄÅÂâçÊñáÂõûÈ°æ</h4><p>Âú®„ÄäKubernetesË∞ÉÂ∫¶Á≥ªÁªüÁî±ÊµÖÂÖ•Ê∑±Á≥ªÂàóÔºöÂàùÊé¢„Äã‰∏≠ÔºåÁªôÂá∫Êï¥‰ΩìÁöÑ‰∫§‰∫íÂõæÔºåÊù•ÊûÑÂª∫PodË∞ÉÂ∫¶ÁöÑÁõ¥ËßÇÊÑüÂèóÔºåÊàë‰ª¨ÊãìÂ±ï‰∫Ü‰∏Ä‰∏ã‰∫§‰∫íÂõæÔºåÂ¶Ç‰∏ãÊâÄÁ§∫„ÄÇ</p><p>Ê≥®ÔºöËØ•‰∫§‰∫íÂõæÈùû‰∏ì‰∏öUMLÔºåËøòËØ∑Ë∞ÖËß£„ÄÇ</p><p><img src="https://s3.ax1x.com/2021/01/19/sgNXVJ.png" alt="Âõæ1 ‰∫§‰∫íÊµÅÁ®ãÂõæ"></p><p>‰∏äËø∞‰ª•ÂàõÂª∫‰∏Ä‰∏™Pod‰∏∫‰æãÔºåÁÆÄË¶Å‰ªãÁªçË∞ÉÂ∫¶ÊµÅÁ®ãÔºö</p><ol><li><p>Áî®Êà∑ÈÄöËøáÂëΩ‰ª§Ë°åÂàõÂª∫Pod(ÈÄâÊã©Áõ¥Êé•ÂàõÂª∫PodËÄå‰∏çÊòØÂÖ∂‰ªñworkloadÔºåÊòØ‰∏∫‰∫ÜÁúÅÁï•kube-controller-manager)</p></li><li><p>kube-apiserverÁªèËøáÂØπË±°Ê†°È™å„ÄÅadmission„ÄÅquotaÁ≠âÂáÜÂÖ•Êìç‰ΩúÔºåÂÜôÂÖ•etcd</p></li><li><p>kube-apiserverÂ∞ÜÁªìÊûúËøîÂõûÁªôÁî®Êà∑</p></li><li><p>ÂêåÊó∂kube-scheduler‰∏ÄÁõ¥ÁõëÂê¨ËäÇÁÇπ„ÄÅPod‰∫ã‰ª∂Á≠âÔºàÊµÅÁ®ã1Ôºâ</p></li><li><p><strong>kube-schedulerÂ∞Üspec.nodeNameÁöÑpodÂä†ÂÖ•Âà∞Ë∞ÉÂ∫¶ÈòüÂàó‰∏≠ÔºåË∞ÉÂ∫¶Á≥ªÁªüÈÄâÊã©podÔºåËøõÂÖ•Ë∞ÉÂ∫¶Âë®ÊúüÔºàÊú¨Êñá‰ªãÁªçÂÜÖÂÆπÔºâÔºàÊµÅÁ®ã2-3Ôºâ</strong></p></li><li><p>kube-schedulerÂ∞Üpod‰∏éÂæóÂàÜÊúÄÈ´òÁöÑËäÇÁÇπËøõË°åbindingÊìç‰ΩúÔºàÊµÅÁ®ã4Ôºâ</p></li><li><p>kube-apiserverÂ∞Übinding‰ø°ÊÅØÂÜôÂÖ•etcd</p></li><li><p>kubeletÁõëÂê¨ÂàÜÈÖçÁªôËá™Â∑±ÁöÑPodÔºåË∞ÉÁî®CRIÊé•Âè£ËøõË°åPodÂàõÂª∫ÔºàËØ•ÈÉ®ÂàÜÂÜÖÂÆπÂêéÁª≠Âá∫Á≥ªÂàóÔºåËøõË°å‰ªãÁªçÔºâ</p></li><li><p>kubeletÂàõÂª∫PodÂêéÔºåÊõ¥Êñ∞PodÁä∂ÊÄÅÁ≠â‰ø°ÊÅØÔºåÂπ∂Âêëkube-apiserver‰∏äÊä•</p></li><li><p>kube-apiserverÂÜôÂÖ•Êï∞ÊçÆ</p></li></ol><h5 id="‰∫å„ÄÅÊ°ÜÊû∂ËÉåÊôØ"><a href="#‰∫å„ÄÅÊ°ÜÊû∂ËÉåÊôØ" class="headerlink" title="‰∫å„ÄÅÊ°ÜÊû∂ËÉåÊôØ"></a>‰∫å„ÄÅÊ°ÜÊû∂ËÉåÊôØ</h5><p>‚ÄãKubernetes ÈöèÁùÄÂäüËÉΩÁöÑÂ¢ûÂ§öÔºå‰ª£Á†Å‰∏éÈÄªËæë‰πüÊó•ÁõäÂ§çÊùÇ„ÄÇ‰ª£Á†Å‰ΩìÈáèÂèäÂ§çÊùÇÂ∫¶ÁöÑÊèêÂçáÂøÖÁÑ∂Â∏¶Êù•Áª¥Êä§ÊàêÊú¨ÁöÑÂ¢ûÂä†ÔºåÈöêÂΩ¢ÁöÑÂ¢ûÂä†ÈîôËØØÂÆö‰ΩçÂíå‰øÆÂ§çÁöÑÈöæÂ∫¶„ÄÇÊóßÁâàÊú¨ÁöÑKubernetesË∞ÉÂ∫¶Á®ãÂ∫èÔºà<strong>1.16Ââç</strong>ÔºâÊèê‰æõ‰∫ÜwebhooksËøõË°åÊâ©Â±ï„ÄÇ‰ΩÜÊúâ‰ª•‰∏ãÁº∫Èô∑Ôºö</p><ul><li><p>Áî®Êà∑ÂèØ‰ª•Êâ©Â±ïÁöÑÁÇπÊØîËæÉÊúâÈôêÔºå‰ΩçÁΩÆÊØîËæÉÂõ∫ÂÆöÔºåÊó†Ê≥ïÊîØÊåÅÁÅµÊ¥ªÁöÑÊâ©Â±ï‰∏éË∞ÉÈÖçÔºå‰æãÂ¶ÇÂè™ËÉΩÂú®ÊâßË°åÂÆåÈªòËÆ§ÁöÑ Filter Á≠ñÁï•ÂêéÊâçËÉΩË∞ÉÁî®„ÄÇ</p></li><li><p>Ë∞ÉÁî®Êâ©Â±ïÊé•Âè£‰ΩøÁî® HTTP ËØ∑Ê±ÇÔºåÂÖ∂ÂèóÂà∞ÁΩëÁªúÂΩ±ÂìçÔºåÊÄßËÉΩËøú‰Ωé‰∫éÊú¨Âú∞ÁöÑÂáΩÊï∞Ë∞ÉÁî®„ÄÇÂêåÊó∂ÊØèÊ¨°Ë∞ÉÁî®ÈÉΩÈúÄË¶ÅÂ∞Ü Pod Âíå Node ÁöÑ‰ø°ÊÅØËøõË°å Â∫èÂàóÂåñ‰∏éÂèçÂ∫èÂàóÂåñ Êìç‰ΩúÔºå‰ºöËøõ‰∏ÄÊ≠•Èôç‰ΩéÊÄßËÉΩ„ÄÇ</p></li><li><p>PodÂΩìÂâçÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØÔºåÊó†Ê≥ïÂèäÊó∂‰º†ÈÄíÔºàÂà©Áî®Ë∞ÉÂ∫¶CacheÔºâ„ÄÇ</p></li></ul><p>‰∏∫‰∫ÜËß£ÂÜ≥‰∏äËø∞ÈóÆÈ¢òÔºå‰ΩøË∞ÉÂ∫¶Á≥ªÁªü‰ª£Á†ÅÁ≤æÁÆÄ„ÄÅÊâ©Â±ïÊÄßÊõ¥Â•ΩÔºåÁ§æÂå∫‰ªé<code> Kubernetes 1.16</code> ÁâàÊú¨ÂºÄÂßã, ÂºïÂÖ•‰∫Ü‰∏ÄÁßçÊñ∞ÁöÑË∞ÉÂ∫¶Ê°ÜÊû∂- Scheduling Framework „ÄÇ</p><p>Scheduling Framework Âú®ÂéüÊúâË∞ÉÂ∫¶ÊµÅÁ®ãÁöÑÂü∫Á°Ä‰πã‰∏ä, ÂÆö‰πâ‰∫Ü‰∏∞ÂØåÁöÑÊâ©Â±ïÁÇπÊé•Âè£ÔºåÂºÄÂèëËÄÖÂèØ‰ª•ÈÄöËøáÂÆûÁé∞Êâ©Â±ïÁÇπÊâÄÂÆö‰πâÁöÑÊé•Âè£Êù•ÂÆûÁé∞Êèí‰ª∂ÔºåÂ∞ÜÊèí‰ª∂Ê≥®ÂÜåÂà∞Êâ©Â±ïÁÇπ„ÄÇScheduling Framework Âú®ÊâßË°åË∞ÉÂ∫¶ÊµÅÁ®ãÊó∂ÔºåËøêË°åÂà∞Áõ∏Â∫îÁöÑÊâ©Â±ïÁÇπÊó∂ÔºåÊâßË°åÁî®Êà∑Ê≥®ÂÜåÁöÑÊèí‰ª∂ÔºåÁîüÊàêÂΩìÂâçÈò∂ÊÆµÁöÑÁªìÊûú„ÄÇÈÄöËøáËøôÁßçÊñπÂºèÊù•Â∞ÜÁî®Êà∑ÁöÑË∞ÉÂ∫¶ÈÄªËæëÈõÜÊàêÂà∞ Scheduling Framework ‰∏≠„ÄÇScheduling FrameworkÊòéÁ°Æ‰∫Ü‰ª•‰∏ãÁõÆÊ†áÔºö</p><ul><li>Êâ©Â±ïÊÄßÔºöË∞ÉÂ∫¶Êõ¥ÂÖ∑Êâ©Â±ïÊÄß</li><li>Áª¥Êä§ÊÄßÔºöÂ∞ÜË∞ÉÂ∫¶Âô®ÁöÑ‰∏Ä‰∫õÁâπÊÄßÁßªÂà∞Êèí‰ª∂‰∏≠</li><li>ÂäüËÉΩÊÄß<ul><li>Ê°ÜÊû∂Êèê‰æõÊâ©Â±ï</li><li>Êèê‰æõ‰∏ÄÁßçÊú∫Âà∂Êù•Êé•Êî∂Êèí‰ª∂ÁªìÊûúÂπ∂Ê†πÊçÆÊé•Êî∂Âà∞ÁöÑÁªìÊûúÁªßÁª≠ÊàñÁªàÊ≠¢</li><li>Êèê‰æõ‰∏ÄÁßçÊú∫Âà∂Â§ÑÁêÜÈîôËØØ‰∏éÊèí‰ª∂ÈÄö‰ø°</li></ul></li></ul><h5 id="‰∏â„ÄÅÊ°ÜÊû∂ÂéüÁêÜ"><a href="#‰∏â„ÄÅÊ°ÜÊû∂ÂéüÁêÜ" class="headerlink" title="‰∏â„ÄÅÊ°ÜÊû∂ÂéüÁêÜ"></a>‰∏â„ÄÅÊ°ÜÊû∂ÂéüÁêÜ</h5><p>‚ÄãFramework ÁöÑË∞ÉÂ∫¶ÊµÅÁ®ãÊòØÂàÜ‰∏∫‰∏§‰∏™Èò∂ÊÆµÔºö</p><ul><li>Ë∞ÉÂ∫¶Èò∂ÊÆµÊòØÂêåÊ≠•ÊâßË°åÁöÑÔºåÂêå‰∏Ä‰∏™Âë®ÊúüÂÜÖÂè™Êúâ‰∏Ä‰∏™ scheduling cycleÔºåÁ∫øÁ®ãÂÆâÂÖ®</li><li>ÁªëÂÆöÈò∂ÊÆµ(gouroutine)ÊòØÂºÇÊ≠•ÊâßË°åÁöÑÔºåÂêå‰∏Ä‰∏™Âë®ÊúüÂÜÖÂèØËÉΩ‰ºöÊúâÂ§ö‰∏™ binding cycleÂú®ËøêË°åÔºåÁ∫øÁ®ã‰∏çÂÆâÂÖ®</li></ul><p>Âú®‰ªãÁªçFramework ÁöÑË∞ÉÂ∫¶ÊµÅÁ®ã‰πãÂâçÔºåÂÖà‰ªãÁªç‰∏äÂõæÁöÑË∞ÉÂ∫¶ÊµÅÁ®ãÔºåÂç≥schedulerOneÁöÑÂ§ÑÁêÜÈÄªËæëÔºö</p><p><strong>a. Ë∞ÉÂ∫¶Èò∂ÊÆµ</strong></p><pre><code> 1. **ËøáÊª§**Êìç‰ΩúÂç≥findNodesThatFitPodÂáΩÊï∞ - ÊâßË°åPreFilterPlugins - ÊâßË°åFilterPlugins - ÊâßË°åÊâ©Â±ï Filter - Ëã•Âá∫Áé∞FitErrorÔºåÊâßË°åPostFilter 2. **ËØÑÂàÜ**Êìç‰ΩúÂç≥prioritizeNodesÂáΩÊï∞     - ÊâßË°åPreScorePlugins     - ÊâßË°åScorePlugins     - ÊâßË°åÊâ©Â±ïPrioritize 3. ÊåëÈÄâËäÇÁÇπÂç≥selectÂáΩÊï∞ÔºàÁ¨¶ÂêàÊù°‰ª∂ËäÇÁÇπÔºåÊåâÁÖßËØÑÂàÜÊéíÂ∫èÂèäÈááÊ†∑ÈÄâÊã©Ôºâ 4. ËäÇÁÇπÈ¢ÑÂàÜÈÖçÂç≥assumeÔºàÂè™ÊòØÈ¢ÑÂÖàÂàÜÈÖçÔºåÂèØÊî∂ÂõûÔºâ 5. Áõ∏ÂÖ≥Ë∞ÉÂ∫¶Êï∞ÊçÆÁºìÂ≠òÂç≥RunReservePluginsÔºå‰ªéËØ•ËäÇÁÇπÂºÄÂßãÔºåÂêéÁª≠Èò∂ÊÆµÂèëÁîüÈîôËØØÔºåÈúÄË¶ÅË∞ÉÁî®UnReserveÔºåËøõË°åÂõûÊªöÔºàÁ±ª‰ºº‰∫ãÂä°Ôºâ 6.  ÊâßË°åÂáÜÂÖ•Êìç‰ΩúÂç≥RunPermitPlugins</code></pre><p><strong>b. ÁªëÂÆöÈò∂ÊÆµ</strong></p><pre><code>1. ÊâßË°åWaitOnPermitÔºåÂ§±Ë¥•Êó∂Ë∞ÉÁî®RunReservePluginsUnreserve 2. ÊâßË°åÈ¢ÑÁªëÂÆöÂç≥RunPreBindPluginsÔºåÂ§±Ë¥•Êó∂Ë∞ÉÁî®RunReservePluginsUnreserve 3. ÊâßË°åÊâ©Â±ïbingdingÂç≥extendersBindingÔºåÂ§±Ë¥•Êó∂Ë∞ÉÁî®RunReservePluginsUnreserve 4. ÊâßË°åÁªëÂÆöÊî∂Â∞æÂ∑•‰ΩúÂç≥RunPostBindPlugins</code></pre><h5 id="Êâ©Â±ïÁÇπ‰ªãÁªç"><a href="#Êâ©Â±ïÁÇπ‰ªãÁªç" class="headerlink" title="Êâ©Â±ïÁÇπ‰ªãÁªç"></a>Êâ©Â±ïÁÇπ‰ªãÁªç</h5><p>‰∏äËø∞Ê∂âÂèäÂà∞ÁöÑÂêÑÁ±ªPluginsÔºàÂõæ‰∏≠Á¥´Ëâ≤ÈÉ®ÂàÜÔºâÔºåÈíàÂØπ‰∏ãÂõæÔºåÂêÑ‰ΩçÂ∫îËØ•Áúã‰∫ÜÂæàÂ§öÁØá‰∫ÜÔºåÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØUnreserveÁöÑÊó∂Êú∫ÔºåÂêÑÊèí‰ª∂ÂäüËÉΩËØ¥ÊòéÂ¶Ç‰∏ãÔºö</p><p><code>pkg/scheduler/framework/interface.go</code></p><p><img src="https://s3.ax1x.com/2021/01/19/sg2Jns.png"></p><table><thead><tr><th>Êâ©Â±ïÁÇπ</th><th>Áî®ÈÄîËØ¥Êòé</th></tr></thead><tbody><tr><td>QueueSort</td><td>Áî®Êù•ÊîØÊåÅËá™ÂÆö‰πâ Pod ÁöÑÊéíÂ∫è„ÄÇÂ¶ÇÊûúÊåáÂÆö QueueSort ÁöÑÊéíÂ∫èÁÆóÊ≥ïÔºåÂú®Ë∞ÉÂ∫¶ÈòüÂàóÈáåÈù¢Â∞±‰ºöÊåâÁÖßÊåáÂÆöÁöÑÊéíÂ∫èÁÆóÊ≥ïÊù•ËøõË°åÊéíÂ∫èÔºåÂè™ËÉΩenable‰∏Ä‰∏™</td></tr><tr><td>Prefilter</td><td>ÂØπ Pod ‰ø°ÊÅØÁöÑÈ¢ÑÂ§ÑÁêÜÔºåÊØîÂ¶Ç Pod ÁöÑÁºìÂ≠òÁ≠â</td></tr><tr><td>Filter</td><td>ÂØπÂ∫îÊóßÂºèÁöÑPredicate ÔºåËøáÊª§‰∏çÊª°Ë∂≥Ë¶ÅÊ±ÇÁöÑËäÇÁÇπ</td></tr><tr><td>PostFilter</td><td>Áî®‰∫éÂ§ÑÁêÜÂΩì Pod Âú® Filter Èò∂ÊÆµÂ§±Ë¥•ÂêéÁöÑÊìç‰ΩúÔºå‰æãÂ¶ÇÊä¢Âç†Á≠âË°å‰∏∫</td></tr><tr><td>PreScore</td><td>Áî®‰∫éÂú® Score ‰πãÂâçËøõË°å‰∏Ä‰∫õ‰ø°ÊÅØÁîüÊàêÔºå‰πüÂèØ‰ª•Âú®Ê≠§Â§ÑÁîüÊàê‰∏Ä‰∫õÊó•ÂøóÊàñËÄÖÁõëÊéß‰ø°ÊÅØ</td></tr><tr><td>Score</td><td>ÂØπÂ∫îÊóßÂºèÁöÑPriorityÔºåÊ†πÊçÆ Êâ©Â±ïÁÇπÂÆö‰πâÁöÑËØÑÂàÜÁ≠ñÁï•ÊåëÈÄâÂá∫ÊúÄ‰ºòÁöÑËäÇÁÇπ(ÊâìÂàÜ‰∏éÂΩí‰∏ÄÂåñÂ§ÑÁêÜ)</td></tr><tr><td>Reserver</td><td>Ë∞ÉÂ∫¶Èò∂ÊÆµÁöÑÊúÄÂêé‰∏Ä‰∏™Êèí‰ª∂, Èò≤Ê≠¢Ë∞ÉÂ∫¶ÊàêÂäüÂêéËµÑÊ∫êÁöÑÁ´û‰∫â, Á°Æ‰øùÈõÜÁæ§ÁöÑËµÑÊ∫ê‰ø°ÊÅØÁöÑÂáÜÁ°ÆÊÄß</td></tr><tr><td>Permit</td><td>‰∏ªË¶ÅÊèê‰æõ‰∫ÜPodÁªëÂÆöÁöÑÊã¶Êà™ÂäüËÉΩÔºåÊ†πÊçÆÊù°‰ª∂ÂØπpodËøõË°åallow„ÄÅrejectÊàñËÄÖwait„ÄÇ</td></tr><tr><td>PreBind</td><td>Âú®ÁúüÊ≠£ bind node ‰πãÂâçÔºåÊâßË°å‰∏Ä‰∫õÊìç‰Ωú</td></tr><tr><td>Bind</td><td>‰∏Ä‰∏™ Pod Âè™‰ºöË¢´‰∏Ä‰∏™ BindPlugin Â§ÑÁêÜÔºåÂàõÂª∫BindÂØπË±°</td></tr><tr><td>PostBind</td><td>bind ÊàêÂäü‰πãÂêéÊâßË°åÁöÑÈÄªËæë</td></tr><tr><td>Unreserve</td><td>Âú® Permit Âà∞ Bind ËøôÂá†‰∏™Èò∂ÊÆµÂè™Ë¶ÅÊä•ÈîôÂ∞±ÂõûÊªöÊï∞ÊçÆËá≥ÂàùÂßãÁä∂ÊÄÅÔºåÁ±ª‰ºº‰∫ãÂä°„ÄÇ</td></tr><tr><td></td><td></td></tr></tbody></table><h5 id="Âõõ„ÄÅ‰ΩøÁî®Âú∫ÊôØ"><a href="#Âõõ„ÄÅ‰ΩøÁî®Âú∫ÊôØ" class="headerlink" title="Âõõ„ÄÅ‰ΩøÁî®Âú∫ÊôØ"></a>Âõõ„ÄÅ‰ΩøÁî®Âú∫ÊôØ</h5><p>‚Äã‰∏ãËø∞‰∏∫‰∏Ä‰∫õÂÖ≥‰∫éÂ¶Ç‰Ωï‰ΩøÁî®Ë∞ÉÂ∫¶Ê°ÜÊû∂Êù•Ëß£ÂÜ≥Â∏∏ËßÅË∞ÉÂ∫¶Âú∫ÊôØÁöÑÁ§∫‰æã„ÄÇ</p><ol><li><p>ËÅîÂêàË∞ÉÂ∫¶</p><p>Á±ª‰ºº<code>kube-batch</code>ÔºåÂÖÅËÆ∏Ë∞ÉÂ∫¶‰ª•‰∏ÄÂÆöÊï∞ÈáèÁöÑPod‰∏∫Êï¥‰ΩìÁöÑ‰ªªÂä°„ÄÇÂÖ∂ËÉΩÂ§üÂ∞Ü‰∏Ä‰∏™ËÆ≠ÁªÉ‰ªªÂä°ÁöÑÂ§ö‰∏™workerÂΩìÂÅö‰∏Ä‰∏™Êï¥‰ΩìËøõË°åË∞ÉÂ∫¶ÔºåÂè™ÊúâÂΩì‰ªªÂä°ÊâÄÊúâworkerÁöÑËµÑÊ∫êÈÉΩÊª°Ë∂≥ÔºåÊâç‰ºöÂ∞ÜÂÆπÂô®Âú®ËäÇÁÇπ‰∏äÂêØÂä®„ÄÇ</p></li><li><p>ÈõÜÁæ§ËµÑÊ∫êÁöÑÂä®ÊÄÅÁªëÂÆö</p><p> Volume topology-awareË∞ÉÂ∫¶ÂèØ‰ª•ÈÄöËøáfilterÂíåprebindÊñπÂºèÂÆûÁé∞„ÄÇ</p></li><li><p>Ë∞ÉÂ∫¶ÊãìÂ±ï</p><p>ËØ•Ê°ÜÊû∂ÂÖÅËÆ∏Ëá™ÂÆö‰πâÊèí‰ª∂Ôºå‰ª•mainÂáΩÊï∞Â∞ÅË£ÖschedulerÊñπÂºèËøêË°å„ÄÇ</p></li></ol><p>ÂÖ≥‰∫éÊ°ÜÊû∂ÈÉ®ÂàÜÔºåËØ•ÊñáÂ∞±‰ªãÁªçÂà∞Ê≠§Â§ÑÔºåÊé•‰∏ãÈáåÂ∞ÜËøõÂÖ•Ê∫êÁ†ÅÈò∂ÊÆµÔºåÂêéÁª≠ÂÜÖÂÆπ‰∏∫Ë∞ÉÂ∫¶ÈÖçÁΩÆÂèäÁ¨¨‰∏âÊñπË∞ÉÂ∫¶ÈõÜÊàêÁöÑÁõ∏ÂÖ≥ÂÜÖÂÆπÔºåÊï¨ËØ∑ÂÖ≥Ê≥®„ÄÇ</p><h5 id="‰∫î„ÄÅÂèÇËÄÉËµÑÊñô"><a href="#‰∫î„ÄÅÂèÇËÄÉËµÑÊñô" class="headerlink" title="‰∫î„ÄÅÂèÇËÄÉËµÑÊñô"></a>‰∫î„ÄÅÂèÇËÄÉËµÑÊñô</h5><pre><code>1. https://kubernetes.io/docs/concepts/scheduling-eviction/kube-scheduler/ 2. https://kubernetes.io/docs/concepts/scheduling-eviction/scheduling-framework/ 3. https://github.com/kubernetes/enhancements/blob/master/keps/sig-scheduling/624-scheduling-framework/README.md</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;‰ªäÂ§©zouyeeÂÖàÂ∏¶ÂêÑ‰ΩçÁõòÁÇπCNCF‰∏äÂë®ÁöÑ‰∏Ä‰∫õÊúâË∂£ÁöÑ‰∫ãÊÉÖÔºö&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;KubernetesÁ§æÂå∫GB‰ª£Ë°®ÈÄâ‰∏æÁªìÊùü Paris PittmanÂΩìÈÄâ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;CNCFÂ≠µÂåñÈ°πÁõÆOPAËøõÂÖ•ÊØï‰∏öÊµÅÁ®ã&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;‰∏äÂë®</summary>
      
    
    
    
    <category term="Kubernetes GO" scheme="https://zoues.com/categories/Kubernetes-GO/"/>
    
    
    <category term="cloudnative" scheme="https://zoues.com/tags/cloudnative/"/>
    
    <category term="kubernetes" scheme="https://zoues.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>‰∏ÄÊñáÊêûÊáÇKubernetesÁΩëÁªúÁ≠ñÁï•</title>
    <link href="https://zoues.com/posts/d6be75a2/"/>
    <id>https://zoues.com/posts/d6be75a2/</id>
    <published>2021-01-13T04:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.375Z</updated>
    
    <content type="html"><![CDATA[<p>‰ªéCNCFÂü∫Èáë‰ºöÁöÑÊàêÁ´ãÔºåÂà∞KubernetesÁ§æÂå∫Ëì¨ÂãÉÂèëÂ±ïÔºåÂéÜÁªè6ËΩΩÔºå17Âπ¥ÂºÇÂÜõÁ™ÅËµ∑ÔºåÂú®mesos„ÄÅswarmÁ≠âÈ°πÁõÆËßíÈÄê‰∏≠ÔºåÊãîÂæóÂ§¥Á≠πÔºåÁªßËÄå‰∏ÄÁªüÂÆπÂô®ÁºñÊéí,ÂÖ∂ÊàêÂäüÁöÑÂÖ≥ÈîÆÂéüÂõ†ÂèØÊ¶ÇÊã¨‰∏∫‰ª•‰∏ãÂá†ÁÇπÔºö</p><ul><li>È°πÁõÆÈ¢ÜÂØºËÄÖ‰ª¨ÁöÑÂùöÂÆà‰∏éËøúËßÅ</li><li>Á§æÂå∫ÁöÑËâØÂ•ΩÁöÑËøê‰Ωú‰∏éÁ§æÂå∫ÊñáÂåñ</li><li>Á§æÂå∫‰∏é‰ºÅ‰∏öËêΩÂú∞ÁöÑÊ≠£ÂèçÈ¶à</li></ul><p>‰ªäÂ§©zouyee‰∏∫Â§ßÂÆ∂Â∏¶Êù•„Ää‰∏ÄÊñáÊêûÊáÇKubernetesÁΩëÁªúÁ≠ñÁï•„ÄãÔºåÂÖ∂‰∏≠„ÄäkuberneterË∞ÉÂ∫¶Áî±ÊµÖÂÖ•Ê∑±ÔºöÊ°ÜÊû∂„ÄãÊ≠£Âú®ÁºñÂÜô‰∏≠ÔºåÊï¨ËØ∑ÊúüÂæÖÔºåÂΩìÂâçÊ∂âÂèäÁâàÊú¨Âùá‰∏∫<code>1.20.+</code>„ÄÇ</p><hr><h4 id="‰∏Ä„ÄÅNetwork-PolicyÁÆÄ‰ªã"><a href="#‰∏Ä„ÄÅNetwork-PolicyÁÆÄ‰ªã" class="headerlink" title="‰∏Ä„ÄÅNetwork PolicyÁÆÄ‰ªã"></a>‰∏Ä„ÄÅNetwork PolicyÁÆÄ‰ªã</h4><p>‚ÄãÈöèÁùÄÂæÆÊúçÂä°Êû∂ÊûÑÁöÑÊó•Ê∏êÁõõË°åÔºåServerlessÊ°ÜÊû∂ÁöÑÈÄêÊ≠•ËêΩÂú∞ÔºåÂ∫îÁî®‰∏ä‰∫ëÂêéÂ∏¶Êù•‰∫ÜÊ®°ÂùóÈó¥ÁΩëÁªúË∞ÉÁî®ÈúÄÊ±ÇÁöÑÂ§ßËßÑÊ®°Â¢ûÈïøÔºåKubernetes Ëá™ 1.3 ÂºïÂÖ•‰∫Ü Network PolicyÔºåÂÖ∂Êèê‰æõ‰ª•Â∫îÁî®‰∏∫‰∏≠ÂøÉÔºå Âü∫‰∫éÁ≠ñÁï•ÁöÑÁΩëÁªúÊéßÂà∂ÔºåÁî®‰∫éÈöîÁ¶ªÂ∫îÁî®‰ª•ÂáèÂ∞ëÊîªÂáªÈù¢„ÄÇ</p><p>‚ÄãPod‰πãÈó¥ËÉΩÂê¶ÈÄö‰ø°ÂèØÈÄöËøáÂ¶Ç‰∏ã‰∏âÁßçÁªÑÂêàËøõË°åÁ°ÆËÆ§Ôºö</p><ol><li>ÂÖ∂‰ªñË¢´ÂÖÅËÆ∏ÁöÑ PodsÔºà‰æãÂ¶ÇÔºöPod Êó†Ê≥ïÈôêÂà∂ÂØπËá™Ë∫´ÁöÑËÆøÈóÆÔºâ</li><li>Ë¢´ÂÖÅËÆ∏ËÆøÈóÆÁöÑnamespace</li><li>IP  CIDRÔºà‰æãÂ¶ÇÔºö‰∏é Pod ËøêË°åÊâÄÂú®ËäÇÁÇπÁöÑÈÄö‰ø°ÊÄªÊòØË¢´ÂÖÅËÆ∏ÁöÑÔºâ</li></ol><p>Âú®ÂÆö‰πâÂü∫‰∫é Pod ÊàñnamespaceÁöÑ NetworkPolicy Êó∂ÔºåÂèØ‰ª•‰ΩøÁî®<code>Ê†áÁ≠æÈÄâÊã©Âô®</code>Êù•ËÆæÂÆöÂì™‰∫õÊµÅÈáèÂèØ‰ª•ËøõÂÖ•ÊàñÁ¶ªÂºÄ Pod„ÄÇÂêåÊó∂ÔºåÂΩìÂàõÂª∫Âü∫‰∫é IP ÁöÑ NetworkPolicy Êó∂ÔºåÂèØ‰ª•Âü∫‰∫é IP CIDR Êù•ÂÆö‰πâÁ≠ñÁï•„ÄÇ</p><p>‰ª•‰∏ãÁªìÊûÑ‰ΩìÁ§∫ÊÑèÂõæËæÖÂä©ÁêÜËß£ÔºåÂêéÈù¢Á´†ËäÇÊúâÂÖ∑‰ΩìËØ¥ÊòéÔºö</p><p><img src="https://s3.ax1x.com/2021/01/12/sYphbq.png"></p><h5 id="ÁâàÊú¨ÂèòËøÅ"><a href="#ÁâàÊú¨ÂèòËøÅ" class="headerlink" title="ÁâàÊú¨ÂèòËøÅ"></a>ÁâàÊú¨ÂèòËøÅ</h5><table><thead><tr><th>Kubernetes ÁâàÊú¨</th><th>Networking API ÁâàÊú¨</th><th>ËØ¥Êòé</th></tr></thead><tbody><tr><td>v1.5-v1.6</td><td>extensions&#x2F;v1beta1</td><td>ÈúÄË¶ÅÂú®kube-apiserverÂºÄÂêØ <code>extensions/v1beta1/networkpolicies</code></td></tr><tr><td>v1.7</td><td>networking.k8s.io&#x2F;v1</td><td></td></tr><tr><td>v1.8</td><td>networking.k8s.io&#x2F;v1</td><td>Êñ∞Â¢û <strong>Egress</strong> Âíå <strong>IPBlock</strong> ÁöÑÊîØÊåÅ</td></tr></tbody></table><h4 id="‰∫å„ÄÅÁÆÄË¶Å‰ªãÁªç"><a href="#‰∫å„ÄÅÁÆÄË¶Å‰ªãÁªç" class="headerlink" title="‰∫å„ÄÅÁÆÄË¶Å‰ªãÁªç"></a>‰∫å„ÄÅÁÆÄË¶Å‰ªãÁªç</h4><p>ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåPod ÊòØÈùûÈöîÁ¶ªÁöÑÔºåÂÆÉ‰ª¨Êé•Âèó‰ªª‰ΩïÊµÅÈáè„ÄÇ</p><p>Pod Âú®Ë¢´Êüê NetworkPolicy ÈÄâ‰∏≠Êó∂ËøõÂÖ•ÈöîÁ¶ªÁä∂ÊÄÅ„ÄÇ ‰∏ÄÊó¶ÂêçÂ≠óÁ©∫Èó¥‰∏≠Êúâ NetworkPolicy ÈÄâÊã©‰∫ÜÁâπÂÆöÁöÑ PodÔºåËØ• Pod ‰ºöÊãíÁªùËØ• NetworkPolicy ÊâÄ‰∏çÂÖÅËÆ∏ÁöÑËøûÊé•„ÄÇ ÔºàÂêçÂ≠óÁ©∫Èó¥‰∏ãÂÖ∂‰ªñÊú™Ë¢´ NetworkPolicy ÊâÄÈÄâÊã©ÁöÑ Pod ‰ºöÁªßÁª≠Êé•ÂèóÊâÄÊúâÁöÑÊµÅÈáèÔºâ</p><p><em><strong>ÁΩëÁªúÁ≠ñÁï•‰∏ç‰ºöÂÜ≤Á™Å</strong></em>„ÄÇ Â¶ÇÊûú‰ªª‰Ωï‰∏Ä‰∏™ÊàñÂ§ö‰∏™Á≠ñÁï•ÈÄâÊã©‰∫Ü‰∏Ä‰∏™ Pod, ÂàôËØ• Pod ÂèóÈôê‰∫éËøô‰∫õÁ≠ñÁï•ÁöÑ ÂÖ•Á´ôÔºàIngressÔºâ&#x2F;Âá∫Á´ôÔºàEgressÔºâËßÑÂàôÁöÑÂπ∂ÈõÜ„ÄÇ</p><p>‚ö†Ô∏èÂú®‰ΩøÁî® Network Policy Êó∂ÔºåÁΩëÁªúÊèí‰ª∂ÈúÄË¶ÅÊîØÊåÅ Network PolicyÔºåÂ¶Ç Calico„ÄÅRomana„ÄÅWeave Net Âíå Trireme Á≠âÔºåÂÖ∂‰∏≠Engress‰∏∫ Âá∫Âè£ÊµÅÈáèÔºåIngress‰∏∫ ÂÖ•Âè£ÊµÅÈáè„ÄÇ</p><h5 id="2-1-ÁªìÊûÑ‰ΩìËØ¥Êòé"><a href="#2-1-ÁªìÊûÑ‰ΩìËØ¥Êòé" class="headerlink" title="2.1 ÁªìÊûÑ‰ΩìËØ¥Êòé"></a>2.1 ÁªìÊûÑ‰ΩìËØ¥Êòé</h5><p><code>staging/src/k8s.io/api/networking/v1/types.go</code></p><p>‰∏ãÈù¢ÊòØ NetworkPolicy ÁöÑ‰∏Ä‰∏™Á§∫‰æãÔºåÂ¶ÇÈúÄÂÆåÊï¥ËØ¥ÊòéÔºåÂèØÂèÇÁúãÁªìÊûÑÂÆö‰πâÊñáÊ°£:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">NetworkPolicy</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">network-policy-sample</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">podSelector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">role:</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">policyTypes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Ingress</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Egress</span></span><br><span class="line">  <span class="attr">ingress:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">from:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">ipBlock:</span></span><br><span class="line">        <span class="attr">cidr:</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line">        <span class="attr">except:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">172.17</span><span class="number">.1</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">namespaceSelector:</span></span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">project:</span> <span class="string">myproject</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">podSelector:</span></span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">role:</span> <span class="string">frontend</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">egress:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">to:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">ipBlock:</span></span><br><span class="line">        <span class="attr">cidr:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">5978</span></span><br></pre></td></tr></table></figure><p><strong>ÂøÖÈúÄÂ≠óÊÆµ</strong>Ôºö‰∏éÊâÄÊúâÂÖ∂‰ªñÁöÑ Kubernetes ÂØπË±°‰∏ÄÊ†∑ÔºåNetworkPolicy ÈúÄË¶Å <code>apiVersion</code>„ÄÅ <code>kind</code> Âíå <code>metadata</code> Â≠óÊÆµ„ÄÇ</p><p><strong>spec</strong>ÔºöNetworkPolicy <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">ËßÑÁ∫¶</a>‰∏≠ÂåÖÂê´‰∫ÜÂú®ÂêçÂ≠óÁ©∫Èó¥‰∏≠ÂÆö‰πâÁâπÂÆöÁΩëÁªúÁ≠ñÁï•ÊâÄÈúÄÁöÑÊâÄÊúâ‰ø°ÊÅØ„ÄÇ</p><p><strong>podSelector</strong>ÔºöÊØè‰∏™ NetworkPolicy ÈÉΩÂåÖÊã¨‰∏Ä‰∏™ <code>podSelector</code>ÔºåÂÆÉÈÄâÊã©ÈÄÇÁî®ËØ•ËØ•Á≠ñÁï•ÁöÑ Pod„ÄÇÁ§∫‰æã‰∏≠ÁöÑÁ≠ñÁï•ÈÄâÊã©Â∏¶Êúâ ‚Äúrole&#x3D;db‚Äù Ê†áÁ≠æÁöÑ Pod„ÄÇ Ëã•<code>podSelector</code>‰∏∫Á©∫ÁöÑÔºåÂàôÈÄâÊã©ÂêçÂ≠óÁ©∫Èó¥‰∏ãÊâÄÊúâ Pod„ÄÇ</p><p><strong>policyTypes</strong>: ÊØè‰∏™ NetworkPolicy ÈÉΩÂåÖÂê´‰∏Ä‰∏™ <code>policyTypes</code> ÂàóË°®ÔºåÂÖ∂‰∏≠ÂåÖÂê´ <code>Ingress</code> Êàñ <code>Egress</code> ÊàñÔºà‰∏§ËÄÖ‰∫¶ÂèØÔºâ„ÄÇ<code>policyTypes</code> Â≠óÊÆµË°®Á§∫ÁªôÂÆöÁöÑÁ≠ñÁï•ÊòØÂ∫îÁî®‰∫é ÊâÄÈÄâ Pod ÁöÑÂÖ•Âè£ÊµÅÈáèËøòÊòØÊù•Âá∫Âè£ÊµÅÈáèÔºà‰∏§ËÄÖ‰∫¶ÂèØÔºâ„ÄÇ Â¶ÇÊûú NetworkPolicy Êú™ÊåáÂÆö <code>policyTypes</code> ÂàôÈªòËÆ§ÊÉÖÂÜµ‰∏ãÂßãÁªàËÆæÁΩÆ <code>Ingress</code>Ôºõ Â¶ÇÊûú NetworkPolicy Êúâ‰ªª‰ΩïÂá∫Âè£ËßÑÂàôÁöÑËØùÂàôËÆæÁΩÆ <code>Egress</code>„ÄÇ</p><p><strong>ingress</strong>: ÊØè‰∏™ NetworkPolicy ÂèØÂåÖÂê´‰∏Ä‰∏™ <code>ingress</code> ËßÑÂàôÁöÑÁôΩÂêçÂçïÂàóË°®„ÄÇ ÊØè‰∏™ËßÑÂàôÈÉΩÂÖÅËÆ∏ÂêåÊó∂ÂåπÈÖç <code>from</code> Âíå <code>ports</code> ÈÉ®ÂàÜÁöÑÊµÅÈáè„ÄÇÁ§∫‰æãÁ≠ñÁï•‰∏≠ÂåÖÂê´‰∏ÄÊù° ÁÆÄÂçïÁöÑËßÑÂàôÔºö ÂÆÉÂåπÈÖçÊüê‰∏™ÁâπÂÆöÁ´ØÂè£ÔºåÁ¨¨‰∏Ä‰∏™ÈÄöËøá <code>ipBlock</code> ÊåáÂÆöÔºåÁ¨¨‰∫å‰∏™ÈÄöËøá <code>namespaceSelector</code> ÊåáÂÆöÔºåÁ¨¨‰∏â‰∏™ÈÄöËøá <code>podSelector</code> ÊåáÂÆö„ÄÇ</p><p><strong>egress</strong>: ÊØè‰∏™ NetworkPolicy ÂèØÂåÖÂê´‰∏Ä‰∏™ <code>egress</code> ËßÑÂàôÁöÑÁôΩÂêçÂçïÂàóË°®„ÄÇ ÊØè‰∏™ËßÑÂàôÈÉΩÂÖÅËÆ∏ÂåπÈÖç <code>to</code> Âíå <code>port</code> ÈÉ®ÂàÜÁöÑÊµÅÈáè„ÄÇËØ•Á§∫‰æãÁ≠ñÁï•ÂåÖÂê´‰∏ÄÊù°ËßÑÂàôÔºå ËØ•ËßÑÂàôÊåáÂÆöÁ´ØÂè£‰∏äÁöÑÊµÅÈáèÂåπÈÖçÂà∞ <code>10.0.0.0/24</code> ‰∏≠ÁöÑ‰ªª‰ΩïÁõÆÁöÑÂú∞„ÄÇ</p><p>ËØ•ÁΩëÁªúÁ≠ñÁï•ÊÄªÁªìÂ¶Ç‰∏ã:</p><ol><li>ÈöîÁ¶ª <code>default</code>ÂêçÂ≠óÁ©∫Èó¥‰∏ã <code>role=db</code> ÁöÑ Pod „ÄÇ</li><li>Âá∫Âè£ÈôêÂà∂:ÂÖÅËÆ∏Á¨¶Âêà‰ª•‰∏ãÊù°‰ª∂ÁöÑ Pod ËøûÊé•Âà∞ <code>default</code>ÂêçÂ≠óÁ©∫Èó¥‰∏ãÊ†áÁ≠æ‰∏∫ <code>role=db</code>ÁöÑÊâÄÊúâ Pod ÁöÑ 6379 TCP Á´ØÂè£Ôºö<ul><li><code>default</code>ÂêçÂ≠óÁ©∫Èó¥‰∏ãÂ∏¶Êúâ <code>role=frontend</code> Ê†áÁ≠æÁöÑÊâÄÊúâ Pod</li><li>Â∏¶Êúâ <code>project=myproject</code> Ê†áÁ≠æÁöÑÊâÄÊúâÂêçÂ≠óÁ©∫Èó¥‰∏≠ÁöÑ Pod</li><li>IP Âú∞ÂùÄËåÉÂõ¥‰∏∫<code> 172.17.0.0‚Äì172.17.0.255</code> Âíå <code>172.17.2.0‚Äì172.17.255.255 </code>ÔºàÂç≥Èô§‰∫Ü 172.17.1.0&#x2F;24 ‰πãÂ§ñÁöÑÊâÄÊúâ 172.17.0.0&#x2F;16Ôºâ</li></ul></li><li>ÂÖ•Âè£ÈôêÂà∂ÔºöÂÖÅËÆ∏‰ªéÂ∏¶Êúâ <code>role=db</code>Ê†áÁ≠æÁöÑÂêçÂ≠óÁ©∫Èó¥‰∏ãÁöÑ‰ªª‰Ωï Pod Âà∞ CIDR 10.0.0.0&#x2F;24 ‰∏ã 5978 TCP Á´ØÂè£„ÄÇ</li></ol><h5 id="2-2-ÁÆÄÂçïÁ§∫‰æã"><a href="#2-2-ÁÆÄÂçïÁ§∫‰æã" class="headerlink" title="2.2 ÁÆÄÂçïÁ§∫‰æã"></a>2.2 ÁÆÄÂçïÁ§∫‰æã</h5><p>‰ª• calico ‰∏∫‰æãÁúã‰∏Ä‰∏ã Network Policy ÁöÑÂÖ∑‰ΩìÁî®Ê≥ï„ÄÇ</p><ol><li>ÈÖçÁΩÆ kubelet ‰ΩøÁî® CNI ÁΩëÁªúÊèí‰ª∂(ÈªòËÆ§Â∑≤ÁªèÈÖçÁΩÆÔºåÊó†ÈúÄÊõ¥Êîπ)</li></ol><p><code>kubelet --network-plugin=cni --cni-conf-dir=/etc/cni/net.d --cni-bin-dir=/opt/cni/bin ...</code></p><ol start="2"><li>ÂÆâË£Ö calio ÁΩëÁªúÊèí‰ª∂</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Ê≥®ÊÑè‰øÆÊîπ CIDRÔºåÈúÄË¶ÅË∑ü k8s pod-network-cidr ‰∏ÄËá¥ÔºåÈªòËÆ§‰∏∫ 192.168.0.0/16</span><br><span class="line"># ÂΩìÂâçÈÄâÊã©ÁöÑÊòØÂ∞è‰∫é50ËäÇÁÇπÁöÑÂÆâË£ÖÊñπÂºèÔºåÂÖ∑‰ΩìÂÆâË£ÖÂèØÊü•Áúã</span><br><span class="line"># https://docs.projectcalico.org/getting-started/kubernetes/self-managed-onprem/onpremises</span><br><span class="line">kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml</span><br></pre></td></tr></table></figure><ol start="3"><li>ÈÉ®ÁΩ≤Â∫îÁî®</li></ol><p>ÈÉ®ÁΩ≤ nginx ÊúçÂä°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create deployment nginx --image=nginx</span><br><span class="line">deployment &quot;nginx&quot; created</span><br><span class="line">$ kubectl expose deployment nginx --port=80</span><br><span class="line">service &quot;nginx&quot; exposed</span><br></pre></td></tr></table></figure><p>ÊµãËØïÁΩëÁªú</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get svc,pod</span><br><span class="line">NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">service/kubernetes   ClusterIP   10.233.0.1      &lt;none&gt;        443/TCP   186d</span><br><span class="line">service/nginx        ClusterIP   10.233.27.142   &lt;none&gt;        80/TCP    2s</span><br><span class="line"></span><br><span class="line">NAME                            READY   STATUS              RESTARTS   AGE</span><br><span class="line">pod/nginx-f89759699-kfmbj       1/1     Running   0          62s</span><br><span class="line"></span><br><span class="line">$ kubectl run busybox --rm -ti --image=busybox /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line"></span><br><span class="line">/ # wget --spider --timeout=1 nginx</span><br><span class="line">Connecting to nginx (10.233.27.142:80)</span><br><span class="line">remote file exists</span><br><span class="line">/ #</span><br></pre></td></tr></table></figure><p>4ÔºâÊµãËØïÁΩëÁªúÁ≠ñÁï•</p><p>Â¶ÇÊûúÂè™ËÆ©ÈÇ£‰∫õÊã•ÊúâÊ†áÁ≠æ <code>access: true</code> ÁöÑ Pod ËÆøÈóÆ <code>nginx</code> ÊúçÂä°Ôºå ÈÇ£‰πàÂèØ‰ª•ÂàõÂª∫‰∏Ä‰∏™Â¶Ç‰∏ãÊâÄÁ§∫ÁöÑ NetworkPolicy ÂØπË±°Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ cat nginx-policy.yaml</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">metadata:</span><br><span class="line">  name: access-nginx</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  ingress:</span><br><span class="line">  - from:</span><br><span class="line">    - podSelector:</span><br><span class="line">        matchLabels:</span><br><span class="line">          access: &quot;true&quot;</span><br><span class="line"></span><br><span class="line">$ kubectl create -f nginx-policy.yaml</span><br><span class="line">networkpolicy &quot;access-nginx&quot; created</span><br><span class="line"></span><br><span class="line"># ‰∏çÂ∏¶ access=true Ê†áÁ≠æÁöÑ Pod ËøòÊòØÊó†Ê≥ïËÆøÈóÆ nginx ÊúçÂä°</span><br><span class="line">$ kubectl run busybox --rm -ti --image=busybox /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line"></span><br><span class="line">/ # wget --spider --timeout=1 nginx</span><br><span class="line">Connecting to nginx (10.233.27.142:80)</span><br><span class="line">wget: download timed out</span><br><span class="line">/ #</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ËÄåÂ∏¶Êúâ access=true Ê†áÁ≠æÁöÑ Pod ÂèØ‰ª•ËÆøÈóÆ nginx ÊúçÂä°</span><br><span class="line">$ kubectl run busybox --rm -ti --labels=&quot;access=true&quot; --image=busybox /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line"></span><br><span class="line">/ # wget --spider --timeout=1 nginx</span><br><span class="line">Connecting to nginx (10.233.27.142:80)</span><br><span class="line">/ #</span><br></pre></td></tr></table></figure><h5 id="‰∏â„ÄÅÂ∫îÁî®Âú∫ÊôØ"><a href="#‰∏â„ÄÅÂ∫îÁî®Âú∫ÊôØ" class="headerlink" title="‰∏â„ÄÅÂ∫îÁî®Âú∫ÊôØ"></a>‰∏â„ÄÅÂ∫îÁî®Âú∫ÊôØ</h5><h5 id="3-1-‰∏ÄËà¨Âú∫ÊôØ"><a href="#3-1-‰∏ÄËà¨Âú∫ÊôØ" class="headerlink" title="3.1 ‰∏ÄËà¨Âú∫ÊôØ"></a>3.1 ‰∏ÄËà¨Âú∫ÊôØ</h5><h5 id="a-Á¶ÅÊ≠¢ËÆøÈóÆÊåáÂÆöÊúçÂä°"><a href="#a-Á¶ÅÊ≠¢ËÆøÈóÆÊåáÂÆöÊúçÂä°" class="headerlink" title="a. Á¶ÅÊ≠¢ËÆøÈóÆÊåáÂÆöÊúçÂä°"></a>a. Á¶ÅÊ≠¢ËÆøÈóÆÊåáÂÆöÊúçÂä°</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run web --image=nginx --labels app=web --expose --port 80</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Êú™ÊúâÁ≠ñÁï•ÈôêÂà∂Êó∂ÔºåÂèØ‰ª•ËÆøÈóÆ</span><br><span class="line">$ kubectl run busybox --rm -ti --image=busybox /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # wget -qO- http://web</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br></pre></td></tr></table></figure><p>ÂàõÂª∫ÁΩëÁªúÁ≠ñÁï•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># cat web-deny-all.yaml</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: web-deny-all</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: web</span><br><span class="line">  ingress: []</span><br><span class="line">  </span><br><span class="line">$ kubectl apply -f web-deny-all.yaml</span><br><span class="line">networkpolicy &quot;web-deny-all&quot; created</span><br></pre></td></tr></table></figure><p>ËÆøÈóÆÊµãËØï</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run busybox --rm -ti --image=busybox /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # wget -qO- --timeout=2 http://web</span><br><span class="line">wget: download timed out</span><br></pre></td></tr></table></figure><p><img src="https://github.com/feiskyer/kubernetes-handbook/raw/master/concepts/images/15022447799137.jpg" alt="img"></p><h5 id="b-ÈôêÂà∂ËÆøÈóÆÊåáÂÆöÊúçÂä°"><a href="#b-ÈôêÂà∂ËÆøÈóÆÊåáÂÆöÊúçÂä°" class="headerlink" title="b. ÈôêÂà∂ËÆøÈóÆÊåáÂÆöÊúçÂä°"></a>b. ÈôêÂà∂ËÆøÈóÆÊåáÂÆöÊúçÂä°</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run apiserver --image=nginx --labels app=bookstore,role=api --expose --port 80</span><br></pre></td></tr></table></figure><p><img src="https://github.com/feiskyer/kubernetes-handbook/raw/master/concepts/images/15022448622429.jpg" alt="img"></p><p>ÂàõÂª∫ÁΩëÁªúÁ≠ñÁï•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># cat api-allow.yaml</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: api-allow</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: bookstore</span><br><span class="line">      role: api</span><br><span class="line">  ingress:</span><br><span class="line">  - from:</span><br><span class="line">      - podSelector:</span><br><span class="line">          matchLabels:</span><br><span class="line">            app: bookstore</span><br><span class="line"># kubectl apply -f api-allow.yaml</span><br><span class="line">networkpolicy &quot;api-allow&quot; created</span><br></pre></td></tr></table></figure><p>ËÆøÈóÆÊµãËØï</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ÂàõÂª∫‰∏çÂä†labelÁöÑpodÔºåÈ¢ÑÊúüÁªìÊûúÔºåËÆøÈóÆË¢´ÈôêÂà∂</span><br><span class="line">$ kubectl run busybox --rm -ti --image=busybox /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # wget -qO- --timeout=2 http://apiserver</span><br><span class="line">wget: download timed out</span><br><span class="line">/ # exit</span><br><span class="line">ÂàõÂª∫Â∏¶app=bookstoreÊ†áÁ≠æÁöÑpodÔºåÈ¢ÑÊúüÁªìÊûúÔºåËÆøÈóÆË¢´ÈôêÂà∂</span><br><span class="line">$ kubectl run busybox --rm -ti --image=busybox --labels app=bookstore,role=frontend /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # wget -qO- --timeout=2 http://apiserver</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;&lt;head&gt;</span><br><span class="line">/ # exit</span><br></pre></td></tr></table></figure><h5 id="c-ÊîæÈÄöËÆøÈóÆÈôêÂà∂"><a href="#c-ÊîæÈÄöËÆøÈóÆÈôêÂà∂" class="headerlink" title="c. ÊîæÈÄöËÆøÈóÆÈôêÂà∂"></a>c. ÊîæÈÄöËÆøÈóÆÈôêÂà∂</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run apiserver --image=nginx --labels app=bookstore,role=api --expose --port 80</span><br></pre></td></tr></table></figure><p>Â∫îÁî®a‰∏≠ÁöÑÁΩëÁªúÁ≠ñÁï•ÔºåÈôêÂà∂ÊâÄÊúâÊµÅÈáè</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># cat web-deny-all.yaml</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: web-deny-all</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: web</span><br><span class="line">  ingress: []</span><br><span class="line">  </span><br><span class="line">$ kubectl apply -f web-deny-all.yaml</span><br><span class="line">networkpolicy &quot;web-deny-all&quot; created</span><br></pre></td></tr></table></figure><p>ÂàõÂª∫ÊîæÈÄöÈÄöÁΩëÁªúÁ≠ñÁï•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># cat web-deny-all.yaml</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: web-allow-all</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: web</span><br><span class="line">  ingress:</span><br><span class="line">  - &#123;&#125;</span><br><span class="line">  </span><br><span class="line">$ kubectl apply -f web-allow-all.yaml</span><br><span class="line">networkpolicy &quot;web-allow-all&quot; created</span><br><span class="line"># ÈúÄË¶ÅÊ≥®ÊÑèdenyË∑üallowÁöÑÁªÜÂæÆÂ∑ÆÂà´Â∞±ÊòØ[]‰∏é&#123;&#125;ÔºåÂÖ∂‰∏≠&#123;&#125;‰ª£Ë°®</span><br><span class="line">- from:</span><br><span class="line">    podSelector: &#123;&#125;</span><br><span class="line">    namespaceSelector: &#123;&#125;</span><br></pre></td></tr></table></figure><h5 id="3-2-namespaceÈôêÂà∂"><a href="#3-2-namespaceÈôêÂà∂" class="headerlink" title="3.2 namespaceÈôêÂà∂"></a>3.2 namespaceÈôêÂà∂</h5><h5 id="a-Á¶ÅÊ≠¢-namespace-‰∏≠ÈùûÁôΩÂêçÂçïÊµÅÈáè"><a href="#a-Á¶ÅÊ≠¢-namespace-‰∏≠ÈùûÁôΩÂêçÂçïÊµÅÈáè" class="headerlink" title="a. Á¶ÅÊ≠¢ namespace ‰∏≠ÈùûÁôΩÂêçÂçïÊµÅÈáè"></a>a. Á¶ÅÊ≠¢ namespace ‰∏≠ÈùûÁôΩÂêçÂçïÊµÅÈáè</h5><p><img src="https://github.com/feiskyer/kubernetes-handbook/raw/master/concepts/images/15022451724392.gif" alt="img"></p><p>ÂàõÂª∫ÁΩëÁªúÁ≠ñÁï•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># cat default-deny-all.yaml</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: default-deny-all</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  podSelector: &#123;&#125;</span><br><span class="line">  ingress: []</span><br><span class="line"># kubectl apply -f default-deny-all.yaml</span><br></pre></td></tr></table></figure><p>ËØ¥Êòé:</p><ul><li><p><code>namespace: default</code> ËØ•Á≠ñÁï•ÈÉ®ÁΩ≤‰∫édefault</p></li><li><p><code>podSelector</code>‰∏∫<code>&#123;&#125;</code>ÊåáÂåπÈÖçÊâÄÊúâpodÔºåÂõ†ËÄåËØ•Á≠ñÁï•ÂØπdefaultÂëΩÂêçÁ©∫Èó¥ÁöÑÊâÄÊúâpodÈÉΩÊúâÊïà</p></li><li><p><code>ingress</code>Êú™ÊåáÂÆöÔºåÂõ†ËÄåÂØπ‰∫éÊâÄÊúâËøõÂÖ•ÊµÅÈáèÈÉΩÁ¶ÅÊ≠¢</p></li></ul><h5 id="b-Á¶ÅÊ≠¢ÂÖ∂‰ªñ-namespace-ÊµÅÈáè"><a href="#b-Á¶ÅÊ≠¢ÂÖ∂‰ªñ-namespace-ÊµÅÈáè" class="headerlink" title="b. Á¶ÅÊ≠¢ÂÖ∂‰ªñ namespace ÊµÅÈáè"></a>b. Á¶ÅÊ≠¢ÂÖ∂‰ªñ namespace ÊµÅÈáè</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl create namespace secondary</span><br><span class="line">kubectl run web --namespace secondary --image=nginx \</span><br><span class="line">    --labels=app=web --expose --port 80</span><br></pre></td></tr></table></figure><p><img src="https://github.com/feiskyer/kubernetes-handbook/raw/master/concepts/images/15022452203435.gif" alt="img"></p><p>ÂàõÂª∫ÁΩëÁªúÈÖçÁΩÆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  namespace: secondary</span><br><span class="line">  name: web-deny-other-namespaces</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">  ingress:</span><br><span class="line">  - from:</span><br><span class="line">    - podSelector: &#123;&#125;</span><br></pre></td></tr></table></figure><p>ËÆøÈóÆÊµãËØï</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># defaultÂëΩÂêçÁ©∫Èó¥ËÆøÈóÆ</span><br><span class="line">$ kubectl run busybox --rm -ti --image=busybox /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # wget -qO- --timeout=2 http://web.secondary</span><br><span class="line">wget: download timed out</span><br><span class="line">/ # exit</span><br><span class="line"># secondaryÂëΩÂêçÁ©∫Èó¥ËÆøÈóÆ</span><br><span class="line">$ kubectl run busybox --rm -ti --image=busybox --namespace=secondary /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # wget -qO- --timeout=2 http://web.secondary</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></table></figure><h5 id="c-ËøêË°åÊâÄÊúânamespaceÊµÅÈáè"><a href="#c-ËøêË°åÊâÄÊúânamespaceÊµÅÈáè" class="headerlink" title="c. ËøêË°åÊâÄÊúânamespaceÊµÅÈáè"></a>c. ËøêË°åÊâÄÊúânamespaceÊµÅÈáè</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run web --image=nginx --labels app=web --expose --port 80</span><br></pre></td></tr></table></figure><p><img src="https://github.com/ahmetb/kubernetes-network-policy-recipes/raw/master/img/5.gif" alt="Diagram of  ALLOW traffic to an application from all namespaces policy"></p><p>ÂàõÂª∫ÁΩëÁªúÁ≠ñÁï•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># cat web-allow-all-namespaces.yaml</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  namespace: default</span><br><span class="line">  name: web-allow-all-namespaces</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: web</span><br><span class="line">  ingress:</span><br><span class="line">  - from:</span><br><span class="line">    - namespaceSelector: &#123;&#125;</span><br><span class="line"># kubectl apply -f web-allow-all-namespaces.yaml</span><br><span class="line"># kubectl create namespace secondary</span><br></pre></td></tr></table></figure><p>ËØ¥ÊòéÔºö</p><ul><li><code>app: web</code>ÁΩëÁªúÁ≠ñÁï•Â∫îÁî®Âà∞ËØ•Ê†áÁ≠æpod</li><li><code>namespaceSelector: &#123;&#125;</code>ÂåπÈÖçÊâÄÊúâÂëΩÂêçÁ©∫Èó¥</li></ul><p>ËÆøÈóÆÊµãËØï</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># kubectl run busybox --rm -ti --image=busybox --namespace=secondary /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # wget -qO- --timeout=2 http://web.secondary</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></table></figure><h5 id="c-ÊåáÂÆö-namespace-ËÆøÈóÆÊúçÂä°"><a href="#c-ÊåáÂÆö-namespace-ËÆøÈóÆÊúçÂä°" class="headerlink" title="c. ÊåáÂÆö namespace ËÆøÈóÆÊúçÂä°"></a>c. ÊåáÂÆö namespace ËÆøÈóÆÊúçÂä°</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># kubectl run web --image=nginx \</span><br><span class="line">    --labels=app=web --expose --port 80</span><br><span class="line"># kubectl create namespace dev</span><br><span class="line"># kubectl label namespace/dev purpose=testing</span><br><span class="line"># kubectl create namespace prod</span><br><span class="line"># kubectl label namespace/prod purpose=production</span><br></pre></td></tr></table></figure><p><img src="https://github.com/feiskyer/kubernetes-handbook/raw/master/concepts/images/15022453441751.gif" alt="img"></p><p>ÂàõÂª∫ÁΩëÁªúÁ≠ñÁï•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># cat web-allow-prod.yaml</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: web-allow-prod</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: web</span><br><span class="line">  ingress:</span><br><span class="line">  - from:</span><br><span class="line">    - namespaceSelector:</span><br><span class="line">        matchLabels:</span><br><span class="line">          purpose: production</span><br><span class="line"># kubectl apply -f web-allow-prod.yaml</span><br></pre></td></tr></table></figure><h5 id="d-ÂÖÅËÆ∏ÂÖ∂‰ªñnamespaceÁöÑÊåáÂÆöpodÁöÑÊµÅÈáè"><a href="#d-ÂÖÅËÆ∏ÂÖ∂‰ªñnamespaceÁöÑÊåáÂÆöpodÁöÑÊµÅÈáè" class="headerlink" title="d. ÂÖÅËÆ∏ÂÖ∂‰ªñnamespaceÁöÑÊåáÂÆöpodÁöÑÊµÅÈáè"></a>d. ÂÖÅËÆ∏ÂÖ∂‰ªñnamespaceÁöÑÊåáÂÆöpodÁöÑÊµÅÈáè</h5><p>‚ö†Ô∏è Kubernetes 1.11ÂêéÊîØÊåÅ<code>podSelector</code> ‰∏é<code>namespaceSelector</code>ÁöÑËøêÁÆóÁ¨¶Êìç‰ΩúÔºåÂêåÊó∂ÈúÄË¶ÅÁΩëÁªúÊèí‰ª∂ÊîØÊåÅ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># kubectl run web --image=nginx \</span><br><span class="line">    --labels=app=web --expose --port 80</span><br><span class="line"># kubectl create namespace other</span><br><span class="line"># kubectl create namespace other</span><br></pre></td></tr></table></figure><p> ÂàõÂª∫ÁΩëÁªúÁ≠ñÁï•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># cat web-allow-all-ns-monitoring.yaml</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: web-allow-all-ns-monitoring</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: web</span><br><span class="line">  ingress:</span><br><span class="line">    - from:</span><br><span class="line">      - namespaceSelector:     # ÈÄâÊã©namespaces‰∏≠Â∏¶Êúâteam=operationsÊ†áÁ≠æÁöÑpod</span><br><span class="line">          matchLabels:</span><br><span class="line">            team: operations  </span><br><span class="line">        podSelector:           # ÈÄâÊã©Â∏¶Êúâtype=monitoringÊ†áÁ≠æÁöÑpod</span><br><span class="line">          matchLabels:</span><br><span class="line">            type: monitoring</span><br><span class="line"># kubectl apply -f web-allow-all-ns-monitoring.yaml</span><br></pre></td></tr></table></figure><p>ËÆøÈóÆÊµãËØï</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">kubectl run busybox --rm -ti --image=busybox  /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # wget -qO- --timeout=2 http://web.default</span><br><span class="line">wget: download timed out</span><br><span class="line"></span><br><span class="line">(ËÆøÈóÆÈôêÂà∂)</span><br><span class="line">/ # exit</span><br><span class="line"></span><br><span class="line"># kubectl run busybox --rm -ti --image=busybox --labels type=monitoring /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # wget -qO- --timeout=2 http://web.default</span><br><span class="line">wget: download timed out</span><br><span class="line"></span><br><span class="line">(ËÆøÈóÆÈôêÂà∂)</span><br><span class="line"></span><br><span class="line"># kubectl run busybox --rm -ti --image=busybox --namespace=other /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # wget -qO- --timeout=2 http://web.default</span><br><span class="line">wget: download timed out</span><br><span class="line"></span><br><span class="line">(ËÆøÈóÆÈôêÂà∂)</span><br><span class="line"></span><br><span class="line"># kubectl run busybox --rm -ti --image=busybox --namespace=other  --labels type=monitoring /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # wget -qO- --timeout=2 http://web.default</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">...</span><br><span class="line">(ÂÖÅËÆ∏ËÆøÈóÆ)</span><br></pre></td></tr></table></figure><h5 id="3-3-ÂÖÅËÆ∏Â§ñÁΩëËÆøÈóÆÊúçÂä°"><a href="#3-3-ÂÖÅËÆ∏Â§ñÁΩëËÆøÈóÆÊúçÂä°" class="headerlink" title="3.3 ÂÖÅËÆ∏Â§ñÁΩëËÆøÈóÆÊúçÂä°"></a>3.3 ÂÖÅËÆ∏Â§ñÁΩëËÆøÈóÆÊúçÂä°</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl run web --image=nginx --labels=app=web --port 80</span><br><span class="line">kubectl expose pod/web --type=LoadBalancer</span><br><span class="line">kubectl get svc web</span><br><span class="line">NAME   TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">web    LoadBalancer   10.233.54.206   &lt;pending&gt;     80:32548/TCP   40s</span><br><span class="line">Áõ¥Ëá≥EXTERNAL-IPÂàÜÈÖçIP‰∏∫Ê≠¢</span><br></pre></td></tr></table></figure><p><img src="https://github.com/feiskyer/kubernetes-handbook/raw/master/concepts/images/15022454444461.gif" alt="img"></p><p>ÂàõÂª∫ÁΩëÁªúÁ≠ñÁï•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># cat web-allow-external.yaml</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: web-allow-external</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: web</span><br><span class="line">  ingress:</span><br><span class="line">  - ports:</span><br><span class="line">    - port: 80</span><br><span class="line">    from: []</span><br><span class="line"># kubectl apply -f web-allow-external.yaml</span><br></pre></td></tr></table></figure><h5 id="3-5-È´òÁ∫ßÂäüËÉΩ"><a href="#3-5-È´òÁ∫ßÂäüËÉΩ" class="headerlink" title="3.5 È´òÁ∫ßÂäüËÉΩ"></a>3.5 È´òÁ∫ßÂäüËÉΩ</h5><h5 id="a-ÂÖÅËÆ∏Â∫îÁî®Âõ∫ÂÆöÁ´ØÂè£ÊµÅÈáè"><a href="#a-ÂÖÅËÆ∏Â∫îÁî®Âõ∫ÂÆöÁ´ØÂè£ÊµÅÈáè" class="headerlink" title="a. ÂÖÅËÆ∏Â∫îÁî®Âõ∫ÂÆöÁ´ØÂè£ÊµÅÈáè"></a>a. ÂÖÅËÆ∏Â∫îÁî®Âõ∫ÂÆöÁ´ØÂè£ÊµÅÈáè</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># kubectl run busybox -ti --image=busybox --labels=app=apiserver /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line"># nohup python3 -m http.server 8001 &amp;</span><br><span class="line"># nohup python3 -m http.server 5001 &amp;</span><br><span class="line"># exit</span><br><span class="line"># kubectl create service clusterip apiserver \</span><br><span class="line">    --tcp 8001:8000 \</span><br><span class="line">    --tcp 5001:5000</span><br></pre></td></tr></table></figure><p><img src="https://github.com/ahmetb/kubernetes-network-policy-recipes/raw/master/img/9.gif" alt="Diagram of ALLOW traffic only to a port of an application policy"></p><p>ÂàõÂª∫ÁΩëÁªúÁ≠ñÁï•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># cat api-allow-5000.yml</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: api-allow-5000</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: apiserver</span><br><span class="line">  ingress:</span><br><span class="line">  - ports:</span><br><span class="line">    - port: 5000</span><br><span class="line">    from:</span><br><span class="line">    - podSelector:</span><br><span class="line">        matchLabels:</span><br><span class="line">          role: monitoring</span><br><span class="line"># kubectl apply -f api-allow-5000.yml</span><br></pre></td></tr></table></figure><p>ËÆøÈóÆÊµãËØï</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># ÂêØÂä®podÊú™Êê∫Â∏¶ÊåáÂÆölabelÊó∂ÔºåËÆøÈóÆÂèóÈôê</span><br><span class="line"># kubectl run busybox --rm -ti --image=busybox /bin/sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # wget -qO- --timeout=2 http://apiserver:8001</span><br><span class="line">wget: download timed out</span><br><span class="line"></span><br><span class="line">/ # wget -qO- --timeout=2 http://apiserver:5001/metrics</span><br><span class="line">wget: download timed out</span><br><span class="line"></span><br><span class="line"># ÂêØÂä®podÊê∫Â∏¶ÊåáÂÆölabelÊó∂ÔºåËÆøÈóÆ‰∏çÂèóÈôê</span><br><span class="line">$ kubectl run busybox --rm -ti --image=busybox --labels=role=monitoring /bin/sh</span><br><span class="line">/ # wget -qO- --timeout=2 http://apiserver:8001</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot; &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">/ # wget -qO- --timeout=2 http://apiserver:5001/</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot; &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h5 id="b-Â§öÊ†áÁ≠æÈôêÂà∂"><a href="#b-Â§öÊ†áÁ≠æÈôêÂà∂" class="headerlink" title="b. Â§öÊ†áÁ≠æÈôêÂà∂"></a>b. Â§öÊ†áÁ≠æÈôêÂà∂</h5><p>ËØ¥ÊòéÔºöNetwork PolicyÂÆö‰πâ‰∏ÄÁªÑÂæÆÊúçÂä°ËÆøÈóÆÊüê‰∏ÄÂ∫îÁî®,Â¶Ç‰∏ãËø∞Á§∫‰æã‰∏≠Ôºå‰∏ÄÁªÑÂæÆÊúçÂä°ÂÖ±‰∫´redisÊúçÂä°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl run db --image=redis:4 --port 6379 --expose \</span><br><span class="line">    --labels app=bookstore,role=db</span><br></pre></td></tr></table></figure><p>‰ª•‰∏ãÊúçÂä°ÂÖ±‰∫´redisÊúçÂä°</p><table><thead><tr><th>service</th><th>labels</th></tr></thead><tbody><tr><td><code>search</code></td><td><code>app=bookstore</code> <code>role=search</code></td></tr><tr><td><code>api</code></td><td><code>app=bookstore</code> <code>role=api</code></td></tr><tr><td><code>catalog</code></td><td><code>app=inventory</code> <code>role=web</code></td></tr></tbody></table><p>ÂàõÂª∫ÁΩëÁªúÁ≠ñÁï•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># cat redis-allow-services.yaml</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: redis-allow-services</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: bookstore</span><br><span class="line">      role: db</span><br><span class="line">  ingress:</span><br><span class="line">  - from:</span><br><span class="line">    - podSelector:</span><br><span class="line">        matchLabels:</span><br><span class="line">          app: bookstore</span><br><span class="line">          role: search</span><br><span class="line">    - podSelector:</span><br><span class="line">        matchLabels:</span><br><span class="line">          app: bookstore</span><br><span class="line">          role: api</span><br><span class="line">    - podSelector:</span><br><span class="line">        matchLabels:</span><br><span class="line">          app: inventory</span><br><span class="line">          role: web</span><br><span class="line"># kubectl apply -f redis-allow-services.yaml</span><br></pre></td></tr></table></figure><p>ËÆøÈóÆÊµãËØï</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run busybox --rm -ti --image=curl --labels=app=inventory,role=web /bin/sh</span><br><span class="line"></span><br><span class="line">/ # nc -v -w 2 db 6379</span><br><span class="line">db (10.233.27.143:6379) open</span><br><span class="line"></span><br><span class="line">(works)</span><br><span class="line"></span><br><span class="line">$ kubectl run busybox --rm -ti --image=curl --labels=app=other /bin/sh</span><br><span class="line"></span><br><span class="line">/ # nc -v -w 2 db 6379</span><br><span class="line">nc: db (10.233.27.143:6379): Operation timed out</span><br><span class="line"></span><br><span class="line">(ËÆøÈóÆÂèóÈôê)</span><br></pre></td></tr></table></figure><h5 id="3-6-ÊéßÂà∂Âá∫Âè£ÊµÅÈáè"><a href="#3-6-ÊéßÂà∂Âá∫Âè£ÊµÅÈáè" class="headerlink" title="3.6 ÊéßÂà∂Âá∫Âè£ÊµÅÈáè"></a>3.6 ÊéßÂà∂Âá∫Âè£ÊµÅÈáè</h5><h5 id="a-Á¶ÅÊ≠¢Â∫îÁî®ÁöÑÂá∫Âè£ÊµÅÈáè"><a href="#a-Á¶ÅÊ≠¢Â∫îÁî®ÁöÑÂá∫Âè£ÊµÅÈáè" class="headerlink" title="a. Á¶ÅÊ≠¢Â∫îÁî®ÁöÑÂá∫Âè£ÊµÅÈáè"></a>a. Á¶ÅÊ≠¢Â∫îÁî®ÁöÑÂá∫Âè£ÊµÅÈáè</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run web --image=nginx --labels app=web --expose --port 80</span><br></pre></td></tr></table></figure><p>ÂàõÂª∫ÁΩëÁªúÁ≠ñÁï•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># cat foo-deny-egress.yaml</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">metadata:</span><br><span class="line">  name: foo-deny-egress</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: foo</span><br><span class="line">  policyTypes:</span><br><span class="line">  - Egress</span><br><span class="line">  egress: []</span><br><span class="line"># kubectl apply -f foo-deny-egress.yaml</span><br></pre></td></tr></table></figure><p>ËØ¥ÊòéÔºö</p><ul><li><code>policyTypes: [&quot;egress&quot;]</code> ËØ•Á≠ñÁï•Á±ªÂûã‰∏∫Âá∫Âè£ÊµÅÈáè</li><li><code>egress: []</code> Á≠ñÁï•‰∏∫Á©∫ËØ¥ÊòéÂá∫Âè£ÊµÅÈáèÂÖ®ÈÉ®Á¶ÅÊ≠¢</li></ul><h5 id="b-Á¶ÅÊ≠¢ÂëΩÂêçÁ©∫Èó¥ÈùûÁôΩÂêçÂçïÊµÅÈáè"><a href="#b-Á¶ÅÊ≠¢ÂëΩÂêçÁ©∫Èó¥ÈùûÁôΩÂêçÂçïÊµÅÈáè" class="headerlink" title="b. Á¶ÅÊ≠¢ÂëΩÂêçÁ©∫Èó¥ÈùûÁôΩÂêçÂçïÊµÅÈáè"></a>b. Á¶ÅÊ≠¢ÂëΩÂêçÁ©∫Èó¥ÈùûÁôΩÂêçÂçïÊµÅÈáè</h5><p>ÂàõÂª∫ÁΩëÁªúÁ≠ñÁï•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># cat default-deny-all-egress.yaml</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: default-deny-all-egress</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  policyTypes:</span><br><span class="line">  - Egress</span><br><span class="line">  podSelector: &#123;&#125;</span><br><span class="line">  egress: []</span><br><span class="line"># kubectl apply -f default-deny-all-egress.yaml</span><br></pre></td></tr></table></figure><p>ËØ¥ÊòéÔºö</p><ul><li><code>podSelector</code>‰∏∫Á©∫ÔºåËØ¥ÊòéÂåπÈÖçÊâÄÊúâpod</li><li><code>egress</code>‰∏∫Á©∫Êï∞ÁªÑÔºåËØ¥ÊòéÁ¶ÅÊ≠¢ÊâÄÊúâÁ¨¶Âêà<code>podSelector</code>ÁöÑÂá∫Âè£ÊµÅÈáè</li></ul><h5 id="Âõõ„ÄÅNetworkPolicy-ÂºÄÂèë"><a href="#Âõõ„ÄÅNetworkPolicy-ÂºÄÂèë" class="headerlink" title="Âõõ„ÄÅNetworkPolicy ÂºÄÂèë"></a>Âõõ„ÄÅNetworkPolicy ÂºÄÂèë</h5><p>‚ÄãÂÆûÁé∞‰∏Ä‰∏™ÊîØÊåÅ Network Policy ÁöÑÁΩëÁªúÊâ©Â±ïÈúÄË¶ÅËá≥Â∞ëÂåÖÂê´‰∏§‰∏™ÁªÑ‰ª∂</p><ul><li>CNI ÁΩëÁªúÊèí‰ª∂ÔºöË¥üË¥£Áªô Pod ÈÖçÁΩÆÁΩëÁªúÊé•Âè£</li><li>Policy controllerÔºöÁõëÂê¨ Network Policy ÁöÑÂèòÂåñÔºåÂπ∂Â∞Ü Policy Â∫îÁî®Âà∞Áõ∏Â∫îÁöÑÁΩëÁªúÊé•Âè£</li></ul><p><img src="https://github.com/feiskyer/kubernetes-handbook/raw/master/plugins/images/policy-controller.jpg" alt="img"></p><h5 id="ÊÄßËÉΩÊµãËØï"><a href="#ÊÄßËÉΩÊµãËØï" class="headerlink" title="ÊÄßËÉΩÊµãËØï"></a>ÊÄßËÉΩÊµãËØï</h5><p>‰∏ãÂõæÂü∫‰∫éKubernetes 1.19ÁâàÊú¨ÊµãËØï‰∫Ü‰ª•‰∏ãÁâπÊÄßÔºö</p><p>1ÔºâMTU auto config</p><p>2Ôºâ Â∏¶ÂÆΩÊÄßËÉΩ: Pod to Pod„ÄÅPod to ServiceÔºàTCP„ÄÅUDPÔºâ</p><p>3ÔºâËµÑÊ∫êÊ∂àËÄó: Pod to Pod„ÄÅPod to ServiceÔºàTCP„ÄÅUDPÔºâ</p><p>4ÔºâÂÆâÂÖ®ÁâπÊÄßÔºöNetwork Policies„ÄÅ EncryptionÁ≠â</p><p><img src="https://s3.ax1x.com/2021/01/12/sJzrLt.png" alt="Image for post"></p><p>calicoÂÖ∂‰ªñËØ¶ÁªÜÁöÑËÉΩÂäõËØ¥ÊòéÔºåÂèØÂèÇÁúãÂÆòÁΩë„ÄÇ</p><h5 id="‰∫î„ÄÅÊú™Êù•Â±ïÊúõ"><a href="#‰∫î„ÄÅÊú™Êù•Â±ïÊúõ" class="headerlink" title="‰∫î„ÄÅÊú™Êù•Â±ïÊúõ"></a>‰∫î„ÄÅÊú™Êù•Â±ïÊúõ</h5><h5 id="a-SCTPÁâπÊÄß"><a href="#a-SCTPÁâπÊÄß" class="headerlink" title="a. SCTPÁâπÊÄß"></a>a. SCTPÁâπÊÄß</h5><p><strong>ÊîØÊåÅÁâàÊú¨Ôºö</strong> <code>Kubernetes v1.19 [beta]</code></p><p>‰Ωú‰∏∫‰∏Ä‰∏™ Beta ÁâπÊÄßÔºåSCTP ÈªòËÆ§ÊòØË¢´ÂêØÁî®ÁöÑ„ÄÇ Ë¶ÅÂú®ÈõÜÁæ§Â±ÇÈù¢Á¶ÅÁî® SCTPÔºåÈúÄË¶Å‰∏∫ <code>kube-apiserver</code>ÂÖ≥Èó≠ÁâπÊÄß<code>--feature-gates=SCTPSupport=false,...</code> ‰ª•Á¶ÅÁî® <code>SCTP</code> „ÄÇ ÂêØÁî®ËØ•ÁâπÊÄßÂêéÔºåÁî®Êà∑ÂèØ‰ª•Â∞Ü NetworkPolicy ÁöÑ <code>protocol</code> Â≠óÊÆµËÆæÁΩÆ‰∏∫ <code>SCTP</code>„ÄÇ</p><p>‚ö†Ô∏è CNIÊèí‰ª∂ÈúÄË¶ÅÊîØÊåÅSCTPÂçèËÆÆ</p><h5 id="b-ÂæÖÂºÄÂèë"><a href="#b-ÂæÖÂºÄÂèë" class="headerlink" title="b. ÂæÖÂºÄÂèë"></a>b. ÂæÖÂºÄÂèë</h5><p>Êà™Ê≠¢Kubernetes v1.20 ÔºåNetworkPolicy API Ëøò‰∏çÊîØÊåÅ‰∏ãËø∞ÂäüËÉΩ„ÄÇ</p><ul><li>Âº∫Âà∂ÈõÜÁæ§ÂÜÖÈÉ®ÊµÅÈáèÁªèËøáÊüêÂÖ¨Áî®ÁΩëÂÖ≥ÔºàÂèØÈÄöËøáÊúçÂä°ÁΩëÊ†ºÊàñÂÖ∂‰ªñ‰ª£ÁêÜÊù•ÂÆûÁé∞Ôºâ</li><li>‰∏é TLS Áõ∏ÂÖ≥ÁöÑÂú∫ÊôØÔºàÂèØ‰ΩøÁî®ÊúçÂä°ÁΩëÊ†ºÊàñËÄÖ Ingress ÊéßÂà∂Âô®Ôºâ</li><li>ÂÆûÁé∞ÈÄÇÁî®‰∫éÊâÄÊúâÂêçÂ≠óÁ©∫Èó¥Êàñ Pods ÁöÑÈªòËÆ§Á≠ñÁï•ÔºàÂ¶ÇcalicoÔºâ</li><li>È´òÁ∫ßÁöÑÁ≠ñÁï•Êü•ËØ¢ÊàñËÄÖÁ≠ñÁï•È™åËØÅÁõ∏ÂÖ≥Â∑•ÂÖ∑ÔºàÂ¶ÇcalicoÔºâ</li><li>Âú®Âêå‰∏ÄÁ≠ñÁï•Â£∞Êòé‰∏≠ÈÄâÊã©ÁõÆÊ†áÁ´ØÂè£ËåÉÂõ¥ÁöÑËÉΩÂäõ</li><li>ÁîüÊàêÁΩëÁªúÂÆâÂÖ®‰∫ã‰ª∂Êó•ÂøóÁöÑËÉΩÂäõÔºà‰æãÂ¶ÇÔºåË¢´ÈòªÂ°ûÊàñÊé•Êî∂ÁöÑËøûÊé•ËØ∑Ê±ÇÔºâ</li><li>Á¶ÅÊ≠¢Êú¨Âú∞ÂõûË∑ØÊàñÊåáÂêëÂÆø‰∏ªÁöÑÁΩëÁªúÊµÅÈáèÔºàPod ÁõÆÂâçÊó†Ê≥ïÈòªÂ°û localhost ËÆøÈóÆÔºå ÂÆÉ‰ª¨‰πüÊó†Ê≥ïÁ¶ÅÊ≠¢Êù•Ëá™ÊâÄÂú®ËäÇÁÇπÁöÑËÆøÈóÆËØ∑Ê±ÇÔºâ„ÄÇ</li></ul><p>‰∏äËø∞ÈúÄÊ±ÇÂèØ‰ª•ÈÄöËøáÊìç‰ΩúÁ≥ªÁªüÁªÑ‰ª∂ÔºàÂ¶Ç SELinux„ÄÅOpenVSwitch„ÄÅIPTables Á≠âÔºâ ÊàñËÄÖ‰∏ÉÂ±ÇÊäÄÊúØÔºàIngress ÊéßÂà∂Âô®„ÄÅÊúçÂä°ÁΩëÊ†ºÂÆûÁé∞ÔºâÂèäÂáÜÂÖ•ÊéßÂà∂Âô®ËøõË°åÂäüËÉΩÂ¢ûÂº∫ÔºåÂΩìÁÑ∂ÊúâÂÖ¥Ë∂£ÁöÑÂèØ‰ª•ÂèÇËÄÉcalicoÂèäOPAÈ°πÁõÆ„ÄÇ</p><h5 id="ÂÖ≠„ÄÅÂèÇËÄÉÊñáÊ°£"><a href="#ÂÖ≠„ÄÅÂèÇËÄÉÊñáÊ°£" class="headerlink" title="ÂÖ≠„ÄÅÂèÇËÄÉÊñáÊ°£"></a>ÂÖ≠„ÄÅÂèÇËÄÉÊñáÊ°£</h5><ul><li><a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">Kubernetes network policies</a></li><li><a href="https://kubernetes.io/docs/tasks/administer-cluster/declare-network-policy/">Declare Network Policy</a></li><li><a href="https://ahmet.im/blog/kubernetes-network-policy/">Securing Kubernetes Cluster Networking</a></li><li><a href="https://github.com/ahmetb/kubernetes-networkpolicy-tutorial">Kubernetes Network Policy Recipes</a></li><li><a href="https://github.com/feiskyer/kubernetes-handbook/blob/master/concepts/network-policy.md">fesikyer network policy</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;‰ªéCNCFÂü∫Èáë‰ºöÁöÑÊàêÁ´ãÔºåÂà∞KubernetesÁ§æÂå∫Ëì¨ÂãÉÂèëÂ±ïÔºåÂéÜÁªè6ËΩΩÔºå17Âπ¥ÂºÇÂÜõÁ™ÅËµ∑ÔºåÂú®mesos„ÄÅswarmÁ≠âÈ°πÁõÆËßíÈÄê‰∏≠ÔºåÊãîÂæóÂ§¥Á≠πÔºåÁªßËÄå‰∏ÄÁªüÂÆπÂô®ÁºñÊéí,ÂÖ∂ÊàêÂäüÁöÑÂÖ≥ÈîÆÂéüÂõ†ÂèØÊ¶ÇÊã¨‰∏∫‰ª•‰∏ãÂá†ÁÇπÔºö&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;È°πÁõÆÈ¢ÜÂØºËÄÖ‰ª¨ÁöÑÂùöÂÆà‰∏éËøúËßÅ&lt;/li&gt;
&lt;li&gt;Á§æÂå∫ÁöÑËâØÂ•ΩÁöÑËøê‰Ωú</summary>
      
    
    
    
    <category term="Kubernetes GO" scheme="https://zoues.com/categories/Kubernetes-GO/"/>
    
    
    <category term="cloudnative" scheme="https://zoues.com/tags/cloudnative/"/>
    
    <category term="kubernetes" scheme="https://zoues.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>KubernetesË∞ÉÂ∫¶Áî±ÊµÖÂÖ•Ê∑±ÔºöÂàùÊé¢</title>
    <link href="https://zoues.com/posts/bafe2904/"/>
    <id>https://zoues.com/posts/bafe2904/</id>
    <published>2021-01-08T04:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.372Z</updated>
    
    <content type="html"><![CDATA[<p>‰ªéCNCFÂü∫Èáë‰ºöÁöÑÊàêÁ´ãÔºåÂà∞KubernetesÁ§æÂå∫Ëì¨ÂãÉÂèëÂ±ïÔºåÂéÜÁªè6ËΩΩÔºå17Âπ¥ÂºÇÂÜõÁ™ÅËµ∑ÔºåÂú®mesos„ÄÅswarmÁ≠âÈ°πÁõÆËßíÈÄê‰∏≠ÔºåÊãîÂæóÂ§¥Á≠πÔºåÁªßËÄå‰∏ÄÁªüÂÆπÂô®ÁºñÊéí,ÂÖ∂ÊàêÂäüÁöÑÂÖ≥ÈîÆÂéüÂõ†ÂèØÊ¶ÇÊã¨‰∏∫‰ª•‰∏ãÂá†ÁÇπÔºö</p><ul><li>È°πÁõÆÈ¢ÜÂØºËÄÖ‰ª¨ÁöÑÂùöÂÆà‰∏éËøúËßÅ</li><li>Á§æÂå∫ÁöÑËâØÂ•ΩÁöÑËøê‰Ωú‰∏éÁ§æÂå∫ÊñáÂåñ</li><li>Á§æÂå∫‰∏é‰ºÅ‰∏öËêΩÂú∞ÁöÑÊ≠£ÂèçÈ¶à</li></ul><p>ËôΩÁÑ∂ÈíàÂØπkubernetesÁöÑ‰ªãÁªçÂ∑≤ÁªèÊØîËæÉÂ§ö‰∫ÜÔºå‰ΩÜÊòØ‰∫ëÂéüÁîüËøòÊòØKubernetesÈ°πÁõÆÁöÑÂèëÂ±ïÈÉΩÂ∑≤ÁªèËøàÂÖ•Ê∑±Ê∞¥Âå∫ÔºåÂõ†ËÄå‰ªäÂ§©zouyee‰∏∫Â§ßÂÆ∂Â∏¶Êù•„ÄäkuberneterË∞ÉÂ∫¶Áî±ÊµÖÂÖ•Ê∑±„ÄãÔºåÂ∏åÊúõÈÄöËøáÊé•‰∏ãÊù•ÁöÑ‰∫îÁØáÊñáÁ´†ÔºåËÆ©ÂêÑ‰ΩçËÉΩÂ§üÁ≥ªÁªüÊ∑±ÂÖ•ÁöÑ‰∫ÜËß£kubernetesË∞ÉÂ∫¶Á≥ªÁªüÔºåËØ•Á≥ªÂàóÂØπÂ∫îÁâàÊú¨‰∏∫<code>1.20.+</code>Ôºå‰ªäÂ§©Â∏¶Êù•„ÄäKubernetesË∞ÉÂ∫¶Á≥ªÁªüÁî±ÊµÖÂÖ•Ê∑±Á≥ªÂàóÔºöÂàùÊé¢„Äã</p><h4 id="‰∏Ä„ÄÅË∞ÉÂ∫¶ÁÆÄ‰ªã"><a href="#‰∏Ä„ÄÅË∞ÉÂ∫¶ÁÆÄ‰ªã" class="headerlink" title="‰∏Ä„ÄÅË∞ÉÂ∫¶ÁÆÄ‰ªã"></a>‰∏Ä„ÄÅË∞ÉÂ∫¶ÁÆÄ‰ªã</h4><p>Âú®ÂºÄÂßãÂâçÔºåÂÖàÊù•ÁúãÁúãKubernetesÁöÑÊû∂ÊûÑÁ§∫ÊÑèÂõæÔºåÂÖ∂‰∏≠ÊéßÂà∂Âπ≥Èù¢ÂåÖÂê´‰ª•‰∏ã‰∏âÂ§ßÁªÑ‰ª∂Ôºökube-scheduler„ÄÅkube-apiserver„ÄÅkube-controller-manager„ÄÇkubeletÂèäkube-proxyÁªÑ‰ª∂ÁöÑÂàÜÊûêÊàë‰ª¨ÂêéÁª≠ÂçïÁã¨ÊàêÁ´†ËøõË°åËÆ≤Ëß£ÔºåÁé∞Âú®Êàë‰ª¨ÂèØ‰ª•ÁÆÄÂçïÁªôÁêÜËß£‰∏äËø∞ÁªÑ‰ª∂ÁöÑÈöæÊòìÁ®ãÂ∫¶Êéí‰∏™Â∫èÔºåkube-apiserver„ÄÅkubelet„ÄÅkube-scheduler„ÄÅkube-controller-manager„ÄÅkube-proxy„ÄÇ</p><p><img src="https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg" alt="Components of Kubernetes"></p><p>Â¶Ç‰∏äÊâÄËø∞Ôºå<code>kube-scheduler</code>ÊòØK8SÁ≥ªÁªüÁöÑÊ†∏ÂøÉÁªÑ‰ª∂‰πã‰∏ÄÔºåÂÖ∂‰∏ªË¶ÅË¥üË¥£PodÁöÑË∞ÉÂ∫¶ÔºåÂÖ∂ÁõëÂê¨kube-apiserverÔºåÊü•ËØ¢Êú™ÂàÜÈÖç NodeÁöÑPodÔºàÊú™ÂàÜÈÖç„ÄÅÂàÜÈÖçÂ§±Ë¥•ÂèäÂ∞ùËØïÂ§öÊ¨°Êó†Ê≥ïÂàÜÈÖçÔºâÔºåÊ†πÊçÆÈÖçÁΩÆÁöÑË∞ÉÂ∫¶Á≠ñÁï•ÔºåÂ∞ÜPodË∞ÉÂ∫¶Âà∞ÊúÄ‰ºòÁöÑÂ∑•‰ΩúËäÇÁÇπ‰∏äÔºå‰ªéËÄåÈ´òÊïà„ÄÅÂêàÁêÜÁöÑÂà©Áî®ÈõÜÁæ§ÁöÑËµÑÊ∫êÔºåËØ•ÁâπÊÄßÊòØÁî®Êà∑ÈÄâÊã©K8SÁ≥ªÁªüÁöÑÂÖ≥ÈîÆÂõ†Á¥†‰πã‰∏ÄÔºåÂ∏ÆÂä©Áî®Êà∑ÊèêÂçáÊïàÁéá„ÄÅÈôç‰ΩéËÉΩËÄó„ÄÇ</p><p><code>kube-scheduler</code> Ë¥üË¥£Â∞ÜPod Ë∞ÉÂ∫¶Âà∞ÈõÜÁæ§ÂÜÖÁöÑ<em>ÊúÄ‰Ω≥ËäÇÁÇπ</em>(Âü∫‰∫éÁõ∏Â∫îÁ≠ñÁï•ËÆ°ÁÆóÂá∫ÁöÑÊúÄ‰Ω≥ÂÄº)‰∏äÔºåÂÆÉÁõëÂê¨<code> kube-apiserver</code>ÔºåÊü•ËØ¢ËøòÊú™ÂàÜÈÖçËäÇÁÇπ ÁöÑ PodÔºåÁÑ∂ÂêéÊ†πÊçÆË∞ÉÂ∫¶Á≠ñÁï•‰∏∫Ëøô‰∫õ Pod ÂàÜÈÖçËäÇÁÇπÔºåÊâßË°åÁªëÂÆöËäÇÁÇπÁöÑÊìç‰Ωú(Êõ¥Êñ∞PodÁöÑ<strong>nodeName</strong>Â≠óÊÆµ)„ÄÇ</p><p>Âú®‰∏äËø∞ËøáÁ®ã‰∏≠ÔºåÈúÄË¶ÅËÄÉËôë‰ª•‰∏ãÈóÆÈ¢òÔºö</p><ul><li>Â¶Ç‰ΩïÁ°Æ‰øùËäÇÁÇπÂàÜÈÖçÁöÑÂÖ¨Âπ≥ÊÄß</li><li>Â¶Ç‰ΩïÁ°Æ‰øùËäÇÁÇπËµÑÊ∫êÂàÜÈÖçÁöÑÈ´òÊïàÊÄß</li><li>Â¶Ç‰ΩïÁ°Æ‰øùPodË∞ÉÂ∫¶ÁöÑÂÖ¨Âπ≥ÊÄß</li><li>Â¶Ç‰ΩïÁ°Æ‰øùPodË∞ÉÂ∫¶ÁöÑÈ´òÊïàÊÄß</li><li>Â¶Ç‰ΩïÊâ©Â±ïPodË∞ÉÂ∫¶Á≠ñÁï•</li></ul><p>‰∏∫Ëß£ÂÜ≥‰∏äËø∞ÁöÑÈóÆÈ¢òÔºå<code>kube-scheduler</code>ÈÄöËøáÊ±áÈõÜËäÇÁÇπËµÑÊ∫ê„ÄÅËäÇÁÇπÂú∞Âüü„ÄÅËäÇÁÇπÈïúÂÉè„ÄÅPodË∞ÉÂ∫¶Á≠â‰ø°ÊÅØÁªºÂêàÂÜ≥Á≠ñÔºåÁ°Æ‰øùPodÂàÜÈÖçÂà∞ÊúÄ‰Ω≥ËäÇÁÇπÔºå‰ª•‰∏ã‰∏∫<code>kube-scheduler</code>ÁöÑ‰∏ªË¶ÅÁõÆÊ†áÔºö</p><ul><li>ÂÖ¨Âπ≥ÊÄßÔºöÂú®Ë∞ÉÂ∫¶PodÊó∂ÈúÄË¶ÅÂÖ¨Âπ≥ÁöÑÂÜ≥Á≠ñÔºåÊØè‰∏™ËäÇÁÇπÈÉΩÊúâË¢´ÂàÜÈÖçÁöÑÊú∫‰ºöÔºåË∞ÉÂ∫¶Âô®ÈúÄË¶ÅÈíàÂØπ‰∏çÂêåËäÇÁÇπ‰ΩúÂá∫Âπ≥Ë°°ÂÜ≥Á≠ñ„ÄÇ</li><li>ËµÑÊ∫êÈ´òÊïàÔºöÊúÄÂ§ßÂåñÊèêÂçáÊâÄÊúâÂèØË∞ÉÂ∫¶ËµÑÊ∫êÁöÑÂà©Áî®ÁéáÔºå‰ΩøÊúâÈôêÁöÑCPU„ÄÅÂÜÖÂ≠òÁ≠âËµÑÊ∫êÊúçÂä°Â∞ΩÂèØËÉΩÊõ¥Â§öÁöÑPod„ÄÇ</li><li>ÊÄßËÉΩÔºöËÉΩÂø´ÈÄüÁöÑÂÆåÊàêÂØπÂ§ßËßÑÊ®°PodÁöÑË∞ÉÂ∫¶Â∑•‰ΩúÔºåÂú®ÈõÜÁæ§ËßÑÊ®°Êâ©Â¢ûÁöÑÊÉÖÂÜµ‰∏ãÔºå‰æùÁÑ∂ËÉΩÁ°Æ‰øùË∞ÉÂ∫¶ÁöÑÊÄßËÉΩ„ÄÇ</li><li>ÁÅµÊ¥ªÊÄßÔºöÂú®ÂÆûÈôÖÁîü‰∫ß‰∏≠ÔºåÁî®Êà∑Â∏åÊúõPodÁöÑË∞ÉÂ∫¶Á≠ñÁï•ÊòØÂèØÊâ©Â±ïÁöÑÔºå‰ªéËÄåÂèØ‰ª•ÂÆöÂà∂ÂåñË∞ÉÂ∫¶ÁÆóÊ≥ï‰ª•Â§ÑÁêÜÂ§çÊùÇÁöÑÂÆûÈôÖÈóÆÈ¢ò„ÄÇÂõ†Ê≠§Âπ≥Âè∞Ë¶ÅÂÖÅËÆ∏Â§öÁßçË∞ÉÂ∫¶Âô®Âπ∂Ë°åÂ∑•‰ΩúÔºåÂπ∂ÊîØÊåÅËá™ÂÆö‰πâË∞ÉÂ∫¶Âô®„ÄÇ</li></ul><h4 id="‰∫å„ÄÅË∞ÉÂ∫¶ÊµÅÁ®ã"><a href="#‰∫å„ÄÅË∞ÉÂ∫¶ÊµÅÁ®ã" class="headerlink" title="‰∫å„ÄÅË∞ÉÂ∫¶ÊµÅÁ®ã"></a>‰∫å„ÄÅË∞ÉÂ∫¶ÊµÅÁ®ã</h4><p>È¶ñÂÖàÊàë‰ª¨ÈÄöËøá‰∏ãÈù¢ÁöÑÊï¥‰ΩìÁöÑ‰∫§‰∫íÂõæÔºåÊù•ÊûÑÂª∫PodË∞ÉÂ∫¶ÁöÑÁõ¥ËßÇÊÑüÂèó„ÄÇ</p><p><img src="https://s3.ax1x.com/2021/01/06/sZ9Aun.png"></p><p>‰∏äËø∞‰ª•ÂàõÂª∫‰∏Ä‰∏™Pod‰∏∫‰æãÔºåÁÆÄË¶Å‰ªãÁªçË∞ÉÂ∫¶ÊµÅÁ®ãÔºö</p><ol><li><p>Áî®Êà∑ÈÄöËøáÂëΩ‰ª§Ë°åÂàõÂª∫Pod(ÈÄâÊã©Áõ¥Êé•ÂàõÂª∫PodËÄå‰∏çÊòØÂÖ∂‰ªñworkloadÔºåÊòØ‰∏∫‰∫ÜÁúÅÁï•kube-controller-manager)</p></li><li><p>kube-apiserverÁªèËøáÂØπË±°Ê†°È™å„ÄÅadmission„ÄÅquotaÁ≠âÂáÜÂÖ•Êìç‰ΩúÔºåÂÜôÂÖ•etcd</p></li><li><p>kube-apiserverÂ∞ÜÁªìÊûúËøîÂõûÁªôÁî®Êà∑</p></li><li><p>ÂêåÊó∂kube-scheduler‰∏ÄÁõ¥ÁõëÂê¨ËäÇÁÇπ„ÄÅPod‰∫ã‰ª∂Á≠âÔºàÊµÅÁ®ã1Ôºâ</p></li><li><p>kube-schedulerÂ∞Üspec.nodeNameÁöÑpodÂä†ÂÖ•Âà∞Ë∞ÉÂ∫¶ÈòüÂàó‰∏≠ÔºåËøõË°åË∞ÉÂ∫¶Âë®ÊúüÔºàËØ•Âë®ÊúüÂç≥‰ΩçÂêéÁª≠‰ªãÁªçÂÜÖÂÆπÔºâÔºàÊµÅÁ®ã2-3Ôºâ</p></li><li><p>kube-schedulerÂ∞Üpod‰∏éÂæóÂàÜÊúÄÈ´òÁöÑËäÇÁÇπËøõË°åbindingÊìç‰ΩúÔºàÊµÅÁ®ã4Ôºâ</p></li><li><p>kube-apiserverÂ∞Übinding‰ø°ÊÅØÂÜôÂÖ•etcd</p></li><li><p>kubeletÁõëÂê¨ÂàÜÈÖçÁªôËá™Â∑±ÁöÑPodÔºåË∞ÉÁî®CRIÊé•Âè£ËøõË°åPodÂàõÂª∫ÔºàËØ•ÈÉ®ÂàÜÂÜÖÂÆπÂêéÁª≠Âá∫Á≥ªÂàóÔºåËøõË°å‰ªãÁªçÔºâ</p></li><li><p>kubeletÂàõÂª∫PodÂêéÔºåÊõ¥Êñ∞PodÁä∂ÊÄÅÁ≠â‰ø°ÊÅØÔºåÂπ∂Âêëkube-apiserver‰∏äÊä•</p></li><li><p>kube-apiserverÂÜôÂÖ•Êï∞ÊçÆ</p></li></ol><h5 id="Ë∞ÉÂ∫¶Âë®Êúü"><a href="#Ë∞ÉÂ∫¶Âë®Êúü" class="headerlink" title="Ë∞ÉÂ∫¶Âë®Êúü"></a>Ë∞ÉÂ∫¶Âë®Êúü</h5><p><code>kube-scheduler</code>ÁöÑÂ∑•‰Ωú‰ªªÂä°ÊòØÊ†πÊçÆÂêÑÁßçË∞ÉÂ∫¶ÁÆóÊ≥ïÂ∞ÜPodÁªëÂÆöÔºàbindÔºâÂà∞ÊúÄÂêàÈÄÇÁöÑÂ∑•‰ΩúËäÇÁÇπÔºåÊï¥‰∏™Ë∞ÉÂ∫¶ÊµÅÁ®ãÂàÜ‰∏∫‰∏§‰∏™Èò∂ÊÆµÔºöËøáÊª§ÂíåËØÑÂàÜ„ÄÇÊµÅÁ®ãÁ§∫ÊÑèÂõæÂ¶Ç‰∏ãÊâÄÁ§∫„ÄÇ</p><p><img src="https://s3.ax1x.com/2021/01/06/sZ9lv9.png"></p><p>‚ÄãÊ≥®Ôºö‰ª•ÂâçÁß∞‰πã‰∏∫predicate‰∏éprioritiesÔºåÂΩìÂâçÁªüÁß∞‰∏∫ËøáÊª§‰∏éËØÑÂàÜÔºåÂÆûÈôÖÊïàÊûú‰∏ÄËá¥</p><ul><li><p><strong>ËøáÊª§</strong>ÔºöËæìÂÖ•ÊòØÊâÄÊúâËäÇÁÇπÔºåËæìÂá∫ÊòØÊª°Ë∂≥È¢ÑÈÄâÊù°‰ª∂ÁöÑËäÇÁÇπ„ÄÇ<code>kube-scheduler</code>Ê†πÊçÆËøáÊª§Á≠ñÁï•ËøáÊª§Êéâ‰∏çÊª°Ë∂≥ÁöÑËäÇÁÇπ„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûúÊüêËäÇÁÇπÁöÑËµÑÊ∫ê‰∏çË∂≥ÊàñËÄÖ‰∏çÊª°Ë∂≥È¢ÑÈÄâÁ≠ñÁï•ÁöÑÊù°‰ª∂Â¶Ç‚ÄúËäÇÁÇπÁöÑÊ†áÁ≠æÂøÖÈ°ª‰∏éPodÁöÑSelector‰∏ÄËá¥‚ÄùÊó∂ÂàôÊó†Ê≥ïÈÄöËøáËøáÊª§„ÄÇ</p></li><li><p><strong>ËØÑÂàÜÔºö</strong>ËæìÂÖ•ÊòØÈÄöËøáËøáÊª§Èò∂ÊÆµÁöÑËäÇÁÇπÔºåËØÑÂàÜÊó∂‰ºöÊ†πÊçÆËØÑÂàÜÁÆóÊ≥ï‰∏∫ÈÄöËøáËøáÊª§ÁöÑËäÇÁÇπËøõË°åÊâìÂàÜÔºåÈÄâÊã©ÂæóÂàÜÊúÄÈ´òÁöÑËäÇÁÇπ„ÄÇ‰æãÂ¶ÇÔºåËµÑÊ∫êË∂äÂÖÖË∂≥„ÄÅË¥üËΩΩË∂äÂ∞èÁöÑËäÇÁÇπÂèØËÉΩÂÖ∑ÊúâË∂äÈ´òÁöÑÊéíÂêç„ÄÇ</p></li></ul><p>‚ÄãÈÄö‰øóÁÇπËØ¥ÔºåË∞ÉÂ∫¶ÁöÑËøáÁ®ãÂ∞±ÊòØÂú®ÂõûÁ≠î‰∏§‰∏™ÈóÆÈ¢òÔºö1. ÂÄôÈÄâËäÇÁÇπÊúâÂì™‰∫õÔºü2. ÂÖ∂‰∏≠ÊúÄÈÄÇÂêàÁöÑÊòØÂì™‰∏Ä‰∏™Ôºü</p><p>‚ÄãÂ¶ÇÊûúÂú®ËøáÊª§Èò∂ÊÆµÊ≤°ÊúâËäÇÁÇπÊª°Ë∂≥Êù°‰ª∂ÔºåPod‰ºö‰∏ÄÁõ¥Â§ÑÂú®PendingÁä∂ÊÄÅÁõ¥Âà∞Âá∫Áé∞Êª°Ë∂≥ÁöÑËäÇÁÇπÔºåÂú®Ê≠§ÊúüÈó¥Ë∞ÉÂ∫¶Âô®‰ºö‰∏çÊñ≠ÁöÑËøõË°åÈáçËØï„ÄÇÂ¶ÇÊûúÊúâÂ§ö‰∏™ËäÇÁÇπËØÑÂàÜ‰∏ÄËá¥ÔºåÈÇ£‰πà<code>kube-scheduler</code>‰ªªÊÑèÈÄâÊã©ÂÖ∂‰∏Ä„ÄÇ</p><p>‚ÄãÊ≥®ÔºöPodÈ¶ñÂÖàËøõÂÖ•Ë∞ÉÂ∫¶ÈòüÂàóÔºåÂ§±Ë¥•ÂêéËøõÂÖ•backoffÔºåÂ§öÊ¨°Â§±Ë¥•ÂêéËøõÂÖ•unscheduleÔºåËØ•ÈÉ®ÂàÜÂÜÖÂÆπÂêéÁª≠‰ªãÁªç„ÄÇ</p><h5 id="Ë∞ÉÂ∫¶ÁÆóÊ≥ï"><a href="#Ë∞ÉÂ∫¶ÁÆóÊ≥ï" class="headerlink" title="Ë∞ÉÂ∫¶ÁÆóÊ≥ï"></a>Ë∞ÉÂ∫¶ÁÆóÊ≥ï</h5><p>ÂΩìÂâçÊîØÊåÅ‰∏§ÁßçÊñπÂºèÈÖçÁΩÆËøáÊª§„ÄÅËØÑÂàÜÁÆóÊ≥ïÔºö</p><pre><code>1. Scheduling PoliciesÔºöÈÄöËøáÊñá‰ª∂ÊàñËÄÖconfigmapÈÖçÁΩÆPredicateÁÆóÊ≥ï(ËøáÊª§)Âíå PrioritiesÁÆóÊ≥ï(ËØÑÂàÜ)ÁöÑÁÆóÊ≥ï 2. Scheduling ProfilesÔºöÂΩìÂâçË∞ÉÂ∫¶Á≥ªÁªü‰∏∫ÊèíÊãîÊû∂ÊûÑÔºåÂÖ∂Â∞ÜË∞ÉÂ∫¶Âë®ÊúüÂàÜ‰∏∫ `QueueSort`„ÄÅ`PreFilter`„ÄÅ`Filter`„ÄÅ`PreScore`„ÄÅ`Score`„ÄÅ`Reserve`„ÄÅ`Permit`„ÄÅ`PreBind`„ÄÅ`Bind`„ÄÅ`PostBind`Á≠âÈò∂ÊÆµÔºåÈÄöËøáÂÆöÂà∂Ë∞ÉÂ∫¶Âë®Êúü‰∏≠‰∏çÂêåÈò∂ÊÆµÁöÑÊèí‰ª∂Ë°å‰∏∫Êù•ÂÆûÁé∞Ëá™ÂÆö‰πâ„ÄÇ</code></pre><p>‰∏ãÈù¢ÁÆÄÂçï‰ªãÁªç‰∏Ä‰∏ãÈÄöËøáScheduling PoliciesÊñπÂºèÈÖçÁΩÆ</p><p><code>pkg/scheduler/framework/plugins/legacy_registry.go</code></p><p> <em><strong>È¢ÑÈÄâ(Precates)</strong></em></p><table><thead><tr><th>ÁÆóÊ≥ïÂêçÁß∞</th><th>ÁÆóÊ≥ïÂê´‰πâ</th></tr></thead><tbody><tr><td>MatchInterPodAffinity</td><td>Ê£ÄÊü•podËµÑÊ∫êÂØπË±°‰∏éÂÖ∂‰ªñpodËµÑÊ∫êÂØπË±°ÊòØÂê¶Á¨¶Âêà‰∫≤ÂíåÊÄßËßÑÂàô</td></tr><tr><td>CheckVolumeBinding</td><td>Ê£ÄÊü•ËäÇÁÇπÊòØÂê¶Êª°Ë∂≥podËµÑÊ∫êÂØπË±°ÁöÑpvcÊåÇËΩΩÈúÄÊ±Ç</td></tr><tr><td>GeneralPredicates</td><td>Ê£ÄÊü•ËäÇÁÇπ‰∏äpodËµÑÊ∫êÂØπË±°Êï∞ÈáèÁöÑ‰∏äÁ∫øÔºå‰ª•ÂèäCPU ÂÜÖÂ≠ò GPUÁ≠âËµÑÊ∫êÊòØÂê¶Á¨¶ÂêàË¶ÅÊ±Ç</td></tr><tr><td>HostName</td><td>Ê£ÄÊü•PodÊåáÂÆöÁöÑNodeNameÊòØÂê¶ÂåπÈÖçÂΩìÂâçËäÇÁÇπ</td></tr><tr><td>PodFitsHostPorts</td><td>Ê£ÄÊü•PodÂÆπÂô®ÊâÄÈúÄÁöÑHostPortÊòØÂê¶Â∑≤Ë¢´ËäÇÁÇπ‰∏äÂÖ∂ÂÆÉÂÆπÂô®ÊàñÊúçÂä°Âç†Áî®„ÄÇÂ¶ÇÊûúÂ∑≤Ë¢´Âç†Áî®ÔºåÂàôÁ¶ÅÊ≠¢PodË∞ÉÂ∫¶Âà∞ËØ•ËäÇÁÇπ</td></tr><tr><td>MatchNodeSelector</td><td>Ê£ÄÊü•PodÁöÑËäÇÁÇπÈÄâÊã©Âô®ÊòØÂê¶‰∏éËäÇÁÇπÁöÑÊ†áÁ≠æÂåπÈÖç</td></tr><tr><td>PodFitsResources</td><td>Ê£ÄÊü•ËäÇÁÇπÊòØÂê¶ÊúâË∂≥Â§üÁ©∫Èó≤ËµÑÊ∫êÔºà‰æãÂ¶ÇCPUÂíåÂÜÖÂ≠òÔºâÊù•Êª°Ë∂≥PodÁöÑË¶ÅÊ±Ç</td></tr><tr><td>NoDiskConflict</td><td>Ê£ÄÊü•ÂΩìÂâçpodËµÑÊ∫êÂØπË±°‰ΩøÁî®ÁöÑÂç∑ÊòØÂê¶‰∏éËäÇÁÇπ‰∏äÂÖ∂‰ªñÁöÑpodËµÑÊ∫êÂØπË±°‰ΩøÁî®ÁöÑÂç∑ÂÜ≤Á™Å</td></tr><tr><td>PodToleratesNodeTaints</td><td>Â¶ÇÊûúÂΩìÂâçËäÇÁÇπË¢´Ê†áËÆ∞‰∏∫taintsÔºåÊ£ÄÊü•podËµÑÊ∫êÂØπË±°ÊòØÂê¶ËÉΩÂÆπÂøçnode taints</td></tr><tr><td>CheckNodeUnschedulable</td><td>Ê£ÄÊü•ËäÇÁÇπÊòØÂê¶ÂèØË∞ÉÂ∫¶</td></tr><tr><td>CheckNodeLabelPresence</td><td>Ê£ÄÊü•ËäÇÁÇπÊ†áÁ≠æÊòØÂê¶Â≠òÂú®</td></tr><tr><td>CheckServiceAffinity</td><td>Ê£ÄÊü•ÊúçÂä°‰∫≤ÂíåÊÄß</td></tr><tr><td>MaxCSIVolumeCountPred</td><td>Â¶ÇÊûúËÆæÁΩÆ‰∫Üfeaturegate ÔºàattachvolumelimitÔºâÂäüËÉΩÔºåÊ£ÄÊü•podËµÑÊ∫êÂØπË±°ÊåÇËΩΩÁöÑcsiÂç∑ÊòØÂê¶Ë∂ÖÂá∫‰∫ÜËäÇÁÇπ‰∏äÂç∑ÁöÑÊúÄÂ§ßÊåÇËΩΩÊï∞Èáè</td></tr><tr><td>NoVolumeZoneConflict</td><td>Ê£ÄÊü•podËµÑÊ∫êÂØπË±°ÊåÇËΩΩpvcÊòØÂê¶Â±û‰∫éË∑®Âå∫ÂüüÊåÇËΩΩÔºåÂõ†‰∏∫gceÁöÑpdÂ≠òÂÇ®ÊàñawsÁöÑebsÂç∑ÈÉΩ‰∏çÊîØÊåÅË∑®Âå∫ÂüüÊåÇËΩΩ</td></tr><tr><td>EvenPodsSpreadPred</td><td>‰∏ÄÁªÑ Pod Âú®Êüê‰∏™ TopologyKey ‰∏äÁöÑÂùáË°°ÊâìÊï£ÈúÄÊ±Ç</td></tr></tbody></table><p>Ê≥®ÔºöÂÖ∂‰∏≠ MaxEBSVolumeCountPred„ÄÅ MaxGCEPDVolumeCountPred  MaxAzureDiskVolumeCountPred„ÄÅMaxCinderVolumeCountPred Á≠â‰∫ëÂéÇÂïÜÁõ∏ÂÖ≥È¢ÑÈÄâÁÆóÊ≥ïÂ∑≤ÁªèÂ∫üÂºÉ</p><p><em><strong>‰ºòÈÄâ(Priorities)</strong></em></p><table><thead><tr><th>ÁÆóÊ≥ïÂêçÁß∞</th><th>ÁÆóÊ≥ïÂê´‰πâ</th></tr></thead><tbody><tr><td>EqualPriority</td><td>ËäÇÁÇπÊùÉÈáçÁõ∏Á≠â</td></tr><tr><td>MostRequestedPriority</td><td>ÂÅèÂêëÂÖ∑ÊúâÊúÄÂ§öËØ∑Ê±ÇËµÑÊ∫êÁöÑËäÇÁÇπ„ÄÇËøô‰∏™Á≠ñÁï•Â∞ÜÊääËÆ°ÂàíÁöÑPodsÊîæÂà∞Êï¥‰∏™Â∑•‰ΩúË¥üËΩΩÈõÜÊâÄÈúÄÁöÑÊúÄÂ∞èËäÇÁÇπ‰∏äËøêË°å„ÄÇ</td></tr><tr><td>RequestedToCapacityRatioPriority</td><td>‰ΩøÁî®ÈªòËÆ§ÁöÑËµÑÊ∫êËØÑÂàÜÂáΩÊï∞Ê®°ÂûãÂàõÂª∫Âü∫‰∫éResourceAllocationPriorityÁöÑrequestedToCapacity„ÄÇ</td></tr><tr><td>SelectorSpreadPriority</td><td>Â∞ÜÂ±û‰∫éÁõ∏Âêåservice rcs rss sts ÁöÑpodÂ∞ΩÈáèË∞ÉÂ∫¶Âú®‰∏çÂêåÁöÑËäÇÁÇπ‰∏ä</td></tr><tr><td>ServiceSpreadingPriority</td><td>ÂØπ‰∫éÁªôÂÆöÁöÑÊúçÂä°ÔºåÊ≠§Á≠ñÁï•Êó®Âú®Á°Æ‰øùServiceÁöÑPodsËøêË°åÂú®‰∏çÂêåÁöÑËäÇÁÇπ‰∏ä„ÄÇÊÄªÁöÑÁªìÊûúÊòØÔºåServiceÂØπÂçï‰∏™ËäÇÁÇπÊïÖÈöúÂèòÂæóÊõ¥ÊúâÂºπÊÄß„ÄÇ</td></tr><tr><td>InterPodAffinityPriority</td><td>Âü∫‰∫é‰∫≤ÂíåÊÄßÔºàaffinityÔºâÂíåÂèç‰∫≤ÂíåÊÄßÔºàanti-affinityÔºâËÆ°ÁÆóÂàÜÊï∞</td></tr><tr><td>LeastRequestdPriority</td><td>ÂÅèÂêë‰ΩøÁî®ËæÉÂ∞ëËØ∑Ê±ÇËµÑÊ∫êÁöÑËäÇÁÇπ„ÄÇÊç¢Âè•ËØùËØ¥ÔºåÊîæÁΩÆÂú®ËäÇÁÇπ‰∏äÁöÑPodË∂äÂ§öÔºåËøô‰∫õPod‰ΩøÁî®ÁöÑËµÑÊ∫êË∂äÂ§öÔºåÊ≠§Á≠ñÁï•ÁªôÂá∫ÁöÑÊéíÂêçÂ∞±Ë∂ä‰Ωé„ÄÇ</td></tr><tr><td>BalancedRequestdPriority</td><td>ËÆ°ÁÆóËäÇÁÇπ‰∏äcpuÂíåÂÜÖÂ≠òÁöÑ‰ΩøÁî®ÁéáÔºå‰ΩøÁî®ÁéáÊúÄÂùáË°°ÁöÑËäÇÁÇπÊúÄ‰ºò</td></tr><tr><td>NodePreferAvoidPodsPriority</td><td>Âü∫‰∫éËäÇÁÇπ‰∏äÂÆö‰πâÁöÑÊ≥®ÈáäÔºàannotaionÔºâËÆ∞ÂàÜÔºåÊ≥®Èáä‰∏≠Â¶ÇÊûúÂÆö‰πâ‰∫Üalpha.kubernetes.io&#x2F;preferAvoidPodsÂàô‰ºöÁ¶ÅÁî®ReplicationControllerÊàñËÄÖÂ∞ÜReplicaSetÁöÑpodËµÑÊ∫êÂØπË±°Ë∞ÉÂ∫¶Âú®ËØ•ËäÇÁÇπ‰∏ä</td></tr><tr><td>NodeAffinityPriority</td><td>Âü∫‰∫éËäÇÁÇπ‰∫≤ÂíåÊÄßËÆ°ÁÆóÂàÜÊï∞</td></tr><tr><td>TaintTolerationPriority</td><td>Âü∫‰∫éÊ±°ÁÇπÔºàtaintÔºâÂíåÂÆπÂøçÂ∫¶ÔºàtolerationÔºâÊòØÂê¶ÂåπÈÖçËÆ°ÁÆóÂàÜÊï∞</td></tr><tr><td>ImageLocalityPriority</td><td>Âü∫‰∫éËäÇÁÇπ‰∏äÊòØÂê¶Â∑≤Áªè‰∏ãÊãâ‰∫ÜËøêË°åpodËµÑÊ∫êÂØπË±°ÁöÑÈïúÂÉèËÆ°ÁÆóÂàÜÊï∞</td></tr><tr><td>EvenPodsSpreadPriority</td><td>Áî®Êù•ÊåáÂÆö‰∏ÄÁªÑÁ¨¶ÂêàÊù°‰ª∂ÁöÑ Pod Âú®Êüê‰∏™ÊãìÊâëÁªìÊûÑ‰∏äÁöÑÊâìÊï£ÈúÄÊ±Ç</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;‰ªéCNCFÂü∫Èáë‰ºöÁöÑÊàêÁ´ãÔºåÂà∞KubernetesÁ§æÂå∫Ëì¨ÂãÉÂèëÂ±ïÔºåÂéÜÁªè6ËΩΩÔºå17Âπ¥ÂºÇÂÜõÁ™ÅËµ∑ÔºåÂú®mesos„ÄÅswarmÁ≠âÈ°πÁõÆËßíÈÄê‰∏≠ÔºåÊãîÂæóÂ§¥Á≠πÔºåÁªßËÄå‰∏ÄÁªüÂÆπÂô®ÁºñÊéí,ÂÖ∂ÊàêÂäüÁöÑÂÖ≥ÈîÆÂéüÂõ†ÂèØÊ¶ÇÊã¨‰∏∫‰ª•‰∏ãÂá†ÁÇπÔºö&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;È°πÁõÆÈ¢ÜÂØºËÄÖ‰ª¨ÁöÑÂùöÂÆà‰∏éËøúËßÅ&lt;/li&gt;
&lt;li&gt;Á§æÂå∫ÁöÑËâØÂ•ΩÁöÑËøê‰Ωú</summary>
      
    
    
    
    <category term="Kubernetes GO" scheme="https://zoues.com/categories/Kubernetes-GO/"/>
    
    
    <category term="cloudnative" scheme="https://zoues.com/tags/cloudnative/"/>
    
    <category term="kubernetes" scheme="https://zoues.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>CloudEvents‰∏âÈÉ®Êõ≤:ÂÆûË∑µÁØá</title>
    <link href="https://zoues.com/posts/c8b5de4b/"/>
    <id>https://zoues.com/posts/c8b5de4b/</id>
    <published>2020-12-20T13:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.371Z</updated>
    
    <content type="html"><![CDATA[<p>ÈöèÁùÄ‰∫ëÂéüÁîüÁöÑÂèëÂ±ïÔºà‰∫ëÂéüÁîüÁöÑ‰∏ã‰∏Ä‰∏™‰∫îÂπ¥Âú®Âì™ÈáåÔºüÔºâÔºåÈÄêÊ≠•ËøõÂÖ•Ê∑±Ê∞¥Âå∫Ôºå‰∏öÁïåÈúÄË¶Å‰∏ÄÁßçÁªü‰∏ÄÁöÑ‰∫ã‰ª∂ÂÆö‰πâÂíåÊèèËø∞ËßÑËåÉÔºå‰ª•Êèê‰æõË∑®ÊúçÂä°„ÄÅË∑®Âπ≥Âè∞ÁöÑ‰∫§‰∫íËÉΩÂäõ„ÄÇCloudEvents‰∫ã‰ª∂ËßÑËåÉÂ∫îËøêËÄåÁîüÔºåÂπ∂ÂæóÂà∞‰∫ÜË°å‰∏öÁöÑÂπøÊ≥õÂÖ≥Ê≥®ÔºåÂåÖÊã¨‰∏ªË¶ÅÁöÑ‰∫ëÊèê‰æõÂïÜÂíå SaaS ÂÖ¨Âè∏„ÄÇ<br>ÂØπ‰∫éCloudEventÁöÑ‰ªãÁªç„ÄÅËßÑËåÉËØ¥ÊòéÂèäÂÆûË∑µËêΩÂú∞ÔºåÂ∞Ü‰ª•‰∏âÁØáÁ≥ªÂàóÊñáÁ´†ËøõË°åËØ¥ÊòéÔºåÊú¨Êñá‰∏∫„ÄäCloudEvent‰∏âÈÉ®Êõ≤:ÂÆûË∑µÁØá„Äã</p><hr><h4 id="‰∏Ä„ÄÅ‰∫ßÂìÅÊé•ÂÖ•"><a href="#‰∏Ä„ÄÅ‰∫ßÂìÅÊé•ÂÖ•" class="headerlink" title="‰∏Ä„ÄÅ‰∫ßÂìÅÊé•ÂÖ•"></a>‰∏Ä„ÄÅ‰∫ßÂìÅÊé•ÂÖ•</h4><h5 id="Âú∫ÊôØ"><a href="#Âú∫ÊôØ" class="headerlink" title="Âú∫ÊôØ"></a>Âú∫ÊôØ</h5><p>ServerlessÊòØ‰∏ÄÈ°πÂü∫‰∫é‰∫ã‰ª∂È©±Âä®ÁöÑÂáΩÊï∞ËÆ°ÁÆóÊúçÂä°ÔºåÈÄöËøá‰ΩøÁî®ÂáΩÊï∞ËÆ°ÁÆó‰∫ßÂìÅÔºåÂáΩÊï∞‰ª•ÂºπÊÄß„ÄÅÂÖçËøêÁª¥„ÄÅÈ´òÂèØÈù†ÁöÑÊñπÂºèËøêË°åÔºåÁî®Êà∑ÂèØ‰ª•Êó†ÈúÄÈááË¥≠ÂíåÁª¥Êä§ÊúçÂä°Âô®Á≠âÂü∫Á°ÄËÆæÊñΩÔºåÂèØ‰ª•Êõ¥Âä†‰∏ìÊ≥®‰∫éÂáΩÊï∞‰ª£Á†ÅÁöÑÁºñÂÜô„ÄÇ<br>ÁõÆÂâç CloudEvents Âú®ÂáΩÊï∞ËÆ°ÁÆó‰∏≠Â∑≤ÊúâÂπøÊ≥õÁöÑÂ∫îÁî®ÔºåÁ¨¨‰∏âÊñπÊúçÂä°Êé•ÂÖ•ÂáΩÊï∞ËÆ°ÁÆóÊúçÂä°ÔºåÈúÄË¶Å‰ΩøÁî®Á¨¶Âêà CloudEvents ËßÑËåÉÁöÑÊ∂àÊÅØ‰º†ÈÄíÊï∞ÊçÆÔºåÊñπ‰æøÂáΩÊï∞ËÆ°ÁÆóÂπ≥Âè∞ÊñπÂØπÁ¨¨‰∏âÊñπÊúçÂä°ÁöÑÊ∂àÊÅØËøõË°åÂàÜÂèëËøáÊª§ÔºåÂêåÊó∂Áî±‰∫éËßÑËåÉÁöÑÈÄöÁî®ÊÄßÔºåÁ¨¨‰∏âÊñπÊúçÂä°‰∏ÄÊ¨°ÊîπÈÄ†ÂêéÂèØ‰ª•Êó†ÁºùÈÄÇÈÖçÂà∞ÂêÑÁ±ªÁ¨¶Âêà CloudEvents ËßÑËåÉÁöÑÂπ≥Âè∞‰∏ä„ÄÇ<br>Ê≠§Â§ñÊ∂àÊÅØÁ±ª‰∫ßÂìÅÔºà‰æãÂ¶ÇÔºöÊ∂àÊÅØÈòüÂàóÔºåÊ∂àÊÅØÊúçÂä°Ôºå‰∫ã‰ª∂ÊÄªÁ∫øÁ≠âÔºâ‰πüÂèØÈÄöËøáÊîØÊåÅ CloudEvents ËßÑËåÉÔºåÁªü‰∏Ä‰∫ëÁöÑ‰∫ã‰ª∂Ê†áÂáÜÔºåÂä†ÈÄü‰∫ëÂéüÁîüÁîüÊÄÅÈõÜÊàê„ÄÇ</p><h5 id="ÂºÄÂèë"><a href="#ÂºÄÂèë" class="headerlink" title="ÂºÄÂèë"></a>ÂºÄÂèë</h5><p>ÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåË¶ÅÊûÑÂª∫‰∏Ä‰∏™CloudEventÔºåÈúÄË¶Å‰ΩøÁî®CloudEventsÁöÑËΩØ‰ª∂ÂºÄÂèëÂ∑•ÂÖ∑ÂåÖÔºàSDKÔºâÔºåÂà©Áî®SDKÂèØ‰ª•ÊûÅÂ§ßÊñπ‰æøÂºÄÂèë‰∫∫ÂëòËøõË°åÈõÜÊàêÂºÄÂèëÔºåÊà™Ëá≥ CloudEvents v1.0 ËßÑËåÉÁöÑÂèëÂ∏ÉÔºåCloudEvents Âõ¢ÈòüÊîØÊåÅÂíåÁª¥Êä§‰ª•‰∏ã6ÁßçSDKÔºö</p><ul><li>CSharp</li><li>Go SDK</li><li>Java SDK</li><li>JavaScript SDK</li><li>Python SDK</li><li>Ruby SDK</li></ul><p>‰ª•‰∏ã‰ΩøÁî® GoÔºåPython SDKÊûÑÈÄ†Á¨¶ÂêàCloudEvent 1.0 ËßÑËåÉÁöÑÊ∂àÊÅØÊé•Êî∂ÂèëÈÄÅÔºåHTTP&#x2F;JSONËØ∑Ê±ÇËΩ¨ÂåñÁ≠âÂäüËÉΩÁöÑËåÉ‰æã„ÄÇ</p><p><em><strong>Golang</strong></em></p><ol><li><p>Ëé∑Âèñ‰æùËµñ<br><code>go get github.com/cloudevents/sdk-go/v2@v2.0.0</code></p></li><li><p>‰æùËµñÂºïÁî®<br><code>import cloudevents &quot;github.com/cloudevents/sdk-go/v2&quot;</code></p></li><li><p>ÂèëÈÄÅ‰∫ã‰ª∂</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line"></span><br><span class="line">cloudevents <span class="string">&quot;github.com/cloudevents/sdk-go/v2&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// The default client is HTTP.</span></span><br><span class="line">c, err := cloudevents.NewDefaultClient()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalf(<span class="string">&quot;failed to create client, %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an Event.</span></span><br><span class="line">event :=  cloudevents.NewEvent()</span><br><span class="line">event.SetSource(<span class="string">&quot;example/uri&quot;</span>)</span><br><span class="line">event.SetType(<span class="string">&quot;example.type&quot;</span>)</span><br><span class="line">event.SetData(cloudevents.ApplicationJSON, <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;<span class="string">&quot;hello&quot;</span>: <span class="string">&quot;world&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set a target.</span></span><br><span class="line">ctx := cloudevents.ContextWithTarget(context.Background(), <span class="string">&quot;http://localhost:8080/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Send that Event.</span></span><br><span class="line"><span class="keyword">if</span> result := c.Send(ctx, event); !cloudevents.IsACK(result) &#123;</span><br><span class="line">log.Fatalf(<span class="string">&quot;failed to send, %v&quot;</span>, result)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Êé•Âèó‰∫ã‰ª∂</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line"></span><br><span class="line">cloudevents <span class="string">&quot;github.com/cloudevents/sdk-go/v2&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(event cloudevents.Event)</span></span> &#123;</span><br><span class="line"><span class="comment">// do something with event.</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%s&quot;</span>, event)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// The default client is HTTP.</span></span><br><span class="line">c, err := cloudevents.NewDefaultClient()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalf(<span class="string">&quot;failed to create client, %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">log.Fatal(c.StartReceiver(context.Background(), receive));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Â∫èÂàóÂåñ</p></li></ol><p><em><strong>Â∫èÂàóÂåñ‰∏∫JSON</strong></em></p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">event := cloudevents.NewEvent()</span><br><span class="line">event.SetSource(&quot;example/uri&quot;)</span><br><span class="line">event.SetType(&quot;example.type&quot;)</span><br><span class="line">event.SetData(cloudevents.ApplicationJSON, map[string]string&#123;&quot;hello&quot;: &quot;world&quot;&#125;)</span><br><span class="line"></span><br><span class="line">bytes, err := json.Marshal(event)</span><br></pre></td></tr></table></figure><p><em><strong>ÂèçÂ∫èÂàóÂåñ</strong></em></p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">event :=  cloudevents.NewEvent()</span><br><span class="line">err := json.Marshal(bytes, &amp;event)</span><br></pre></td></tr></table></figure><p><em><strong>Python</strong></em></p><ol><li><p>‰æùËµñÂåÖÂÆâË£Ö<br><code>pip install cloudevents</code></p></li><li><p>‰∫ã‰ª∂ÂèëÈÄÅËÄÖ<br>ÈÄöËøá Python SDK ‰∏≠ÁöÑ CloudEvent Á±ªÂûãÊûÑÈÄ† CloudEvents ‰∫ã‰ª∂ÔºåÂÜçÂà©Áî® to_binaryÂáΩÊï∞Â∞ÜÂÖ∂Â∫èÂàóÂåñ‰∏∫ JSON Ê†ºÂºèÁöÑÊï∞ÊçÆÔºå‰ΩøÁî® requestsÊ°ÜÊû∂ÂèëÈÄÅËØ• JSON ËØ∑Ê±Ç„ÄÇ</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cloudevents.http <span class="keyword">import</span> CloudEvent, to_binary</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># ÊûÑÂª∫CloudEventÁªìÊûÑ‰Ωì</span></span><br><span class="line"><span class="comment"># - The CloudEvent &quot;id&quot; is generated if omitted. &quot;specversion&quot; defaults to &quot;1.0&quot;.</span></span><br><span class="line">attributes = &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;com.example.sampletype1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: <span class="string">&quot;https://example.com/event-producer&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">data = &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World!&quot;</span>&#125;</span><br><span class="line">event = CloudEvent(attributes, data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Âà©Áî®to_binaryÂáΩÊï∞Â∞ÜÂÖ∂Â∫èÂàóÂåñ‰∏∫ JSON Ê†ºÂºèÁöÑÊï∞ÊçÆ</span></span><br><span class="line">headers, body = to_binary(event)</span><br><span class="line"></span><br><span class="line"><span class="comment"># POST</span></span><br><span class="line">requests.post(<span class="string">&quot;&lt;some-url&gt;&quot;</span>, data=body, headers=headers)</span><br></pre></td></tr></table></figure><ol start="3"><li>Êé•Âèó‰∫ã‰ª∂Â§ÑÁêÜ</li></ol><p>ÈÄöËøá Python SDK ‰∏≠ÁöÑ from_http ÂáΩÊï∞Ëß£ÊûêÂá∫ CloudEvents ‰∫ã‰ª∂ÔºåÂπ∂ÊâìÂç∞‰∫ã‰ª∂ÂÜÖÂÆπ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> cloudevents.http <span class="keyword">import</span> from_http</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># create an endpoint at http://localhost:/3000/</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="comment"># create a CloudEvent</span></span><br><span class="line">    event = from_http(request.headers, request.get_data())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># you can access cloudevent fields as seen below</span></span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">f&quot;Found <span class="subst">&#123;event[<span class="string">&#x27;id&#x27;</span>]&#125;</span> from <span class="subst">&#123;event[<span class="string">&#x27;source&#x27;</span>]&#125;</span> with type &quot;</span></span><br><span class="line">        <span class="string">f&quot;<span class="subst">&#123;event[<span class="string">&#x27;type&#x27;</span>]&#125;</span> and specversion <span class="subst">&#123;event[<span class="string">&#x27;specversion&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, <span class="number">204</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(port=<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><hr><h4 id="‰∫å„ÄÅÊé•ÂÖ•ÊñπÂºè"><a href="#‰∫å„ÄÅÊé•ÂÖ•ÊñπÂºè" class="headerlink" title="‰∫å„ÄÅÊé•ÂÖ•ÊñπÂºè"></a>‰∫å„ÄÅÊé•ÂÖ•ÊñπÂºè</h4><h5 id="Êû∂ÊûÑ"><a href="#Êû∂ÊûÑ" class="headerlink" title="Êû∂ÊûÑ"></a>Êû∂ÊûÑ</h5><p>Âü∫‰∫é‰∫ã‰ª∂È©±Âä®ÊúçÂä°ÊòØÂáΩÊï∞ËÆ°ÁÆóÁöÑÊ†∏ÂøÉÂäüËÉΩ‰πã‰∏ÄÔºåÂπ≥Âè∞‰ΩøÁî® Knative Eventing ÁöÑBroker&#x2F;Trigger ‰∫ã‰ª∂Â§ÑÁêÜÊ®°ÂûãÂØπ‰∫ã‰ª∂ËøõË°åËøáÊª§ÂàÜÂèëÔºåÊ≠§Â§ñ‰∏∫‰∫ÜÁ°Æ‰øùË∑®Âπ≥Âè∞Âíå‰∫íÊìç‰ΩúÊÄßÔºåÂ∞ÜÈááÁî®CNCFÂÆö‰πâÁöÑÊ†áÂáÜÊï∞ÊçÆÊ†ºÂºèCloudEvents ËøõË°å‰∫ã‰ª∂‰º†Ëæì„ÄÇ</p><p><img src="https://s3.ax1x.com/2020/12/20/rafMi4.png" alt="Âõæ 1 ‰∫ßÂìÅÊé•ÂÖ•Êû∂ÊûÑ"></p><p>Â¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÊû∂ÊûÑÂàÜ‰∏∫‰∏âÂùóÂÜÖÂÆπÔºå‰ªéÂ∑¶Âà∞Âè≥ÂàÜÂà´‰∏∫‰∫ã‰ª∂Ê∫êÔºå‰∫ã‰ª∂Êé•Êî∂&#x2F;ËΩ¨ÂèëËÄÖÔºå‰∫ã‰ª∂Ê∂àË¥πËÄÖ„ÄÇ</p><ol><li>‰∫ã‰ª∂Ê∫ê</li></ol><p>‰∫ã‰ª∂Ê∫êÊòØ‰∏ÄÁßç Kubernetes ÂÆöÂà∂ËµÑÊ∫êÔºåÂÆÉÊèê‰æõ‰∫Ü‰∏ÄÁßçÊú∫Âà∂ÔºåÁî®‰∫éÊ≥®ÂÜåÊù•Ëá™ÁâπÂÆöÊúçÂä°Á≥ªÁªüÁöÑ‰∏ÄÁ±ª‰∫ã‰ª∂„ÄÇ‰æãÂ¶ÇÔºöÂØπË±°Â≠òÂÇ®‰∫ã‰ª∂Ê∫êÔºåGithub‰∫ã‰ª∂Ê∫êÁ≠âÁ≠âÔºåÂõ†Ê≠§‰∏çÂêåÁöÑ‰∫ã‰ª∂Ê∫êÈúÄË¶ÅÁöÑ‰∏çÂêåÁöÑËá™ÂÆö‰πâËµÑÊ∫êËøõË°åÊèèËø∞„ÄÇ</p><p>‰∫ã‰ª∂Ê∫êË¥üË¥£Ëé∑ÂèñÁâπÂÆöÊúçÂä°Á≥ªÁªüÁöÑ‰∫ã‰ª∂ÔºåÂπ∂Â∞Ü‰∫ã‰ª∂ËΩ¨Âåñ‰∏∫CloudEventsÊ†ºÂºè‰∫ã‰ª∂ÂèëÈÄÅÁªô Knative Eventing Âπ≥Âè∞ÔºàÂç≥ Broker&#x2F;Trigger‰∫ã‰ª∂Â§ÑÁêÜÊ®°ÂûãÔºâ„ÄÇ</p><ol start="2"><li>‰∫ã‰ª∂Êé•Âèó&#x2F;ËΩ¨ÂèëËÄÖ</li></ol><p>ÂºïÂÖ•Broker&#x2F;Trigger‰∫ã‰ª∂Â§ÑÁêÜÊ®°ÂûãÁöÑÁõÆÁöÑÔºåÊòØ‰∏∫‰∫ÜÊê≠Âª∫‰∏Ä‰∫õÈªëÁõíÂ≠êÔºåÂ∞ÜÂÖ∑‰ΩìÁöÑÂÆûÁé∞ÈöêËóèËµ∑Êù•ÔºåÁî®Êà∑Êó†ÈúÄÂÖ≥ÂøÉÂ∫ïÂ±ÇÂÆûÁé∞ÁªÜËäÇ„ÄÇ</p><ul><li>BrokerÂ¶ÇÂêå‰∫ã‰ª∂Ê°∂ÔºåÊé•Êî∂ÂêÑÁßç‰∏çÂêåÁöÑ‰∫ã‰ª∂ÔºåËøô‰∫õ‰∫ã‰ª∂ÂèØ‰ª•ÈÄöËøáÂ±ûÊÄßÊù•ËøáÊª§„ÄÇ</li><li>TriggerÊèèËø∞‰∫Ü‰∏Ä‰∏™ËøáÊª§Âô®ÔºåÂè™ÊúâÈÄöËøá‰∫ÜËøáÊª§Âô®ÈÄâÊã©ÁöÑ‰∫ã‰ª∂ÔºåÂèØ‰ª•Ë¢´‰º†ÈÄÅÁªô‰∫ã‰ª∂Ê∂àË¥πËÄÖ„ÄÇ</li></ul><p>Â¶ÇÂõæ1ÊâÄÁ§∫ÔºåÁî®Êà∑ÈÄöËøá filterÊåáÂÆöÊÑüÂÖ¥Ë∂£Á∫¢Ëâ≤Â∞èÁêÉÁöÑ‰∫ã‰ª∂ÔºåÊúÄÁªàÂè™ÊúâËØ•Á±ª‰∫ã‰ª∂Ë¢´‰º†ÈÄÅÁªô‰∫ã‰ª∂Ê∂àË¥πËÄÖÔºàËøôÈáåÊòØKnative ServiceÔºåÂç≥ KSvcÂáΩÊï∞Ôºâ„ÄÇ</p><ol start="3"><li>‰∫ã‰ª∂Ê∂àË¥πËÄÖ</li></ol><p>‰∫ã‰ª∂Ê∂àË¥πËÄÖÂèØ‰ª•ÊòØÊüê‰∏™ÊúçÂä°ÊàñÁ≥ªÁªüÔºåËøôÈáåÁöÑ‰∫ã‰ª∂Ê∂àË¥πËÄÖÊòØÁî®Êà∑ÁºñÂÜôÁöÑKSvcÂáΩÊï∞ÔºàÂç≥Â§ÑÁêÜ‰∫ã‰ª∂ÁöÑÈÄªËæë‰ª£Á†ÅÔºâ„ÄÇ</p><h5 id="ÂÆûÁé∞ÊñπÂºè"><a href="#ÂÆûÁé∞ÊñπÂºè" class="headerlink" title="ÂÆûÁé∞ÊñπÂºè"></a>ÂÆûÁé∞ÊñπÂºè</h5><ol><li>Á¨¨‰∏âÊñπÊé•ÂÖ•</li></ol><p>Á¨¨‰∏âÊñπÊúçÂä°Êé•ÂÖ•Âü∫‰∫éknativeÂÆûÁé∞ÁöÑserverlessÂπ≥Âè∞ÈúÄË¶ÅÊèê‰æõÁâπÂÆöÁöÑ‰∫ã‰ª∂Ê∫êÔºåKnativeÁ§æÂå∫Â∑≤Áª¥Êä§ÈÉ®ÂàÜ‰∫ã‰ª∂Ê∫êÔºåÂÖ∑‰ΩìÂàóË°®ËØ∑Êü•ÁúãÔºö<a href="https://github.com/knative/eventing-contrib">https://github.com/knative/eventing-contrib</a></p><p>Â¶ÇÊûúÁ¨¨‰∏âÊñπÊúçÂä°‰∏çÂú®Á§æÂå∫Êèê‰æõÁöÑÊîØÊåÅÂàóË°®‰∏≠ÔºåÂ∞±ÈúÄË¶ÅËá™ÂÆö‰πâ‰∫ã‰ª∂Ê∫êÔºåÊúâÂ¶Ç‰∏ãÂ∏∏Áî®ÁöÑÂá†ÁßçÊñπÂºèÔºö</p><p><img src="https://s3.ax1x.com/2020/12/20/rafGsx.png"></p><p>ContainerSource ÂÆûÁé∞ÁÆÄÂçïÔºåÊòØÁõÆÂâçÂ§ßÈÉ®ÂàÜËá™ÂÆö‰πâ‰∫ã‰ª∂Ê∫êÁöÑÂÆûÁé∞ÊñπÂºèÔºå‰πüÊòØKNativeÂπ≥Âè∞Êé®ËçêÁöÑÊñπÂºè„ÄÇ</p><p>ContainerSource ÊòØ Kubernetes ‰∏≠Ëá™ÂÆö‰πâÁöÑ CRDÔºàCustom Resource DefinitionÔºâËµÑÊ∫êÁ±ªÂûãÔºåÂÖ∑‰ΩìÂÆö‰πâÂ¶Ç‰∏ã</p><p><img src="https://s3.ax1x.com/2020/12/20/rafteK.png" alt="CRD"></p><p>‰∏ªË¶ÅÁúã‰ª•‰∏ãÂá†‰∏™ÈÉ®ÂàÜÔºö</p><ol><li>sinkÔºö‰∫ã‰ª∂ËΩ¨ÂèëÁöÑÁõÆÊ†áÂØπË±°ÔºåËøôÈáåÂç≥Âõæ1‰∏≠‰ªãÁªçÁöÑBorker</li><li>imageÔºöÈúÄË¶ÅÂºÄÂèëÁöÑÈïúÂÉèÔºåÂåÖÊã¨‰∫ÜÁõëÂê¨ÂÖ∑‰ΩìÊï∞ÊçÆÊ∫êÁöÑ‰∫ã‰ª∂ÂíåËΩ¨Âèë‰∫ã‰ª∂Âà∞sinkÁöÑÂÆûÁé∞</li><li>argÂíåenvÔºöÂºÄÂèëËÄÖËá™ÂÆö‰πâÁöÑ‰∏Ä‰∫õÊï∞ÊçÆÈÄöËøá arg Âíå env ‰º†ÂÖ•ÈïúÂÉè</li></ol><p>ContainerSource ‰∏≠ image ÈïúÂÉèÈÉ®ÂàÜÂç≥ÈúÄË¶ÅËá™ÂÆö‰πâÂÆûÁé∞ÁöÑÈÉ®ÂàÜÔºåÂÆûÁé∞ÊñπÂºèÊ†πÊçÆËé∑ÂèñÁ¨¨‰∏âÊñπÊúçÂä°‰∫ã‰ª∂ÁöÑ‰∏çÂêåÂàÜ‰∏∫‰ª•‰∏ã‰∏§ÁßçÔºö</p><ol><li>Ê∂àÊÅØÈòüÂàóÊñπÂºè<br>Â¶Ç‰∏ãÂõæ 2ÊâÄÁ§∫ÔºåÂ¶ÇÊûúÁ¨¨‰∏âÊñπÊúçÂä°Â∑≤ÈÄÇÈÖçÊ∂àÊÅØÈòüÂàóÔºåÂèØ‰ª•Â∞Ü‰∫ßÁîüÁöÑ‰∫ã‰ª∂ÂèëÂæÄÊ∂àÊÅØÈòüÂàóÔºåÊ≠§Êó∂ ContainerSource ÂèØ‰ª•Áõ¥Êé•‰ªéÊ∂àÊÅØÈòüÂàó‰∏≠Ê∂àË¥πÁ¨¨‰∏âÊñπÊúçÂä°ÁöÑ‰∫ã‰ª∂„ÄÇ</li></ol><p><img src="https://s3.ax1x.com/2020/12/20/rafdFe.png" alt="Âõæ 2 Ê∂àÊÅØÈòüÂàóÊñπÂºè"></p><ol start="2"><li>Áõ¥ËøûÊñπÂºè<br>Â¶Ç‰∏ãÂõæ 3ÊâÄÁ§∫ÔºåÂ¶ÇÊûúÁ¨¨‰∏âÊñπÊúçÂä°Êú™ÈÄÇÈÖçÊ∂àÊÅØÈòüÂàóÔºå‰ΩÜÊúçÂä°Êú¨Ë∫´Êèê‰æõ‰∫ã‰ª∂ËÆ¢ÈòÖËÉΩÂäõÔºàÂ¶Ç Redis ÁöÑÈîÆÁ©∫Èó¥ÁâπÊÄßÔºåKeyspace Notifications futureÔºâÔºåÊ≠§Êó∂ ContainerSource ÂèØ‰ª•Áõ¥Êé•ËÆ¢ÈòÖÁ¨¨‰∏âÊñπÊúçÂä°ÁöÑ‰∫ã‰ª∂ÔºåÁõëÂê¨ÊúçÂä°ÂèòÂåñ„ÄÇ</li></ol><p><img src="https://s3.ax1x.com/2020/12/20/raf0Wd.png" alt="Âõæ 3 Áõ¥ËøûÊñπÂºè"></p><p>Ê≥®ÊÑèÔºöÊó†ËÆ∫ÈááÁî®‰ª•‰∏äÂì™ÁßçÊñπÂºèÔºåContainerSource Âú®ÁîüÊàê CloudEvents ‰∫ã‰ª∂Êó∂ÔºåÈÉΩÈúÄË¶ÅÊê∫Â∏¶ KSVC ÁõÆÊ†áÂáΩÊï∞ÁöÑÂîØ‰∏ÄÊ†áËØÜÔºå‰ª•‰æõÂπ≥Âè∞‰æßÂàÜÂèë‰∫ã‰ª∂Êó∂‰ΩøÁî®„ÄÇ‰æãÂ¶ÇÔºö1. Ê∂àÊÅØÈòüÂàóÊñπÂºèÔºåÁî±‰∫éÊâÄÊúâ‰∫ã‰ª∂ÈÉΩ‰ªéÂêå‰∏Ä‰∏™Ê∂àÊÅØÈòüÂàó‰∏≠Ëé∑ÂèñÔºåÊ≠§Êó∂ÈúÄË¶ÅÂú®Á¨¨‰∏âÊñπÊúçÂä°Áîü‰∫ß‰∫ã‰ª∂Êó∂Â∞±Êê∫Â∏¶ÁõÆÊ†áÂáΩÊï∞ÁöÑÊ†áËØÜÔºàÂØπË±°Â≠òÂÇ®‰∫ßÂìÅÊé•ÂÖ•Êó∂ÈááÁî®ËØ•ÊñπÂºèÔºâÔºõ2. Áõ¥ËøûÊñπÂºèÔºåÁî±‰∫é ContainerSource ‰∏éÁ¨¨‰∏âÊñπÊúçÂä°ÊòØ‰∏ÄÂØπ‰∏ÄÂÖ≥Á≥ªÔºåÊâÄ‰ª•ÂèØ‰ª•Âú® ContainerSource ÁîüÊàê CloudEvents ‰∫ã‰ª∂Êó∂Ê∑ªÂä†ÁõÆÊ†áÂáΩÊï∞ÁöÑÊ†áËØÜ„ÄÇ</p><p>Âà©Áî® Broker&#x2F;Trigger ‰∫ã‰ª∂Â§ÑÁêÜÊ®°ÂûãÔºåÊûÅÂ§ßÁÆÄÂåñ‰∫ÜÁ¨¨‰∏âÊñπÊúçÂä°Êé•ÂÖ•ÂáΩÊï∞ËÆ°ÁÆóÁöÑÊµÅÁ®ã„ÄÇÊó†ËÆ∫‰ΩøÁî®Ê∂àÊÅØÈòüÂàóÊñπÂºèËøòÊòØÁõ¥ËøûÊñπÂºèÔºå‰∫ßÂìÅ‰æßÂè™ÈúÄË¶ÅÊèê‰æõÈÄÇÈÖçÁ¨¨‰∏âÊñπÊúçÂä°ÁöÑ ContainerSource ÈïúÂÉèÔºå‰ª•‰æõÂπ≥Âè∞‰æß‰ΩøÁî®„ÄÇ</p><ol start="2"><li>Âπ≥Âè∞‰æßÁ∫≥ÁÆ°</li></ol><p>Âπ≥Âè∞‰æßÁöÑÂ∑•‰Ωú‰∏ªË¶ÅÊòØÁ∫≥ÁÆ°‰∫ßÂìÅ‰æßÊèê‰æõÁöÑ ContainerSourceÔºåÂπ∂Âà©Áî® Trigger Êèê‰æõ‰∫ã‰ª∂ËøáÊª§ÁöÑËÉΩÂäõ„ÄÇ</p><p>ÈíàÂØπ ContainerSource ‰∏çÂêåÁöÑÂÆûÁé∞ÊñπÂºèÔºåÂπ≥Âè∞‰æßÂ∑•‰ΩúÂÜÖÂÆπ‰πüÊúâÊâÄÂå∫Âà´Ôºö</p><p><em><strong>Ê∂àÊÅØÈòüÂàóÂÆûÁé∞ÊñπÂºè</strong></em></p><p>Âπ≥Âè∞‰æß‰ºöÂàõÂª∫Â¶Ç‰∏ãÂÜÖÂÆπÔºö</p><ol><li>‰∏ÄÁªÑÁõ∏ÂêåÁöÑContainerSourceÔºàÁî®‰∫éÈ´òÂèØÁî®Ôºâ</li><li>‰∏Ä‰∏™ Broker Á±ªÂûãÁöÑËµÑÊ∫êÔºåÁî®‰∫éÂàÜÂèë‰∫ã‰ª∂</li><li>Â§ö‰∏™ Trigger Á±ªÂûãËµÑÊ∫êÔºåÁî®‰∫é‰∫ã‰ª∂ËøáÊª§</li></ol><p>Âπ≥Âè∞‰æß‰ºöÈ¢ÑÂÖàÂàõÂª∫Â•Ω ContainerSource Âíå Broker ËµÑÊ∫êÔºåÂπ∂Êèê‰æõÁ∫≥ÁÆ° Trigger ÁöÑÂ¢ûÂà†ÊîπÊü•Êé•Âè£Áî®‰∫é‰∫ã‰ª∂ËøáÊª§ÔºåÊ≠§Êó∂ ContainerSourceÔºåBrokerÔºåTrigger ÂØπÂ∫îÂÖ≥Á≥ªÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p><p><img src="https://s3.ax1x.com/2020/12/20/rafsyt.png"></p><p><em><strong>Áõ¥ËøûÊñπÂºè</strong></em></p><p>Âπ≥Âè∞‰æß‰ºöÂàõÂª∫Â¶Ç‰∏ãÂÜÖÂÆπÔºö</p><ol><li>Â§ö‰∏™ ContainerSource ËÆ¢ÈòÖÁõëÂê¨‰∏çÂêåÁöÑÊúçÂä°ÂÆû‰æã</li><li>‰∏Ä‰∏™ Broker Á±ªÂûãÁöÑËµÑÊ∫êÔºåÁî®‰∫éÂàÜÂèë‰∫ã‰ª∂</li><li>Â§ö‰∏™ Trigger Á±ªÂûãËµÑÊ∫êÔºåÁî®‰∫é‰∫ã‰ª∂ËøáÊª§</li></ol><p>Âπ≥Âè∞‰æß‰ºöÈ¢ÑÂÖàÊèê‰æõÂ•Ω Broker ËµÑÊ∫êÔºåÂπ∂Êèê‰æõÁ∫≥ÁÆ° ContainerSource Âíå Trigger ÁöÑÂ¢ûÂà†ÊîπÊü•Êé•Âè£ÔºåÊ≠§Êó∂ ContainerSourceÔºåBrokerÔºåTrigger ÂØπÂ∫îÂÖ≥Á≥ªÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p><p><img src="https://s3.ax1x.com/2020/12/20/rafcef.png"></p><hr><h4 id="ÂèÇËÄÉËµÑÊñô"><a href="#ÂèÇËÄÉËµÑÊñô" class="headerlink" title="ÂèÇËÄÉËµÑÊñô"></a>ÂèÇËÄÉËµÑÊñô</h4><ul><li><a href="https://www.bookstack.cn/read/serverless-handbook/core-function-code.md">function</a></li><li><a href="https://cloudevents.github.io/sdk-go/">go sdk</a></li><li><a href="https://github.com/cloudevents/sdk-go">sdk-go</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ÈöèÁùÄ‰∫ëÂéüÁîüÁöÑÂèëÂ±ïÔºà‰∫ëÂéüÁîüÁöÑ‰∏ã‰∏Ä‰∏™‰∫îÂπ¥Âú®Âì™ÈáåÔºüÔºâÔºåÈÄêÊ≠•ËøõÂÖ•Ê∑±Ê∞¥Âå∫Ôºå‰∏öÁïåÈúÄË¶Å‰∏ÄÁßçÁªü‰∏ÄÁöÑ‰∫ã‰ª∂ÂÆö‰πâÂíåÊèèËø∞ËßÑËåÉÔºå‰ª•Êèê‰æõË∑®ÊúçÂä°„ÄÅË∑®Âπ≥Âè∞ÁöÑ‰∫§‰∫íËÉΩÂäõ„ÄÇCloudEvents‰∫ã‰ª∂ËßÑËåÉÂ∫îËøêËÄåÁîüÔºåÂπ∂ÂæóÂà∞‰∫ÜË°å‰∏öÁöÑÂπøÊ≥õÂÖ≥Ê≥®ÔºåÂåÖÊã¨‰∏ªË¶ÅÁöÑ‰∫ëÊèê‰æõÂïÜÂíå SaaS ÂÖ¨Âè∏„ÄÇ&lt;br&gt;ÂØπ‰∫éCloudEventÁöÑ‰ªãÁªç</summary>
      
    
    
    
    <category term="serverless" scheme="https://zoues.com/categories/serverless/"/>
    
    
    <category term="serverless" scheme="https://zoues.com/tags/serverless/"/>
    
    <category term="cloudnative" scheme="https://zoues.com/tags/cloudnative/"/>
    
  </entry>
  
  <entry>
    <title>CloudEvents‰∏âÈÉ®Êõ≤:ËßÑËåÉÁØá</title>
    <link href="https://zoues.com/posts/e6aacf5d/"/>
    <id>https://zoues.com/posts/e6aacf5d/</id>
    <published>2020-12-20T13:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.372Z</updated>
    
    <content type="html"><![CDATA[<p>ÈöèÁùÄ‰∫ëÂéüÁîüÁöÑÂèëÂ±ïÔºà‰∫ëÂéüÁîüÁöÑ‰∏ã‰∏Ä‰∏™‰∫îÂπ¥Âú®Âì™ÈáåÔºüÔºâÔºåÈÄêÊ≠•ËøõÂÖ•Ê∑±Ê∞¥Âå∫Ôºå‰∏öÁïåÈúÄË¶Å‰∏ÄÁßçÁªü‰∏ÄÁöÑ‰∫ã‰ª∂ÂÆö‰πâÂíåÊèèËø∞ËßÑËåÉÔºå‰ª•Êèê‰æõË∑®ÊúçÂä°„ÄÅË∑®Âπ≥Âè∞ÁöÑ‰∫§‰∫íËÉΩÂäõ„ÄÇCloudEvents‰∫ã‰ª∂ËßÑËåÉÂ∫îËøêËÄåÁîüÔºåÂπ∂ÂæóÂà∞‰∫ÜË°å‰∏öÁöÑÂπøÊ≥õÂÖ≥Ê≥®ÔºåÂåÖÊã¨‰∏ªË¶ÅÁöÑ‰∫ëÊèê‰æõÂïÜÂíå SaaS ÂÖ¨Âè∏„ÄÇ<br>ÂØπ‰∫éCloudEventÁöÑ‰ªãÁªç„ÄÅËßÑËåÉËØ¥ÊòéÂèäÂÆûË∑µËêΩÂú∞ÔºåÂ∞Ü‰ª•‰∏âÁØáÁ≥ªÂàóÊñáÁ´†ËøõË°åËØ¥ÊòéÔºåÊú¨Êñá‰∏∫„ÄäCloudEvent‰∏âÈÉ®Êõ≤:ËßÑËåÉÁØá„Äã.</p><hr><h4 id="‰∏Ä„ÄÅËßÑËåÉÊ¶ÇËø∞"><a href="#‰∏Ä„ÄÅËßÑËåÉÊ¶ÇËø∞" class="headerlink" title="‰∏Ä„ÄÅËßÑËåÉÊ¶ÇËø∞"></a>‰∏Ä„ÄÅËßÑËåÉÊ¶ÇËø∞</h4><p>‰∫ã‰ª∂ËôΩÊó†Â§Ñ‰∏çÂú®Ôºå‰ΩÜ‰∫ã‰ª∂Áîü‰∫ßËÄÖÂæÄÂæÄ‰ºö‰ª•‰∏çÂêåÁöÑÊñπÂºèÊù•ÊèèËø∞‰∫ã‰ª∂„ÄÇ</p><p>ÂÖ≥‰∫é‰∫ã‰ª∂ÁöÑË°å‰∏öËßÑËåÉÁöÑÁº∫Â§±ÊÑèÂë≥ÁùÄÂºÄÂèë‰∫∫ÂëòÂøÖÈ°ªÈáçÂ§çÂØπÊé•‰∫ã‰ª∂Â§ÑÁêÜÊµÅÁ®ã„ÄÇËøôÂ¢ûÂä†‰∫ÜË∑®Á≥ªÁªüÔºàÂ§öÁ≥ªÁªüÔºâÂèëÈÄÅ‰∫ã‰ª∂ÁöÑÈöæÂ∫¶ÔºåÈôç‰Ωé‰∫ã‰ª∂Â§ÑÁêÜÁöÑÂèØÁßªÊ§çÊÄß„ÄÇ</p><p>CloudEventsÊòØ‰∏ÄÁßçÁî®ÈÄöÁî®Ê†ºÂºèÊèèËø∞‰∫ã‰ª∂Êï∞ÊçÆÁöÑËßÑËåÉÔºå‰ª•Êèê‰æõË∑®ÊúçÂä°„ÄÅÂπ≥Âè∞ÂíåÁ≥ªÁªüÁöÑ‰∫íÊìç‰ΩúÊÄß„ÄÇ‰∫ã‰ª∂Ê†ºÂºèÊåáÂÆö‰∫ÜÂ¶Ç‰ΩïÁî®ÁâπÂÆöÁöÑÁºñÁ†ÅÊ†ºÂºèÂØπ CloudEvents ËøõË°åÂ∫èÂàóÂåñ„ÄÇÊîØÊåÅËøô‰∫õÁºñÁ†ÅÁöÑCloudEventsÂÆûÁé∞ÂøÖÈ°ªÈÅµÂÆàÁõ∏Â∫î‰∫ã‰ª∂Ê†ºÂºè‰∏≠ÊåáÂÆöÁöÑÁºñÁ†ÅËßÑÂàôÔºåÊâÄÊúâÂÆûÁé∞ÈÉΩÂøÖÈ°ªÊîØÊåÅJSONÊ†ºÂºèÔºå<em>protobuf</em>ÁöÑÊ†ºÂºè‰πüÂú®ÊúâÂ∫èÊé®Ëøõ‰∏≠„ÄÇ</p><h6 id="ËÆæËÆ°ÁõÆÊ†á"><a href="#ËÆæËÆ°ÁõÆÊ†á" class="headerlink" title="ËÆæËÆ°ÁõÆÊ†á"></a>ËÆæËÆ°ÁõÆÊ†á</h6><p>CloudEventsÈÄöÂ∏∏Áî®‰∫éÂàÜÂ∏ÉÂºèÁ≥ªÁªüÔºå‰ª•ÂÖÅËÆ∏ÊúçÂä°Âú®ÂºÄÂèëÊúüÈó¥‰ΩéËÄ¶ÂêàÔºåÂπ∂Áã¨Á´ãÈÉ®ÁΩ≤Ôºå‰æø‰∫éËøûÊé•‰ª•ÊûÑÂª∫Êñ∞Â∫îÁî®Á®ãÂ∫è„ÄÇ</p><p>CloudEventsÁöÑÁõÆÊ†áÊòØÂÆö‰πâ‰∫ã‰ª∂Á≥ªÁªüÁöÑ‰∫íÊìç‰ΩúÊÄßÔºåËØ•Á≥ªÁªüÂÖÅËÆ∏ÊúçÂä°ÁîüÊàêÊàñ‰ΩøÁî®‰∫ã‰ª∂ÔºåÂÖ∂‰∏≠ÂåÖÊã¨Áã¨Á´ãÂºÄÂèëÂíåÈÉ®ÁΩ≤Áîü‰∫ßËÄÖÂíå‰ΩøÁî®ËÄÖ„ÄÇÁîü‰∫ßËÄÖÂèØ‰ª•Âú®Ê∂àË¥πËÄÖÊî∂Âê¨‰πãÂâçÁîüÊàê‰∫ã‰ª∂ÔºåÂπ∂‰∏îÊ∂àË¥πËÄÖÂèØ‰ª•ËøõË°åÁõ∏ÂÖ≥ËÆ¢ÈòÖÊìç‰Ωú„ÄÇÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÊ≠§Â∑•‰Ωú‰∫ßÁîüÁöÑËßÑËåÉÈõÜ‰∏≠‰∫é‰∫ã‰ª∂Ê†ºÂºèÁöÑ‰∫íÊìç‰ΩúÊÄß‰ª•ÂèäÂú®ÂêÑÁßçÂçèËÆÆÔºà‰æãÂ¶ÇHTTP„ÄÅprotobufÔºâ‰∏äÂèëÈÄÅ‰∫ã‰ª∂Ê†ºÂºèÁöÑÊòæÁ§∫ÊñπÂºè„ÄÇËßÑËåÉ‰∏çÂÖ≥Ê≥®‰∫ã‰ª∂‰∫ßÁîüËÄÖÊàñ‰∫ã‰ª∂Ê∂àË¥πËÄÖÁöÑÂ§ÑÁêÜÊ®°Âûã„ÄÇ</p><p>CloudEventsÁöÑÊ†∏ÂøÉÊòØÂÆö‰πâ‰∫Ü‰∏ÄÁªÑÂÖÉÊï∞ÊçÆÔºåÁß∞‰∏∫Â±ûÊÄßÔºå‰ª•ÂèäÊúâÂÖ≥Âú®Á≥ªÁªü‰πãÈó¥‰º†ËæìÁöÑ‰∫ã‰ª∂ÂíåËøô‰∫õÂÖÉÊï∞ÊçÆÂ∫îÂ¶Ç‰ΩïÂá∫Áé∞Âú®Ê∂àÊÅØ‰∏≠„ÄÇËØ•ÂÖÉÊï∞ÊçÆÊòØÂÆö‰πâ‰∫ÜÂ∞ÜËØ∑Ê±ÇË∑ØÁî±Âà∞ÈÄÇÂΩìÁªÑ‰ª∂Âπ∂‰øÉËøõËØ•ÁªÑ‰ª∂ÂØπ‰∫ã‰ª∂ËøõË°åÈÄÇÂΩìÂ§ÑÁêÜÊâÄÈúÄÁöÑÊúÄÂ∞ëÊï∞ÊçÆÈõÜ„ÄÇÂ∞ΩÁÆ°ËøôÂèØËÉΩÊÑèÂë≥ÁùÄ‰∫ã‰ª∂Êú¨Ë∫´ÁöÑÊüê‰∫õÂ∫îÁî®Á®ãÂ∫èÊï∞ÊçÆÂèØËÉΩ‰ºö‰Ωú‰∏∫CloudEventsÂ±ûÊÄßÈõÜÁöÑ‰∏ÄÈÉ®ÂàÜÔºå‰ΩÜËøô‰πüÊòØ‰∏∫‰∫ÜÊ≠£Á°Æ‰º†ÈÄíÂíåÂ§ÑÁêÜÊ∂àÊÅØËÄåËøõË°åÁöÑÂøÖË¶ÅÊìç‰Ωú„ÄÇ</p><p><strong><strong>ÈùûËßÑËåÉËåÉÁï¥</strong></strong></p><p>‰ª•‰∏ãÂÜÖÂÆπ‰∏çÂ±û‰∫éËßÑËåÉËÄÉËôëËåÉÁï¥Ôºö</p><ul><li>ÂáΩÊï∞ÊûÑÂª∫ÂíåË∞ÉÁî®ËøáÁ®ã</li><li>ÁâπÂÆöËØ≠Ë®ÄÁöÑËøêË°åÊó∂API</li><li>Âçï‰∏ÄË∫´‰ªΩ&#x2F;ËÆøÈóÆÊéßÂà∂Á≥ªÁªü</li></ul><hr><h4 id="‰∫å„ÄÅÁ¨¶Âè∑ÂíåÊúØËØ≠"><a href="#‰∫å„ÄÅÁ¨¶Âè∑ÂíåÊúØËØ≠" class="headerlink" title="‰∫å„ÄÅÁ¨¶Âè∑ÂíåÊúØËØ≠"></a>‰∫å„ÄÅÁ¨¶Âè∑ÂíåÊúØËØ≠</h4><h5 id="Á¨¶Âè∑Á∫¶ÂÆö"><a href="#Á¨¶Âè∑Á∫¶ÂÆö" class="headerlink" title="Á¨¶Âè∑Á∫¶ÂÆö"></a>Á¨¶Âè∑Á∫¶ÂÆö</h5><p>‰∏∫‰∫ÜÊ∏ÖÊ•öËµ∑ËßÅÔºåÂΩì‰∏Ä‰∏™ÂäüËÉΩË¢´Ê†áËÆ∞‰∏∫‚ÄùÂèØÈÄâ‚ÄùÊó∂ÔºåËøôË°®ÊòéÊ∂àÊÅØÁöÑÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖÈÉΩÂèØ‰ª•ÈÄâÊã©ÊîØÊåÅËØ•ÂäüËÉΩ„ÄÇÊç¢Âè•ËØùËØ¥ÔºåÂ¶ÇÊûúÁîü‰∫ßËÄÖÊÑøÊÑèÔºåÂèØ‰ª•ÈÄâÊã©Â∞ÜËØ•ÂäüËÉΩÂåÖÂê´Âú®Ê∂àÊÅØ‰∏≠ÔºåÂ¶ÇÊûúÊ∂àË¥πËÄÖÊÑøÊÑèÔºåÂèØ‰ª•ÈÄâÊã©ÊîØÊåÅËØ•ÂäüËÉΩ„ÄÇÈÇ£‰πà‰∏çÊîØÊåÅËØ•ÂäüËÉΩÁöÑÊ∂àË¥πËÄÖÂ∞±‰ºöÈªòÈªòÂú∞ÂøΩÁï•Ê∂àÊÅØ‰∏≠ÁöÑÈÇ£ÈÉ®ÂàÜÂÜÖÂÆπ„ÄÇÁîü‰∫ßËÄÖÈúÄË¶Å‰∏∫Ê∂àË¥πËÄÖÂøΩÁï•ËØ•ÂäüËÉΩÁöÑÊÉÖÂÜµÂÅöÂ•ΩÂáÜÂ§á„ÄÇ‰∏≠Èó¥‰∫∫Â∫îËØ•ËΩ¨ÂèëÈÄâÊã©ÊÄßÂ±ûÊÄß„ÄÇ</p><p><em><strong>Ëß¶Âèë</strong></em></p><p>‚ÄúËß¶Âèë‚ÄùÊòØÊåáÂú®ËΩØ‰ª∂Á≥ªÁªüËøêË°åËøáÁ®ã‰∏≠Ëé∑ÂèñÂà∞ÁöÑ‰∫ã‰ª∂„ÄÇËøôÂèØËÉΩÊòØÁî±‰∫éÁ≥ªÁªüÂºïÂèëÁöÑ‰ø°Âè∑ÊàñÁ≥ªÁªüËßÇÂØüÂà∞ÁöÑ‰ø°Âè∑„ÄÅÁä∂ÊÄÅÂèòÂåñ„ÄÅËÆ°Êó∂Âô®ËøáÊúüÊàñ‰ªª‰ΩïÂÖ∂‰ªñÂÄºÂæóÊ≥®ÊÑèÁöÑÊ¥ªÂä®ËÄåÂèëÁîü„ÄÇ‰æãÂ¶ÇÔºåËÆæÂ§áÂèØËÉΩÂõ†‰∏∫ÁîµÊ±†ÁîµÈáè‰∏çË∂≥ËÄåËøõÂÖ•Ë≠¶Êä•Áä∂ÊÄÅÔºåÊàñËÄÖËôöÊãüÊú∫Âç≥Â∞ÜÊâßË°åÈ¢ÑÂÆöÁöÑÈáçÂêØ„ÄÇ</p><p><em><strong>‰∫ã‰ª∂</strong></em></p><p>‚Äú‰∫ã‰ª∂‚ÄùÊòØË°®Á§∫‰∫ã‰ª∂ÂèëÁîüÂèäÂÖ∂‰∏ä‰∏ãÊñáÁöÑÊï∞ÊçÆËÆ∞ÂΩï„ÄÇ‰∫ã‰ª∂Ë¢´‰ªé‰∫ã‰ª∂Áîü‰∫ßËÄÖÔºàÊ∫êÔºâÂàÜÂèëÂà∞ÊÑüÂÖ¥Ë∂£ÁöÑ‰∫ã‰ª∂Ê∂àË¥πËÄÖ„ÄÇÂèØ‰ª•Ê†πÊçÆ‰∫ã‰ª∂‰∏≠ÂåÖÂê´ÁöÑ‰ø°ÊÅØËøõË°åÂàÜÂèëÔºå‰ΩÜ‰∫ã‰ª∂‰∏ç‰ºöÁ°ÆÂÆöÂÖ∑‰ΩìÁöÑÂàÜÂèëÁõÆÁöÑÂú∞„ÄÇ‰∫ã‰ª∂Â∞ÜÂåÖÂê´‰∏§Á±ª‰ø°ÊÅØÔºö‰∫ã‰ª∂Êï∞ÊçÆ‰ª£Ë°®Ëß¶ÂèëÂêéÁöÑÊï∞ÊçÆÔºåËÄå‰∏ä‰∏ãÊñáÂÖÉÊï∞ÊçÆÊèê‰æõÂÖ≥‰∫é‰∫ã‰ª∂Ëß¶ÂèëÁöÑ‰∏ä‰∏ãÊñá‰ø°ÊÅØ„ÄÇ‰∏Ä‰∏™‰∫ã‰ª∂Ëß¶ÂèëÂèØËÉΩ‰ºö‰∫ßÁîüÂ§ö‰∏™‰∫ã‰ª∂„ÄÇ</p><p><em><strong>Áîü‰∫ßËÄÖ</strong></em></p><p>‚ÄúÁîü‰∫ßËÄÖ‚ÄùÊòØÁâπÂÆöÂÆû‰æã„ÄÅËøáÁ®ãÊàñËÆæÂ§áÔºåÁî®‰∫éÂàõÂª∫ÊèèËø∞CloudEventÁöÑÊï∞ÊçÆÁªìÊûÑ„ÄÇ</p><p><em><strong>‰∫ã‰ª∂Ê∫ê</strong></em></p><p>‚ÄúÊù•Ê∫ê‚ÄùÊòØÊåá‰∫ã‰ª∂Ëß¶ÂèëÊó∂ÁöÑ‰∏ä‰∏ãÊñá„ÄÇÂú®‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºåÂÆÉÂèØËÉΩÁî±Â§ö‰∏™Áîü‰∫ßËÄÖÁªÑÊàê„ÄÇ</p><p><em><strong>Ê∂àË¥πËÄÖ</strong></em></p><p>‚ÄúÊ∂àË¥πËÄÖ‚ÄùÊé•Êî∂‰∫ã‰ª∂ÔºåÂπ∂ÂØπÂÖ∂ÈááÂèñË°åÂä®„ÄÇÂÆÉ‰ΩøÁî®‰∏ä‰∏ãÊñáÂíåÊï∞ÊçÆÊù•ÊâßË°å‰∏Ä‰∫õÈÄªËæëÔºåËøôÂèØËÉΩÂØºËá¥Êñ∞‰∫ã‰ª∂ÁöÑÂèëÁîü„ÄÇ</p><p><em><strong>‰∏≠‰ªãÊú∫ÊûÑ</strong></em></p><p>‚Äú‰∏≠‰ªãÊú∫ÊûÑ‚ÄùÊé•Êî∂ÂåÖÂê´‰∫ã‰ª∂ÁöÑÊ∂àÊÅØÔºàÂ¶Ç‰∏≠Èó¥‰ª∂ÔºâÔºåÁõÆÁöÑÊòØÂ∞ÜÂÖ∂ËΩ¨ÂèëÁªô‰∏ã‰∏Ä‰∏™Êé•Êî∂ËÄÖÔºåËÄåÊé•Êî∂ËÄÖÂèØËÉΩÊòØÂè¶‰∏Ä‰∏™‰∏≠Èó¥‰∫∫ÊàñÊ∂àË¥πËÄÖ„ÄÇ‰∏≠Èó¥‰∫∫ÁöÑ‰∏Ä‰∏™ÂÖ∏Âûã‰ªªÂä°ÊòØÊ†πÊçÆ‰∏ä‰∏ãÊñá‰∏≠ÁöÑ‰ø°ÊÅØÂ∞Ü‰∫ã‰ª∂ËΩ¨ÂèëÂà∞Êé•Êî∂ËÄÖ„ÄÇ</p><p><em><strong>‰∏ä‰∏ãÊñá</strong></em></p><p>‰∏ä‰∏ãÊñáÂÖÉÊï∞ÊçÆÂ∞ÜË¢´Â∞ÅË£ÖÂú®‰∏ä‰∏ãÊñáÂ±ûÊÄß‰∏≠„ÄÇÂ∑•ÂÖ∑ÂíåÂ∫îÁî®Á®ãÂ∫è‰ª£Á†ÅÂèØ‰ª•‰ΩøÁî®Ëøô‰∫õ‰ø°ÊÅØÊù•ËØÜÂà´‰∫ã‰ª∂‰∏éÁ≥ªÁªüÁöÑÂêÑ‰∏™ÊñπÈù¢Êàñ‰∏éÂÖ∂‰ªñ‰∫ã‰ª∂ÁöÑÂÖ≥Á≥ª„ÄÇ</p><p><em><strong>Êï∞ÊçÆ</strong></em></p><p>‰∫ã‰ª∂ÁöÑÁâπÂÆö‰ø°ÊÅØ„ÄÇËøôÂèØËÉΩÂåÖÊã¨ÊúâÂÖ≥Ëß¶Âèë‰∫ã‰ª∂ÁöÑ‰ø°ÊÅØ„ÄÅ‰øÆÊîπÂêéÁöÑÊï∞ÊçÆÁ≠â„ÄÇ</p><p><em><strong>‰∫ã‰ª∂Ê†ºÂºè</strong></em></p><p>‰∫ã‰ª∂Ê†ºÂºèÊåáÂÆö‰∫ÜÂ¶Ç‰ΩïÂ∞ÜCloudEventÂ∫èÂàóÂåñ‰∏∫Â≠óËäÇÂ∫èÂàó„ÄÇÁã¨Á´ãÁöÑ‰∫ã‰ª∂Ê†ºÂºèÔºàÂ¶ÇJSON„ÄÅprotobufÊ†ºÂºèÔºâÂèØÊåáÂÆöÁã¨Á´ã‰∫é‰ªª‰ΩïÂçèËÆÆÊàñÂ≠òÂÇ®‰ªãË¥®ÁöÑÂ∫èÂàóÂåñ„ÄÇ</p><p><em><strong>Ê∂àÊÅØ</strong></em></p><p>‰∫ã‰ª∂ÈÄöËøáÊ∂àÊÅØ‰ªé‰∫ã‰ª∂Ê∫ê‰º†ËæìÂà∞ÁõÆÁöÑÂú∞„ÄÇ</p><p>‚ÄúÁªìÊûÑÂåñÊä•Êñá‚ÄùÊòØÊåá‰ΩøÁî®Áã¨Á´ãÁöÑ‰∫ã‰ª∂Ê†ºÂºèÂØπ‰∫ã‰ª∂ËøõË°åÂÆåÂÖ®ÁºñÁ†ÅÂπ∂Â≠òÂÇ®Âú®Ê∂àÊÅØ‰∏ª‰Ωì‰∏≠„ÄÇ</p><p>‚Äú‰∫åËøõÂà∂Êä•Êñá‚ÄùÊòØÊåá‰∫ã‰ª∂Êï∞ÊçÆÂ≠òÂÇ®Âú®Ê∂àÊÅØ‰Ωì‰∏≠Ôºå‰∫ã‰ª∂Â±ûÊÄß‰Ωú‰∏∫Ê∂àÊÅØÂÖÉÊï∞ÊçÆÁöÑ‰∏ÄÈÉ®ÂàÜËøõË°åÂ≠òÂÇ®„ÄÇ</p><p><em><strong>ÂçèËÆÆ</strong></em></p><p>Ê∂àÊÅØÂèØ‰ª•ÈÄöËøáÂêÑÁßçË°å‰∏öÊ†áÂáÜÂçèËÆÆÔºà‰æãÂ¶ÇHTTPÔºåAMQPÔºåMQTTÔºåSMTPÔºâÔºåÂºÄÊ∫êÂçèËÆÆÔºà‰æãÂ¶ÇKafkaÔºåNATSÔºâÊàñÂπ≥Âè∞&#x2F;‰æõÂ∫îÂïÜÁâπÂÆöÂçèËÆÆÔºàAWS KinesisÔºåAzure Event GridÔºâËøõË°å‰º†ÈÄí„ÄÇ</p><h5 id="‰∏ä‰∏ãÊñáÂ±ûÊÄß"><a href="#‰∏ä‰∏ãÊñáÂ±ûÊÄß" class="headerlink" title="‰∏ä‰∏ãÊñáÂ±ûÊÄß"></a>‰∏ä‰∏ãÊñáÂ±ûÊÄß</h5><p>Á¨¶ÂêàÊú¨ËßÑËåÉÁöÑÊØè‰∏™CloudEventÂøÖÈ°ªÂåÖÂê´‰∏ä‰∏ãÊñáÁ≠âÂ±ûÊÄß„ÄÇËøô‰∫õÂ±ûÊÄßÂú®ÊèèËø∞‰∫ã‰ª∂ÁöÑÂêåÊó∂ÔºåË¢´ËÆæËÆ°‰∏∫ÂèØ‰ª•Áã¨Á´ã‰∫é‰∫ã‰ª∂Êï∞ÊçÆËøõË°åÂ∫èÂàóÂåñ„ÄÇËøô‰ΩøÂæóÂÆÉ‰ª¨ÂèØ‰ª•Âú®ÁõÆÁöÑÂú∞Ë¢´Ê£ÄÊü•ÔºåËÄå‰∏çÈúÄË¶ÅÂØπ‰∫ã‰ª∂Êï∞ÊçÆËøõË°åÂèçÂ∫èÂàóÂåñ„ÄÇ</p><p><em><strong>Â±ûÊÄßÂëΩÂêçÁ∫¶ÂÆö</strong></em></p><p>CloudEventsËßÑËåÉÂÆö‰πâ‰∫ÜÂØπÂêÑÁßçÂçèËÆÆÂíåÁºñÁ†ÅÁöÑÊò†Â∞ÑÔºåÈöèÈôÑÁöÑCloudEvents SDKÈíàÂØπÂêÑÁßçËøêË°åÊó∂ÂíåËØ≠Ë®Ä„ÄÇÂÖ∂‰∏≠Êúâ‰∫õÂ∞ÜÂÖÉÊï∞ÊçÆÂÖÉÁ¥†ËßÜ‰∏∫Â§ßÂ∞èÂÜôÊïèÊÑüÔºåËÄåÂè¶‰∏Ä‰∫õÂàô‰∏çÊïèÊÑüÔºåËÄå‰∏îÂçï‰∏™CloudEventÂèØËÉΩ‰ºöÈÄöËøáÂ§ö‰∏™Ë∑≥ËΩ¨Êù•ÂÆûÁé∞Ôºå‰∏≠Èó¥Ê∂âÂèäÂçèËÆÆ„ÄÅÁºñÁ†ÅÂíåËøêË°åÊó∂„ÄÇÂõ†Ê≠§ÔºåÊú¨ËßÑËåÉÈôêÂà∂‰∫ÜÊâÄÊúâÂ±ûÊÄßÁöÑÂèØÁî®Â≠óÁ¨¶ÈõÜÔºå‰ª•Èò≤Ê≠¢Â§ßÂ∞èÂÜôÊïèÊÑüÈóÆÈ¢òÊàñ‰∏éÈÄöÁî®ËØ≠Ë®Ä‰∏≠Ê†áËØÜÁ¨¶ÁöÑÂÖÅËÆ∏Â≠óÁ¨¶ÈõÜÂÜ≤Á™Å„ÄÇ</p><p>CloudEventsÂ±ûÊÄßÂêçÁß∞ÂøÖÈ°ªÁî±ASCIIÂ≠óÁ¨¶ÈõÜ‰∏≠ÁöÑÂ∞èÂÜôÂ≠óÊØçÊàñÊï∞Â≠óÁªÑÊàê„ÄÇÂ±ûÊÄßÂêçÁß∞Â∫îÂÖ∑ÊúâÊèèËø∞ÊÄßÂíåÁÆÄÊ¥ÅÊÄßÔºåÈïøÂ∫¶‰∏çÂæóË∂ÖËøá20‰∏™Â≠óÁ¨¶„ÄÇ</p><p><em><strong>Á±ªÂûãÁ≥ªÁªü</strong></em></p><p>‰ª•‰∏ãÊòØÂèØÁî®‰∫éÂ±ûÊÄß‰∏≠ÁöÑÊäΩË±°Êï∞ÊçÆÁ±ªÂûã„ÄÇËøô‰∫õÁ±ªÂûã‰∏≠ÁöÑÊØè‰∏™Á±ªÂûãÈÉΩÂèØ‰ª•Áî±‰∏çÂêåÁöÑ‰∫ã‰ª∂Ê†ºÂºèÂíåÂçèËÆÆÂÖÉÊï∞ÊçÆÂ≠óÊÆµÊù•Ë°®Á§∫„ÄÇÊú¨ËßÑËåÉ‰∏∫ÊØè‰∏™Á±ªÂûãÂÆö‰πâ‰∫Ü‰∏Ä‰∏™Ê†áÂáÜÁöÑÂ≠óÁ¨¶‰∏≤ÁºñÁ†ÅÔºåÊâÄÊúâÁöÑÂÆûÁé∞ÈÉΩÂøÖÈ°ªÊîØÊåÅ„ÄÇ</p><ul><li>Â∏ÉÂ∞îÂûã - ÂÄº‰∏∫<code>true</code>Êàñ<code>false</code>ÁöÑÂ∏ÉÂ∞îÂÄº„ÄÇ<br>Â≠óÁ¨¶‰∏≤ÁºñÁ†ÅÔºöÂ§ßÂ∞èÂÜôÊïèÊÑüÁöÑ<code>true</code>Êàñ<code>false</code>ÂÄº„ÄÇ</li><li>Êï¥Âûã - <code>2,147,483,648</code>Âà∞<code>+2,147,483,647</code>‰πãÈó¥ÁöÑÊï¥Êï∞„ÄÇËøôÊòØ‰∏Ä‰∏™ÊúâÁ¨¶Âè∑ÁöÑ„ÄÅ32‰ΩçÁöÑ„ÄÅ‰∫åËøõÂà∂ÁºñÁ†ÅÁöÑËåÉÂõ¥„ÄÇ‰∫ã‰ª∂Ê†ºÂºè‰∏ç‰∏ÄÂÆöË¶Å‰ΩøÁî®Ëøô‰∏™ÁºñÁ†ÅÔºå‰ΩÜÂÆÉ‰ª¨ÂøÖÈ°ªÂè™<br>‰ΩøÁî®Ëøô‰∏™ËåÉÂõ¥ÂÜÖÁöÑÊï¥Êï∞ÂÄº„ÄÇ<br>Â≠óÁ¨¶‰∏≤ÁºñÁ†Å: Ê†πÊçÆRFC 7159ÔºåÁ¨¨6ËäÇÔºåJSONÂè∑Á†ÅÁöÑÊï¥Êï∞ÈÉ®ÂàÜ„ÄÇ</li><li>Â≠óÁ¨¶‰∏≤ - ÂÖÅËÆ∏ÁöÑUnicodeÂ≠óÁ¨¶Â∫èÂàó„ÄÇ‰ª•‰∏ãÂ≠óÁ¨¶‰∏çÂÖÅËÆ∏‰ΩøÁî®„ÄÇ</li></ul><ul><li>U+0000-U+001F Âíå U+007F-U+009F (‰∏§‰∏™ËåÉÂõ¥ÈÉΩÂåÖÊã¨Âú®ÂÜÖ)‰∏≠ÁöÑ‚ÄùÊéßÂà∂Â≠óÁ¨¶‚ÄùÔºåÂõ†‰∏∫Â§ßÂ§öÊï∞Â≠óÁ¨¶Ê≤°ÊúâÁ∫¶ÂÆöÁöÑÂê´‰πâÔºåÊúâ‰∫õÂ≠óÁ¨¶ÔºåÂ¶Ç U+000A (Êç¢Ë°åÁ¨¶)ÔºåÂú®HTTPÂ§¥Á≠â‰∏ä‰∏ãÊñá‰∏≠‰∏çËÉΩ‰ΩøÁî®„ÄÇ</li><li>‰ª£Á†ÅÁÇπË¢´UnicodeËØÜÂà´‰∏∫ÈùûÂ≠óÁ¨¶„ÄÇ</li><li>U+D800-U+DBFFÂíåU+DC00-U+DFFFÔºåËøô‰∏§‰∏™ËåÉÂõ¥ÈÉΩÂåÖÊã¨Âú®ÂÜÖÔºåÈô§ÈùûÊ≠£Á°ÆÂú∞ÊàêÂØπ‰ΩøÁî®„ÄÇ</li></ul><p>ËÄå‚Äù\uD800\uDEAD‚ÄùÊòØÂêàÊ≥ïÁöÑ„ÄÇ</p><ul><li>Â≠óËäÇ - Â≠óËäÇÂ∫èÂàó„ÄÇ</li><li>URI‚ÄìÁªùÂØπÁªü‰∏ÄÁöÑËµÑÊ∫êÊ†áËØÜÁ¨¶„ÄÇ</li></ul><ul><li>Â≠óÁ¨¶‰∏≤ÁºñÁ†ÅÔºöRFC4648‰∏≠ÂÆö‰πâÁöÑÁªùÂØπÁªü‰∏ÄËµÑÊ∫êÊ†áËØÜÁ¨¶„ÄÇ</li></ul><ul><li>URI-reference - Áªü‰∏ÄËµÑÊ∫êÊ†áËØÜÁ¨¶ÂºïÁî®„ÄÇ</li><li>Êó∂Èó¥Êà≥ -‰ΩøÁî®Gregorian CalendarÁöÑÊó•ÊúüÂíåÊó∂Èó¥Ë°®ËææÂºè„ÄÇ</li></ul><p>ÊâÄÊúâÁöÑ‰∏ä‰∏ãÊñáÂ±ûÊÄßÂÄºÂøÖÈ°ªÊòØ‰∏äÈù¢ÂàóÂá∫ÁöÑÁ±ªÂûã‰πã‰∏Ä„ÄÇÂ±ûÊÄßÂÄºÂèØ‰ª•‰ª•Êú¨Âú∞Á±ªÂûãÊàñÊ†áÂáÜÂ≠óÁ¨¶‰∏≤ÁöÑÂΩ¢ÂºèÂëàÁé∞„ÄÇË°®Á§∫ CloudEvent Êàñ‰ªª‰ΩïÊâ©Â±ïÁöÑÂº∫Á±ªÂûãÁºñÁ®ãÊ®°ÂûãÂøÖÈ°ªËÉΩÂ§üÂ∞ÜÂ∏∏ËßÑÂ≠óÁ¨¶‰∏≤ÁºñÁ†ÅËΩ¨Êç¢‰∏∫ÊúÄÈÄÇÂêàÊäΩË±°Á±ªÂûãÁöÑËøêË°åÊó∂&#x2F;ËØ≠Ë®ÄÂéüÁîüÁ±ªÂûã„ÄÇ</p><p>‰æãÂ¶ÇÔºåÂú®ÁªôÂÆöÁöÑÂÆûÁé∞‰∏≠ÔºåÊó∂Èó¥Â±ûÊÄßÂèØ‰ª•Áî®ËØ≠Ë®ÄÁöÑÊú¨Êú∫Êó•ÊúüÊó∂Èó¥Á±ªÂûãÊù•Ë°®Á§∫Ôºå‰ΩÜÂøÖÈ°ªÊèê‰æõRFC3339Â≠óÁ¨¶‰∏≤ÔºåÂπ∂‰∏îÂú®Êò†Â∞ÑÂà∞HTTPÊ∂àÊÅØÁöÑÊä•ÊñáÂ§¥Êó∂ÔºåÂøÖÈ°ªÂèØËΩ¨Êç¢‰∏∫RFC3339Â≠óÁ¨¶‰∏≤„ÄÇ</p><p>ÂêåÊ†∑ÔºåCloudEventsÂçèËÆÆÁªëÂÆöÊàñ‰∫ã‰ª∂Ê†ºÂºèÂÆûÁé∞‰πüÂøÖÈ°ªËÉΩÂ§üÂú®ÁºñÁ†ÅÊàñÂçèËÆÆÂÖÉÊï∞ÊçÆÂ≠óÊÆµ‰∏≠Â∞ÜÊ†áÂáÜÂ≠óÁ¨¶‰∏≤ÁºñÁ†ÅËΩ¨Êç¢‰∏∫Áõ∏Â∫îÁöÑÊï∞ÊçÆÁ±ªÂûã„ÄÇÊó∂Èó¥Êà≥Á±ªÂûãÁöÑÂ±ûÊÄßÂÄºÁ°ÆÂÆûÂèØ‰ª•‰Ωú‰∏∫‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÈÄöËøáÂ§öÊ¨°Ë∑≥ËΩ¨ÔºåÂπ∂‰∏îÂè™Âú®Áîü‰∫ßËÄÖÂíåÊúÄÁªàÊ∂àË¥πËÄÖÈÇ£Èáå‰ª•Êú¨Âú∞ËøêË°åÊó∂&#x2F;ËØ≠Ë®ÄÁ±ªÂûãÁöÑÂΩ¢ÂºèÂÆûÁé∞„ÄÇÊó∂Èó¥Êà≥‰πüÂèØËÉΩË¢´Ë∑ØÁî±‰∏∫Êú¨Âú∞ÂçèËÆÆÁ±ªÂûãÔºåÂπ∂ÂèØËÉΩÂú®Áîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖÁ´ØË¢´Êò†Â∞ÑÂà∞&#x2F;‰ªéÂêÑËá™ÁöÑËØ≠Ë®Ä&#x2F;ËøêË°åÊó∂Á±ªÂûãÔºåËÄåÊ∞∏Ëøú‰∏ç‰ºö‰ª•Â≠óÁ¨¶‰∏≤ÁöÑÂΩ¢ÂºèÂÆûÁé∞„ÄÇ</p><p>Â∫èÂàóÂåñÊú∫Âà∂ÁöÑÈÄâÊã©Â∞ÜÂÜ≥ÂÆö‰∏ä‰∏ãÊñáÂ±ûÊÄßÂíå‰∫ã‰ª∂Êï∞ÊçÆÁöÑÂ∫èÂàóÂåñÊñπÂºè„ÄÇ‰æãÂ¶ÇÔºåÂú®JSONÂ∫èÂàóÂåñÁöÑÊÉÖÂÜµ‰∏ãÔºå‰∏ä‰∏ãÊñáÂ±ûÊÄßÂíå‰∫ã‰ª∂Êï∞ÊçÆÂèØËÉΩÂêåÊó∂Âá∫Áé∞Âú®Âêå‰∏Ä‰∏™JSONÂØπË±°‰∏≠„ÄÇ</p><h5 id="ÂøÖË¶ÅÂ±ûÊÄß"><a href="#ÂøÖË¶ÅÂ±ûÊÄß" class="headerlink" title="ÂøÖË¶ÅÂ±ûÊÄß"></a>ÂøÖË¶ÅÂ±ûÊÄß</h5><p>‰ª•‰∏ãÂ±ûÊÄßÂøÖÈ°ªÂú®ÊâÄÊúâCloudEvents‰∏≠Âá∫Áé∞„ÄÇ</p><p><em><strong>id</strong></em></p><table><thead><tr><th align="left">Â±ûÊÄßÂêç</th><th align="left">id</th></tr></thead><tbody><tr><td align="left">Á±ªÂûã</td><td align="left">Â≠óÁ¨¶‰∏≤</td></tr><tr><td align="left">ÊèèËø∞</td><td align="left">Ê†áÁ§∫‰∫ã‰ª∂„ÄÇÁîü‰∫ßËÄÖÂøÖÈ°ªÁ°Æ‰øù source + id ÂØπ‰∫éÊØè‰∏™Áã¨Á´ãÁöÑ‰∫ã‰ª∂ÈÉΩÊòØÂîØ‰∏ÄÁöÑ„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™ÈáçÂ§çÁöÑ‰∫ã‰ª∂Ë¢´ÈáçÊñ∞ÂèëÈÄÅÔºà‰æãÂ¶ÇÔºåÁî±‰∫éÁΩëÁªúÈîôËØØÔºâÔºåÂÆÉÂèØËÉΩÊúâÁõ∏ÂêåÁöÑid„ÄÇÊ∂àË¥πËÄÖÂèØËÉΩ‰ºöËÆ§‰∏∫ source Âíå id Áõ∏ÂêåÁöÑ‰∫ã‰ª∂ÊòØÈáçÂ§çÁöÑ„ÄÇÔΩú</td></tr><tr><td align="left">Á∫¶Êùü</td><td align="left">1. ÂøÖÈ°ª <br>2. ÂøÖÈ°ªÊòØ‰∏Ä‰∏™ÈùûÁ©∫Â≠óÁ¨¶‰∏≤<br>3.ÂøÖÈ°ªÂú®Áîü‰∫ßËÄÖËåÉÂõ¥ÂÜÖÊòØÂîØ‰∏ÄÁöÑ</td></tr><tr><td align="left">ËåÉ‰æã</td><td align="left">1.Áî±Áîü‰∫ßËÄÖÁª¥Êä§ÁöÑ‰∫ã‰ª∂ËÆ°Êï∞Âô®<br>2.UUID</td></tr></tbody></table><p><em><strong>source</strong></em></p><table><thead><tr><th align="left">Â±ûÊÄßÂêç</th><th align="left">source</th></tr></thead><tbody><tr><td align="left">Á±ªÂûã</td><td align="left">URI-reference</td></tr><tr><td align="left">ÊèèËø∞</td><td align="left">Ê†áÁ§∫‰∫ã‰ª∂ÂèëÁîüÁöÑ‰∏ä‰∏ãÊñá„ÄÇÈÄöÂ∏∏ÂåÖÊã¨‰∫ã‰ª∂Ê∫êÁöÑÁ±ªÂûã„ÄÅÂèëÂ∏É‰∫ã‰ª∂ÁöÑÁªÑÁªáÊàñ‰∫ßÁîü‰∫ã‰ª∂ÁöÑËøáÁ®ãÁ≠â‰ø°ÊÅØ„ÄÇURI‰∏≠ÁºñÁ†ÅÁöÑÊï∞ÊçÆËÉåÂêéÁöÑÁ°ÆÂàáËØ≠Ê≥ïÂíåËØ≠‰πâÁî±‰∫ã‰ª∂Áîü‰∫ßËÄÖÂÆö‰πâ„ÄÇÁîü‰∫ßËÄÖÂøÖÈ°ªÁ°Æ‰øù source + id ÂØπ‰∫éÊØè‰∏™Áã¨Á´ãÁöÑ‰∫ã‰ª∂ÈÉΩÊòØÂîØ‰∏ÄÁöÑ„ÄÇÂ∫îÁî®Á®ãÂ∫èÂèØ‰ª•‰∏∫ÊØè‰∏™Áã¨Á´ãÁöÑÁîü‰∫ßËÄÖÂàÜÈÖç‰∏Ä‰∏™ÂîØ‰∏ÄÁöÑsourceÔºåËøôÊ†∑Â∞±ÂæàÂÆπÊòì‰∫ßÁîüÂîØ‰∏ÄÁöÑIDÔºåÂõ†‰∏∫Ê≤°ÊúâÂÖ∂‰ªñÁîü‰∫ßËÄÖ‰ºöÊúâÁõ∏ÂêåÁöÑsource„ÄÇÂ∫îÁî®Á®ãÂ∫èÂèØ‰ª•‰ΩøÁî® UUIDs„ÄÅURNs„ÄÅDNS ÊùÉÈôêÊàñÁâπÂÆö‰∫éÂ∫îÁî®Á®ãÂ∫èÁöÑÊñπÊ°àÊù•ÂàõÂª∫ÂîØ‰∏ÄÁöÑsourceÊ†áËØÜÁ¨¶„ÄÇ‰∏Ä‰∏™Ê∫ê‰πüÂèØ‰ª•ÂåÖÊã¨Â§ö‰∏™ÁöÑÁîü‰∫ßËÄÖ„ÄÇÂú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÁîü‰∫ßËÄÖÂøÖÈ°ªÂêà‰ΩúÔºåÁ°Æ‰øù source + id ÂØπ‰∫éÊØè‰∏™Áã¨Á´ãÁöÑ‰∫ã‰ª∂ÈÉΩÊòØÂîØ‰∏ÄÁöÑ„ÄÇ</td></tr><tr><td align="left">Á∫¶Êùü</td><td align="left">1. ÂøÖÈ°ª<br>2.ÂøÖÈ°ª‰∏∫ÈùûÁ©∫URI-reference<br>3.Êé®Ëçê‰ΩøÁî®ÁªùÂØπURI</td></tr><tr><td align="left">ËåÉ‰æã</td><td align="left">ÂÖ®ÁΩëÂîØ‰∏ÄÁöÑURIÔºåÂÖ∑ÊúâDNSÊùÉÈôê„ÄÇ<br>1.<a href="https://github.com/cloudevents">https://github.com/cloudevents</a> <br>2.mailto:<a href="mailto:&#99;&#110;&#99;&#x66;&#45;&#119;&#103;&#x2d;&#x73;&#101;&#114;&#x76;&#x65;&#x72;&#108;&#x65;&#x73;&#x73;&#64;&#x6c;&#x69;&#115;&#x74;&#115;&#46;&#x63;&#110;&#99;&#102;&#46;&#x69;&#x6f;">&#99;&#110;&#99;&#x66;&#45;&#119;&#103;&#x2d;&#x73;&#101;&#114;&#x76;&#x65;&#x72;&#108;&#x65;&#x73;&#x73;&#64;&#x6c;&#x69;&#115;&#x74;&#115;&#46;&#x63;&#110;&#99;&#102;&#46;&#x69;&#x6f;</a><br><br>ÈÄöÁî®ÂîØ‰∏ÄÁöÑURN‰∏éUUID<br>1.urn:uuid:6e8bc430-9c3a-11d9-9669-0800200c9a66<br><br>Â∫îÁî®ÁâπÂÆöÁöÑÊ†áËØÜÁ¨¶<br>1.&#x2F;cloudevents&#x2F;spec&#x2F;pull&#x2F;123<br>2.&#x2F;sensors&#x2F;tn-1234567&#x2F;alertsd.1-555-123-4567</td></tr></tbody></table><p><em><strong>specversion</strong></em></p><table><thead><tr><th align="left">Â±ûÊÄßÂêç</th><th align="left">specversion</th></tr></thead><tbody><tr><td align="left">Á±ªÂûã</td><td align="left">Â≠óÁ¨¶‰∏≤</td></tr><tr><td align="left">ÊèèËø∞</td><td align="left">‰∫ã‰ª∂ÊâÄ‰ΩøÁî®ÁöÑCloudEventsËßÑËåÉÁöÑÁâàÊú¨„ÄÇËØ•ÁâàÊú¨ÂèØÁî®‰∫éËß£Èáä‰∏ä‰∏ãÊñá„ÄÇ</td></tr><tr><td align="left">Á∫¶Êùü</td><td align="left">1. ÂøÖÈ°ª<br>2.ÂøÖÈ°ªÊòØ‰∏Ä‰∏™ÈùûÁ©∫Â≠óÁ¨¶‰∏≤<br>3.ÂøÖÈ°ªÂú®Áîü‰∫ßËÄÖËåÉÂõ¥ÂÜÖÊòØÂîØ‰∏ÄÁöÑ</td></tr></tbody></table><p><em><strong>type</strong></em></p><table><thead><tr><th align="left">Â±ûÊÄßÂêç</th><th align="left">type</th></tr></thead><tbody><tr><td align="left">Á±ªÂûã</td><td align="left">Â≠óÁ¨¶‰∏≤</td></tr><tr><td align="left">ÊèèËø∞</td><td align="left">ËØ•Â±ûÊÄßÂåÖÂê´‰∏Ä‰∏™ÊèèËø∞‰∫ã‰ª∂Á±ªÂûãÁöÑÂÄºÔºåÊèèËø∞‰∏éËµ∑Ê∫ê‰∫ã‰ª∂Áõ∏ÂÖ≥ÁöÑ‰∫ã‰ª∂Á±ªÂûã„ÄÇËØ•Â±ûÊÄßÈÄöÂ∏∏Áî®‰∫éË∑ØÁî±„ÄÅÁõëÊéß„ÄÅÁ≠ñÁï•ÊâßË°åÁ≠â„ÄÇËØ•Â±ûÊÄßÁöÑÊ†ºÂºèÊòØÁî±Áîü‰∫ßËÄÖÂÆö‰πâÁöÑ„ÄÇ</td></tr><tr><td align="left">Á∫¶Êùü</td><td align="left">1. ÂøÖÈ°ª<br>2.ÂøÖÈ°ªÊòØ‰∏Ä‰∏™ÈùûÁ©∫Â≠óÁ¨¶‰∏≤<br>3.Â∫îËØ•‰ª•‰∏Ä‰∏™ÂèçËΩ¨ÁöÑDNSÂêçÁß∞‰∏∫ÂâçÁºÄ„ÄÇÂâçÁºÄÂüüÂÜ≥ÂÆö‰∫ÜÂÆö‰πâËøô‰∏™‰∫ã‰ª∂Á±ªÂûãÁöÑËØ≠‰πâÁöÑÁªÑÁªá„ÄÇ</td></tr><tr><td align="left">ËåÉ‰æã</td><td align="left">a.com.github.pull.create<br>b.com.example.object.delete.v2</td></tr></tbody></table><h5 id="ÂèØÈÄâÂ±ûÊÄß"><a href="#ÂèØÈÄâÂ±ûÊÄß" class="headerlink" title="ÂèØÈÄâÂ±ûÊÄß"></a>ÂèØÈÄâÂ±ûÊÄß</h5><p>‰ª•‰∏ã‰∏∫Âú®CloudEvents‰∏≠Âá∫Áé∞ÁöÑÂèØÈÄâÂ±ûÊÄß„ÄÇ</p><p><em><strong>datacontenttype</strong></em></p><table><thead><tr><th align="left">Â±ûÊÄßÂêç</th><th align="left">datacontenttype</th></tr></thead><tbody><tr><td align="left">Á±ªÂûã</td><td align="left">Â≠óÁ¨¶‰∏≤</td></tr><tr><td align="left">ÊèèËø∞</td><td align="left">Êï∞ÊçÆÁöÑÂÜÖÂÆπÁ±ªÂûã„ÄÇËØ•Â±ûÊÄß‰ΩøÊï∞ÊçÆÂèØ‰ª•Êê∫Â∏¶‰ªª‰ΩïÁ±ªÂûãÁöÑÂÜÖÂÆπÔºåÂÖ∂Ê†ºÂºèÂíåÁºñÁ†ÅÂèØËÉΩ‰∏éÊâÄÈÄâ‰∫ã‰ª∂Ê†ºÂºè‰∏çÂêå„ÄÇ‰æãÂ¶ÇÔºå‰ΩøÁî®JSON‰ø°Â∞ÅÊ†ºÂºèÊ∏≤ÊüìÁöÑ‰∫ã‰ª∂ÂèØËÉΩ‰ºöÊê∫Â∏¶‰∏Ä‰∏™XMÁöÑÊï∞ÊçÆÔºåËøô‰∏™Â±ûÊÄßË¢´ËÆæÁΩÆ‰∏∫‚Äùapplication&#x2F;xml‚ÄùÂ∞±‰ºöÈÄöÁü•Ê∂àË¥πËÄÖ„ÄÇ‰∏çÂêåÁöÑÊï∞ÊçÆÂÜÖÂÆπÂ¶Ç‰ΩïÊ∏≤Êüì‰∏çÂêåÁöÑÊï∞ÊçÆÂÜÖÂÆπÁ±ªÂûãÂÄºÁöÑËßÑÂàôÂú®‰∫ã‰ª∂Ê†ºÂºèËßÑËåÉ‰∏≠ÂÆö‰πâ‰∫ÜÔºåÂØπ‰∫é‰∏Ä‰∫õ‰∫åËøõÂà∂Ê®°ÂºèÁöÑÂçèËÆÆÁªëÂÆöÔºåËØ•Â≠óÊÆµÁõ¥Êé•Êò†Â∞ÑÂà∞ÂêÑËá™ÂçèËÆÆÁöÑÂÜÖÂÆπÁ±ªÂûãÂÖÉÊï∞ÊçÆÂ±ûÊÄß„ÄÇ‰∫åËøõÂà∂Ê®°ÂºèÂíåÂÜÖÂÆπÁ±ªÂûãÂÖÉÊï∞ÊçÆÊò†Â∞ÑÁöÑËßÑËåÉÊÄßËßÑÂàôÂèØ‰ª•Âú®Áõ∏Â∫îÁöÑÂçèËÆÆ‰∏≠ÊâæÂà∞„ÄÇÂú®Êüê‰∫õ‰∫ã‰ª∂Ê†ºÂºè‰∏≠ÔºådatacontententtypeÂ±ûÊÄßÂèØËÉΩ‰ºöË¢´ÁúÅÁï•„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûú‰∏Ä‰∏™JSONÊ†ºÂºèÁöÑ‰∫ã‰ª∂Ê≤°ÊúâdatacontententtypeÂ±ûÊÄßÔºåÈÇ£‰πàÂ∞±ÊÑèÂë≥ÁùÄÊï∞ÊçÆÊòØÁ¨¶Âêà‚Äùapplication&#x2F;json‚ÄùÁ±ªÂûãÁöÑJSONÂÄº„ÄÇÊç¢Âè•ËØùËØ¥Ôºö‰∏Ä‰∏™Ê≤°ÊúâdatacontententtypeÁöÑJSONÊ†ºÂºè‰∫ã‰ª∂‰∏é‰∏Ä‰∏™datacontenttype&#x3D;‚Äùapplication&#x2F;json‚ÄùÁöÑ‰∫ã‰ª∂ÂÆåÂÖ®Á≠âÂêå„ÄÇÂΩìÂ∞Ü‰∏Ä‰∏™Ê≤°ÊúâdatacontenttypeÂ±ûÊÄßÁöÑ‰∫ã‰ª∂Ê∂àÊÅØÁøªËØëÊàê‰∏çÂêåÁöÑÊ†ºÂºèÊàñÂçèËÆÆÁªëÂÆöÊó∂ÔºåÁõÆÊ†ádatacontenttypeÂ∫îËØ•ÊòéÁ°ÆÂú∞ËÆæÁΩÆ‰∏∫Ê∫êÁöÑÈöêÂê´datacontenttype„ÄÇ</td></tr><tr><td align="left">Á∫¶Êùü</td><td align="left">1. ÂèØÈÄâ<br>2.Â¶ÇÊûúÂ≠òÂú®ÔºåÂøÖÈ°ªÈÅµÂÆàRFC 2046‰∏≠ËßÑÂÆöÁöÑÊ†ºÂºè„ÄÇ</td></tr></tbody></table><p><em><strong>dataschema</strong></em></p><table><thead><tr><th align="left">Â±ûÊÄßÂêç</th><th align="left">dataschema</th></tr></thead><tbody><tr><td align="left">Á±ªÂûã</td><td align="left">URI</td></tr><tr><td align="left">ÊèèËø∞</td><td align="left">ÊåáÊòéÊï∞ÊçÆÊâÄÈÅµÂæ™ÁöÑ schema„ÄÇÂØπÊ®°Âºè‰∏çÂÖºÂÆπÁöÑÊõ¥ÊîπÂ∫îËØ•ÈÄöËøá‰∏çÂêåÁöÑURIÊù•ÂèçÊò†„ÄÇ</td></tr><tr><td align="left">Á∫¶Êùü</td><td align="left">1. ÂèØÈÄâ <br>2.ÂøÖÈ°ªÊòØ‰∏Ä‰∏™ÈùûÁ©∫Â≠óÁ¨¶‰∏≤</td></tr></tbody></table><p><em><strong>subject</strong></em></p><table><thead><tr><th align="left">Â±ûÊÄßÂêç</th><th align="left">subject</th></tr></thead><tbody><tr><td align="left">Á±ªÂûã</td><td align="left">Â≠óÁ¨¶‰∏≤</td></tr><tr><td align="left">ÊèèËø∞</td><td align="left">ÊèèËø∞‰∫Ü‰∫ã‰ª∂Áîü‰∫ßËÄÖÔºàÈÄöËøá source Ê†áËØÜÔºâ‰∏ä‰∏ãÊñá‰∏≠ÁöÑ‰∫ã‰ª∂‰∏ªÈ¢ò„ÄÇÂú®ÂèëÂ∏É-ËÆ¢ÈòÖÂú∫ÊôØ‰∏≠ÔºåËÆ¢ÈòÖËÄÖÈÄöÂ∏∏‰ºöËÆ¢ÈòÖÁî±Ê∫êÂèëÂá∫ÁöÑ‰∫ã‰ª∂Ôºå‰ΩÜÂ¶ÇÊûúÊ∫ê‰∏ä‰∏ãÊñáÊúâÂÜÖÈÉ®Â≠êÁªìÊûÑÔºå‰ªÖÊúâÊ∫êÊ†áËØÜÁ¨¶ÂèØËÉΩ‰∏çË∂≥‰ª•‰Ωú‰∏∫‰ªª‰ΩïÁâπÂÆö‰∫ã‰ª∂ÁöÑÈôêÂÆöÁ¨¶„ÄÇ</td></tr><tr><td align="left">Á∫¶Êùü</td><td align="left">1.ÂèØÈÄâ<br>2.ÂøÖÈ°ªÊòØ‰∏Ä‰∏™ÈùûÁ©∫Â≠óÁ¨¶‰∏≤</td></tr><tr><td align="left">ËåÉ‰æã</td><td align="left">ÂΩìÂú®blob-Â≠òÂÇ®ÂÆπÂô®ÂÜÖÂàõÂª∫Êñ∞ÁöÑblobÊó∂ÔºåËÆ¢ÈòÖËÄÖÂèØËÉΩ‰ºöÂØπÊ≠§ËøõË°åËÆ¢ÈòÖ„ÄÇÂú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºå‰∫ã‰ª∂ source Ê†áËØÜ‰∫ÜËÆ¢ÈòÖËåÉÂõ¥ÔºàÂ≠òÂÇ®ÂÆπÂô®ÔºâÔºåtype Ê†áËØÜ‰∫Ü‚ÄùblobÂàõÂª∫‚Äù‰∫ã‰ª∂ÔºåidÂîØ‰∏ÄÊ†áËØÜ‰∫Ü‰∫ã‰ª∂ÂÆû‰æãÔºå‰ª•Âå∫ÂàÜÂ∑≤ÂàõÂª∫ÁöÑÁõ∏ÂêåÂêçÁß∞ÁöÑblobÔºõÊñ∞ÂàõÂª∫ÁöÑblobÁöÑÂêçÁß∞Êê∫Â∏¶Âú®subject‰∏≠„ÄÇ<br>sourceÔºö<a href="https://example.com/storage/tenant/container">https://example.com/storage/tenant/container</a><br>subject: mynewfile.jpg</td></tr></tbody></table><p><em><strong>time</strong></em></p><table><thead><tr><th align="left">Â±ûÊÄßÂêç</th><th align="left">time</th></tr></thead><tbody><tr><td align="left">Á±ªÂûã</td><td align="left">Timestamp</td></tr><tr><td align="left">ÊèèËø∞</td><td align="left">‰∫ã‰ª∂ÂèëÁîüÁöÑÊó∂Èó¥Êà≥„ÄÇÂ¶ÇÊûúÊó†Ê≥ïÁ°ÆÂÆö‰∫ã‰ª∂ÂèëÁîüÁöÑÊó∂Èó¥ÔºåÂàôËØ•Â±ûÊÄßÂèØ‰ª•Áî± CloudEvents Áîü‰∫ßËÄÖËÆæÁΩÆ‰∏∫ÂÖ∂‰ªñÊó∂Èó¥ÔºàÂ¶ÇÂΩìÂâçÊó∂Èó¥ÔºâÔºå‰ΩÜÂêå‰∏ÄÊ∫êÁöÑÊâÄÊúâÁîü‰∫ßËÄÖÂú®ËøôÊñπÈù¢ÂøÖÈ°ª‰øùÊåÅ‰∏ÄËá¥„ÄÇÊç¢Âè•ËØùËØ¥ÔºåÂÆÉ‰ª¨Ë¶Å‰πàÈÉΩ‰ΩøÁî®ÂÆûÈôÖÂèëÁîüÁöÑÊó∂Èó¥ÔºåË¶Å‰πàÈÉΩ‰ΩøÁî®Áõ∏ÂêåÁöÑÁÆóÊ≥ïÊù•Á°ÆÂÆöÊâÄ‰ΩøÁî®ÁöÑÂÄº„ÄÇ</td></tr><tr><td align="left">Á∫¶Êùü</td><td align="left">1.ÂøÖÈ°ª<br>2.Â¶ÇÊûúÂ≠òÂú®ÔºåÂøÖÈ°ªÈÅµÂÆàRFC 3339‰∏≠ËßÑÂÆöÁöÑÊ†ºÂºè„ÄÇ</td></tr></tbody></table><h5 id="Êâ©Â±ï‰∏ä‰∏ãÊñáÂ±ûÊÄß"><a href="#Êâ©Â±ï‰∏ä‰∏ãÊñáÂ±ûÊÄß" class="headerlink" title="Êâ©Â±ï‰∏ä‰∏ãÊñáÂ±ûÊÄß"></a>Êâ©Â±ï‰∏ä‰∏ãÊñáÂ±ûÊÄß</h5><p>CloudEventsÂèØÂåÖÂê´‰ªªÊÑèÊï∞ÈáèÁöÑÂÖ∑Êúâ‰∏çÂêåÂêçÁß∞ÁöÑÈôÑÂä†‰∏ä‰∏ãÊñáÂ±ûÊÄßÔºåÁß∞‰∏∫‚ÄùÊâ©Â±ïÂ±ûÊÄß‚Äù„ÄÇÊâ©Â±ïÂ±ûÊÄßÂøÖÈ°ªÈÅµÂæ™‰∏éÊ†áÂáÜÂ±ûÊÄßÁõ∏ÂêåÁöÑÂëΩÂêçÊÉØ‰æãÔºåÂπ∂‰ΩøÁî®‰∏éÊ†áÂáÜÂ±ûÊÄßÁõ∏ÂêåÁöÑÁ±ªÂûãÁ≥ªÁªü„ÄÇÊâ©Â±ïÂ±ûÊÄßÂú®Êú¨ËßÑËåÉ‰∏≠Ê≤°ÊúâÂÆö‰πâÁöÑÂê´‰πâÔºåÂÆÉ‰ª¨ÂÖÅËÆ∏Â§ñÈÉ®Á≥ªÁªüÂ∞ÜÂÖÉÊï∞ÊçÆÈôÑÂä†Âà∞‰∫ã‰ª∂‰∏≠ÔºåÂ∞±ÂÉèHTTPËá™ÂÆö‰πâÂ§¥‰∏ÄÊ†∑„ÄÇÊâ©Â±ïÂ±ûÊÄßÊÄªÊòØÊåâÁÖß‰∏éÊ†áÂáÜÂ±ûÊÄß‰∏ÄÊ†∑ÁöÑÁªëÂÆöËßÑÂàôËøõË°åÂ∫èÂàóÂåñ„ÄÇÁÑ∂ËÄåÔºåÊú¨ËßÑËåÉÂπ∂‰∏çÂ¶®Á¢çÊâ©Â±ïÂ∞Ü‰∫ã‰ª∂Â±ûÊÄßÂÄºÂ§çÂà∂Âà∞Ê∂àÊÅØÁöÑÂÖ∂‰ªñÈÉ®ÂàÜÔºå‰ª•‰æø‰∏éÂêåÊ†∑Â§ÑÁêÜÊ∂àÊÅØÁöÑÈùûCloudEventsÁ≥ªÁªüËøõË°å‰∫§‰∫í„ÄÇËøôÊ†∑ÂÅöÁöÑÊâ©Â±ïËßÑËåÉÂ∫îËØ•ÊåáÂÆöÂ¶ÇÊûúÂ§çÂà∂ÁöÑÂÄº‰∏é cloud event Â∫èÂàóÂåñÁöÑÂÄº‰∏çÂêåÔºåÊé•Êî∂ËÄÖÂ∫îËØ•Â¶Ç‰ΩïËß£ÈáäÊ∂àÊÅØ„ÄÇ</p><p>Êâ©Â±ïÁöÑÂÆö‰πâÂ∫îËØ•ÂÆö‰πâÂ±ûÊÄßÁöÑÊâÄÊúâÊñπÈù¢Ôºå‰æãÂ¶ÇÔºåÂÖ∂ÂêçÁß∞„ÄÅÁ±ªÂûã„ÄÅËØ≠‰πâÂíåÂèØËÉΩÁöÑÂÄº„ÄÇÊñ∞ÁöÑÊâ©Â±ïÂÆö‰πâÂ∫îËØ•‰ΩøÁî®‰∏Ä‰∏™ÊèèËø∞ÊÄßË∂≥Â§üÂº∫ÁöÑÂêçÁß∞Ôºå‰ª•ÂáèÂ∞ë‰∏éÂÖ∂‰ªñÊâ©Â±ïÂêçÁß∞ÂêåÂêçÁöÑÂèØËÉΩÊÄß„ÄÇ</p><p>ËÆ∏Â§öÂçèËÆÆÊîØÊåÅÂèëÈÄÅËÄÖÈôÑÂä†ÂÖÉÊï∞ÊçÆÁöÑËÉΩÂäõÔºå‰æãÂ¶Ç‰Ωú‰∏∫ HTTP Â§¥Êñá‰ª∂„ÄÇËôΩÁÑ∂ CloudEvents Êé•Êî∂ÊñπÊ≤°ÊúâË¢´Âº∫Âà∂Ë¶ÅÊ±Ç‰º†ÈÄíÂíåÂ§ÑÁêÜËøô‰∫õÂÖÉÊï∞ÊçÆÔºå‰ΩÜÂª∫ËÆÆÈÄöËøáÊüêÁßçÊú∫Âà∂Êù•Ëß£ÂÜ≥Ëøô‰∫õÂÖÉÊï∞ÊçÆÔºå‰ª•Ë°®ÊòéÂÆÉ‰ª¨ÊòØÈùûCloudEventsÂÖÉÊï∞ÊçÆ„ÄÇ</p><hr><h4 id="‰∫ã‰ª∂Êï∞ÊçÆ"><a href="#‰∫ã‰ª∂Êï∞ÊçÆ" class="headerlink" title="‰∫ã‰ª∂Êï∞ÊçÆ"></a>‰∫ã‰ª∂Êï∞ÊçÆ</h4><p>CloudEventsÂèØÂåÖÊã¨‰∏é‰∫ã‰ª∂ÂèëÁîüÁõ∏ÂÖ≥ÁöÑÁâπÂÆö‰ø°ÊÅØ„ÄÇÂ¶ÇÊûúÂ≠òÂú®ÔºåËØ•Á±ª‰ø°ÊÅØÂ∞ÜË¢´Â∞ÅË£ÖÂú®Êï∞ÊçÆ‰∏≠„ÄÇ</p><h5 id="ÈïøÂ∫¶ÈôêÂà∂"><a href="#ÈïøÂ∫¶ÈôêÂà∂" class="headerlink" title="ÈïøÂ∫¶ÈôêÂà∂"></a>ÈïøÂ∫¶ÈôêÂà∂</h5><p>Âú®ËÆ∏Â§öÂú∫ÊôØ‰∏≠ÔºåCloudEvents Â∞ÜÈÄöËøá‰∏Ä‰∏™ÊàñÂ§ö‰∏™‰∏≠Èó¥‰ª∂ËΩ¨ÂèëÔºåÊØè‰∏™‰∏≠Èó¥‰ª∂ÈÉΩÂèØËÉΩ‰ºöÂØπËΩ¨Âèë‰∫ã‰ª∂ÁöÑÂ§ßÂ∞èËøõË°åÈôêÂà∂„ÄÇCloudEvents‰πüÂèØËÉΩ‰ºöË¢´ËΩ¨ÂèëÂà∞Ê∂àË¥πËÄÖÔºåÊØîÂ¶ÇÂµåÂÖ•ÂºèËÆæÂ§áÔºåËøô‰∫õËÆæÂ§áÂèóÂ≠òÂÇ®ÊàñÂÜÖÂ≠òÈôêÂà∂„ÄÇ</p><p>‰∫ã‰ª∂ÁöÑ‚ÄùÂ§ßÂ∞è‚ÄùÊòØÊåá‰∫ã‰ª∂ÁöÑÁ∫ø‰∏äÂ§ßÂ∞èÔºåÂåÖÊã¨‰∫ã‰ª∂ÁöÑÁ∫ø‰∏ä‰º†ËæìÁöÑÊØè‰∏Ä‰∏™ÊØîÁâπÔºöÂçèËÆÆÂ∏ßÂÖÉÊï∞ÊçÆ„ÄÅ‰∫ã‰ª∂ÂÖÉÊï∞ÊçÆÂíå‰∫ã‰ª∂Êï∞ÊçÆÔºåÂü∫‰∫éÊâÄÈÄâÁöÑ‰∫ã‰ª∂Ê†ºÂºèÂèäÊâÄÈÄâÁöÑÁªëÂÆöÂçèËÆÆ„ÄÇ</p><p>Â¶ÇÊûúÂ∫îÁî®ÈÖçÁΩÆË¶ÅÊ±ÇÂú®‰∏çÂêåÁöÑÂçèËÆÆ‰πãÈó¥ËΩ¨Âèë‰∫ã‰ª∂ÔºåÊàñË¶ÅÊ±ÇÂØπ‰∫ã‰ª∂ËøõË°åÈáçÊñ∞ÁºñÁ†ÅÔºåÂàôÂ∫îËÄÉËôëÂ∫îÁî®ÊâÄ‰ΩøÁî®ÁöÑÊúÄÊúâÊïàÁöÑÂçèËÆÆÂíåÁºñÁ†ÅÔºå‰ª•Á¨¶ÂêàËøô‰∫õÂ§ßÂ∞èÈôêÂà∂„ÄÇ</p><ul><li>a.‰∏≠Èó¥‰ª∂ÂøÖÈ°ªËΩ¨ÂèëÂ§ßÂ∞è‰∏∫64KByteÊàñ‰ª•‰∏ãÁöÑ‰∫ã‰ª∂„ÄÇ</li><li>b.Ê∂àË¥πËÄÖÂ∫îÊé•ÂèóËá≥Â∞ë64 KByteÂ§ßÂ∞èÁöÑ‰∫ã‰ª∂„ÄÇ</li></ul><p>ÂÆûÈôÖ‰∏äÔºåËøô‰∫õËßÑÂàôÂ∞ÜÂÖÅËÆ∏Áîü‰∫ßËÄÖÂÆâÂÖ®Âú∞ÂèëÂ∏ÉÂ§ßÂ∞è‰∏çË∂ÖËøá64KBÁöÑ‰∫ã‰ª∂„ÄÇ</p><p>‰∏ÄËà¨Êù•ËØ¥ÔºåCloudEvents ÂèëÂ∏ÉËÄÖÂ∫îËØ•ÈÄöËøáÈÅøÂÖçÂú®‰∫ã‰ª∂ÊúâÊïàËΩΩËç∑‰∏≠ÂµåÂÖ•Â§ßÂûãÊï∞ÊçÆÈ°πÊù•‰øùÊåÅ‰∫ã‰ª∂ÁöÑÁ¥ßÂáëÊÄßÔºåËÄåÊòØ‰ΩøÁî®‰∫ã‰ª∂ÊúâÊïàËΩΩËç∑ÈìæÊé•Âà∞Ëøô‰∫õÊï∞ÊçÆÈ°π„ÄÇ‰ªéËÆøÈóÆÊéßÂà∂ÁöÑËßíÂ∫¶Êù•ÁúãÔºåËøôÁßçÊñπÊ≥ïËøòÂèØ‰ª•ËÆ©‰∫ã‰ª∂ÁöÑÂàÜÂ∏ÉËåÉÂõ¥Êõ¥ÂπøÔºåÂõ†‰∏∫ÈÄöËøáËß£ÊûêÈìæÊé•ËÆøÈóÆ‰∫ã‰ª∂Áõ∏ÂÖ≥ÁöÑÁªÜËäÇÔºåÂèØ‰ª•ÂÆûÁé∞Â∑ÆÂºÇÂåñÁöÑËÆøÈóÆÊéßÂà∂ÂíåÈÄâÊã©ÊÄßÁöÑÊä´Èú≤ÔºåËÄå‰∏çÊòØÁõ¥Êé•Â∞ÜÊïèÊÑüÁªÜËäÇÂµåÂÖ•‰∫ã‰ª∂‰∏≠„ÄÇ</p><h5 id="ÈöêÁßÅ‰∏éÂÆâÂÖ®"><a href="#ÈöêÁßÅ‰∏éÂÆâÂÖ®" class="headerlink" title="ÈöêÁßÅ‰∏éÂÆâÂÖ®"></a>ÈöêÁßÅ‰∏éÂÆâÂÖ®</h5><p>‰∫íÊìç‰ΩúÊÄßÊòØÊú¨ËßÑËåÉËÉåÂêéÁöÑ‰∏ªË¶ÅÈ©±Âä®ÂäõÔºåË¶ÅÂÆûÁé∞ËøôÊ†∑ÁöÑË°å‰∏∫ÔºåÈúÄË¶ÅÂ∞Ü‰∏Ä‰∫õ‰ø°ÊÅØÂÖ¨ÂºÄÔºåÂØºËá¥‰ø°ÊÅØÊ≥ÑÈú≤ÁöÑÂèØËÉΩÊÄß„ÄÇ</p><p>ËØ∑ËÄÉËôë‰ª•‰∏ãÂá†ÁÇπÔºå‰ª•Èò≤Ê≠¢‰∏çÁªèÊÑèÈó¥ÁöÑÊï∞ÊçÆÊ≥ÑÊºèÔºåÁâπÂà´ÊòØÂú®Âà©Áî®Á¨¨‰∏âÊñπÂπ≥Âè∞ÂèäÈÄö‰ø°ÁΩëÁªúÊó∂„ÄÇ</p><ol><li><p>‰∏ä‰∏ãÊñáÂ±ûÊÄß<br>ÊïèÊÑü‰ø°ÊÅØ‰∏çÂ∫îÂú®‰∏ä‰∏ãÊñáÂ±ûÊÄß‰∏≠Êê∫Â∏¶ÊàñË°®Á§∫„ÄÇ<br>CloudEventsÁîü‰∫ßËÄÖ„ÄÅÊ∂àË¥πËÄÖÂíå‰∏≠Èó¥‰∫∫ÂèØ‰ª•ÂÆ°Êü•Âπ∂ËÆ∞ÂΩï‰∏ä‰∏ãÊñáÂ±ûÊÄß„ÄÇ</p></li><li><p>Êï∞ÊçÆ<br>‰∏öÂä°Êï∞ÊçÆÂ∫îËøõË°åÂä†ÂØÜÔºå‰ª•ÈôêÂà∂Âèó‰ø°‰ªªÊñπÁöÑÂèØËßÅÊÄß„ÄÇÊï∞ÊçÆÂä†ÂØÜÊòØÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖ‰πãÈó¥ÁöÑÂçèËÆÆÔºå‰∏çÂ±û‰∫éÊú¨ËßÑËåÉÁöÑËåÉÂõ¥„ÄÇ</p></li><li><p>ÂçèËÆÆÁªëÂÆö<br>Â∫îÈááÁî®Â∑•‰∏öÁ∫ßÁöÑÂÆâÂÖ®ÊñπÊ°àÔºå‰ª•Á°Æ‰øùCloudEventsÁöÑÂèØ‰ø°ÂèäÂÆâÂÖ®ÁöÑ‰ø°ÊÅØ‰∫§Êç¢„ÄÇ</p></li></ol><hr><h2 id="ÂèÇËÄÉËµÑÊñô"><a href="#ÂèÇËÄÉËµÑÊñô" class="headerlink" title="ÂèÇËÄÉËµÑÊñô"></a>ÂèÇËÄÉËµÑÊñô</h2><ul><li><a href="https://www.bookstack.cn/read/serverless-handbook/core-function-code.md">function</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ÈöèÁùÄ‰∫ëÂéüÁîüÁöÑÂèëÂ±ïÔºà‰∫ëÂéüÁîüÁöÑ‰∏ã‰∏Ä‰∏™‰∫îÂπ¥Âú®Âì™ÈáåÔºüÔºâÔºåÈÄêÊ≠•ËøõÂÖ•Ê∑±Ê∞¥Âå∫Ôºå‰∏öÁïåÈúÄË¶Å‰∏ÄÁßçÁªü‰∏ÄÁöÑ‰∫ã‰ª∂ÂÆö‰πâÂíåÊèèËø∞ËßÑËåÉÔºå‰ª•Êèê‰æõË∑®ÊúçÂä°„ÄÅË∑®Âπ≥Âè∞ÁöÑ‰∫§‰∫íËÉΩÂäõ„ÄÇCloudEvents‰∫ã‰ª∂ËßÑËåÉÂ∫îËøêËÄåÁîüÔºåÂπ∂ÂæóÂà∞‰∫ÜË°å‰∏öÁöÑÂπøÊ≥õÂÖ≥Ê≥®ÔºåÂåÖÊã¨‰∏ªË¶ÅÁöÑ‰∫ëÊèê‰æõÂïÜÂíå SaaS ÂÖ¨Âè∏„ÄÇ&lt;br&gt;ÂØπ‰∫éCloudEventÁöÑ‰ªãÁªç</summary>
      
    
    
    
    <category term="serverless" scheme="https://zoues.com/categories/serverless/"/>
    
    
    <category term="serverless" scheme="https://zoues.com/tags/serverless/"/>
    
    <category term="cloudnative" scheme="https://zoues.com/tags/cloudnative/"/>
    
  </entry>
  
  <entry>
    <title>CloudEvents‰∏âÈÉ®Êõ≤:ÂàùËØÜÁØá</title>
    <link href="https://zoues.com/posts/744a240b/"/>
    <id>https://zoues.com/posts/744a240b/</id>
    <published>2020-12-20T12:40:08.000Z</published>
    <updated>2024-02-03T06:32:45.371Z</updated>
    
    <content type="html"><![CDATA[<p>ÈöèÁùÄ‰∫ëÂéüÁîüÁöÑÂèëÂ±ïÔºà‰∫ëÂéüÁîüÁöÑ‰∏ã‰∏Ä‰∏™‰∫îÂπ¥Âú®Âì™ÈáåÔºüÔºâÔºåÈÄêÊ≠•ËøõÂÖ•Ê∑±Ê∞¥Âå∫Ôºå‰∏öÁïåÈúÄË¶Å‰∏ÄÁßçÁªü‰∏ÄÁöÑ‰∫ã‰ª∂ÂÆö‰πâÂíåÊèèËø∞ËßÑËåÉÔºå‰ª•Êèê‰æõË∑®ÊúçÂä°„ÄÅË∑®Âπ≥Âè∞ÁöÑ‰∫§‰∫íËÉΩÂäõ„ÄÇCloudEvents‰∫ã‰ª∂ËßÑËåÉÂ∫îËøêËÄåÁîüÔºåÂπ∂ÂæóÂà∞‰∫ÜË°å‰∏öÁöÑÂπøÊ≥õÂÖ≥Ê≥®ÔºåÂåÖÊã¨‰∏ªË¶ÅÁöÑ‰∫ëÊèê‰æõÂïÜÂíå SaaS ÂÖ¨Âè∏„ÄÇ<br>ÂØπ‰∫éCloudEventÁöÑ‰ªãÁªç„ÄÅËßÑËåÉËØ¥ÊòéÂèäÂÆûË∑µËêΩÂú∞ÔºåÂ∞Ü‰ª•‰∏âÁØáÁ≥ªÂàóÊñáÁ´†ËøõË°åËØ¥ÊòéÔºåÊú¨Êñá‰∏∫„ÄäCloudEvent‰∏âÈÉ®Êõ≤:ÂàùËØÜÁØá„Äã.</p><hr><h4 id="‰∏Ä„ÄÅËßÑËåÉËÉåÊôØ"><a href="#‰∏Ä„ÄÅËßÑËåÉËÉåÊôØ" class="headerlink" title="‰∏Ä„ÄÅËßÑËåÉËÉåÊôØ"></a>‰∏Ä„ÄÅËßÑËåÉËÉåÊôØ</h4><h5 id="ÈúÄÊ±ÇËÉåÊôØ"><a href="#ÈúÄÊ±ÇËÉåÊôØ" class="headerlink" title="ÈúÄÊ±ÇËÉåÊôØ"></a>ÈúÄÊ±ÇËÉåÊôØ</h5><p>‰∫ã‰ª∂Âú®Á≥ªÁªüËÆæËÆ°‰∏≠Â∑≤ÁªèÂèòÁöÑÊó†Â§Ñ‰∏çÂú®Ôºå‰ΩÜÂêÑÁ±ª‰∫ã‰ª∂ÁöÑÊèê‰æõÊñπÂÄæÂêë‰∫é‰ª•‰∏çÂêåÁöÑÊñπÂºèÊù•ÊèèËø∞‰∫ã‰ª∂ÔºåÁº∫‰πè‰∏ÄÁßçÂØπ‰∫ã‰ª∂ÁöÑÁªü‰∏ÄÊèèËø∞Ôºå‰∫ã‰ª∂‰ΩøÁî®ÊñπÂíåÊèê‰æõÊñπÂæÄÂæÄË¶ÅËä±Ë¥πÂ§ßÈáèÁöÑÊó∂Èó¥Ê≤üÈÄöÂ≠óÊÆµÂÆö‰πâÔºåËÆæËÆ°‰∫ã‰ª∂Â±ûÊÄßÔºåÂπ∂Âú®Â∞ÜÊù•ÁöÑ‰ΩøÁî®ËøáÁ®ã‰∏≠Áñ≤‰∫éÊñ∞Â¢ûÊàñ‰øÆÊîπ‰∫ã‰ª∂ÁöÑÂ±ûÊÄß„ÄÇËøô‰πüÈôêÂà∂‰∫ÜÁ±ªÂ∫ì„ÄÅÂ∑•ÂÖ∑ÂíåÂü∫Á°ÄËÆæÊñΩÂú®Ë∑®ÁéØÂ¢ÉÊó∂ÂèëÈÄÅ‰∫ã‰ª∂Êï∞ÊçÆÁöÑÊΩúÂäõÔºåÂ¶ÇSDK„ÄÅ‰∫ã‰ª∂Ë∑ØÁî±Âô®ÊàñË∑üË∏™Á≥ªÁªüÁ≠â„ÄÇ</p><p>ÈöèÁùÄ‰∫ëÂéüÁîüÁöÑÂèëÂ±ïÔºà‰∫ëÂéüÁîüÁöÑ‰∏ã‰∏Ä‰∏™‰∫îÂπ¥Âú®Âì™ÈáåÔºüÔºâÔºåÈÄêÊ≠•ËøõÂÖ•Ê∑±Ê∞¥Âå∫Ôºå‰∏öÁïåÈúÄË¶Å‰∏ÄÁßçÁªü‰∏ÄÁöÑ‰∫ã‰ª∂ÂÆö‰πâÂíåÊèèËø∞ËßÑËåÉÔºå‰ª•Êèê‰æõË∑®ÊúçÂä°„ÄÅË∑®Âπ≥Âè∞ÁöÑ‰∫§‰∫íËÉΩÂäõ„ÄÇCloudEvents‰∫ã‰ª∂ËßÑËåÉÂ∫îËøêËÄåÁîüÔºåÂπ∂ÂæóÂà∞‰∫ÜË°å‰∏öÁöÑÂπøÊ≥õÂÖ≥Ê≥®ÔºåÂåÖÊã¨‰∏ªË¶ÅÁöÑ‰∫ëÊèê‰æõÂïÜÂíå SaaS ÂÖ¨Âè∏„ÄÇ</p><h5 id="ÂéÜÂè≤ËÉåÊôØ"><a href="#ÂéÜÂè≤ËÉåÊôØ" class="headerlink" title="ÂéÜÂè≤ËÉåÊôØ"></a>ÂéÜÂè≤ËÉåÊôØ</h5><p>CloudEvents ÊòØ‰∏ÄÁßç‰ª•ÈÄöÁî®ÊñπÂºèÊèèËø∞‰∫ã‰ª∂Êï∞ÊçÆÁöÑ‰æõÂ∫îÂïÜ‰∏≠Á´ãÁöÑËßÑËåÉÔºåËØ•‰∫ã‰ª∂Êï∞ÊçÆÂÆö‰πâËßÑËåÉÊó®Âú®ÁÆÄÂåñË∑®ÊúçÂä°ÔºåÂπ≥Âè∞ÂèäÂÖ∂‰ªñÊñπÈù¢ÁöÑ‰∫ã‰ª∂Â£∞ÊòéÂíåÂèëÈÄÅ„ÄÇ</p><p> CloudEvents ÁöÑÁõ∏ÂÖ≥Â∑•‰ΩúÊúÄÂàùÊòØ‰Ωú‰∏∫‰∫ëÂéüÁîüËÆ°ÁÆóÂü∫Èáë‰ºöÔºàCloud Native Computing FoundationÔºåÁÆÄÁß∞ CNCFÔºâServerlessÂ∑•‰ΩúÁªÑÁöÑ‰∏ÄÈÉ®ÂàÜÂºÄÂ±ïÁöÑÔºåÂΩìËßÑËåÉËææÂà∞v0.1ÁöÑÈáåÁ®ãÁ¢ë‰πãÂêéÔºå‰∫é2018Âπ¥5Êúà15Êó•Ëé∑ÂæóÊäÄÊúØÁõëÁù£ÂßîÂëò‰ºöÔºàTechnical Oversight CommitteeÔºåÁÆÄÁß∞ TOCÔºâÊâπÂáÜ‰Ωú‰∏∫‰∏Ä‰∏™ÂÖ®Êñ∞ÁöÑÁã¨Á´ãÁöÑCNCFÊ≤ôÁõíÈ°πÁõÆ„ÄÇ</p><p>2019Âπ¥10Êúà24Êó•ÔºåCloudEventsÈ°πÁõÆÂèñÂæó‰∫Ü‰∏§È°πÈáçÂ§ßÊàêÊûú„ÄÇÁ¨¨‰∏ÄÔºåCNCFÁöÑÊäÄÊúØÁõëÁù£ÂßîÂëò‰ºöÊâπÂáÜËØ•È°πÁõÆÊàê‰∏∫ ‚ÄúÂ≠µÂåñÂô®‚ÄúÈ°πÁõÆÔºà‰ªéËÄå‰ΩøÂÖ∂‰ªéCNCFÁöÑ‚ÄúÊ≤ôÁõí‚ÄùÊØï‰∏öÔºâ„ÄÇÁ¨¨‰∫åÔºåCloudEventsËßÑËåÉÂèëÂ∏É‰∫Ü1.0ÁâàÊú¨ÔºåËøôÊòØËØ•ËßÑËåÉÁöÑÁ¨¨‰∏Ä‰∏™‰∏ªË¶ÅÁâàÊú¨ÔºÅ</p><h6 id="Áé∞Áä∂"><a href="#Áé∞Áä∂" class="headerlink" title="Áé∞Áä∂"></a>Áé∞Áä∂</h6><p>ÁõÆÂâçÂêÑÂ§ßÁ¨¨‰∏âÊñπ‰∫ëÊèê‰æõÂïÜÈÉΩÂú®Â§ßÂäõÊé®ÂπøËêΩÂú∞CloudEventsËßÑËåÉÔºå‰æãÂ¶ÇÔºö</p><ul><li>2018Âπ¥ÔºåÂæÆËΩØÂÆ£Â∏ÉÂ∞ÜÈÄöËøáEvent GridÊúçÂä°Ôºà‰∏ÄÈ°πÁî±AzureÈõÜ‰∏≠ÁÆ°ÁêÜÁöÑ‰∫ã‰ª∂ÊúçÂä°ÔºåÊîØÊåÅÁî®Êà∑ÈÄöËøá‚ÄúÂèëÂ∏É-ËÆ¢ÈòÖ‚ÄùÊú∫Âà∂ÂèëÈÄÅÂíåÊé•Êî∂‰∫ã‰ª∂ÔºâÊèê‰æõÂØπCloudEventsÁöÑÊîØÊåÅ</li><li>2019Âπ¥ÔºåÈòøÈáå‰∫ëÂºÄÂßãÊé®Âπø OpenMessaging Ê†áÂáÜÂçèËÆÆÔºåÂ∏åÊúõËÆ© Apache RocketMQ ÂÖºÂÆπ Cloudevent ‰ΩìÁ≥ªÔºåÊàê‰∏∫ Serverless ÁöÑÊ°•Ê¢Å</li><li>2020Âπ¥ÔºåÂ≠óËäÇË∑≥Âä®Âú®ÂÖ∂ÂáΩÊï∞ËÆ°ÁÆó‰∫ßÂìÅ‰∏≠Âà©Áî®CloudEventsËßÑËåÉÁªü‰∏Ä‰∫ã‰ª∂Ê∫êÊ†áÂáÜÔºåÊûÅÂ§ßÊñπ‰æø‰πãÂêéÁöÑËÉΩÂäõÊâ©Â±ï„ÄÇ</li></ul><p>‰ΩÜÂ§ßÂ§öÊï∞‰∫ëÁõÆÂâçÁº∫‰πèCloudEventsËßÑËåÉÁöÑÁõ∏Â∫îÊîØÊåÅÔºåÂØºËá¥ÂêÑËÉΩÂäõÊúçÂä°‰πãÈó¥ÁöÑËÅîÂä®ÊïàÁéáËæÉÂ∑ÆÔºåËØ•ÈóÆÈ¢ò‰∏ûÂæÖËß£ÂÜ≥„ÄÇ</p><hr><h4 id="‰∫å„ÄÅËßÑËåÉ‰ºòÂäø"><a href="#‰∫å„ÄÅËßÑËåÉ‰ºòÂäø" class="headerlink" title="‰∫å„ÄÅËßÑËåÉ‰ºòÂäø"></a>‰∫å„ÄÅËßÑËåÉ‰ºòÂäø</h4><p>‰ªéÂéÜÂè≤‰∏äÁúãÔºåË°å‰∏öÁº∫‰πèÊèèËø∞Êó†ÊúçÂä°Âô®ÁöÑ‰∫ã‰ª∂ÂÖÉÊï∞ÊçÆÁöÑÊ†áÂáÜÔºåËøôÊÑèÂë≥ÁùÄÂºÄÂèë‰∫∫ÂëòÈúÄË¶ÅÈáçÊñ∞Â≠¶‰π†Â¶Ç‰ΩïË∑®Á≥ªÁªü‰ΩøÁî®ÂêÑÁßçÁ±ªÂûãÁöÑ‰∫ã‰ª∂Êï∞ÊçÆÔºå‰ªéËÄåÈöæ‰ª•ÊûÑÂª∫ÂèØÁßªÊ§çÁöÑÂ∑•ÂÖ∑„ÄÇ CloudEvents ÂÆö‰πâ‰∫Ü‰∏ÄÂ•ó‰∏ÄËá¥ÁöÑÂÖÉÊï∞ÊçÆÔºå‰∏îÈ¶ñÊ¨°Â∞Ü‰∏öÁïåÁöÑ‰∫ë‰æõÂ∫îÂïÜ„ÄÅ‰ºÅ‰∏öËΩØ‰ª∂Â∑®Â§¥ÂíåÂàùÂàõ‰ºÅ‰∏öÁöÑÊó†ÊúçÂä°Âô®Á§æÂå∫ËÅöÈõÜÂú®‰∏ÄËµ∑ÔºåÂÆûÁé∞Âπ∂ÊîØÊåÅËØ•ËßÑËåÉ„ÄÇ</p><p>CloudEvents ÂÖ∑ÊúâÂ¶Ç‰∏ã‰∏Ä‰∫õ‰ºòÂäøÔºö</p><h5 id="Ê∂àË¥π‰ºòÂäø"><a href="#Ê∂àË¥π‰ºòÂäø" class="headerlink" title="Ê∂àË¥π‰ºòÂäø"></a>Ê∂àË¥π‰ºòÂäø</h5><p>Áîü‰∫ßËÄÖÁîü‰∫ß‰∫ã‰ª∂‰æõÊ∂àË¥πËÄÖ‰ΩøÁî®Êó∂ÔºåÁî±‰∫é‰ΩøÁî®‰∫Ü CloudEvents ËßÑËåÉÔºåÊ∂àË¥πËÄÖ‰∏çÂÜçÈúÄË¶Å‰∏∫Âπ≥Âè∞ÊàñÊúçÂä°ÁöÑÂ∑ÆÂºÇÊÄßÁºñÂÜôÁâπÂÆöÁöÑÊ∂àË¥πÈÄªËæëÔºåÊîπËÄå‰ΩøÁî®ÈÄöÁî®ÈÄªËæëÂ§ÑÁêÜ‰∫ã‰ª∂Êï∞ÊçÆÔºåÊñπ‰æø‰∫ã‰ª∂Ê∂àË¥πËÄÖÊèêÈ´òÂºÄÂèëÊïàÁéáÔºåÂπ∂Èôç‰ΩéÁ≥ªÁªüÂ§çÊùÇÂ∫¶„ÄÇ‰æãÂ¶ÇÔºöÈòøÈáå‰∫ëÁöÑ‰∫ã‰ª∂ÊÄªÁ∫ø EventBridgeÔºåÂæÆËΩØAzureÁöÑEvent GridÊúçÂä°ÈÉΩÊûÅÂ§ßÊñπ‰æø‰∫Ü‰∫ßÂìÅÁöÑÁ´ØÂà∞Á´ØÈõÜÊàê„ÄÇ</p><h5 id="Ë∑ØÁî±‰ºòÂäø"><a href="#Ë∑ØÁî±‰ºòÂäø" class="headerlink" title="Ë∑ØÁî±‰ºòÂäø"></a>Ë∑ØÁî±‰ºòÂäø</h5><p>‰∏≠Èó¥‰ª∂Â∞Ü‰∫ã‰ª∂‰ªéÁîü‰∫ßËÄÖË∑ØÁî±Âà∞Ê∂àË¥πËÄÖÔºåÊàñËÄÖËΩ¨ÂèëÂà∞ÂÖ∂‰ªñ‰∏≠Èó¥‰ª∂ÁöÑÊó∂ÔºåCloudEvents‰ºö‰øùÁïô‰∫ã‰ª∂ÁöÑË∫´‰ªΩÂíåËØ≠‰πâÂÆåÊï¥ÊÄß„ÄÇ Áî®‰∫é‰∫ã‰ª∂ÁöÑÂàÜÁ±ªËøáÊª§ÊàñÂÖÉÊï∞ÊçÆÁöÑÈâ¥Âà´„ÄÇ‰æãÂ¶ÇÔºöÊ∂àË¥πËÄÖÂà©Áî®ËøáÊª§ÂäüËÉΩÂè™ÂÖ≥Ê≥®ÁâπÂÆöÁî®Êà∑ÔºõÊàñËÄÖÂà©Áî®ÂÖÉÊï∞ÊçÆÈâ¥Âà´Âè™Êé•Êî∂ÂêéÁºÄ‰∏∫ .doc ÁöÑÊñ∞Âª∫Êñá‰ª∂Á≠â„ÄÇ</p><p>Âà©Áî® CloudEvents‰∏≠Èó¥‰ª∂ÂèØ‰ª•Âú®ÊîπÂèò‰∫ã‰ª∂ÁöÑËØ≠‰πâÂê´‰πâÊó∂ÊâøÊãÖÁîüÊàêÂô®ÁöÑËßíËâ≤ÔºåÂú®Âü∫‰∫é‰∫ã‰ª∂ÈááÂèñË°åÂä®Êó∂ÊâøÊãÖÊ∂àË¥πËÄÖÁöÑËßíËâ≤ÔºåÊàñÂú®Ë∑ØÁî±‰∫ã‰ª∂‰∏çËøõË°åËØ≠‰πâÊõ¥ÊîπÊó∂ÊâøÊãÖ‰∏≠Èó¥‰ª∂ÁöÑËßíËâ≤„ÄÇ‰æãÂ¶ÇÔºö Apache RocketMQ Á§æÂå∫ÂèëÂ∏ÉÁöÑOpenMessaging Ê†áÂáÜÂçèËÆÆÂÖºÂÆπCloudEventsËßÑËåÉÔºå‰ªéËÄåÊàê‰∏∫ Serverless ÁöÑÊ°•Ê¢ÅÔºåÊõ¥Âä†È´òÊïàÂπøÊ≥õÁöÑËøõË°åÊ∂àÊÅØË∑ØÁî±„ÄÇ</p><h5 id="‰∫§‰∫í‰ºòÂäø"><a href="#‰∫§‰∫í‰ºòÂäø" class="headerlink" title="‰∫§‰∫í‰ºòÂäø"></a>‰∫§‰∫í‰ºòÂäø</h5><p>Âà©Áî® CloudEventsÁ≥ªÁªüÊ°ÜÊû∂ÂØπÂÜÖËß£ËÄ¶ÂêÑÊ®°ÂùóÁöÑÈÄö‰ø°ËÉΩÂäõÔºåÊèêÈ´òÂèØÁª¥Êä§ÊÄßÔºõÂØπÂ§ñ‰∏éÂÖ∂‰ªñ‰∫ã‰ª∂Âπ≥Âè∞Âü∫Á°ÄËÆæÊñΩÁöÑ‰∫§‰∫íÂ∞ÜÊõ¥ÁÆÄÂçïÔºåÂπ∂‰∏îÊñπ‰æø‰∏∫ÂÖ∂‰ªñÂπ≥Âè∞ËÆæÊñΩÊèê‰æõÈÄöÁî® APIÔºåÈôç‰Ωé‰∫§‰∫íÁöÑÂ§çÊùÇÊÄßÔºåÊèêÈ´òÁ≥ªÁªüÂπ≥Âè∞ÁöÑÊâ©Â±ïÊÄß„ÄÇ</p><hr><h4 id="‰∏â„ÄÅËêΩÂú∞Âú∫ÊôØ"><a href="#‰∏â„ÄÅËêΩÂú∞Âú∫ÊôØ" class="headerlink" title="‰∏â„ÄÅËêΩÂú∞Âú∫ÊôØ"></a>‰∏â„ÄÅËêΩÂú∞Âú∫ÊôØ</h4><p>CloudEvents Âú®Â¶Ç‰∏ãÂú∫ÊôØ‰∏≠ÊúâÂπøÊ≥õÁöÑÂ∫îÁî®‰ª∑ÂÄºÔºö</p><h5 id="Ë∑®Âπ≥Âè∞ÂíåÊúçÂä°ÁöÑ‰∫ã‰ª∂ËßÑËåÉÂåñ"><a href="#Ë∑®Âπ≥Âè∞ÂíåÊúçÂä°ÁöÑ‰∫ã‰ª∂ËßÑËåÉÂåñ" class="headerlink" title="Ë∑®Âπ≥Âè∞ÂíåÊúçÂä°ÁöÑ‰∫ã‰ª∂ËßÑËåÉÂåñ"></a>Ë∑®Âπ≥Âè∞ÂíåÊúçÂä°ÁöÑ‰∫ã‰ª∂ËßÑËåÉÂåñ</h5><p>‰∏çÂêåÁöÑ‰∫ëÊèê‰æõÂïÜÈÉΩÂú®ÂêÑËá™ÁöÑÂπ≥Âè∞‰∏ä‰ª•‰∏çÂêåÁöÑÊ†ºÂºèÂèëÂ∏É‰∫ã‰ª∂ÔºåÊ≠§Â§ñÂêå‰∏Ä‰∫ëÊèê‰æõÂïÜ‰∏äÁöÑ‰∏çÂêåÊúçÂä°‰πüÂèØËÉΩ‰ª•‰∏çÂêåÁöÑÊ†ºÂºèÂèëÂ∏É‰∫ã‰ª∂„ÄÇËøôÂ∞±Ëø´‰Ωø‰∫ã‰ª∂Ê∂àË¥πËÄÖ‰∏çÂæó‰∏çÈíàÂØπÂêÑÁ±ªÂπ≥Âè∞ÊàñÂêÑÁ±ªÊúçÂä°ÁºñÂÜôÈíàÂØπÊÄßÈÄªËæëÊù•Ê∂àË¥π‰∫ã‰ª∂Êï∞ÊçÆ„ÄÇËÄåCloudEvents ÂèØ‰ª•‰∏∫Â§ÑÁêÜË∑®Âπ≥Âè∞ÂíåË∑®ÊúçÂä°ÁöÑ‰∫ã‰ª∂ÁöÑÊ∂àË¥πËÄÖÊèê‰æõÁªü‰∏ÄÁöÑ‰ΩìÈ™å„ÄÇ</p><h5 id="‰∫ã‰ª∂ËøΩË∏™"><a href="#‰∫ã‰ª∂ËøΩË∏™" class="headerlink" title="‰∫ã‰ª∂ËøΩË∏™"></a>‰∫ã‰ª∂ËøΩË∏™</h5><p>‰ªé‰∫ã‰ª∂Ê∫êÂèëÈÄÅÁöÑ‰∫ã‰ª∂ÂèØËÉΩ‰ºöÂØºËá¥ÂêÑÁßç‰∏≠Èó¥‰ª∂ËÆæÂ§áÔºàÂ¶Ç‰∫ã‰ª∂‰ª£ÁêÜÂíåÁΩëÂÖ≥Ôºâ‰∫ßÁîüÁöÑÈôÑÂä†‰∫ã‰ª∂Â∫èÂàó„ÄÇÂà©Áî®CloudEvents ÂåÖÂê´‰∫ã‰ª∂ÁöÑÂÖÉÊï∞ÊçÆËøô‰∏ÄÁâπÊÄßÔºà‰æãÂ¶ÇÔºö‰∫ã‰ª∂ÁªèËøáÂ§ö‰∏™‰ª£ÁêÜÊó∂Ôºå‰ª£ÁêÜ‰ºöÂ∞ÜËá™Ë∫´IPËøΩÂä†Âà∞CloudEventsÊâ©Â±ïÂ±ûÊÄß‰∏≠ÔºåÊúÄÁªà‰∫ã‰ª∂Ê∂àË¥πËÄÖÂèØ‰ª•ÈÄöËøáÊâ©Â±ïÂ±ûÊÄß‰∏≠ÁöÑ IP ‰ø°ÊÅØÔºåÁü•ÈÅì‰∫ã‰ª∂ÁªèËøáÂì™‰∫õ‰ª£ÁêÜÔºâÔºåÂèØ‰ª•Â∞ÜËøô‰∫õÈôÑÂä†ÁöÑ‰∫ã‰ª∂‰ø°ÊÅØ‰Ωú‰∏∫Ê∫ê‰∫ã‰ª∂Â∫èÂàóÁöÑ‰∏ÄÈÉ®ÂàÜËøõË°åÂÖ≥ËÅîÔºå‰ªéËÄåËøõË°å‰∫ã‰ª∂ËøΩË∏™ÂíåÊïÖÈöúÊéíÈô§„ÄÇ</p><h5 id="ÊèêÈ´òServerlessÁöÑÂèØÁßªÊ§çÊÄß"><a href="#ÊèêÈ´òServerlessÁöÑÂèØÁßªÊ§çÊÄß" class="headerlink" title="ÊèêÈ´òServerlessÁöÑÂèØÁßªÊ§çÊÄß"></a>ÊèêÈ´òServerlessÁöÑÂèØÁßªÊ§çÊÄß</h5><p>ServerlessÔºà‰πüÁß∞Êó†ÊúçÂä°Âô®ËÆ°ÁÆóÔºâÊòØITÈ¢ÜÂüüÂèëÂ±ïÊúÄÂø´ÁöÑË∂ãÂäø‰πã‰∏ÄÔºåÂÆÉ‰∏ªË¶ÅÊòØÁî±‰∫ã‰ª∂È©±Âä®„ÄÇÁÑ∂ËÄåÔºå‰æõÂ∫îÂïÜÁöÑÈîÅÂÆöÊòØFaaSÁöÑ‰∏Ä‰∏™‰∏ªË¶ÅÈóÆÈ¢òÔºåËøôÁßçÈîÅÂÆöÈÉ®ÂàÜ‰∏ªË¶ÅÊòØÁî±‰∫éÂêÑ‰æõÂ∫îÂïÜÂáΩÊï∞ÂÜÖÈÉ®Êé•Êî∂‰∫ã‰ª∂Êï∞ÊçÆÁöÑÊ†ºÂºèÂ∑ÆÂºÇÈÄ†ÊàêÁöÑ„ÄÇCloudEvents ÂØπ‰∫ã‰ª∂Êï∞ÊçÆÁöÑÈÄöÁî®ÊèèËø∞ÊñπÂºèËß£ÂÜ≥‰∫ÜËØ•ÈóÆÈ¢òÔºå‰ªéËÄåÊèêÈ´ò‰∫ÜFaaSÁöÑÂèØÁßªÊ§çÊÄß„ÄÇ</p><p>ÂæÆËΩØAzureÁöÑEvent Grid‰∫ã‰ª∂ÊúçÂä°Êèê‰æõ‰∫ÜÂØπCloudEvensÁöÑÊîØÊåÅÔºåÁî®Êà∑ÂèØ‰ª•Â∞ÜËá™Â∑±ÁöÑCloudEventsÊé®ÈÄÅÂà∞ÊåáÂÆöÁöÑAzure Grid Event‰∏ªÈ¢òÔºàtopicÔºâ„ÄÇÊ≠§ÂêéÔºåGrid EventÊîØÊåÅÂ∞ÜÁ¨¶ÂêàCloudEventÊ®°ÂºèÁöÑ‰∫ã‰ª∂ËΩ¨Êç¢‰∏∫Á¨¶ÂêàÁâπÂÆöEvent GridÊ®°ÂºèÁöÑ‰∫ã‰ª∂ÔºåÊàñËÄÖÂèç‰πã„ÄÇ</p><hr><h4 id="ÂèÇËÄÉËµÑÊñô"><a href="#ÂèÇËÄÉËµÑÊñô" class="headerlink" title="ÂèÇËÄÉËµÑÊñô"></a>ÂèÇËÄÉËµÑÊñô</h4><ul><li><a href="https://www.bookstack.cn/read/serverless-handbook/core-function-code.md">function</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ÈöèÁùÄ‰∫ëÂéüÁîüÁöÑÂèëÂ±ïÔºà‰∫ëÂéüÁîüÁöÑ‰∏ã‰∏Ä‰∏™‰∫îÂπ¥Âú®Âì™ÈáåÔºüÔºâÔºåÈÄêÊ≠•ËøõÂÖ•Ê∑±Ê∞¥Âå∫Ôºå‰∏öÁïåÈúÄË¶Å‰∏ÄÁßçÁªü‰∏ÄÁöÑ‰∫ã‰ª∂ÂÆö‰πâÂíåÊèèËø∞ËßÑËåÉÔºå‰ª•Êèê‰æõË∑®ÊúçÂä°„ÄÅË∑®Âπ≥Âè∞ÁöÑ‰∫§‰∫íËÉΩÂäõ„ÄÇCloudEvents‰∫ã‰ª∂ËßÑËåÉÂ∫îËøêËÄåÁîüÔºåÂπ∂ÂæóÂà∞‰∫ÜË°å‰∏öÁöÑÂπøÊ≥õÂÖ≥Ê≥®ÔºåÂåÖÊã¨‰∏ªË¶ÅÁöÑ‰∫ëÊèê‰æõÂïÜÂíå SaaS ÂÖ¨Âè∏„ÄÇ&lt;br&gt;ÂØπ‰∫éCloudEventÁöÑ‰ªãÁªç</summary>
      
    
    
    
    <category term="serverless" scheme="https://zoues.com/categories/serverless/"/>
    
    
    <category term="serverless" scheme="https://zoues.com/tags/serverless/"/>
    
    <category term="cloudnative" scheme="https://zoues.com/tags/cloudnative/"/>
    
  </entry>
  
</feed>
